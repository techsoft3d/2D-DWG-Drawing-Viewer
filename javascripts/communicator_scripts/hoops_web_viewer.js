var __assign=this&&this.__assign||function(){__assign=Object.assign||function(d){for(var h,g=1,a=arguments.length;g<a;g++){h=arguments[g];for(var e in h)Object.prototype.hasOwnProperty.call(h,e)&&(d[e]=h[e])}return d};return __assign.apply(this,arguments)},Communicator;
(function(d){(function(h){var g=function(){function a(a){this.name=a;this.nodeChannels=[];this.cameraChannels=[];this.pivotPoints=new Map}a.prototype.createNodeChannel=function(a,c,b,f){a=new h.NodeChannel(a,c,b,f);this._registerNodeChannel(a);return a};a.prototype._registerNodeChannel=function(a){this.nodeChannels.push(a)};a.prototype.createCameraChannel=function(a,c,b){a=new h.CameraChannel(a,c,b);this._registerCameraChannel(a);return a};a.prototype._registerCameraChannel=function(a){this.cameraChannels.push(a)};
a.prototype.deleteChannel=function(a){for(var c=0;c<this.nodeChannels.length;c++)if(this.nodeChannels[c]===a){this.nodeChannels.splice(c,1);return}for(c=0;c<this.cameraChannels.length;c++)if(this.cameraChannels[c]===a){this.cameraChannels.splice(c,1);break}};a.prototype._gatherForExport=function(a){for(var c=0,b=this.nodeChannels;c<b.length;c++){var f=b[c];f._gatherForExport(a)}c=0;for(b=this.cameraChannels;c<b.length;c++)f=b[c],f._gatherForExport(a)};a.prototype._export=function(a){var c=this,b=
[],f={};""!==this.name&&(f.name=this.name);var k={},e=function(b){if(0!==c[b].length){for(var f=[],e=0,d=c[b];e<d.length;e++)f.push(d[e]._export(a));k[b]=f}};this.pivotPoints.forEach(function(c,f){b.push({node:f,point:c})});0!==b.length&&(f.pivotPoints=b);e("nodeChannels");e("cameraChannels");return __assign({},f,k)};a._import=function(e,c){var b=new a(c.name||"");if(void 0!==c.nodeChannels)for(var f=0,k=c.nodeChannels;f<k.length;f++){var l=k[f];b._registerNodeChannel(h.NodeChannel._import(e,l))}if(void 0!==
c.cameraChannels)for(f=0,k=c.cameraChannels;f<k.length;f++)l=k[f],b._registerCameraChannel(h.CameraChannel._import(e,l));if(void 0!==c.pivotPoints)for(e=0,c=c.pivotPoints;e<c.length;e++)l=c[e],f=d.Point3.fromJson(l.point),b.pivotPoints.set(l.node,f);return b};return a}();h.Animation=g})(d.Animation||(d.Animation={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g;(function(c){c[c.Translation=0]="Translation";c[c.Rotation=1]="Rotation";c[c.Scale=2]="Scale";c[c.Opacity=3]="Opacity";c[c.Visibility=4]="Visibility";c[c.Color=5]="Color";c[c.ColorMap=6]="ColorMap"})(g=h.NodeProperty||(h.NodeProperty={}));var a=function(){function c(b,c,k,a){this.name=b;this.nodeId=c;this.property=k;this.sampler=a;switch(this.property){case g.Translation:case g.Scale:case g.Color:if(a.buffer.keyType!==h.KeyType.Vec3)throw Error("Key type mismatch. Expected Vec3");
break;case g.Rotation:if(a.buffer.keyType!==h.KeyType.Quat)throw Error("Key type mismatch. Expected Quat");break;case g.Opacity:case g.Visibility:case g.ColorMap:if(a.buffer.keyType!==h.KeyType.Scalar)throw Error("Key type mismatch. Expected Scalar");}}c.prototype._getValue=function(b,c){switch(this.property){case g.Translation:this.sampler.interpolateVec3(b,c.translate);c.flags|=h.Internal.NodeValuesFlags.Transform;break;case g.Rotation:this.sampler.interpolateQuat(b,c.rotation);c.flags|=h.Internal.NodeValuesFlags.Transform;
break;case g.Scale:this.sampler.interpolateVec3(b,c.scale);c.flags|=h.Internal.NodeValuesFlags.Transform;break;case g.Opacity:c.opacity=this.sampler.interpolateScalar(b);c.flags|=h.Internal.NodeValuesFlags.Opacity;break;case g.Visibility:c.visibility=this.sampler.interpolateScalar(b);c.flags|=h.Internal.NodeValuesFlags.Visibility;break;case g.Color:this.sampler.interpolateVec3(b,c.color);c.flags|=h.Internal.NodeValuesFlags.Color;break;case g.ColorMap:b=this.sampler.interpolateScalar(b),b=this._getColorFromMap(b),
null!==b&&(c.color.set(b.r,b.g,b.b),c.flags|=h.Internal.NodeValuesFlags.Color)}};c.prototype._getColorFromMap=function(b){if(void 0===this.colorMap)return null;0>b&&(b=0);1<b&&(b=1);for(var c=0;c<this.colorMap.length-1;){var k=this.colorMap[c].position,a=this.colorMap[c].color,e=this.colorMap[c+1].position,g=this.colorMap[c+1].color;if(b<=k)return a;if(b<=e)return b=(b-k)/(e-k),new d.Color((1-b)*a.r+b*g.r,(1-b)*a.g+b*g.g,(1-b)*a.b+b*g.b);if(b>=e&&c===this.colorMap.length-2)return g;++c}return null};
c.prototype._gatherForExport=function(b){void 0!==this.colorMap&&b.colorMaps.add(this.colorMap);b.samplers.add(this.sampler);this.sampler._gatherForExport(b)};c.prototype._export=function(b){var c={};""!==this.name&&(c.name=this.name);void 0!==this.colorMap&&(c.colorMap=b.colorMaps.getIndex(this.colorMap));return __assign({nodeId:this.nodeId,property:g[this.property],sampler:b.samplers.getIndex(this.sampler)},c)};c._import=function(b,f){var k=new c(f.name||"",f.nodeId,g[f.property],b.samplers[f.sampler]);
void 0!==f.colorMap&&(k.colorMap=b.colorMaps[f.colorMap]);return k};return c}();h.NodeChannel=a;var e;(function(c){c[c.Position=0]="Position";c[c.Target=1]="Target";c[c.Up=2]="Up";c[c.Width=3]="Width";c[c.Height=4]="Height"})(e=h.CameraProperty||(h.CameraProperty={}));a=function(){function c(b,c,k){this.name=b;this.property=c;this.sampler=k;switch(this.property){case e.Position:case e.Target:case e.Up:if(k.buffer.keyType!==h.KeyType.Vec3)throw Error("Key type mismatch. Expected Vec3");break;case e.Width:case e.Height:if(k.buffer.keyType!==
h.KeyType.Scalar)throw Error("Key type mismatch. Expected Scalar");}}c.prototype._getValue=function(b,c){switch(this.property){case e.Position:null===c.position&&(c.position=new d.Point3(0,0,0));this.sampler.interpolateVec3(b,c.position);break;case e.Target:null===c.target&&(c.target=new d.Point3(0,0,-1));this.sampler.interpolateVec3(b,c.target);break;case e.Up:null===c.up&&(c.up=new d.Point3(0,1,0));this.sampler.interpolateVec3(b,c.up);break;case e.Width:c.width=this.sampler.interpolateScalar(b);
break;case e.Height:c.height=this.sampler.interpolateScalar(b)}};c.prototype._gatherForExport=function(b){b.samplers.add(this.sampler);this.sampler._gatherForExport(b)};c.prototype._export=function(b){var c={};""!==this.name&&(c.name=this.name);return __assign({property:e[this.property],sampler:b.samplers.getIndex(this.sampler)},c)};c._import=function(b,f){return new c(f.name||"",e[f.property],b.samplers[f.sampler])};return c}();h.CameraChannel=a})(d.Animation||(d.Animation={}))})(Communicator||(Communicator=
{}));
(function(d){(function(h){function g(a){for(var c=[],b=0;b<a.length;b++){var f=a[b];c.push([f.position,f.color.r,f.color.g,f.color.b])}return c}function a(a){for(var c=[],b=0;b<a.length;b++){var f=a[b];c.push({position:f[0],color:new d.Color(f[1],f[2],f[3])})}return c}h.exportAnimations=function(a){for(var c=new h.Internal.ExportContext,b=0;b<a.length;b++){var f=a[b];f._gatherForExport(c)}b={};if(!c.buffers.isEmpty()){b.buffers=[];f=0;for(var k=c.buffers.toArray();f<k.length;f++)b.buffers.push(k[f]._export())}if(!c.samplers.isEmpty())for(b.samplers=[],
f=0,k=c.samplers.toArray();f<k.length;f++)b.samplers.push(k[f]._export(c));if(!c.colorMaps.isEmpty())for(b.colorMaps=[],f=0,k=c.colorMaps.toArray();f<k.length;f++)b.colorMaps.push(g(k[f]));if(0!==a.length)for(b.animations=[],k=0;k<a.length;k++)f=a[k],b.animations.push(f._export(c));return __assign({},b)};h.importAnimations=function(e){var c=new h.Internal.ImportContext;if(void 0!==e.buffers)for(var b=0,f=e.buffers;b<f.length;b++)c.buffers.push(h.KeyframeBuffer._import(f[b]));if(void 0!==e.samplers)for(b=
0,f=e.samplers;b<f.length;b++)c.samplers.push(h.Sampler._import(c,f[b]));if(void 0!==e.colorMaps)for(b=0,f=e.colorMaps;b<f.length;b++)c.colorMaps.push(a(f[b]));b=[];if(void 0!==e.animations)for(f=0,e=e.animations;f<e.length;f++)b.push(h.Animation._import(c,e[f]));return b}})(d.Animation||(d.Animation={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){return function(){this.buffers=new e;this.samplers=new e;this.colorMaps=new e}}();g.ExportContext=a;a=function(){return function(){this.buffers=[];this.samplers=[];this.colorMaps=[]}}();g.ImportContext=a;var e=function(){function c(){this.map=new Map}c.prototype.add=function(b){this.map.has(b)||this.map.set(b,this.map.size)};c.prototype.getIndex=function(b){b=this.map.get(b);if(void 0===b)throw new d.InternalLogicError;return b};c.prototype.toArray=
function(){var b=[];this.map.forEach(function(c,k){b[c]=k});return b};c.prototype.isEmpty=function(){return 0===this.map.size};return c}();g.IndexedSet=e})(h.Internal||(h.Internal={}))})(d.Animation||(d.Animation={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g;(function(a){a[a.Scalar=1]="Scalar";a[a.Vec3=3]="Vec3";a[a.Quat=4]="Quat"})(g=d.KeyType||(d.KeyType={}));var a=function(){function a(c){this.keyType=c;this.times=[];this.values=[];this.tangents=[];this._hasTangents=null;this.keyOffset=c}a.prototype._validateKey=function(c){if(this.keyType!==c)throw Error("Cannot add keyframe of type: "+g[c]+" to buffer of type: "+g[this.keyType]);};a.prototype._validateTangents=function(c){if(null===this._hasTangents)this._hasTangents=
c;else if(this._hasTangents!==c)throw Error("Cannot add keyframe with"+(c?"":"out")+" tangents to buffer with"+(c?"out":"")+" tangents");};a.prototype.getKeyframeIndex=function(c){return this.times.indexOf(c)};a.prototype.deleteKeyframe=function(c){this.times.splice(c,1);this.tangents.splice(c*this.keyOffset*2,2*this.keyOffset);this.values.splice(c*this.keyOffset,this.keyOffset)};a.prototype.appendScalarKeyframe=function(c,b,f,k){this._validateKey(g.Scalar);this.times.push(c);this.values.push(b);
void 0!==f&&void 0!==k?(this._validateTangents(!0),this.tangents.push(f),this.tangents.push(k)):this._validateTangents(!1)};a.prototype.insertScalarKeyframe=function(c,b,f,k,a){this.times.splice(c,0,b);this.values.splice(c,0,f);void 0!==k&&void 0!==a?(this._validateTangents(!0),this.tangents.splice(2*c,0,k,a)):this._validateTangents(!1)};a.prototype.updateScalarKeyframe=function(c,b,f,a,e){this.values[c]=f;this.times[c]=b;void 0!==a&&void 0!==e&&(this.tangents[2*c]=a,this.tangents[2*c+1]=e)};a.prototype.appendVec3Keyframe=
function(c,b,f,a,e,d,m,p,q,h){this._validateKey(g.Vec3);this.times.push(c);this.values.push(b);this.values.push(f);this.values.push(a);void 0!==e&&void 0!==d&&void 0!==m&&void 0!==p&&void 0!==q&&void 0!==h?(this._validateTangents(!0),this.tangents.push(e),this.tangents.push(d),this.tangents.push(m),this.tangents.push(p),this.tangents.push(q),this.tangents.push(h)):this._validateTangents(!1)};a.prototype.insertVec3Keyframe=function(c,b,f,a,e,d,g,p,q,h,u){this.times.splice(c,0,b);this.values.splice(c*
this.keyOffset,0,f,a,e);void 0!==d&&void 0!==g&&void 0!==p&&void 0!==q&&void 0!==h&&void 0!==u?(this._validateTangents(!0),this.tangents.splice(c*this.keyOffset*2,d,g,p,q,h,u)):this._validateTangents(!1)};a.prototype.updateVec3Keyframe=function(c,b,f,a,e,d,g,p,q,h,u){this.times[c]=b;this.values[c*this.keyOffset]=f;this.values[c*this.keyOffset+1]=a;this.values[c*this.keyOffset+2]=e;void 0!==d&&void 0!==g&&void 0!==p&&void 0!==q&&void 0!==h&&void 0!==u?(this._validateTangents(!0),this.tangents.splice(c*
this.keyOffset*2,d,g,p,q,h,u),this.tangents[c*this.keyOffset*2]=d,this.tangents[c*this.keyOffset*2+1]=g,this.tangents[c*this.keyOffset*2+2]=p,this.tangents[c*this.keyOffset*2+3]=q,this.tangents[c*this.keyOffset*2+4]=h,this.tangents[c*this.keyOffset*2+5]=u):this._validateTangents(!1)};a.prototype.appendQuatKeyframe=function(c,b,f,a,e,d,m,p,q,h,u,t,v){this._validateKey(g.Quat);this.times.push(c);this.values.push(b);this.values.push(f);this.values.push(a);this.values.push(e);void 0!==d&&void 0!==m&&
void 0!==p&&void 0!==q&&void 0!==h&&void 0!==u&&void 0!==t&&void 0!==v?(this._validateTangents(!0),this.tangents.push(d),this.tangents.push(m),this.tangents.push(p),this.tangents.push(q),this.tangents.push(h),this.tangents.push(u),this.tangents.push(t),this.tangents.push(v)):this._validateTangents(!1)};a.prototype.insertQuatKeyframe=function(c,b,f,a,e,d,g,p,q,h,u,t,v,w){this.times.splice(c,0,b);this.values.splice(c*this.keyOffset,0,f,a,e,d);void 0!==g&&void 0!==p&&void 0!==q&&void 0!==h&&void 0!==
u&&void 0!==t&&void 0!==v&&void 0!==w?(this._validateTangents(!0),this.tangents.splice(c*this.keyOffset*2,g,p,q,u,t,v)):this._validateTangents(!1)};a.prototype.updateQuatKeyframe=function(c,b,f,a,e,d,g,p,q,h,u,t,v,w){this.times[c]=b;this.values[c*this.keyOffset]=f;this.values[c*this.keyOffset+1]=a;this.values[c*this.keyOffset+2]=e;this.values[c*this.keyOffset+3]=d;void 0!==g&&void 0!==p&&void 0!==q&&void 0!==h&&void 0!==u&&void 0!==t&&void 0!==v&&void 0!==w?(this._validateTangents(!0),this.tangents.splice(c*
this.keyOffset*2,g,p,q,u,t,v),this.tangents[c*this.keyOffset*2]=g,this.tangents[c*this.keyOffset*2+1]=p,this.tangents[c*this.keyOffset*2+2]=q,this.tangents[c*this.keyOffset*2+3]=w,this.tangents[c*this.keyOffset*2+4]=u,this.tangents[c*this.keyOffset*2+5]=t,this.tangents[c*this.keyOffset*2+5]=v,this.tangents[c*this.keyOffset*2+5]=w):this._validateTangents(!1)};a.prototype._export=function(){var c={};0!==this.tangents.length&&(c.tangents=this.tangents.slice());return __assign({keyType:g[this.keyType],
times:this.times.slice(),values:this.values.slice()},c)};a._import=function(c){var b=new a(g[c.keyType]);b.times=c.times.slice();b.values=c.values.slice();void 0!==c.tangents&&(b.tangents=c.tangents.slice());return b};return a}();d.KeyframeBuffer=a})(d.Animation||(d.Animation={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(a){var c=this;this._viewer=a;this._players=[];this._intervalHandle=null;this._batch=new d.BatchedValues;this._viewer.setCallbacks({assemblyTreeReady:function(){c.setTickInterval(50)}})}a.prototype.createPlayer=function(a){a=new d.Player(this._viewer,a);this._players.push(a);return a};a.prototype.clear=function(){this._players=[]};a.prototype._tick=function(){if(0!==this._players.length){this._batch.clear();for(var a=!1,c=performance.now(),b=0,
f=this._players;b<f.length;b++)f[b]._tick(c,this._batch)&&(a=!0);a&&(this._viewer.pauseRendering(),this._batch.apply(this._viewer),this._viewer.resumeRendering())}};a.prototype._shutdown=function(){null!==this._intervalHandle&&clearInterval(this._intervalHandle)};a.prototype.setTickInterval=function(a){var c=this;this._intervalHandle&&clearInterval(this._intervalHandle);this._intervalHandle=setInterval(function(){c._tick()},a)};return a}();d.Manager=g})(d.Animation||(d.Animation={}))})(Communicator||
(Communicator={}));
(function(d){(function(h){var g;(function(a){a[a.Stopped=0]="Stopped";a[a.Playing=1]="Playing";a[a.Paused=2]="Paused";a[a.Complete=3]="Complete"})(g=h.PlayerState||(h.PlayerState={}));var a=function(){function a(c,b){this._viewer=c;this._animation=b;this._nodeValues=new Map;this._disabledChannels=new Set;this._lastUpdate=this._currentTime=0;this.speed=1;this._animationTime=0;this._state=g.Stopped;this._loopCount=this.loop=0;this.onComplete=null;this.nodeIdOffset=0;this.reload()}a.prototype.setChannelEnabled=
function(c,b){b?this._disabledChannels.delete(c):this._disabledChannels.add(c)};a.prototype.reload=function(){this._nodeValues.clear();for(var c=this._animationTime=0,b=this._animation.nodeChannels;c<b.length;c++){var f=b[c],a=f.sampler.buffer.times.length;if(0!==a){if(!this._nodeValues.has(f.nodeId)){var e=new h.Internal.NodeValues(f.nodeId);e.pivotPoint=this._animation.pivotPoints.get(f.nodeId);this._nodeValues.set(f.nodeId,e)}this._animationTime=Math.max(this._animationTime,f.sampler.buffer.times[a-
1])}}c=0;for(b=this._animation.cameraChannels;c<b.length;c++)f=b[c],a=f.sampler.buffer.times.length,0!==a&&(this._animationTime=Math.max(this._animationTime,f.sampler.buffer.times[a-1]))};a.prototype._tick=function(c,b){if(this._state!==g.Playing)return!1;this._tickTime((c-this._lastUpdate)/1E3,b);this._lastUpdate=c;return!0};a.prototype._tickTime=function(c,b){if(this._state!==g.Playing)return!1;this._currentTime+=c*this.speed;c=0>this._currentTime;var f=this._currentTime>this._animationTime;if(c||
f)if(0>this.loop||this.loop>this._loopCount)this._loopCount+=1,this._currentTime=c?this._animationTime:0,this.evaluate(this._currentTime,b);else{if(this._currentTime=this._animationTime,this.evaluate(this._currentTime,b),this._state=g.Complete,this._loopCount=0,this.onComplete)this.onComplete()}else this.evaluate(this._currentTime,b);return!0};a.prototype.play=function(){this._state!==g.Playing&&(this._state===g.Complete&&(this._currentTime=0),this._lastUpdate=performance.now(),this._state=g.Playing)};
a.prototype.pause=function(){this._state===g.Playing&&(this._state=g.Paused)};a.prototype.stop=function(){this._state=g.Stopped;this.setTime(0)};a.prototype.setTime=function(c){var b=new h.BatchedValues;this._currentTime=Math.min(c,this._animationTime);this.evaluate(this._currentTime,b);b.apply(this._viewer)};a.prototype.evaluate=function(c,b){var f=this;void 0===b&&(b=new h.BatchedValues);for(var a=0,e=this._animation.nodeChannels;a<e.length;a++){var n=e[a],g=this._nodeValues.get(n.nodeId);void 0===
g||this._disabledChannels.has(n)||n._getValue(c,g)}this._nodeValues.forEach(function(c){if(void 0===b)throw new d.InternalLogicError;var a=c.nodeId+f.nodeIdOffset;(c.flags&h.Internal.NodeValuesFlags.Transform)===h.Internal.NodeValuesFlags.Transform&&(c.updateMatrix(),b.node.matrixNodeIds.push(a),b.node.matrices.push(c.matrix));(c.flags&h.Internal.NodeValuesFlags.Opacity)===h.Internal.NodeValuesFlags.Opacity&&b.node.opacities.set(a,c.opacity);(c.flags&h.Internal.NodeValuesFlags.Visibility)===h.Internal.NodeValuesFlags.Visibility&&
(0!==c.visibility?b.node.visibilityOn.push(a):b.node.visibilityOff.push(a));(c.flags&h.Internal.NodeValuesFlags.Color)===h.Internal.NodeValuesFlags.Color&&b.node.colors.set(a,new d.Color(c.color.x,c.color.y,c.color.z));c.flags=h.Internal.NodeValuesFlags.None});a=0;for(e=this._animation.cameraChannels;a<e.length;a++)n=e[a],0<n.sampler.buffer.times.length&&!this._disabledChannels.has(n)&&n._getValue(c,b.camera);return b};a.prototype.getState=function(){return this._state};a.prototype.getCurrentTime=
function(){return this._currentTime};a.prototype.getAnimationTime=function(){return this._animationTime};a.LoopIndefinitely=-1;return a}();h.Player=a})(d.Animation||(d.Animation={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(a,e,c){this.x=a;this.y=e;this.z=c}d.prototype.assign=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};d.prototype.set=function(a,e,c){this.x=a;this.y=e;this.z=c;return this};d.prototype.toArray=function(a){a[0]=this.x;a[1]=this.y;a[2]=this.z};d.prototype.fromArray=function(a){this.x=a[0];this.y=a[1];this.z=a[2];return this};d.prototype.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this};d.prototype.subtract=function(a){this.x-=a.x;this.y-=
a.y;this.z-=a.z;return this};d.prototype.copy=function(){return new d(this.x,this.y,this.z)};d.fromJson=function(a){return new d(a.x,a.y,a.z)};d.construct=function(a){return d.fromJson(a)};d.prototype.toJson=function(){return this._toJson()};d.prototype._toJson=function(){return{x:this.x,y:this.y,z:this.z}};d.prototype.forJson=function(){return this.toJson()};d.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.z===a.z};d.prototype.equalsWithTolerance=function(a,e){return this.x-
a.x<e&&this.x-a.x>-e&&this.y-a.y<e&&this.y-a.y>-e&&this.z-a.z<e&&this.z-a.z>-e};d.prototype.isAxis=function(){return 1===Math.abs(this.x)&&0===this.y&&0===this.z||0===this.x&&1===Math.abs(this.y)&&0===this.z||0===this.x&&0===this.y&&1===Math.abs(this.z)};d.prototype.length=function(){return Math.sqrt(this.squaredLength())};d.prototype.squaredLength=function(){return this.x*this.x+this.y*this.y+this.z*this.z};d.prototype.scale=function(a){this.x*=a;this.y*=a;this.z*=a;return this};d.prototype.normalize=
function(){return this.scale(1/this.length())};d.prototype.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};d.zero=function(){return new d(0,0,0)};d.add=function(a,e){return new d(a.x+e.x,a.y+e.y,a.z+e.z)};d.subtract=function(a,e){return new d(a.x-e.x,a.y-e.y,a.z-e.z)};d.dot=function(a,e){return a.x*e.x+a.y*e.y+a.z*e.z};d.cross=function(a,e){return new d(a.y*e.z-a.z*e.y,a.z*e.x-a.x*e.z,a.x*e.y-a.y*e.x)};d.distance=function(a,e){return d.subtract(e,a).length()};d.scale=function(a,
e){return a.copy().scale(e)};d.createFromArray=function(a){return new d(a[0],a[1],a[2])};return d}();d.Point3=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(){this.loadIdentity()}g.prototype.loadIdentity=function(){this.m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return this};g.prototype.isIdentity=function(){var a=this.m;return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&0===a[12]&&0===a[13]&&0===a[14]&&1===a[15]};g.prototype.equals=function(a){for(var e=0;16>e;++e)if(this.m[e]!==a.m[e])return!1;return!0};g.prototype.equalsWithTolerance=function(a,
e){e=Math.abs(e);for(var c=0;16>c;++c)if(Math.abs(this.m[c]-a.m[c])>e)return!1;return!0};g.prototype.setScaleComponent=function(a,e,c){this.m[0]=a;this.m[5]=e;this.m[10]=c;return this};g.prototype.setTranslationComponent=function(a,e,c){this.m[12]=a;this.m[13]=e;this.m[14]=c;return this};g.prototype.copy=function(){var a=new g;a.m=this.m.slice();return a};g.prototype.assign=function(a){for(var e=0;e<a.m.length;e++)this.m[e]=a.m[e];return this};g.prototype.scale=function(a){for(var e=0;16>e;e++)this.m[e]*=
a;return this};g.prototype.transform=function(a,e){if(void 0===e)return e=d.Point3.zero(),this.transform(a,e),e;e.set(a.x*this.m[0]+a.y*this.m[4]+a.z*this.m[8]+this.m[12],a.x*this.m[1]+a.y*this.m[5]+a.z*this.m[9]+this.m[13],a.x*this.m[2]+a.y*this.m[6]+a.z*this.m[10]+this.m[14])};g.prototype.transform4=function(a,e){if(void 0===e)return e=d.Point4.zero(),this.transform4(a,e),e;e.set(a.x*this.m[0]+a.y*this.m[4]+a.z*this.m[8]+this.m[12]*a.w,a.x*this.m[1]+a.y*this.m[5]+a.z*this.m[9]+this.m[13]*a.w,a.x*
this.m[2]+a.y*this.m[6]+a.z*this.m[10]+this.m[14]*a.w,a.x*this.m[3]+a.y*this.m[7]+a.z*this.m[11]+this.m[15]*a.w)};g.prototype.transformArray=function(a,e){for(var c=0;c<a.length;c++){var b=a[c];b=new d.Point3(b.x*this.m[0]+b.y*this.m[4]+b.z*this.m[8]+this.m[12],b.x*this.m[1]+b.y*this.m[5]+b.z*this.m[9]+this.m[13],b.x*this.m[2]+b.y*this.m[6]+b.z*this.m[10]+this.m[14]);e[c]=b}};g.prototype.transformBox=function(a){if(a.isDegenerate())return d.Box.invalid();a=a.getCorners();for(var e=0;e<a.length;e++){var c=
a[e];this.transform(c,c)}e=new d.Box(a[0],a[0]);for(var b=1;b<a.length;++b)c=a[b],e.addPoint(c);return e};g.prototype.transpose=function(){var a=this.m[1];this.m[1]=this.m[4];this.m[4]=a;a=this.m[2];this.m[2]=this.m[8];this.m[8]=a;a=this.m[3];this.m[3]=this.m[12];this.m[12]=a;a=this.m[6];this.m[6]=this.m[9];this.m[9]=a;a=this.m[7];this.m[7]=this.m[13];this.m[13]=a;a=this.m[11];this.m[11]=this.m[14];this.m[14]=a;return this};g.createFromArray=function(a){var e=new g;e.m=a.slice();return e};g.createFromOffAxisRotation=
function(a,e){var c=Math.PI/180*e;e=Math.sin(c);c=Math.cos(c);var b=new g;a=a.copy().normalize();var f=1-c,k=f*a.x*a.y,d=f*a.x*a.z,n=f*a.y*a.z;b.m[0]=f*a.x*a.x+c;b.m[1]=e*a.z+k;b.m[2]=d-e*a.y;b.m[3]=0;b.m[4]=k-e*a.z;b.m[5]=f*a.y*a.y+c;b.m[6]=e*a.x+n;b.m[7]=0;b.m[8]=e*a.y+d;b.m[9]=n-e*a.x;b.m[10]=f*a.z*a.z+c;b.m[11]=0;b.m[12]=0;b.m[13]=0;b.m[14]=0;b.m[15]=1;return b};g.createFromBasis=function(a,e,c){var b=new g;b.m[0]=a.x;b.m[1]=a.y;b.m[2]=a.z;b.m[4]=e.x;b.m[5]=e.y;b.m[6]=e.z;b.m[8]=c.x;b.m[9]=c.y;
b.m[10]=c.z;return b};g.multiply=function(a,e){var c=new g;c.m[0]=a.m[0]*e.m[0]+a.m[1]*e.m[4]+a.m[2]*e.m[8]+a.m[3]*e.m[12];c.m[1]=a.m[0]*e.m[1]+a.m[1]*e.m[5]+a.m[2]*e.m[9]+a.m[3]*e.m[13];c.m[2]=a.m[0]*e.m[2]+a.m[1]*e.m[6]+a.m[2]*e.m[10]+a.m[3]*e.m[14];c.m[3]=a.m[0]*e.m[3]+a.m[1]*e.m[7]+a.m[2]*e.m[11]+a.m[3]*e.m[15];c.m[4]=a.m[4]*e.m[0]+a.m[5]*e.m[4]+a.m[6]*e.m[8]+a.m[7]*e.m[12];c.m[5]=a.m[4]*e.m[1]+a.m[5]*e.m[5]+a.m[6]*e.m[9]+a.m[7]*e.m[13];c.m[6]=a.m[4]*e.m[2]+a.m[5]*e.m[6]+a.m[6]*e.m[10]+a.m[7]*
e.m[14];c.m[7]=a.m[4]*e.m[3]+a.m[5]*e.m[7]+a.m[6]*e.m[11]+a.m[7]*e.m[15];c.m[8]=a.m[8]*e.m[0]+a.m[9]*e.m[4]+a.m[10]*e.m[8]+a.m[11]*e.m[12];c.m[9]=a.m[8]*e.m[1]+a.m[9]*e.m[5]+a.m[10]*e.m[9]+a.m[11]*e.m[13];c.m[10]=a.m[8]*e.m[2]+a.m[9]*e.m[6]+a.m[10]*e.m[10]+a.m[11]*e.m[14];c.m[11]=a.m[8]*e.m[3]+a.m[9]*e.m[7]+a.m[10]*e.m[11]+a.m[11]*e.m[15];c.m[12]=a.m[12]*e.m[0]+a.m[13]*e.m[4]+a.m[14]*e.m[8]+a.m[15]*e.m[12];c.m[13]=a.m[12]*e.m[1]+a.m[13]*e.m[5]+a.m[14]*e.m[9]+a.m[15]*e.m[13];c.m[14]=a.m[12]*e.m[2]+
a.m[13]*e.m[6]+a.m[14]*e.m[10]+a.m[15]*e.m[14];c.m[15]=a.m[12]*e.m[3]+a.m[13]*e.m[7]+a.m[14]*e.m[11]+a.m[15]*e.m[15];return c};g.prototype.inverseAndDeterminant=function(){var a=this.m[4]*this.m[9]-this.m[5]*this.m[8],e=this.m[4]*this.m[10]-this.m[6]*this.m[8],c=this.m[4]*this.m[11]-this.m[7]*this.m[8],b=this.m[4]*this.m[13]-this.m[5]*this.m[12],f=this.m[4]*this.m[14]-this.m[6]*this.m[12],k=this.m[4]*this.m[15]-this.m[7]*this.m[12],d=this.m[5]*this.m[10]-this.m[6]*this.m[9],n=this.m[5]*this.m[11]-
this.m[7]*this.m[9],m=this.m[5]*this.m[14]-this.m[6]*this.m[13],p=this.m[5]*this.m[15]-this.m[7]*this.m[13],q=this.m[6]*this.m[11]-this.m[7]*this.m[10],h=this.m[6]*this.m[15]-this.m[7]*this.m[14],u=this.m[8]*this.m[13]-this.m[9]*this.m[12],t=this.m[8]*this.m[14]-this.m[10]*this.m[12],v=this.m[8]*this.m[15]-this.m[11]*this.m[12],w=this.m[9]*this.m[14]-this.m[10]*this.m[13],y=this.m[9]*this.m[15]-this.m[11]*this.m[13],x=this.m[10]*this.m[15]-this.m[11]*this.m[14],z=new g;z.m[0]=this.m[5]*x-this.m[6]*
y+this.m[7]*w;z.m[1]=this.m[2]*y-this.m[3]*w-this.m[1]*x;z.m[2]=this.m[1]*h-this.m[2]*p+this.m[3]*m;z.m[3]=this.m[2]*n-this.m[3]*d-this.m[1]*q;z.m[4]=this.m[6]*v-this.m[7]*t-this.m[4]*x;z.m[5]=this.m[0]*x-this.m[2]*v+this.m[3]*t;z.m[6]=this.m[2]*k-this.m[3]*f-this.m[0]*h;z.m[7]=this.m[0]*q-this.m[2]*c+this.m[3]*e;z.m[8]=this.m[4]*y-this.m[5]*v+this.m[7]*u;z.m[9]=this.m[1]*v-this.m[3]*u-this.m[0]*y;z.m[10]=this.m[0]*p-this.m[1]*k+this.m[3]*b;z.m[11]=this.m[1]*c-this.m[3]*a-this.m[0]*n;z.m[12]=this.m[5]*
t-this.m[6]*u-this.m[4]*w;z.m[13]=this.m[0]*w-this.m[1]*t+this.m[2]*u;z.m[14]=this.m[1]*f-this.m[2]*b-this.m[0]*m;z.m[15]=this.m[0]*d-this.m[1]*e+this.m[2]*a;a=this.m[0]*z.m[0]-this.m[1]*-z.m[4]+this.m[2]*z.m[8]-this.m[3]*-z.m[12];if(0===a)return[null,0];z.scale(1/a);return[z,a]};g.inverse=function(a){return a.inverseAndDeterminant()[0]};g.prototype.upperLeft3x3Determinant=function(){return this.m[0]*(this.m[5]*this.m[10]-this.m[9]*this.m[6])-this.m[4]*(this.m[1]*this.m[10]-this.m[9]*this.m[2])+this.m[8]*
(this.m[1]*this.m[6]-this.m[5]*this.m[2])};g.prototype.normalMatrix=function(){var a=this.copy().setTranslationComponent(0,0,0).inverseAndDeterminant()[0];return a?a.transpose():null};g.prototype.toJson=function(){return this.m.slice()};g.prototype.forJson=function(){return this.toJson()};g.fromJson=function(a){return g.createFromArray(a)};g.construct=function(a){return g.fromJson(a)};g.toMatrix12=function(a){return[a[0],a[1],a[2],a[4],a[5],a[6],a[8],a[9],a[10],a[12],a[13],a[14]]};g.xAxisRotation=
function(a){var e=new g,c=d.Util.degreesToRadians(a);a=Math.cos(c);c=Math.sin(c);e.m[5]=a;e.m[6]=-c;e.m[9]=c;e.m[10]=a;return e};g.yAxisRotation=function(a){var e=new g,c=d.Util.degreesToRadians(a);a=Math.cos(c);c=Math.sin(c);e.m[0]=a;e.m[2]=c;e.m[8]=-c;e.m[10]=a;return e};g.zAxisRotation=function(a){var e=new g,c=d.Util.degreesToRadians(a);a=Math.cos(c);c=Math.sin(c);e.m[0]=a;e.m[1]=-c;e.m[4]=c;e.m[5]=a;return e};return g}();d.Matrix=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a,e,c,b){this.x=a;this.y=e;this.z=c;this.w=b}g.prototype.set=function(a,e,c,b){this.x=a;this.y=e;this.z=c;this.w=b};g.prototype.assign=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w};g.prototype.copy=function(){return new g(this.x,this.y,this.z,this.w)};g.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.z===a.z&&this.w===a.w};g.prototype.equalsWithTolerance=function(a,e){return this.x-a.x<e&&this.x-a.x>-e&&this.y-a.y<e&&this.y-
a.y>-e&&this.z-a.z<e&&this.z-a.z>-e&&this.w-a.w<e&&this.w-a.w>-e};g.prototype.fromArray=function(a){this.x=a[0];this.y=a[1];this.z=a[2];this.w=a[3];return this};g.prototype.toArray=function(a){a[0]=this.x;a[1]=this.y;a[2]=this.z;a[3]=this.w;return this};g.prototype.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this};g.prototype.magnitudeSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w};g.prototype.magnitude=function(){return Math.sqrt(this.x*
this.x+this.y*this.y+this.z*this.z+this.w*this.w)};g.prototype.normalize=function(){var a=this.magnitude();this.x/=a;this.y/=a;this.z/=a;this.w/=a};g.add=function(a,e){return new g(a.x+e.x,a.y+e.y,a.z+e.z,a.w+e.w)};g.subtract=function(a,e){return new g(a.x-e.x,a.y-e.y,a.z-e.z,a.w-e.w)};g.Identity=function(){return g.identity()};g.identity=function(){return new g(0,0,0,1)};g.toMatrix=function(a){var e=a.x*a.x+a.y*a.y+a.z*a.z+a.w*a.w;e=2/e;var c=a.x*e,b=a.y*e,f=a.z*e;e=a.w*c;var k=a.w*b,l=a.w*f;c*=
a.x;var n=a.x*b,g=a.x*f;b*=a.y;var p=a.y*f;a=a.z*f;f=new d.Matrix;f.m[0]=1-(b+a);f.m[1]=n+l;f.m[2]=g-k;f.m[3]=0;f.m[4]=n-l;f.m[5]=1-(c+a);f.m[6]=p+e;f.m[7]=0;f.m[8]=g+k;f.m[9]=p-e;f.m[10]=1-(c+b);f.m[11]=0;f.m[12]=0;f.m[13]=0;f.m[14]=0;f.m[15]=1;return f};g.createFromMatrix=function(a){var e=[],c=a.m[0]+a.m[5]+a.m[10];if(0<c){var b=Math.sqrt(c+1);e[3]=.5*b;b=.5/b;e[0]=b*(a.m[6]-a.m[9]);e[1]=b*(a.m[8]-a.m[2]);e[2]=b*(a.m[1]-a.m[4])}else{c=0;a.m[5]>a.m[0]&&(c=1);a.m[10]>a.m[4*c+c]&&(c=2);b=[1,2,0];
var f=b[c],k=b[f];b=Math.sqrt(a.m[4*c+c]-(a.m[4*f+f]+a.m[4*k+k])+1);e[c]=.5*b;b=.5/b;e[3]=b*(a.m[4*f+k]-a.m[4*k+f]);e[f]=b*(a.m[4*c+f]+a.m[4*f+c]);e[k]=b*(a.m[4*c+k]+a.m[4*k+c])}return g.identity().fromArray(e)};g.interpolate=function(a,e,c){var b=[],f=[],k=[];a.toArray(b);e.toArray(f);a=b[0]*f[0]+b[1]*f[1]+b[2]*f[2]+b[3]*f[3];if(1+a>g._epsilon){if(1-a>g._epsilon){e=g._arccos(a);var d=1/Math.sin(e);a=d*Math.sin((1-c)*e);c=d*Math.sin(c*e)}else a=1-c;for(e=0;4>e;++e)k[e]=a*b[e]+c*f[e]}else for(k[0]=
-b[1],k[1]=b[0],k[2]=-b[3],k[3]=b[2],a=Math.sin(.5*Math.PI*(1-c)),c=Math.sin(.5*Math.PI*c),e=0;3>e;++e)k[e]=a*b[e]+c*k[e];return g.identity().fromArray(k)};g._arccos=function(a){return-1>a?Math.PI:1<a?0:Math.acos(a)};g._epsilon=1E-5;return g}();d.Quaternion=h})(Communicator||(Communicator={}));
(function(d){(function(h){var g;(function(a){a[a.Constant=0]="Constant";a[a.Linear=1]="Linear";a[a.CubicSpline=2]="CubicSpline"})(g=h.InterpolationType||(h.InterpolationType={}));var a=function(){function a(c,b){this.buffer=c;this.interpolationType=b}a.prototype._getNextKeyframeIndex=function(c){for(var b=0;b<this.buffer.times.length;b+=1)if(this.buffer.times[b]>c)return b;return this.buffer.times.length};a.prototype.interpolateQuat=function(c,b){var f=this._getNextKeyframeIndex(c);if(0===f)this._setQuatFromKeyframeIndex(0,
b);else if(f===this.buffer.times.length)this._setQuatFromKeyframeIndex(f-1,b);else switch(this.interpolationType){case g.Constant:this._setQuatFromKeyframeIndex(f-1,b);break;case g.Linear:this.interpolateQuatSlerp(f-1,f,c,b);break;case g.CubicSpline:this.interpolateQuatCubicSpline(f-1,f,c,b)}};a.prototype.interpolateVec3=function(c,b){var f=this._getNextKeyframeIndex(c);if(0===f)this._setVecFromKeyframeIndex(0,b);else if(f===this.buffer.times.length)this._setVecFromKeyframeIndex(f-1,b);else switch(this.interpolationType){case g.Constant:this._setVecFromKeyframeIndex(f-
1,b);break;case g.Linear:this.interpolateVec3Linear(f-1,f,c,b);break;case g.CubicSpline:this.interpolateVec3CubicSpline(f-1,f,c,b)}};a.prototype.interpolateScalar=function(c){var b=this._getNextKeyframeIndex(c);if(0===b)return this.buffer.values[0];if(b===this.buffer.times.length)return this.buffer.values[b-1];switch(this.interpolationType){case g.Constant:return this.buffer.values[b-1];case g.Linear:return this.interpolateScalarLinear(b-1,b,c);case g.CubicSpline:return this.interpolateScalarCubicSpline(b-
1,b,c)}};a.prototype.interpolateScalarLinear=function(c,b,f){var a=this.buffer.values[c];return a+(f-this.buffer.times[c])/(this.buffer.times[b]-this.buffer.times[c])*(this.buffer.values[b]-a)};a.prototype.interpolateQuatSlerp=function(c,b,f,k){f=(f-this.buffer.times[c])/(this.buffer.times[b]-this.buffer.times[c]);this._setQuatFromKeyframeIndex(c,a.q0);this._setQuatFromKeyframeIndex(b,a.q1);k.assign(d.Quaternion.interpolate(a.q0,a.q1,f))};a._interpVec3=function(c,b,f,a){b.subtract(c);b.scale(f);b.add(c);
a.assign(b)};a.prototype.interpolateVec3Linear=function(c,b,f,k){f=(f-this.buffer.times[c])/(this.buffer.times[b]-this.buffer.times[c]);this._setVecFromKeyframeIndex(c,a.v0);this._setVecFromKeyframeIndex(b,a.v1);a._interpVec3(a.v0,a.v1,f,k)};a.prototype._interpCubicSpline=function(c,b,f,a,d){var k=Math.pow(c,2),e=Math.pow(c,3);return(2*e-3*k+1)*b+(e-2*k+c)*a+(-2*e+3*k)*f+(e-k)*d};a.prototype.interpolateScalarCubicSpline=function(c,b,f){var a=this.buffer.times[b]-this.buffer.times[c];f=(f-this.buffer.times[c])/
a;var d=this.buffer.values[c],e=this.buffer.values[b],g=0,p=0;0!==this.buffer.tangents.length&&(g=this.buffer.tangents[c]*a,p=this.buffer.tangents[b]*a);return this._interpCubicSpline(f,d,e,g,p)};a.prototype.interpolateVec3CubicSpline=function(c,b,f,k){var d=this.buffer.times[b]-this.buffer.times[c];f=(f-this.buffer.times[c])/d;this._setVecFromKeyframeIndex(c,a.v0);this._setVecFromKeyframeIndex(b,a.v1);this._setVecTanFromKeyframeIndex(c,a.v2);this._setVecTanFromKeyframeIndex(b,a.v3);a.v2.scale(d);
a.v3.scale(d);k.set(this._interpCubicSpline(f,a.v0.x,a.v1.x,a.v2.x,a.v3.x),this._interpCubicSpline(f,a.v0.y,a.v1.y,a.v2.y,a.v3.y),this._interpCubicSpline(f,a.v0.z,a.v1.z,a.v2.z,a.v3.z))};a.prototype.interpolateQuatCubicSpline=function(c,b,f,k){var d=this.buffer.times[b]-this.buffer.times[c];f=(f-this.buffer.times[c])/d;this._setQuatFromKeyframeIndex(c,a.q0);this._setQuatFromKeyframeIndex(b,a.q1);this._setQuatTanFromKeyframeIndex(c,a.q2);this._setQuatTanFromKeyframeIndex(b,a.q3);a.q4.set(a.q2.x*d,
a.q2.y*d,a.q2.z*d,a.q2.w*d);a.q5.set(a.q3.x*d,a.q3.y*d,a.q3.z*d,a.q3.w*d);k.set(this._interpCubicSpline(f,a.q0.x,a.q1.x,a.q4.x,a.q5.x),this._interpCubicSpline(f,a.q0.y,a.q1.y,a.q4.y,a.q5.y),this._interpCubicSpline(f,a.q0.z,a.q1.z,a.q4.z,a.q5.z),this._interpCubicSpline(f,a.q0.w,a.q1.w,a.q4.w,a.q5.w));k.normalize()};a.prototype._setVecFromKeyframeIndex=function(c,b){c*=3;b.set(this.buffer.values[c],this.buffer.values[c+1],this.buffer.values[c+2])};a.prototype._setVecTanFromKeyframeIndex=function(c,
b){0===this.buffer.tangents.length?b.set(0,0,0):(c*=3,b.set(this.buffer.tangents[c],this.buffer.tangents[c+1],this.buffer.tangents[c+2]))};a.prototype._setQuatFromKeyframeIndex=function(c,b){c*=4;b.set(this.buffer.values[c],this.buffer.values[c+1],this.buffer.values[c+2],this.buffer.values[c+3])};a.prototype._setQuatTanFromKeyframeIndex=function(c,b){0===this.buffer.tangents.length?b.set(0,0,0,1):(c*=4,b.set(this.buffer.tangents[c],this.buffer.tangents[c+1],this.buffer.tangents[c+2],this.buffer.tangents[c+
3]))};a.prototype._gatherForExport=function(c){c.buffers.add(this.buffer)};a.prototype._export=function(c){return{buffer:c.buffers.getIndex(this.buffer),interpolationType:g[this.interpolationType]}};a._import=function(c,b){return new a(c.buffers[b.buffer],g[b.interpolationType])};a.q0=d.Quaternion.identity();a.q1=d.Quaternion.identity();a.q2=d.Quaternion.identity();a.q3=d.Quaternion.identity();a.q4=d.Quaternion.identity();a.q5=d.Quaternion.identity();a.v0=d.Point3.zero();a.v1=d.Point3.zero();a.v2=
d.Point3.zero();a.v3=d.Point3.zero();return a}();h.Sampler=a})(d.Animation||(d.Animation={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){function a(a,c,b,f){var k=new d.KeyframeBuffer(b===d.CameraProperty.Width||b===d.CameraProperty.Height?d.KeyType.Scalar:d.KeyType.Vec3);f=new d.Sampler(k,f);return a.createCameraChannel(c,b,f)}g.createCameraChannels=function(e,c,b){var f=[];f.push(a(e,c+"-Position",d.CameraProperty.Position,b));f.push(a(e,c+"-Target",d.CameraProperty.Target,b));f.push(a(e,c+"-Up",d.CameraProperty.Up,b));f.push(a(e,c+"-Width",d.CameraProperty.Width,b));f.push(a(e,c+"-Height",
d.CameraProperty.Height,b));return f};g.keyframeCamera=function(a,c,b){var f=c.getPosition();b.cameraChannels[0].sampler.buffer.appendVec3Keyframe(a,f.x,f.y,f.z);f=c.getTarget();b.cameraChannels[1].sampler.buffer.appendVec3Keyframe(a,f.x,f.y,f.z);f=c.getUp();b.cameraChannels[2].sampler.buffer.appendVec3Keyframe(a,f.x,f.y,f.z);b.cameraChannels[3].sampler.buffer.appendScalarKeyframe(a,c.getWidth());b.cameraChannels[4].sampler.buffer.appendScalarKeyframe(a,c.getHeight())}})(d.Util||(d.Util={}))})(d.Animation||
(d.Animation={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a;(function(c){c[c.None=0]="None";c[c.Transform=1]="Transform";c[c.Opacity=2]="Opacity";c[c.Visibility=4]="Visibility";c[c.Color=8]="Color"})(a=g.NodeValuesFlags||(g.NodeValuesFlags={}));var e=function(){function c(b){this.nodeId=b;this.translate=d.Point3.zero();this.rotation=d.Quaternion.identity();this.scale=new d.Point3(1,1,1);this.color=new d.Point3(1,1,1);this.pivotPoint=null;this.visibility=this.opacity=1;this.matrix=new d.Matrix;this.flags=a.None}
c.prototype.updateMatrix=function(){this.pivotPoint?this._updateMatrixWithOrigin():this._updateMatrix()};c.prototype._updateMatrixWithOrigin=function(){var b=this.rotation.x,c=this.rotation.y,a=this.rotation.z,d=this.rotation.w,e=b+b,g=c+c,p=a+a,q=b*e,h=b*g,u=b*p;b=c*g;c*=p;var t=a*p;e*=d;var v=d*g,w=d*p,y=this.scale.x,x=this.scale.y,z=this.scale.z;d=this.pivotPoint.x;p=this.pivotPoint.y;g=this.pivotPoint.z;a=(1-(b+t))*y;var B=(h+w)*y;y*=u-v;h=(h-w)*x;t=(1-(q+t))*x;x*=c+e;u=(u+v)*z;c=(c-e)*z;q=(1-
(q+b))*z;this.matrix.m[0]=a;this.matrix.m[1]=B;this.matrix.m[2]=y;this.matrix.m[3]=0;this.matrix.m[4]=h;this.matrix.m[5]=t;this.matrix.m[6]=x;this.matrix.m[7]=0;this.matrix.m[8]=u;this.matrix.m[9]=c;this.matrix.m[10]=q;this.matrix.m[11]=0;this.matrix.m[12]=this.translate.x+d-(a*d+h*p+u*g);this.matrix.m[13]=this.translate.y+p-(B*d+t*p+c*g);this.matrix.m[14]=this.translate.z+g-(y*d+x*p+q*g);this.matrix.m[15]=1};c.prototype._updateMatrix=function(){var b=this.rotation.x,c=this.rotation.y,a=this.rotation.z,
d=this.rotation.w,e=b+b,g=c+c,p=a+a,q=b*e,h=b*g;b*=p;var u=c*g;c*=p;a*=p;e*=d;g*=d;d*=p;p=this.scale.x;var t=this.scale.y,v=this.scale.z;this.matrix.m[0]=(1-(u+a))*p;this.matrix.m[1]=(h+d)*p;this.matrix.m[2]=(b-g)*p;this.matrix.m[3]=0;this.matrix.m[4]=(h-d)*t;this.matrix.m[5]=(1-(q+a))*t;this.matrix.m[6]=(c+e)*t;this.matrix.m[7]=0;this.matrix.m[8]=(b+g)*v;this.matrix.m[9]=(c-e)*v;this.matrix.m[10]=(1-(q+u))*v;this.matrix.m[11]=0;this.matrix.m[12]=this.translate.x;this.matrix.m[13]=this.translate.y;
this.matrix.m[14]=this.translate.z;this.matrix.m[15]=1};return c}();g.NodeValues=e})(h.Internal||(h.Internal={}))})(d.Animation||(d.Animation={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function c(){this.height=this.width=this.up=this.target=this.position=null}c.prototype.clear=function(){this.height=this.width=this.up=this.target=this.position=null};c.prototype.apply=function(b){var c=!1;null!==this.position&&(b.setPosition(this.position),c=!0);null!==this.target&&(b.setTarget(this.target),c=!0);null!==this.up&&(b.setUp(this.up),c=!0);null!==this.width&&(b.setWidth(this.width),c=!0);null!==this.height&&(b.setHeight(this.height),c=!0);return c};
return c}();d.BatchedCameraValues=g;var a=function(){function c(){this.opacities=new Map;this.colors=new Map;this.matrixNodeIds=[];this.matrices=[];this.visibilityOn=[];this.visibilityOff=[]}c.prototype.clear=function(){this.opacities.clear();this.colors.clear();this.matrixNodeIds=[];this.matrices=[];this.visibilityOn=[];this.visibilityOff=[]};c.prototype.apply=function(b){b=b.model;0<this.opacities.size&&b.setNodesOpacities(this.opacities);0<this.colors.size&&b.setNodesColors(this.colors);0<this.matrixNodeIds.length&&
b._setNodesMatrices(this.matrixNodeIds,this.matrices);0<this.visibilityOn.length&&b.setNodesVisibility(this.visibilityOn,!0);0<this.visibilityOff.length&&b.setNodesVisibility(this.visibilityOff,!1)};return c}();d.BatchedNodeValues=a;var e=function(){function c(){this.node=new a;this.camera=new g}c.prototype.clear=function(){this.node.clear();this.camera.clear()};c.prototype.apply=function(b){this.node.apply(b);b=b.view;var c=b.getCamera();this.camera.apply(c)&&b.setCamera(c)};return c}();d.BatchedValues=
e})(d.Animation||(d.Animation={}))})(Communicator||(Communicator={}));
var __awaiter=this&&this.__awaiter||function(d,h,g,a){return new (g||(g=Promise))(function(e,c){function b(b){try{k(a.next(b))}catch(n){c(n)}}function f(b){try{k(a["throw"](b))}catch(n){c(n)}}function k(c){c.done?e(c.value):(new g(function(b){b(c.value)})).then(b,f)}k((a=a.apply(d,h||[])).next())})},__generator=this&&this.__generator||function(d,h){function g(b){return function(c){return a([b,c])}}function a(a){if(c)throw new TypeError("Generator is already executing.");for(;e;)try{if(c=1,b&&(f=a[0]&
2?b["return"]:a[0]?b["throw"]||((f=b["return"])&&f.call(b),0):b.next)&&!(f=f.call(b,a[1])).done)return f;if(b=0,f)a=[a[0]&2,f.value];switch(a[0]){case 0:case 1:f=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++;b=a[1];a=[0];continue;case 7:a=e.ops.pop();e.trys.pop();continue;default:if(!(f=e.trys,f=0<f.length&&f[f.length-1])&&(6===a[0]||2===a[0])){e=0;continue}if(3===a[0]&&(!f||a[1]>f[0]&&a[1]<f[3]))e.label=a[1];else if(6===a[0]&&e.label<f[1])e.label=f[1],f=a;else if(f&&e.label<
f[2])e.label=f[2],e.ops.push(a);else{f[2]&&e.ops.pop();e.trys.pop();continue}}a=h.call(d,e)}catch(n){a=[6,n],b=0}finally{c=f=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var e={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},c,b,f,k;return k={next:g(0),"throw":g(1),"return":g(2)},"function"===typeof Symbol&&(k[Symbol.iterator]=function(){return this}),k};
(function(d){var h;(function(a){a[a.Unknown=0]="Unknown";a[a.v1_0=1]="v1_0";a[a.v2_0=2]="v2_0";a[a.v2_1=3]="v2_1"})(h=d.BCFVersion||(d.BCFVersion={}));(function(a){a[a.Unknown=0]="Unknown";a[a.TopicFolder=1]="TopicFolder";a[a.Version=2]="Version";a[a.Markup=3]="Markup";a[a.Snapshot=4]="Snapshot";a[a.Viewpoint=5]="Viewpoint";a[a.Schema=6]="Schema";a[a.Project=7]="Project"})(d.BCFFileType||(d.BCFFileType={}));var g=function(){function a(a,c){this._version=h.Unknown;this._topicsMap=new Map;this._bcfFileName=
a;this._id=c}a.prototype.exportBCF=function(a){return __awaiter(this,void 0,void 0,function(){var c,b;return __generator(this,function(f){switch(f.label){case 0:return c=new XMLSerializer,b=new JSZip,b.file("bcf.version",'<?xml version="1.0" encoding="UTF-8"?><Version VersionId="2.1" xsi:noNamespaceSchemaLocation="version.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><DetailedVersion>2.1</DetailedVersion></Version>'),this._topicsMap.forEach(function(f,a){var k=b.folder(a);a=c.serializeToString(f.getMarkup().export());
k.file("markup.bcf",a);f.getViewpointMap().forEach(function(b,f){b=c.serializeToString(b.export());k.file(f,b)});f.getSnapshotMap().forEach(function(b,c){k.file(c,b.getData())})}),[4,b.generateAsync({type:"blob"}).then(function(b){saveAs(b,a+".bcf")})];case 1:return f.sent(),[2]}})})};a.prototype.addTopic=function(a,c){this._topicsMap.set(a,c)};a.prototype.getTopics=function(){return this._topicsMap};a.prototype.getTopic=function(a){return this._topicsMap.get(a)||null};a.prototype.getVersion=function(){return this._version};
a.prototype.setVersion=function(a){this._version=a};a.prototype.getFilename=function(){return this._bcfFileName};a.prototype.getId=function(){return this._id};return a}();d.BCFData=g})(Communicator||(Communicator={}));
(function(d){function h(b,c,f){void 0!==f&&null!==f&&b.setAttribute(c,f)}function g(b,c,f,a){b=b.createElement(f);b.innerHTML=a;c.appendChild(b)}function a(b,c,f,a){void 0!==a&&null!==a&&g(b,c,f,a)}function e(b){return void 0===b||null===b?null:b.toISOString()}function c(b){return void 0===b||null===b?null:b.toString()}function b(b){return void 0===b||null===b?null:b?"true":"false"}var f=function(){function b(b,c,f,a,k,d){this._ifcProject=b;this._ifcSpatialStructureElement=c;this._isExternal=f;this._filename=
a;this._date=k;this._reference=d}b.prototype.getIfcProject=function(){return this._ifcProject||null};b.prototype.getIfcSpacialStructureElement=function(){return this._ifcSpatialStructureElement||null};b.prototype.getIsExternal=function(){return this._isExternal||null};b.prototype.getBimFilename=function(){return this._filename||null};b.prototype.getBimDate=function(){return this._date||null};b.prototype.getReference=function(){return this._reference||null};return b}();d.BCFMarkupHeaderFile=f;var k=
function(){function b(b,c,f,a){this._index=this._snapshotFilename=this._viewpointFilename=void 0;this._guid=b;this._viewpointFilename=c;this._snapshotFilename=f;void 0!==a&&(this._index=parseInt(a,10))}b.prototype.getGuid=function(){return this._guid};b.prototype.getViewpointFilename=function(){return this._viewpointFilename||null};b.prototype.getSnapshotFilename=function(){return this._snapshotFilename||null};b.prototype.getIndex=function(){return this._index||null};return b}();d.BCFMarkupViewpoint=
k;var l=function(){function b(b,c,f,a,k,d,e){this._guid=b;this._date=c;this._author=f;this._text=a;this._viewpointGuid=k;this._modifiedDate=d;this._modifiedAuthor=e}b.prototype.getId=function(){return this._guid};b.prototype.getDate=function(){return this._date};b.prototype.setDate=function(b){this._date=b};b.prototype.getAuthor=function(){return this._author};b.prototype.setAuthor=function(b){this._author=b};b.prototype.getText=function(){return this._text};b.prototype.setText=function(b){this._text=
b};b.prototype.getViewpointGuid=function(){return this._viewpointGuid||null};b.prototype.setViewpointGuid=function(b){this._viewpointGuid=null!==b?b:void 0};b.prototype.getModifiedDate=function(){return this._modifiedDate||null};b.prototype.setModifiedDate=function(b){this._modifiedDate=null!==b?b:void 0};b.prototype.getModifiedAuthor=function(){return this._modifiedAuthor||null};b.prototype.setModifiedAuthor=function(b){this._modifiedAuthor=null!==b?b:void 0};return b}();d.BCFComment=l;var n=function(){function n(b,
c,f){this._markupHeaderFiles=[];this._topic={guid:"",title:"",creationDate:new Date,creationAuthor:""};this._comments=new Map;this._viewpoints=new Map;this._filename=b;this._bcfTopic=f;this._parseDocument(c)}n.prototype._parseDocument=function(b){if(null!==b)for(b=b.documentElement.firstElementChild;null!==b;){var c=b.localName;if(null===c)break;switch(c){case "Header":this._parseHeader(b);break;case "Topic":this._parseTopic(b);break;case "Comment":this._parseComment(b);break;case "Viewpoints":this._parseViewpoint(b)}b=
b.nextElementSibling}};n.prototype._exportHeader=function(c){var f=c.createElement("Header");h(f,"ProjectGuid",this._projectGuid);this._markupHeaderFiles.forEach(function(k){var d=c.createElement("File");h(d,"IfcProject",k.getIfcProject());h(d,"IfcSpatialStructureElement",k.getIfcSpacialStructureElement());h(d,"isExternal",b(k.getIsExternal()));a(c,d,"Filename",k.getBimFilename());a(c,d,"Date",e(k.getBimDate()));a(c,d,"Reference",k.getReference());f.appendChild(d)});return f};n.prototype._exportTopicData=
function(b){var f=b.createElement("Topic");f.setAttribute("Guid",this._topic.guid);h(f,"TopicType",this._topic.topicType);h(f,"TopicStatus",this._topic.topicStatus);g(b,f,"Title",this._topic.title);g(b,f,"CreationDate",this._topic.creationDate.toISOString());g(b,f,"CreationAuthor",this._topic.creationAuthor);a(b,f,"ReferenceLink",this._topic.referenceLink);a(b,f,"Priority",this._topic.priority);a(b,f,"Index",c(this._topic.index));a(b,f,"ModifiedDate",e(this._topic.modifiedDate));a(b,f,"ModifiedAuthor",
this._topic.modifiedAuthor);a(b,f,"DueDate",e(this._topic.dueDate));a(b,f,"AssignedTo",this._topic.assignedTo);a(b,f,"Description",this._topic.description);a(b,f,"Stage",this._topic.stage);if(this._topic.labels){var k=b.createElement("Labels");this._topic.labels.forEach(function(c){g(b,k,"Label",c)});f.appendChild(k)}return f};n.prototype._exportBimSnippet=function(c,f){var k=c.createElement("BimSnippet");k.setAttribute("SnippetType",f.snippetType);h(k,"isExternal",b(f.isExternal));g(c,k,"Reference",
f.reference);a(c,k,"ReferenceSchema",f.referenceSchema);return k};n.prototype._exportDocumentReference=function(c,f){var k=c.createElement("DocumentReference");h(k,"Guid",f.guid);h(k,"isExternal",b(f.isExternal));a(c,k,"ReferencedDocument",f.referencedDocument);a(c,k,"Description",f.description);return k};n.prototype._exportRelatedTopic=function(b,c){b=b.createElement("RelatedTopic");b.setAttribute("Guid",c.guid);return b};n.prototype._exportTopic=function(b){var c=this,f=this._exportTopicData(b);
this._topic.bimSnippets&&this._topic.bimSnippets.forEach(function(a){f.appendChild(c._exportBimSnippet(b,a))});this._topic.documentReferences&&this._topic.documentReferences.forEach(function(a){f.appendChild(c._exportDocumentReference(b,a))});this._topic.relatedTopics&&this._topic.relatedTopics.forEach(function(a){f.appendChild(c._exportRelatedTopic(b,a))});return f};n.prototype._exportComment=function(b,c){var f=b.createElement("Comment");f.setAttribute("Guid",c.getId());g(b,f,"Date",c.getDate().toISOString());
g(b,f,"Author",c.getAuthor());g(b,f,"Comment",c.getText());a(b,f,"ModifiedDate",e(c.getModifiedDate()));a(b,f,"ModifiedAuthor",c.getModifiedAuthor());if(c=c.getViewpointGuid())b=b.createElement("Viewpoint"),b.setAttribute("Guid",c),f.appendChild(b);return f};n.prototype._exportViewpoint=function(b,f){var k=b.createElement("Viewpoints");k.setAttribute("Guid",f.getGuid());a(b,k,"Viewpoint",f.getViewpointFilename());a(b,k,"Snapshot",f.getSnapshotFilename());a(b,k,"Index",c(f.getIndex()));return k};n.prototype.export=
function(){var b=this,c=document.implementation.createDocument("","",null),f=c.createElement("Markup");f.appendChild(this._exportHeader(c));f.appendChild(this._exportTopic(c));this._comments.forEach(function(a){f.appendChild(b._exportComment(c,a))});this._viewpoints.forEach(function(a){f.appendChild(b._exportViewpoint(c,a))});c.appendChild(f);return c};n.prototype.getIfcProject=function(){var b=this._markupHeaderFiles[0];if(void 0!==b)return b.getIfcProject()||void 0};n.prototype.getIfcSpacialStructureElement=
function(){var b=this._markupHeaderFiles[0];if(void 0!==b)return b.getIfcSpacialStructureElement()||void 0};n.prototype.getIsExternal=function(){var b=this._markupHeaderFiles[0];if(void 0!==b)return b.getIsExternal()||void 0};n.prototype.getBimFilename=function(){var b=this._markupHeaderFiles[0];if(void 0!==b)return b.getBimFilename()||void 0};n.prototype.getBimDate=function(){var b=this._markupHeaderFiles[0];if(void 0!==b)return b.getBimDate()||void 0};n.prototype.getReference=function(){var b=this._markupHeaderFiles[0];
if(void 0!==b)return b.getReference()||void 0};n.prototype.getProjectGuid=function(){return this._projectGuid||null};n.prototype.getMarkupHeaderFiles=function(){return this._markupHeaderFiles};n.prototype.getFilename=function(){return this._filename};n.prototype.getTopicType=function(){return this._topic.topicType||null};n.prototype.setTopicType=function(b){this._topic.topicType=null!==b?b:void 0};n.prototype.getTopicStatus=function(){return this._topic.topicStatus||null};n.prototype.setTopicStatus=
function(b){this._topic.topicStatus=null!==b?b:void 0};n.prototype.getTopicTitle=function(){return this._topic.title};n.prototype.setTopicTitle=function(b){this._topic.title=b};n.prototype.getTopicCreationDate=function(){return this._topic.creationDate};n.prototype.setTopicCreationDate=function(b){this._topic.creationDate=b};n.prototype.getTopicCreationAuthor=function(){return this._topic.creationAuthor};n.prototype.setTopicCreationAuthor=function(b){this._topic.creationAuthor=b};n.prototype.getTopicReferenceLink=
function(){return this._topic.referenceLink||null};n.prototype.setTopicReferenceLink=function(b){this._topic.referenceLink=null===b?void 0:b};n.prototype.getTopicPriority=function(){return this._topic.priority||null};n.prototype.setTopicPriority=function(b){this._topic.priority=null===b?void 0:b};n.prototype.getTopicIndex=function(){return this._topic.index||null};n.prototype.setTopicIndex=function(b){this._topic.index=null===b?void 0:b};n.prototype.getTopicLabels=function(){return void 0===this._topic.labels?
[]:this._topic.labels.slice()};n.prototype.setTopicLabels=function(b){this._topic.labels=b.slice()};n.prototype.getTopicModifiedDate=function(){return this._topic.modifiedDate||null};n.prototype.setTopicModifiedDate=function(b){this._topic.modifiedDate=null===b?void 0:b};n.prototype.getTopicModifiedAuthor=function(){return this._topic.modifiedAuthor||null};n.prototype.setTopicModifiedAuthor=function(b){this._topic.modifiedAuthor=null===b?void 0:b};n.prototype.getTopicDueDate=function(){return this._topic.dueDate||
null};n.prototype.setTopicDueDate=function(b){this._topic.dueDate=null===b?void 0:b};n.prototype.getTopicAssignedTo=function(){return this._topic.assignedTo||null};n.prototype.setTopicAssignedTo=function(b){this._topic.assignedTo=null===b?void 0:b};n.prototype.getTopicDescription=function(){return this._topic.description||null};n.prototype.setTopicDescription=function(b){this._topic.description=null===b?void 0:b};n.prototype.getTopicStage=function(){return this._topic.stage||null};n.prototype.setTopicState=
function(b){this._topic.stage=null===b?void 0:b};n.prototype.getComments=function(){return this._comments};n.prototype.addComment=function(b,c,f,a,k,e){var n=d.UUID.create();b=new l(n,b,c,f,a,k,e);this._comments.set(n,b);return b};n.prototype.updateComment=function(b){var c=b.getId();this._comments.set(c,b)};n.prototype.deleteComment=function(b){this._comments.delete(b)};n.prototype.getViewpoints=function(){return this._viewpoints};n.prototype._addFile=function(b){var c=this._getElementAttributes(b),
a=this._getChildData(b);b=a.get("Date");b=void 0===b?void 0:new Date(b);var k=a.get("Filename");a=a.get("Reference");var d=c.get("IfcProject"),e=c.get("IfcSpatialStructureElement");c="true"===c.get("isExternal");this._markupHeaderFiles.push(new f(d,e,c,k,b,a))};n.prototype._parseHeader=function(b){var c=this._getElementAttributes(b).get("ProjectGuid");void 0!==c&&(this._projectGuid=c);b=b.firstElementChild;null!==b&&this._addFile(b)};n.prototype._parseTopic=function(b){var c=this._getElementAttributes(b),
f=c.get("Guid");if(void 0!==f&&(this._topic.guid=f,this._topic.topicType=c.get("TopicType")||c.get("Status"),this._topic.topicStatus=c.get("TopicStatus")||c.get("VerbalStatus"),b=b.firstElementChild,null!==b))for(;null!==b;){var a=b.localName;if(null===a)break;c=this._getChildData(b);f=this._getElementAttributes(b);switch(a){case "BimSnippet":void 0===this._topic.bimSnippets&&(this._topic.bimSnippets=[]);a=c.get("Reference");var k=f.get("SnippetType");void 0!==a&&void 0!==k&&(a={snippetType:k,reference:a},
f.get("isExternal")&&(a.isExternal="true"===f.get("isExternal")),c.get("ReferenceSchema")&&(a.referenceSchema=c.get("ReferenceSchema")),this._topic.bimSnippets.push(a));break;case "DocumentReference":void 0===this._topic.documentReferences&&(this._topic.documentReferences=[]);f={};c.get("Guid")&&(f.guid=c.get("Guid"));c.get("isExternal")&&(f.isExternal="true"===c.get("isExternal"));c.get("Description")&&(f.description=c.get("Description"));c.get("ReferencedDocument")&&(f.referencedDocument=c.get("ReferencedDocument"));
this._topic.documentReferences.push(f);break;case "RelatedTopic":void 0===this._topic.relatedTopics&&(this._topic.relatedTopics=[]);c=c.get("Guid");void 0!==c&&this._topic.relatedTopics.push({guid:c});break;case "ReferenceLink":b.textContent&&(this._topic.referenceLink=b.textContent);break;case "Title":b.textContent&&(this._topic.title=b.textContent);break;case "Priority":b.textContent&&(this._topic.priority=b.textContent);break;case "Index":b.textContent&&(this._topic.index=parseInt(b.textContent,
10));break;case "Labels":c=b.firstChild;if(!c)break;void 0===this._topic.labels&&(this._topic.labels=[]);for(;c;)c.textContent&&this._topic.labels.push(c.textContent),c=c.nextSibling;break;case "CreationDate":b.textContent&&(this._topic.creationDate=new Date(b.textContent));break;case "CreationAuthor":b.textContent&&(this._topic.creationAuthor=b.textContent);break;case "ModifiedDate":b.textContent&&(this._topic.modifiedDate=new Date(b.textContent));break;case "ModifiedAuthor":b.textContent&&(this._topic.modifiedAuthor=
b.textContent);break;case "DueDate":b.textContent&&(this._topic.dueDate=new Date(b.textContent));break;case "AssignedTo":b.textContent&&(this._topic.assignedTo=b.textContent);break;case "Description":b.textContent&&(this._topic.description=b.textContent);break;case "Stage":b.textContent&&(this._topic.stage=b.textContent)}b=b.nextElementSibling}};n.prototype._parseComment=function(b){var c=new Date,f="",a="",k,d=this._getElementAttributes(b).get("Guid");if(d){b=b.firstElementChild;if(null!==b)for(;null!==
b;){var e=b.localName;if(null===e)break;switch(e){case "Date":b.textContent&&(c=new Date(b.textContent));break;case "Author":b.textContent&&(f=b.textContent);break;case "Comment":b.textContent&&(a=b.textContent);break;case "Viewpoint":var n=this._getElementAttributes(b).get("Guid");break;case "ModifiedDate":b.textContent&&(k=new Date(b.textContent));break;case "ModifiedAuthor":if(b.textContent)var g=b.textContent}b=b.nextElementSibling}c=new l(d,c,f,a,n,k,g);this._comments.set(d,c)}};n.prototype._parseViewpoint=
function(b){var c=this._getElementAttributes(b).get("Guid");if(void 0!==c){var f=this._getChildData(b);b=f.get("Viewpoint");var a=f.get("Snapshot");f=f.get("Index");this.addViewpoint(c,b,a,f)}};n.prototype.addViewpoint=function(b,c,f,a){this._viewpoints.set(b,new k(b,c,f,a))};n.prototype._getChildData=function(b){var c=new Map;for(b=b.firstElementChild;null!==b;){var f=b.localName,a=null;null===b.firstElementChild&&(a=b.textContent);null!==f&&null!==a&&c.set(f,a);b=b.nextElementSibling}return c};
n.prototype._getElementAttributes=function(b){b=b.attributes;for(var c=new Map,f=0;f<b.length;++f){var a=b[f];c.set(a.name,a.value)}return c};return n}();d.BCFMarkup=n})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(a,d){this._filename=a;this._data=d}d.createFromImage=function(a,e){e=d.snapshotDataFromImage(e);return new d(a,e)};d.prototype.getFilename=function(){return this._filename};d.prototype.getData=function(){return this._data};d.prototype.getUrl=function(){var a=new Blob([this._data],{type:"image/png"});return URL.createObjectURL(a,{oneTimeOnly:!0})};d.snapshotDataFromImage=function(a){return d._convertDataURIToBinary(a.src)};d._convertDataURIToBinary=function(a){var d=
a.indexOf(";base64,")+8;a=window.atob(a.substring(d));d=new Uint8Array(a.length);for(var c=0;c<a.length;c++){var b=a[c].charCodeAt(0);d[c]=b}return d};return d}();d.BCFSnapshot=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a,d,c,b){this._viewpointMap=new Map;this._snapshotMap=new Map;this._viewer=b;this._topicId=c;this._bcfDataId=a;this._bcfFilename=d}g.createTopic=function(a,e,c,b,f){void 0===f&&(f=null);return __awaiter(this,void 0,void 0,function(){var k,l,n,m,p,q,h,u,t;return __generator(this,function(r){switch(r.label){case 0:return k=d.UUID.create(),l=new g(e,c,k,a),n=l.addMarkup("markup.bcf",null),n.setTopicTitle(b),m="viewpoint.bcfv",[4,d.BCFViewpoint.createViewpoint(a,
m,f)];case 1:return p=r.sent(),l.setViewpoint(m,p),q="snapshot.png",(u=null!==f?f.getSnapshotImage():null)?[3,3]:[4,a.takeSnapshot()];case 2:u=r.sent(),r.label=3;case 3:return h=u,t=d.BCFSnapshot.createFromImage(q,h),l.setSnapshot(q,t),[2,l]}})})};g.prototype.getTopicId=function(){return this._topicId};g.prototype.addMarkup=function(a,e){return this._markup=new d.BCFMarkup(a,e,this)};g.prototype.getMarkup=function(){return this._markup};g.prototype.addViewpoint=function(a,e,c,b,f){e=new d.BCFViewpoint(a,
e,c,b,f,this._viewer);this.setViewpoint(a,e);return e};g.prototype.setViewpoint=function(a,d){this._viewpointMap.set(a,d)};g.prototype.getViewpointMap=function(){return this._viewpointMap};g.prototype.getViewpoint=function(a){return this._viewpointMap.get(a)||null};g.prototype.addSnapshot=function(a,e){e=new d.BCFSnapshot(a,e);this.setSnapshot(a,e)};g.prototype.setSnapshot=function(a,d){this._snapshotMap.set(a,d)};g.prototype.getSnapshotMap=function(){return this._snapshotMap};g.prototype.getSnapshot=
function(a){return this._snapshotMap.get(this._massageSnapshotFilename(a))||null};g.prototype._massageSnapshotFilename=function(a){if("viewpoint.bcfv"===a)return"snapshot.png";var d=a.split(".");return"bcfv"===d[1]?d[0]+".png":a};return g}();d.BCFTopic=h})(Communicator||(Communicator={}));
(function(d){function h(b){return b?"true":"false"}function g(b,c){b=b.createElement("Component");b.setAttribute("IfcGuid",c.ifcGuid);c.originatingSystem&&b.setAttribute("OriginatingSystem",c.originatingSystem);c.authoringToolId&&b.setAttribute("AuthoringToolId",c.authoringToolId);return b}function a(b){return 1===b.length?"0"+b:b}function e(b,c){c=c?a(Math.round(c).toString(16)):"";var f=a(Math.round(b.r).toString(16)),k=a(Math.round(b.g).toString(16));b=a(Math.round(b.b).toString(16));return""+
c+f+k+b}function c(b,c,a){var f=b.createElement("X"),k=b.createElement("Y");b=b.createElement("Z");f.innerHTML=a.x.toString();k.innerHTML=a.y.toString();b.innerHTML=a.z.toString();c.appendChild(f);c.appendChild(k);c.appendChild(b)}var b=function(){function b(b,c,f,a,e,g){this._version=d.BCFVersion.Unknown;this._components={};this._lines=[];this._clippingPlanes=[];this._viewer=g;this._filename=b;this._version=f;this._modelBounding=a;this._unitScale=1E3/e;this._parseDocument(c)}b.createViewpoint=function(c,
f,a){void 0===a&&(a=null);return __awaiter(this,void 0,void 0,function(){var k,e,l,n,g,h,v,w,y,x,z,B,A,D,C,E;return __generator(this,function(m){switch(m.label){case 0:return k=function(b){var c=[];b.forEach(function(b){for(var f=null;null!==b&&null===f;)f=e.getNodeGenericId(b),b=e.getNodeParent(b);null!==f&&c.push(f)});return c},e=c.model,l=e.getAbsoluteRootNode(),[4,c.model.getVisibilityState(l)];case 1:return n=m.sent(),[4,e.getNodeColorMap(l,d.ElementType.Faces)];case 2:return g=m.sent(),[4,e.getModelBounding(!0,
!1)];case 3:return h=m.sent(),v=e.getNodeUnitMultiplier(l),w=new b(f,null,d.BCFVersion.v2_1,h,v,c),w.setDefaultVisibility(n.defaultVisibility),y=n.visibilityExceptions,x=[],y.forEach(function(b){x.push(b)}),z=k(x),w.setVisibilityExceptions(z),B=c.selectionManager.getResults(),A=B.map(function(b){return b.getNodeId()}),D=k(A),w.setSelection(D),C=new Map,0<g.size&&g.forEach(function(b,c){c=e.getNodeParent(c);if(null!==c&&(c=e.getNodeGenericId(c),null!==c)){var f=C.get(b);void 0===f&&(f=new Set,C.set(b,
f));f.add(c)}}),w.setColors(C),w.setCamera(c.view.getCamera()),null!==a&&(E=b._markupRedlineToBcf(a.getMarkup(),c.view),w.setLines(E)),[2,w]}})})};b._markupRedlineToBcf=function(b,c){var f=function(b){b=c.projectPoint(b);return c.unprojectPoint(d.Point2.fromPoint3(b),0)},a=function(b,c,f){for(var a=2*Math.PI/f,k=[],e=0;e<=f;e++){var l=e*a;k.push(new d.Point2(b.x+Math.cos(l)*c,b.y+Math.sin(l)*c))}return k},k=function(b){for(var c=0;c<b.length-1;++c){var f=b[c],a=b[c+1];null!==f&&null!==a&&(f=[f.copy().scale(.001),
a.copy().scale(.001)],l.push(f))}},e=function(b){for(var c=0;c<b.length;++c){var f=b[c],a=b[(c+1)%b.length];null!==f&&null!==a&&(f=[f.copy().scale(.001),a.copy().scale(.001)],l.push(f))}},l=[];b.forEach(function(b){if(b instanceof d.Markup.Redline.RedlinePolyline){var l=b.getPoints().map(f);k(l)}else if(b instanceof d.Markup.Redline.RedlineCircle){l=b.getCenter();var n=b.getRadiusPoint();b=d.Point2.fromPoint3(c.projectPoint(l));l=d.Point2.fromPoint3(c.projectPoint(n));l=d.Point2.subtract(l,b).length();
l=a(b,l,40).map(function(b){return c.unprojectPoint(b,0)});e(l)}else b instanceof d.Markup.Redline.RedlineRectangle&&(l=b.getPoint1(),n=b.getPoint2(),b=d.Point2.fromPoint3(c.projectPoint(l)),n=d.Point2.fromPoint3(c.projectPoint(n)),l=[],l.push(c.unprojectPoint(b,0)),l.push(c.unprojectPoint(new d.Point2(b.x,n.y),0)),l.push(c.unprojectPoint(n,0)),l.push(c.unprojectPoint(new d.Point2(n.x,b.y),0)),e(l))});return l};b.prototype._parseDocument=function(b){if(null!==b){b=b.documentElement;var c=b.attributes.getNamedItem("Guid");
null!==c&&(this._viewpointGuid=c.value);for(b=b.firstElementChild;null!==b;){c=b.localName;if(null===c)break;switch(c){case "Components":this._version>=d.BCFVersion.v2_1?this._parseComponents(b):this._parseComponentsV2_0(b);break;case "OrthogonalCamera":this._parseOrthogonalCamera(b);break;case "PerspectiveCamera":this._parsePerspectiveCamera(b);break;case "Lines":this._parseLines(b);break;case "ClippingPlanes":this._parseClippingPlanes(b)}b=b.nextElementSibling}}};b.prototype._exportComponents=function(b){var c=
b.createElement("Components"),f=b.createElement("ViewSetupHints"),a=this._components.viewSetupHints;a&&(c.setAttribute("SpacesVisible",h(a.spacesVisible)),c.setAttribute("SpaceBoundariesVisible",h(a.spaceBoundariesVisible)),c.setAttribute("OpeningsVisible",h(a.openingsVisible)));c.appendChild(f);var k=b.createElement("Selection");(f=this._components.selection)&&f.forEach(function(c){k.appendChild(g(b,c))});c.appendChild(k);f=b.createElement("Visibility");a=this._components.defaultVisibility;var d=
this._components.visibilityExceptions;if(void 0!==a&&void 0!==d){f.setAttribute("DefaultVisibility",h(a));var r=b.createElement("Exceptions");d.forEach(function(c){r.appendChild(g(b,c))});f.appendChild(r)}c.appendChild(f);var u=b.createElement("Coloring");(f=this._components.coloring)&&f.forEach(function(c){var f=b.createElement("Color");f.setAttribute("Color",e(c.color,c.alpha));c.components.forEach(function(c){f.appendChild(g(b,c))});u.appendChild(f)});c.appendChild(u);return c};b.prototype._exportOrthogonalCamera=
function(b,f){var a=b.createElement("OrthogonalCamera"),k=b.createElement("CameraViewPoint"),d=b.createElement("CameraDirection"),e=b.createElement("CameraUpVector");c(b,k,f.cameraViewPoint);c(b,d,f.cameraDirection);c(b,e,f.cameraUpVector);b=b.createElement("ViewToWorldScale");b.innerHTML=f.viewToWorldScale.toString();a.appendChild(k);a.appendChild(d);a.appendChild(e);a.appendChild(b);return a};b.prototype._exportPerspectiveCamera=function(b,f){var a=b.createElement("PerspectiveCamera"),k=b.createElement("CameraViewPoint"),
d=b.createElement("CameraDirection"),e=b.createElement("CameraUpVector");c(b,k,f.cameraViewPoint);c(b,d,f.cameraDirection);c(b,e,f.cameraUpVector);b=b.createElement("FieldOfView");b.innerHTML=f.fieldOfView.toString();a.appendChild(k);a.appendChild(d);a.appendChild(e);a.appendChild(b);return a};b.prototype._exportLines=function(b){var f=b.createElement("Lines");this._lines.forEach(function(a){var k=b.createElement("Line"),d=b.createElement("StartPoint"),e=b.createElement("EndPoint");c(b,d,a.startPoint);
c(b,e,a.endPoint);k.appendChild(d);k.appendChild(e);f.appendChild(k)});return f};b.prototype._exportClippingPlanes=function(b){var f=b.createElement("ClippingPlanes");this._clippingPlanes.forEach(function(a){var k=b.createElement("ClippingPlane"),d=b.createElement("Location"),e=b.createElement("Direction");c(b,d,a.location);c(b,e,a.direction);k.appendChild(d);k.appendChild(e);f.appendChild(k)});return f};b.prototype.export=function(){var b=document.implementation.createDocument("","",null),c=b.createElement("VisualizationInfo");
c.appendChild(this._exportComponents(b));void 0!==this._viewpointGuid&&c.setAttribute("Guid",this._viewpointGuid);this._orthogonalCamera?c.appendChild(this._exportOrthogonalCamera(b,this._orthogonalCamera)):this._perspectiveCamera&&c.appendChild(this._exportPerspectiveCamera(b,this._perspectiveCamera));0<this._lines.length&&c.appendChild(this._exportLines(b));0<this._clippingPlanes.length&&c.appendChild(this._exportClippingPlanes(b));b.appendChild(c);return b};b.prototype.activate=function(){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._activateCamera(),[4,this._activateComponentsVisibility()];case 1:return b.sent(),[4,this._activateMarkup()];case 2:return b.sent(),[4,this._activateCuttingPlanes()];case 3:return b.sent(),this._activateSelected(),[4,this._activateColors()];case 4:return b.sent(),[2]}})})};b.prototype._activateCamera=function(){var b=this.getCamera();null!==b&&this._viewer.view.setCamera(b,800)};b.prototype._activateComponentsVisibility=
function(){return __awaiter(this,void 0,void 0,function(){var b,c,f;return __generator(this,function(a){switch(a.label){case 0:return b=this._viewer.model,c=this._getDefaultVisibility(),f=b.getNodeIdsByGenericIds(this.getVisibilityExceptions()),f.length?[4,b.setNodesVisibility([-2],c)]:[3,3];case 1:return a.sent(),[4,b.setNodesVisibility(f,!c)];case 2:return a.sent(),[3,5];case 3:return[4,b.reset()];case 4:a.sent(),a.label=5;case 5:return[2]}})})};b.prototype._activateMarkup=function(){return __awaiter(this,
void 0,void 0,function(){var b,c,f,a,e;return __generator(this,function(k){switch(k.label){case 0:return b=this._viewer.lineManager,[4,b.removeAllLines()];case 1:k.sent();c=[];for(f=0;f<this._lines.length;++f)a=this._lines[f],e=new d.Markup.Line.LineMarkup(this._viewer,a.startPoint.copy().scale(1E3),a.endPoint.copy().scale(1E3)),c.push(b.addLine(e));return[4,Promise.all(c)];case 2:return k.sent(),[2]}})})};b.prototype._activateCuttingPlanes=function(){return __awaiter(this,void 0,void 0,function(){var b,
c,f,a,e,g,h,u,t,v;return __generator(this,function(k){switch(k.label){case 0:return b=this._viewer.model,[4,b.getModelBounding(!0,!1)];case 1:return c=k.sent(),f=this._viewer.cuttingManager,[4,f.deactivateCuttingSections(!0)];case 2:k.sent(),a=0,k.label=3;case 3:if(!(a<this._clippingPlanes.length))return[3,7];e=f.getCuttingSection(a);return[4,e.clear()];case 4:return k.sent(),g=this._clippingPlanes[a],h=g.location.copy().scale(1E3),u=g.direction.normalize(),t=d.Plane.createFromPointAndNormal(h,u),
v=f.createReferenceGeometryFromFaceNormal(u,h,c),[4,e.addPlane(t,v)];case 5:k.sent(),k.label=6;case 6:return++a,[3,3];case 7:return[4,f.activateCuttingSections()];case 8:return k.sent(),[2]}})})};b.prototype._activateSelected=function(){var b=this._getGenericIdsFromComponents(this._components.selection);if(b){b=this._viewer.model.getNodeIdsByGenericIds(b);this._viewer.selectionManager.clear();for(var c=0;c<b.length;++c)this._viewer.selectionManager.selectNode(b[c],d.SelectionMode.Add)}};b.prototype._activateColors=
function(){return __awaiter(this,void 0,void 0,function(){var b,c,f,a,d,e;return __generator(this,function(k){switch(k.label){case 0:b=this._viewer.model;c=b.getAbsoluteRootNode();b.unsetNodesFaceColor([c]);b.unsetNodesLineColor([c]);if(void 0===this._components.coloring)return[3,2];f=new Map;a=function(c){var a=d._components.coloring[c];c=d._getGenericIdsFromComponents(a.components);b.getNodeIdsByGenericIds(c).forEach(function(b){f.set(b,a.color)})};d=this;for(e=0;e<this._components.coloring.length;++e)a(e);
return[4,this._viewer.model.setNodesColors(f)];case 1:k.sent(),k.label=2;case 2:return[2]}})})};b.prototype.getFilename=function(){return this._filename};b.prototype.getViewpointGuid=function(){return this._viewpointGuid||null};b.prototype._fromBCFPerspectiveCamera=function(b,c){var f=new d.Camera;f.setProjection(d.Projection.Perspective);var a=b.cameraViewPoint.copy().scale(this._unitScale);c=b.cameraDirection.copy().normalize().scale(c);c=d.Point3.add(a,c);var k=b.cameraUpVector.copy().normalize();
f.setPosition(a);f.setTarget(c);f.setUp(k);b=d.Util.degreesToRadians(b.fieldOfView);b=Math.tan(b/2);b*=2*d.Point3.subtract(f.getTarget(),f.getPosition()).length();f.setWidth(b);f.setHeight(b);return f};b.prototype._fromBCFOrthogonalCamera=function(b,c){var f=new d.Camera;f.setProjection(d.Projection.Orthographic);var a=b.cameraViewPoint.copy().scale(this._unitScale);c=b.cameraDirection.copy().normalize().scale(c);c=d.Point3.add(a,c);var k=b.cameraUpVector.copy().normalize();f.setPosition(a);f.setTarget(c);
f.setUp(k);b=b.viewToWorldScale*this._unitScale*2;f.setWidth(b);f.setHeight(b);return f};b.prototype.getCamera=function(){var b=this._modelBounding.extents().length();return this._perspectiveCamera?this._fromBCFPerspectiveCamera(this._perspectiveCamera,b/40):this._orthogonalCamera?this._fromBCFOrthogonalCamera(this._orthogonalCamera,b):null};b.prototype.setCamera=function(b){b.getProjection()===d.Projection.Perspective?(this._perspectiveCamera=this._toBCFPerspectiveCamera(b),this._orthogonalCamera=
void 0):(this._orthogonalCamera=this._toBCFOrthogonalCamera(b),this._perspectiveCamera=void 0)};b.prototype._toBCFOrthogonalCamera=function(b){var c=b.getPosition(),f=b.getTarget();f=d.Point3.subtract(f,c).normalize();var a=b.getUp().normalize();c=c.copy().scale(1/this._unitScale);b=b.getWidth()/(2*this._unitScale);return{cameraDirection:f,cameraUpVector:a,cameraViewPoint:c,viewToWorldScale:b}};b.prototype._toBCFPerspectiveCamera=function(b){var c=b.getPosition(),f=b.getTarget();f=d.Point3.subtract(f,
c).normalize();var a=b.getUp().normalize();c=c.copy().scale(1/this._unitScale);var k=b.getWidth();b=d.Point3.subtract(b.getTarget(),b.getPosition()).length();b=d.Util.radiansToDegrees(2*Math.atan(k/(2*b)));return{cameraDirection:f,cameraUpVector:a,cameraViewPoint:c,fieldOfView:b}};b.prototype.setDefaultVisibility=function(b){this._components.defaultVisibility=b};b.prototype._getDefaultVisibility=function(){return void 0!==this._components.defaultVisibility?this._components.defaultVisibility:!0};b.prototype.setVisibilityExceptions=
function(b){b=b.map(function(b){return{ifcGuid:b}});this._components.visibilityExceptions=b};b.prototype.getVisibilityExceptions=function(){return this._getGenericIdsFromComponents(this._components.visibilityExceptions)};b.prototype.setColors=function(b){var c=[];b.forEach(function(b,f){var a=[];b.forEach(function(b){a.push({ifcGuid:b})});c.push({color:f,components:a})});this._components.coloring=c};b.prototype.getColors=function(){var b=new Map,c=this._components.coloring;void 0!==c&&c.forEach(function(c){var f=
c.color.copy(),a=new Set;c.components.map(function(b){a.add(b.ifcGuid)});b.set(f,a)});return b};b.prototype.setLines=function(b){var c=this;this._lines=[];b.forEach(function(b){b={startPoint:b[0].copy(),endPoint:b[1].copy()};c._lines.push(b)})};b.prototype.getLines=function(){var b=[];this._lines.forEach(function(c){b.push([c.startPoint.copy(),c.endPoint.copy()])});return b};b.prototype.setClippingPlanes=function(b){var c=this;this._clippingPlanes=[];b.forEach(function(b){b={location:b[0].copy(),
direction:b[1].copy()};c._clippingPlanes.push(b)})};b.prototype.getClippingPlanes=function(){var b=[];this._clippingPlanes.forEach(function(c){b.push([c.location.copy(),c.direction.copy()])});return b};b.prototype.setSelection=function(b){b=b.map(function(b){return{ifcGuid:b}});this._components.selection=b};b.prototype.getSelection=function(){var b=[],c=this._components.selection;void 0!==c&&c.forEach(function(c){b.push(c.ifcGuid)});return b};b.prototype._getGenericIdsFromComponents=function(b){if(!b)return[];
for(var c=[],f=0;f<b.length;++f)c.push(b[f].ifcGuid);return c};b.prototype._parseComponentsV2_0=function(b){console.assert(this._version<=d.BCFVersion.v2_0);var c=[],f=[],a=[],k=!0;for(b=b.firstElementChild;null!==b;){var e=b.localName;if(null===e)break;switch(e){case "Component":var g=b.attributes,h=g.getNamedItem("IfcGuid");e=g.getNamedItem("Selected");var t=g.getNamedItem("Visible");g=g.getNamedItem("Color");null!==h&&h.value&&(h={ifcGuid:h.value},null!==e&&"true"===e.value&&c.push(h),k=!1,null!==
t&&"false"===t.value||f.push(h),null!==g&&g.value&&a.push(this._colorFromArgb(g.value,[h])))}b=b.nextElementSibling}this._components={defaultVisibility:k,selection:c,visibilityExceptions:f,coloring:a}};b.prototype._parseComponents=function(b){console.assert(this._version>=d.BCFVersion.v2_1);b=b.firstElementChild;for(var c={spacesVisible:!1,spaceBoundariesVisible:!1,openingsVisible:!1},f=[],a=!0,k=[],e=[];null!==b;){var g=b.localName;if(null===g)break;var h=b.attributes;switch(g){case "ViewSetupHints":g=
h.getNamedItem("SpacesVisible");var t=h.getNamedItem("SpaceBoundariesVisible");h=h.getNamedItem("OpeningsVisible");null!==g&&(c.spacesVisible="true"===g.value);null!==t&&(c.spaceBoundariesVisible="true"===t.value);null!==h&&(c.openingsVisible="true"===h.value);break;case "Selection":f=this._getComponents(b);break;case "Visibility":(h=h.getNamedItem("DefaultVisibility"))&&(a="true"===h.value);h=b.firstElementChild;null!==h&&(k=this._getComponents(h));break;case "Coloring":e=this._getColoring(b)}b=
b.nextElementSibling}this._components={viewSetupHints:c,selection:f,defaultVisibility:a,visibilityExceptions:k,coloring:e}};b.prototype._getCameraData=function(b){var c=[];for(b=b.firstElementChild;null!==b;)switch(b.nodeName){case "FieldOfView":case "ViewToWorldScale":b=b.textContent;null!==b&&c.push(parseFloat(b));b=null;break;default:c.push(this._getPoint(b)),b=b.nextElementSibling}return c};b.prototype._parseOrthogonalCamera=function(b){b=this._getCameraData(b);4===b.length&&(this._orthogonalCamera=
{cameraViewPoint:b[0],cameraDirection:b[1],cameraUpVector:b[2],viewToWorldScale:b[3]})};b.prototype._parsePerspectiveCamera=function(b){b=this._getCameraData(b);4===b.length&&(this._perspectiveCamera={cameraViewPoint:b[0],cameraDirection:b[1],cameraUpVector:b[2],fieldOfView:b[3]})};b.prototype._parseLines=function(b){for(b=b.firstElementChild;null!==b;)this._lines.push(this._getLine(b)),b=b.nextElementSibling};b.prototype._parseClippingPlanes=function(b){for(b=b.firstElementChild;null!==b;)this._clippingPlanes.push(this._getClippingPlane(b)),
b=b.nextElementSibling};b.prototype._getClippingPlane=function(b){b=b.firstElementChild;var c=d.Point3.zero(),f=d.Point3.zero();null!==b&&(c=this._getPoint(b),b=b.nextElementSibling,null!==b&&(f=this._getPoint(b)));return{location:c,direction:f}};b.prototype._getLine=function(b){b=b.firstElementChild;var c=d.Point3.zero(),f=d.Point3.zero();null!==b&&(c=this._getPoint(b),b=b.nextElementSibling,null!==b&&(f=this._getPoint(b)));return{startPoint:c,endPoint:f}};b.prototype._getPoint=function(b){var c=
[];for(b=b.firstElementChild;null!==b;){var f=b.firstChild;null!==f&&c.push(parseFloat(f.wholeText));b=b.nextElementSibling}console.assert(3===c.length);return new d.Point3(c[0],c[1],c[2])};b.prototype._colorFromArgb=function(b,c){c={color:d.Color.black(),components:c};for(var f=[],a=0;a<b.length;a+=2){var k=b.substr(a,2);f.push(parseInt(k,16))}3===f.length?c.color.set(f[0],f[1],f[2]):4===f.length&&(c.alpha=f[0],c.color.set(f[1],f[2],f[3]));return c};b.prototype._getColoring=function(b){var c=[];
for(b=b.firstElementChild;null!==b;){var f=b.attributes.getNamedItem("Color"),a=this._getComponents(b);f&&a.length&&c.push(this._colorFromArgb(f.value,a));b=b.nextElementSibling}return c};b.prototype._getComponents=function(b){var c=[];for(b=b.firstElementChild;null!==b;){var f=b.attributes,a=f.getNamedItem("IfcGuid"),k=f.getNamedItem("OriginatingSystem");f=f.getNamedItem("AuthoringToolId");null!==a&&(a={ifcGuid:a.value},null!==k&&(a.originatingSystem=k.value),null!==f&&(a.authoringToolId=f.value),
c.push(a));b=b.nextElementSibling}return c};return b}();d.BCFViewpoint=b})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(a,d,c){this.r=a;this.g=d;this.b=c}d.prototype.assign=function(a){this.set(a.r,a.g,a.b);return this};d.prototype.copy=function(){return new d(this.r,this.g,this.b)};d.prototype.equals=function(a){return this.r===a.r&&this.g===a.g&&this.b===a.b};d.prototype.set=function(a,d,c){this.r=a;this.g=d;this.b=c};d.prototype.setFromFloat=function(a,d,c){this.r=Math.round(255*a);this.g=Math.round(255*d);this.b=Math.round(255*c)};d.prototype.fromFloatArray=function(a){return this.setFromFloat(a[0],
a[1],a[2])};d.prototype.getFloatArray=function(){return[this.r/255,this.g/255,this.b/255]};d.prototype.toFloatArray=function(a){a[0]=this.r/255;a[1]=this.g/255;a[2]=this.b/255};d.fromJson=function(a){return new d(a.r,a.g,a.b)};d.prototype.toJson=function(){return this._toJson()};d.prototype._toJson=function(){return{r:this.r,g:this.g,b:this.b}};d.prototype.forJson=function(){return this.toJson()};d.createFromFloat=function(a,e,c){var b=d.black();b.setFromFloat(a,e,c);return b};d.createFromFloatArray=
function(a){var e=d.black();e.fromFloatArray(a);return e};d.red=function(){return new d(255,0,0)};d.green=function(){return new d(0,255,0)};d.blue=function(){return new d(0,0,255)};d.yellow=function(){return new d(255,255,0)};d.white=function(){return new d(255,255,255)};d.black=function(){return new d(0,0,0)};return d}();d.Color=h;h=function(){return function(d,a){this.top=d;this.bottom=a}}();d.VerticalGradient=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a){var e=this;this._position=new d.OverlayUnitPoint(0,d.OverlayUnit.Pixels,0,d.OverlayUnit.Pixels);this._viewportSize=new d.OverlayUnitPoint(200,d.OverlayUnit.Pixels,200,d.OverlayUnit.Pixels);this._anchor=d.OverlayAnchor.LowerLeftCorner;this._instanceKeys=[];this._enabled=!1;this._sceneReadyCompleted=d.Util.OpenPromise.create();this._geometryCreated=!1;this._viewer=a;this._viewer.setCallbacks({sceneReady:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,
function(c){switch(c.label){case 0:return this._createViewport(),this._updateVisibility(),[4,this._createGeometry()];case 1:return c.sent(),this._sceneReadyCompleted.resolve(),[2]}})})},_assemblyTreeReady:function(){return __awaiter(e,void 0,void 0,function(){var c,b,f,a,d;return __generator(this,function(k){switch(k.label){case 0:return[4,this._sceneReadyCompleted];case 1:k.sent();c=this._viewer.model;b=0;for(f=this._instanceKeys;b<f.length;b++)a=f[b],d=c._getNodeFromInstanceInc(!0,0,a,!0),c._preventNodeDeletion(d);
return[2]}})})},_firstAttachment:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this._onCameraUpdate()];case 1:return c.sent(),this._updateVisibility(),[2]}})})},overlayViewportSet:function(c){c===d.BuiltinOverlayIndex.AxisTriad&&e._onViewportSet()}})}g.prototype.setAxisColor=function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b,f;return __generator(this,function(k){switch(k.label){case 0:return[4,this._sceneReadyCompleted];
case 1:k.sent();switch(a){case d.Axis.X:c=this._instanceKeys[0];b=this._instanceKeys[3];break;case d.Axis.Y:c=this._instanceKeys[1];b=this._instanceKeys[4];break;case d.Axis.Z:c=this._instanceKeys[2];b=this._instanceKeys[5];break;default:return[2]}f=this._getScEngine();f.setPartColor([0,c],d.ElementType.Faces,e);f.setPartColor([0,b],d.ElementType.Lines,e);return[2]}})})};g.prototype.setAnchor=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return this._anchor=
a,[4,this._sceneReadyCompleted];case 1:return d.sent(),[2,this._updateViewport()]}})})};g.prototype.getAnchor=function(){return this._anchor};g.prototype.enable=function(){this._enabled=!0;this._updateVisibility();return Promise.resolve()};g.prototype.disable=function(){this._enabled=!1;this._updateVisibility();return Promise.resolve()};g.prototype._updateVisibility=function(){this._enabled?this._showOverlay():this._hideOverlay()};g.prototype._hideOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.AxisTriad,
!1)};g.prototype._showOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.AxisTriad,!0)};g.prototype.getEnabled=function(){return this._enabled};g.prototype.getOverlayId=function(){return d.BuiltinOverlayIndex.AxisTriad};g.prototype._updateViewport=function(){this._viewer.overlayManager.setViewport(d.BuiltinOverlayIndex.AxisTriad,this._anchor,this._position.x,d.OverlayUnit.Pixels,this._position.y,d.OverlayUnit.Pixels,this._viewportSize.x,d.OverlayUnit.Pixels,this._viewportSize.y,
d.OverlayUnit.Pixels)};g.prototype._createViewport=function(){var a=this._viewer.overlayManager;this._updateViewport();var e=new d.Camera;e.setPosition(new d.Point3(0,0,10));e.setTarget(d.Point3.zero());e.setUp(new d.Point3(0,1,0));e.setWidth(g._fieldSize);e.setHeight(g._fieldSize);e.setProjection(d.Projection.Orthographic);a.setCamera(d.BuiltinOverlayIndex.AxisTriad,e)};g.prototype._onViewportSet=function(){var a=this._viewer.overlayManager,e=a._getViewportPosition(d.BuiltinOverlayIndex.AxisTriad),
c=a._getViewportSize(d.BuiltinOverlayIndex.AxisTriad);a=a.getViewportAnchor(d.BuiltinOverlayIndex.AxisTriad);null!==e&&null!==c&&null!==a&&(this._position=e,this._viewportSize=c,this._anchor=a)};g.prototype._createGeometry=function(){return __awaiter(this,void 0,void 0,function(){var a,e,c,b,f,k,l;return __generator(this,function(n){switch(n.label){case 0:if(this._geometryCreated)return[2];a=[this._createAxis(g._xRotMatrix,0,g._xColor),this._createAxis(g._yRotMatrix,1,g._yColor),this._createAxis(g._zRotMatrix,
2,g._zColor),this._createAxisLabel(d.Axis.X,g._xColor,3),this._createAxisLabel(d.Axis.Y,g._yColor,4),this._createAxisLabel(d.Axis.Z,g._zColor,5)];return[4,Promise.all(a)];case 1:e=n.sent();this._onCameraUpdate();c=[];b=0;for(f=e;b<f.length;b++)k=f[b],c.push(0,k);l=this._getScEngine();l.setPartVisibility(c,!0,!0);this._createGeomCallbacks();this._geometryCreated=!0;return[2]}})})};g.prototype._createGeomCallbacks=function(){var a=this;this._viewer.setCallbacks({camera:function(){a._onCameraUpdate()}})};
g.prototype._geometryHasBeenCreated=function(){return this._geometryCreated};g.prototype.insideOverlay=function(a){var d=this._viewer.overlayManager._toPixelPoint(this._viewportSize),c=this._getOverlayOffset();return a.x>=c.x&&a.y>=c.y&&a.x<=c.x+d.x&&a.y<=c.y+d.y};g.prototype._getOverlayOffset=function(){var a=this._viewer.overlayManager._toPixelPoint(this._viewportSize);return this._viewer.overlayManager._getOverlayOffset(this._anchor,a)};g.prototype._getViewportSize=function(){return this._viewportSize};
g.prototype._getViewportPixelSize=function(){return this._viewer.overlayManager._toPixelPoint(this._viewportSize)};g.prototype.getSelectionAxis=function(a){console.assert(this._enabled);if(null===a||!a.isFaceSelection()||a.overlayIndex()!==d.BuiltinOverlayIndex.AxisTriad)return null;var e=this._viewer.model;a=a.getNodeId();e=e._gatherInstanceIncsFromNodeIds([a],1);if(2!==e.length||0!==e[0])return null;e=e[1];for(a=0;a<this._instanceKeys.length;++a)if(this._instanceKeys[a]===e)switch(a%3){case 0:return d.Axis.X;
case 1:return d.Axis.Y;case 2:return d.Axis.Z}return null};g.prototype.onClickSelection=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,f,k,l,n,g;return __generator(this,function(m){switch(m.label){case 0:e=this.getSelectionAxis(a);if(null===e)return[2];c=this._viewer.model;b=this._viewer.view;switch(e){case d.Axis.X:f=34;break;case d.Axis.Y:f=68;break;case d.Axis.Z:f=24}return[4,c.getModelBounding(!0,!1)];case 1:return k=m.sent(),l=b.getCamera(),n=this._alignedFitBounding(f,
!1,!1,k),l.equals(n)&&(n=this._alignedFitBounding(f,!0,!1,k)),[4,b._setCameraPromise(n,d.DefaultTransitionDuration)];case 2:return m.sent(),g=this._viewer.model.getAbsoluteRootNode(),0===this._viewer.model.getNodeChildren(g).length?[2,this._viewer._getScEngine().markCameraAsEmpty()]:[2]}})})};g.prototype._getScEngine=function(){return this._viewer._getScEngine()};g.prototype._createInstance=function(a,e,c,b,f,k){return __awaiter(this,void 0,void 0,function(){var l,n,g,p,h;return __generator(this,
function(m){switch(m.label){case 0:return[4,this._viewer.model.createMesh(a)];case 1:return l=m.sent(),n=new d.MeshInstanceData(l),n.setCreationFlags(k|d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.ExcludeBounding|d.MeshInstanceCreationFlags.Invisible),n.setOverlayIndex(d.BuiltinOverlayIndex.AxisTriad),n.setFaceColor(c),n.setLineColor(b),n.setMatrix(f),g=this._getScEngine(),[4,g.createMeshInstance(n)];case 2:return p=m.sent(),h=p[1],this._instanceKeys[e]=
h,[2,h]}})})};g.prototype._createAxis=function(a,e,c){var b=d.Util.generateConeCylinderMeshData(.2,20,2,.4,.5,.1);return this._createInstance(b,e,c,d.Color.black(),a,d.MeshInstanceCreationFlags.None)};g.prototype._createAxisLabel=function(a,e,c){var b=new d.MeshData;b.setFaceWinding(d.FaceWinding.Clockwise);var f=new d.Matrix;a===d.Axis.X?(b.addPolyline([.15,.25,0,-.15,-.25,0]),b.addPolyline([-.15,.25,0,.15,-.25,0]),f.setTranslationComponent(3.1,0,0)):a===d.Axis.Y?(b.addPolyline([-.15,.25,0,0,0,0]),
b.addPolyline([0,0,0,.15,.25,0]),b.addPolyline([0,0,0,0,-.3125,0]),f.setTranslationComponent(0,3.1,0)):a===d.Axis.Z&&(b.addPolyline([-.15,.25,0,.15,.25,0]),b.addPolyline([.15,.25,0,-.15,-.25,0]),b.addPolyline([-.15,-.25,0,.15,-.25,0]),f.setTranslationComponent(0,0,3.1));return this._createInstance(b,c,d.Color.black(),e,f,d.MeshInstanceCreationFlags.ScreenOriented)};g.prototype._onCameraUpdate=function(){var a=new d.Camera,e=this._viewer.view.getCamera();a.setPosition(e.getPosition().subtract(e.getTarget()).normalize());
a.setTarget(d.Point3.zero());a.setUp(e.getUp());a.setProjection(d.Projection.Orthographic);a.setWidth(g._fieldSize);a.setHeight(g._fieldSize);this._viewer.overlayManager.setCamera(d.BuiltinOverlayIndex.AxisTriad,a)};g.prototype._alignedFitBounding=function(a,e,c,b){var f=d.Point3.subtract(b.max,b.min).length();b=d.Point3.add(d.Point3.scale(b.min,.5),d.Point3.scale(b.max,.5));var k=new d.Point3(b.x,b.y,b.z+f);k=d.Point3.subtract(b,k);var l=-k.length();c=c?-1:1;0===a?(a=new d.Point3(0,c,0),e&&k.negate()):
(e&&(l=-l),0!==(a&2)?k=new d.Point3(l,0,0):0!==(a&4)?k=new d.Point3(0,l,0):(console.assert(0!==(a&8)),k=new d.Point3(0,0,l)),0!==(a&16)?a=new d.Point3(c,0,0):0!==(a&32)?a=new d.Point3(0,c,0):(console.assert(0!==(a&64)),a=new d.Point3(0,0,c)));e=d.Point3.subtract(b,k);c=this._viewer.view.getCamera();return d.Camera.create(e,b,a,c.getProjection(),f,f,c.getNearLimit())};g._xRotMatrix=d.Matrix.createFromOffAxisRotation(new d.Point3(0,0,1),-90);g._yRotMatrix=new d.Matrix;g._zRotMatrix=d.Matrix.createFromOffAxisRotation(new d.Point3(1,
0,0),90);g._xColor=new d.Color(168,56,59);g._yColor=new d.Color(96,166,50);g._zColor=new d.Color(41,81,185);g._fieldSize=8;return g}();d.AxisTriad=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a){this._id=0;this._bcfMap=new Map;this._viewer=a}g.prototype._getId=function(){return++this._id};g.prototype.getBCFMap=function(){return this._bcfMap};g.prototype.getBCFData=function(a){return this._bcfMap.get(a)||null};g.prototype.removeBCFData=function(a){this._bcfMap.delete(a);this._viewer.trigger("bcfRemoved",a)};g.prototype.createBCFData=function(a){var e=this._getId();a=new d.BCFData(a,e);this._bcfMap.set(e,a);this._viewer.trigger("bcfLoaded",a.getId(),
a.getFilename());return a};g.prototype.addBCFFromFile=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b;return __generator(this,function(f){switch(f.label){case 0:return e=this._getId(),c=new d.BCFData(a,e),this._bcfMap.set(e,c),[4,new JSZip.external.Promise(function(b,c){JSZipUtils.getBinaryContent(a,function(f,a){f?c(f):b(a)})})];case 1:return b=f.sent(),[4,this._loadBCFData(b,c)];case 2:return f.sent(),[2]}})})};g.prototype.addBCFFromBuffer=function(a,e){return __awaiter(this,
void 0,void 0,function(){var c,b;return __generator(this,function(f){switch(f.label){case 0:return c=this._getId(),b=new d.BCFData(e,c),this._bcfMap.set(c,b),[4,this._loadBCFData(a,b)];case 1:return f.sent(),[2]}})})};g.prototype._getVersion=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,f;return __generator(this,function(k){switch(k.label){case 0:return e=a.file("bcf.version"),null!==e?[3,1]:[2,d.BCFVersion.v1_0];case 1:return[4,this._getDocument(e)];case 2:c=k.sent();b=c.documentElement;
f=b.firstElementChild;if(null!==f&&null!==f.textContent)switch(f.textContent){case "2.0 RC":return[2,d.BCFVersion.v2_0];case "2.1":return[2,d.BCFVersion.v2_1]}return[2,d.BCFVersion.Unknown]}})})};g.prototype._loadBCFData=function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b,f,k,l,n,g,p,h,r=this;return __generator(this,function(m){switch(m.label){case 0:return c=this._viewer.model,[4,c.getModelBounding(!0,!1)];case 1:return b=m.sent(),f=c.getNodeUnitMultiplier(c.getAbsoluteRootNode()),
k=e.getId(),l=e.getFilename(),[4,JSZip.loadAsync(a)];case 2:return n=m.sent(),p=(g=e).setVersion,[4,this._getVersion(n)];case 3:return p.apply(g,[m.sent()]),h=[],n.forEach(function(c){return __awaiter(r,void 0,void 0,function(){var a,g,m,p,q,r,u,t,C,E,F,H,G,I,K,J,L;return __generator(this,function(v){switch(v.label){case 0:a=d.Util.OpenPromise.create();h.push(a);g=this._getFileType(c);if(g!==d.BCFFileType.Markup&&g!==d.BCFFileType.Snapshot&&g!==d.BCFFileType.Viewpoint)return[3,7];m=c.split("/");p=
m[0];q=m[1];r=e.getTopic(p);null===r&&(r=new d.BCFTopic(k,l,p,this._viewer),e.addTopic(p,r));if(!q.length)return[3,7];u=n.file(c);if(null===u)return[3,7];t=g;switch(t){case d.BCFFileType.Markup:return[3,1];case d.BCFFileType.Viewpoint:return[3,3];case d.BCFFileType.Snapshot:return[3,5]}return[3,7];case 1:return E=(C=r).addMarkup,F=[q],[4,this._getDocument(u)];case 2:return E.apply(C,F.concat([v.sent()])),[3,7];case 3:return G=(H=r).addViewpoint,I=[q],[4,this._getDocument(u)];case 4:return G.apply(H,
I.concat([v.sent(),e.getVersion(),b,f])),[3,7];case 5:return J=(K=r).addSnapshot,L=[q],[4,u.async("uint8array")];case 6:return J.apply(K,L.concat([v.sent()])),[3,7];case 7:return a.resolve(),[2]}})})}),[4,d.Util.waitForAll(h)];case 4:return m.sent(),this._viewer.trigger("bcfLoaded",k,l),[2]}})})};g.prototype._getDocument=function(a){return __awaiter(this,void 0,void 0,function(){var d,c,b;return __generator(this,function(f){switch(f.label){case 0:return d=new DOMParser,b=(c=d).parseFromString,[4,
a.async("text")];case 1:return[2,b.apply(c,[f.sent(),"application/xml"])]}})})};g.prototype._getFileType=function(a){if("/"===a.slice(-1))return d.BCFFileType.TopicFolder;a=a.split(".");console.assert(2===a.length);switch(a[1]){case "bcf":return d.BCFFileType.Markup;case "bcfv":return d.BCFFileType.Viewpoint;case "png":return d.BCFFileType.Snapshot;case "version":return d.BCFFileType.Version;case "xsd":return d.BCFFileType.Schema;case "bcfp":return d.BCFFileType.Project}return d.BCFFileType.Unknown};
return g}();d.BCFManager=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a,e){void 0===a&&(a=d.Point3.zero());void 0===e&&(e=d.Point3.zero());this.min=a.copy();this.max=e.copy()}g.prototype.copy=function(){return new g(this.min,this.max)};g.prototype.equals=function(a){return this.min.equals(a.min)&&this.max.equals(a.max)};g.prototype.center=function(){var a=d.Point3.add(this.min,this.max);a.scale(.5);return a};g.prototype.extents=function(){return d.Point3.subtract(this.max,this.min)};g.prototype.addBox=function(a){a.isDegenerate()||
(this.addPoint(a.min),this.addPoint(a.max))};g.prototype.addPoint=function(a){a.x<this.min.x&&(this.min.x=a.x);a.y<this.min.y&&(this.min.y=a.y);a.z<this.min.z&&(this.min.z=a.z);a.x>this.max.x&&(this.max.x=a.x);a.y>this.max.y&&(this.max.y=a.y);a.z>this.max.z&&(this.max.z=a.z)};g.prototype.toJson=function(){return this._toJson()};g.prototype._toJson=function(){return{min:this.min.toJson(),max:this.max.toJson()}};g.prototype.forJson=function(){return this.toJson()};g.fromJson=function(a){var e=d.Point3.fromJson(a.min);
a=d.Point3.fromJson(a.max);return new g(e,a)};g.construct=function(a){return g.fromJson(a)};g.prototype.getCorners=function(){var a=[];a[0]=this.min.copy();a[1]=this.min.copy();a[2]=this.min.copy();a[1].x=this.max.x;a[2].y=this.max.y;a[3]=a[2].copy();a[3].x=this.max.x;a[4]=a[0].copy();a[5]=a[1].copy();a[6]=a[2].copy();a[7]=a[3].copy();a[4].z=this.max.z;a[5].z=this.max.z;a[6].z=this.max.z;a[7].z=this.max.z;return a};g.invalid=function(){return new g(new d.Point3(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,
Number.POSITIVE_INFINITY),new d.Point3(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY))};g.prototype.isDegenerate=function(){return this.min.x>this.max.x||this.min.y>this.max.y||this.min.z>this.max.z};return g}();d.Box=h})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(){var a=this;this._aliasMap=new Map;this._callbackMap=new Map;this._activeTriggerDepth=0;this._pendingClearUnboundFilteredNames=new Set;this._aliasMap.set("sceneRendered","frameDrawn");this.bind({selectionArray:function(c){a._triggerDeprecatedSelectionCallback(c)},incrementalSelectionBatchBegin:function(){return a.unsafeTrigger("volumeSelectionBatchBegin")},incrementalSelectionBatchEnd:function(){return a.unsafeTrigger("volumeSelectionBatchEnd")},
incrementalSelectionEnd:function(){return a.unsafeTrigger("volumeSelectionEnd")},visibilityChanged:function(c,b){a.unsafeTrigger("partsVisibilityShown",c);a.unsafeTrigger("partsVisibilityHidden",b)}})}a.prototype._triggerDeprecatedSelectionCallback=function(a){if(0===a.length)this.unsafeTrigger("selection",[d.Event.NodeSelectionEvent._createNull()]);else if(100>=a.length)this.unsafeTrigger("selection",a);else{var c=0;for(a=h.chunkify(a,100);c<a.length;c++)this.unsafeTrigger("selection",a[c])}};a.prototype._filterName=
function(a){var c=this._aliasMap.get(a);return void 0===c?a:c};a.prototype.bind=function(a,c){for(var b=0,f=Object.keys(a);b<f.length;b++){var k=f[b],d=a[k];if("function"===typeof d){k=this._filterName(k);var e=this._callbackMap.get(k);void 0===e?this._callbackMap.set(k,[d]):c?e.unshift(d):e.push(d)}}};a.prototype.unbind=function(a){for(var c=0,b=Object.keys(a);c<b.length;c++){var f=b[c],k=this._filterName(f),d=this._callbackMap.get(k);if(void 0!==d){f=a[f];for(var e=0;e<d.length;e++)d[e]===f&&(d[e]=
null,this._pendingClearUnboundFilteredNames.add(k))}}this._clearUnboundCallbacks()};a.prototype._clearUnboundCallbacks=function(){var a=this;0!==this._pendingClearUnboundFilteredNames.size&&0===this._activeTriggerDepth&&(this._pendingClearUnboundFilteredNames.forEach(function(c){var b=a._callbackMap.get(c);void 0!==b&&(b=b.filter(function(b){return null!==b}),0===b.length?a._callbackMap.delete(c):a._callbackMap.set(c,b))}),this._pendingClearUnboundFilteredNames.clear())};a.prototype.promiseTrigger=
function(a,c){for(var b=[],f=2;f<arguments.length;f++)b[f-2]=arguments[f];return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(k){switch(k.label){case 0:console.assert(a!==c),k.label=1;case 1:return k.trys.push([1,3,4,5]),[4,this._unsafePromiseTrigger(a,b)];case 2:return k.sent(),[3,5];case 3:return f=k.sent(),console.error("Rejected promise in '"+a+"' callback:",f),[3,5];case 4:return null!==c&&this.unsafeTrigger(c,b),[7];case 5:return[2]}})})};a.prototype._unsafePromiseTrigger=
function(a,c){var b=this._filterName(a);b=this._callbackMap.get(b);var f=[];if(void 0!==b){++this._activeTriggerDepth;for(var k=0;k<b.length;k++){var e=b[k];if(null!==e)try{f.push(e.apply(null,c))}catch(n){console.error("Unhandled exception in '"+a+"' callback:",n)}}--this._activeTriggerDepth;this._clearUnboundCallbacks()}return d.Util.waitForAll(f)};a.prototype.trigger=function(a){for(var c=[],b=1;b<arguments.length;b++)c[b-1]=arguments[b];this.unsafeTrigger(a,c)};a.prototype.unsafeTrigger=function(a,
c){var b=this._filterName(a);b=this._callbackMap.get(b);if(void 0!==b){++this._activeTriggerDepth;for(var f=0;f<b.length;f++){var k=b[f];if(null!==k)try{k.apply(null,c)}catch(l){console.error("Unhandled exception in '"+a+"' callback:",l)}}--this._activeTriggerDepth;this._clearUnboundCallbacks()}};return a}();h.CallbackManager=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(a){a[a.LoadModel=0]="LoadModel";a[a.CreateNode=1]="CreateNode";a[a.CreateInstance=2]="CreateInstance";a[a.CreatePmi=3]="CreatePmi"})(d.NodeSource||(d.NodeSource={}));(function(a){a[a.Desktop=0]="Desktop";a[a.Mobile=1]="Mobile"})(d.ScreenConfiguration||(d.ScreenConfiguration={}));(function(a){a[a.Faces=0]="Faces";a[a.Lines=1]="Lines";a[a.Points=2]="Points"})(d.ElementType||(d.ElementType={}));(function(a){a[a.Orthographic=0]="Orthographic";a[a.Perspective=1]="Perspective"})(d.Projection||
(d.Projection={}));(function(a){a[a.Top=0]="Top";a[a.Bottom=1]="Bottom";a[a.Left=2]="Left";a[a.Right=3]="Right";a[a.Front=4]="Front";a[a.Back=5]="Back";a[a.Iso=6]="Iso";a[a.TopRightFront=7]="TopRightFront";a[a.TopLeftFront=8]="TopLeftFront";a[a.TopLeftBack=9]="TopLeftBack";a[a.TopRightBack=10]="TopRightBack";a[a.TopBack=11]="TopBack";a[a.TopFront=12]="TopFront";a[a.TopLeft=13]="TopLeft";a[a.TopRight=14]="TopRight";a[a.BottomRightBack=15]="BottomRightBack";a[a.BottomLeftBack=16]="BottomLeftBack";a[a.BottomLeftFront=
17]="BottomLeftFront";a[a.BottomRightFront=18]="BottomRightFront";a[a.BottomFront=19]="BottomFront";a[a.BottomBack=20]="BottomBack";a[a.BottomLeft=21]="BottomLeft";a[a.BottomRight=22]="BottomRight";a[a.RightBottomBack=23]="RightBottomBack";a[a.RightBottomFront=24]="RightBottomFront";a[a.RightTopFront=25]="RightTopFront";a[a.RightTopBack=26]="RightTopBack";a[a.RightTop=27]="RightTop";a[a.RightBottom=28]="RightBottom";a[a.RightFront=29]="RightFront";a[a.RightBack=30]="RightBack";a[a.LeftBottomFront=
31]="LeftBottomFront";a[a.LeftBottomBack=32]="LeftBottomBack";a[a.LeftTopBack=33]="LeftTopBack";a[a.LeftTopFront=34]="LeftTopFront";a[a.LeftTop=35]="LeftTop";a[a.LeftBottom=36]="LeftBottom";a[a.LeftBack=37]="LeftBack";a[a.LeftFront=38]="LeftFront";a[a.FrontBottomRight=39]="FrontBottomRight";a[a.FrontTopRight=40]="FrontTopRight";a[a.FrontTopLeft=41]="FrontTopLeft";a[a.FrontBottomLeft=42]="FrontBottomLeft";a[a.FrontRight=43]="FrontRight";a[a.FrontLeft=44]="FrontLeft";a[a.FrontTop=45]="FrontTop";a[a.FrontBottom=
46]="FrontBottom";a[a.BackTopRight=47]="BackTopRight";a[a.BackBottomRight=48]="BackBottomRight";a[a.BackBottomLeft=49]="BackBottomLeft";a[a.BackTopLeft=50]="BackTopLeft";a[a.BackLeft=51]="BackLeft";a[a.BackRight=52]="BackRight";a[a.BackBottom=53]="BackBottom";a[a.BackTop=54]="BackTop"})(d.ViewOrientation||(d.ViewOrientation={}));(function(a){a[a.X=0]="X";a[a.Y=1]="Y";a[a.Z=2]="Z"})(d.Axis||(d.Axis={}));(function(a){a[a.None=-1]="None";a[a.Left=0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right"})(d.Button||
(d.Button={}));(function(a){a[a.None=0]="None";a[a.Left=1]="Left";a[a.Right=2]="Right";a[a.Middle=4]="Middle"})(d.Buttons||(d.Buttons={}));(function(a){a[a.Axis=0]="Axis";a[a.Plane=1]="Plane";a[a.ViewPlane=2]="ViewPlane";a[a.Rotate=3]="Rotate"})(d.HandleType||(d.HandleType={}));(function(a){a[a.Translate=0]="Translate";a[a.Rotate=1]="Rotate"})(d.HandleEventType||(d.HandleEventType={}));(function(a){a[a.Invalid=-1]="Invalid";a[a.None=0]="None";a[a.Navigate=1]="Navigate";a[a.Orbit=2]="Orbit";a[a.Pan=
3]="Pan";a[a.Zoom=4]="Zoom";a[a.Walk=5]="Walk";a[a.KeyboardWalk=6]="KeyboardWalk";a[a.WalkMode=7]="WalkMode";a[a.Turntable=8]="Turntable";a[a.Select=9]="Select";a[a.AreaSelect=10]="AreaSelect";a[a.RayDrillSelect=11]="RayDrillSelect";a[a.RedlineCircle=12]="RedlineCircle";a[a.RedlineText=13]="RedlineText";a[a.RedlineRectangle=14]="RedlineRectangle";a[a.RedlinePolyline=15]="RedlinePolyline";a[a.MeasureEdgeLength=16]="MeasureEdgeLength";a[a.MeasureFaceFaceDistance=17]="MeasureFaceFaceDistance";a[a.MeasureLineLineAngle=
18]="MeasureLineLineAngle";a[a.MeasurePointPointDistance=19]="MeasurePointPointDistance";a[a.MeasureBodyBodyDistance=20]="MeasureBodyBodyDistance";a[a.MeasureFaceFaceAngle=21]="MeasureFaceFaceAngle";a[a.MeasurePolylineDistance=22]="MeasurePolylineDistance";a[a.MeasurePolygonArea=23]="MeasurePolygonArea";a[a.Note=24]="Note";a[a.Cutting=25]="Cutting";a[a.Handle=26]="Handle";a[a.NavCube=27]="NavCube";a[a.AxisTriad=28]="AxisTriad";a[a.Floorplan=29]="Floorplan"})(d.OperatorId||(d.OperatorId={}));(function(a){a[a.MouseDown=
0]="MouseDown";a[a.MouseMove=1]="MouseMove";a[a.MouseUp=2]="MouseUp";a[a.Mousewheel=3]="Mousewheel";a[a.TouchStart=4]="TouchStart";a[a.TouchMove=5]="TouchMove";a[a.TouchEnd=6]="TouchEnd";a[a.KeyDown=7]="KeyDown";a[a.KeyUp=8]="KeyUp";a[a.ViewOrientationChange=9]="ViewOrientationChange"})(d.EventType||(d.EventType={}));(function(a){a[a.None=0]="None";a[a.Shift=2]="Shift";a[a.Alt=4]="Alt";a[a.Control=8]="Control";a[a.Command=16]="Command"})(d.KeyModifiers||(d.KeyModifiers={}));(function(a){a[a.Down=
0]="Down";a[a.Up=1]="Up";a[a.Move=2]="Move";a[a.Wheel=3]="Wheel"})(d.MouseInputType||(d.MouseInputType={}));(function(a){a[a.Start=0]="Start";a[a.Move=1]="Move";a[a.End=2]="End"})(d.TouchInputType||(d.TouchInputType={}));(function(a){a[a.Down=0]="Down";a[a.Up=1]="Up"})(d.KeyInputType||(d.KeyInputType={}));(function(a){a[a.Forward=0]="Forward";a[a.Backward=1]="Backward";a[a.Left=2]="Left";a[a.Right=3]="Right";a[a.Up=4]="Up";a[a.Down=5]="Down";a[a.RotateRight=6]="RotateRight";a[a.RotateLeft=7]="RotateLeft";
a[a.TiltUp=8]="TiltUp";a[a.TiltDown=9]="TiltDown"})(d.WalkDirection||(d.WalkDirection={}));(function(a){a[a.Backspace=8]="Backspace";a[a.Shift=16]="Shift";a[a.Escape=27]="Escape";a[a.PgUp=33]="PgUp";a[a.PgDown=34]="PgDown";a[a.LeftArrow=37]="LeftArrow";a[a.UpArrow=38]="UpArrow";a[a.RightArrow=39]="RightArrow";a[a.DownArrow=40]="DownArrow";a[a.Delete=46]="Delete";a[a.a=65]="a";a[a.b=66]="b";a[a.c=67]="c";a[a.d=68]="d";a[a.e=69]="e";a[a.f=70]="f";a[a.g=71]="g";a[a.h=72]="h";a[a.i=73]="i";a[a.j=74]=
"j";a[a.k=75]="k";a[a.l=76]="l";a[a.m=77]="m";a[a.n=78]="n";a[a.o=79]="o";a[a.p=80]="p";a[a.q=81]="q";a[a.r=82]="r";a[a.s=83]="s";a[a.t=84]="t";a[a.u=85]="u";a[a.v=86]="v";a[a.w=87]="w";a[a.x=88]="x";a[a.y=89]="y";a[a.z=90]="z";a[a._0=48]="_0";a[a._1=49]="_1";a[a._2=50]="_2";a[a._3=51]="_3";a[a._4=52]="_4";a[a._5=53]="_5";a[a._6=54]="_6";a[a._7=55]="_7";a[a._8=56]="_8";a[a._9=57]="_9";a[a.NumPad_0=96]="NumPad_0";a[a.NumPad_1=97]="NumPad_1";a[a.NumPad_2=98]="NumPad_2";a[a.NumPad_3=99]="NumPad_3";a[a.NumPad_4=
100]="NumPad_4";a[a.NumPad_5=101]="NumPad_5";a[a.NumPad_6=102]="NumPad_6";a[a.NumPad_7=103]="NumPad_7";a[a.NumPad_8=104]="NumPad_8";a[a.NumPad_9=105]="NumPad_9"})(d.KeyCode||(d.KeyCode={}));(function(a){a[a.None=0]="None";a[a.Face=1]="Face";a[a.Line=2]="Line";a[a.Point=4]="Point";a[a.All=7]="All"})(d.SelectionMask||(d.SelectionMask={}));(function(a){a[a.None=0]="None";a[a.Face=1]="Face";a[a.Line=2]="Line";a[a.Point=3]="Point";a[a.Part=4]="Part"})(d.SelectionType||(d.SelectionType={}));(function(a){a[a.Set=
0]="Set";a[a.Add=1]="Add";a[a.Toggle=2]="Toggle"})(d.SelectionMode||(d.SelectionMode={}));(function(a){a[a.HighlightOnly=0]="HighlightOnly";a[a.OutlineOnly=1]="OutlineOnly";a[a.HighlightAndOutline=2]="HighlightAndOutline"})(d.SelectionHighlightMode||(d.SelectionHighlightMode={}));(function(a){a[a.Info=0]="Info";a[a.Warning=1]="Warning";a[a.Error=2]="Error"})(d.InfoType||(d.InfoType={}));(function(a){a[a.Interactive=1]="Interactive";a[a.All=2]="All";a[a.OnDemand=4]="OnDemand";a[a.Default=1]="Default"})(d.StreamingMode||
(d.StreamingMode={}));(function(a){a[a.Client=0]="Client";a[a.Server=1]="Server"})(d.RendererType||(d.RendererType={}));(function(a){a[a.Wireframe=0]="Wireframe";a[a.Shaded=1]="Shaded";a[a.WireframeOnShaded=2]="WireframeOnShaded";a[a.HiddenLine=3]="HiddenLine";a[a.XRay=4]="XRay";a[a.Gooch=5]="Gooch";a[a.Toon=6]="Toon"})(d.DrawMode||(d.DrawMode={}));(function(a){a[a.Unsorted=0]="Unsorted";a[a.SingleLayer=1]="SingleLayer"})(d.TransparencyMode||(d.TransparencyMode={}));(function(a){a[a.Unsorted=0]="Unsorted";
a[a.SingleLayer=1]="SingleLayer"})(d.XRayTransparencyMode||(d.XRayTransparencyMode={}));(function(a){a[a.SMAA=0]="SMAA";a[a.None=1]="None"})(d.AntiAliasingMode||(d.AntiAliasingMode={}));(function(a){a[a.DoNotExplode=0]="DoNotExplode";a[a.DoNotCut=1]="DoNotCut";a[a.DoNotSelect=2]="DoNotSelect";a[a.SuppressCameraScale=3]="SuppressCameraScale";a[a.OverrideSceneVisibility=4]="OverrideSceneVisibility";a[a.DoNotLight=5]="DoNotLight";a[a.DoNotOutlineHighlight=6]="DoNotOutlineHighlight";a[a.ExcludeBounding=
7]="ExcludeBounding";a[a.DoNotUseVertexColors=8]="DoNotUseVertexColors";a[a.AlwaysDraw=9]="AlwaysDraw";a[a.DoNotXRay=10]="DoNotXRay";a[a.ScreenOriented=11]="ScreenOriented";a[a.ScreenSpace=12]="ScreenSpace";a[a.ScreenSpaceStretched=13]="ScreenSpaceStretched";a[a.IgnoreExplosion=0]="IgnoreExplosion";a[a.IgnoreCutting=1]="IgnoreCutting";a[a.IgnoreSelection=2]="IgnoreSelection";a[a.IgnoreCameraScale=3]="IgnoreCameraScale";a[a.IgnoreLighting=5]="IgnoreLighting";a[a.IgnoreOutlineHighlight=6]="IgnoreOutlineHighlight"})(d.InstanceModifier||
(d.InstanceModifier={}));(function(a){a[a.None=0]="None";a[a.SuppressCameraScale=1]="SuppressCameraScale";a[a.ScreenOriented=2]="ScreenOriented";a[a.DoNotCut=4]="DoNotCut";a[a.DoNotExplode=8]="DoNotExplode";a[a.DoNotSelect=16]="DoNotSelect";a[a.DoNotLight=32]="DoNotLight";a[a.DoNotOutlineHighlight=64]="DoNotOutlineHighlight";a[a.ExcludeBounding=128]="ExcludeBounding";a[a.DoNotUseVertexColors=256]="DoNotUseVertexColors";a[a.Invisible=512]="Invisible";a[a.DoNotXRay=1024]="DoNotXRay";a[a.AlwaysDraw=
2048]="AlwaysDraw";a[a.OverrideSceneVisibility=4096]="OverrideSceneVisibility";a[a.ScreenSpace=8192]="ScreenSpace";a[a.ScreenSpaceStretched=16384]="ScreenSpaceStretched"})(d.MeshInstanceCreationFlags||(d.MeshInstanceCreationFlags={}));(function(a){a[a.None=0]="None";a[a.Model=1]="Model";a[a.Instance=2]="Instance";a[a.Ejected=4]="Ejected";a[a.All=7]="All"})(d.BoundingPreviewMode||(d.BoundingPreviewMode={}));(function(a){a[a.CameraTarget=0]="CameraTarget";a[a.ModelCenter=1]="ModelCenter";a[a.OrbitTarget=
2]="OrbitTarget"})(d.OrbitFallbackMode||(d.OrbitFallbackMode={}));(function(a){a[a.Mouse=0]="Mouse";a[a.Keyboard=1]="Keyboard"})(d.WalkMode||(d.WalkMode={}));(function(a){a[a.AssemblyNode=0]="AssemblyNode";a[a.PartInstance=1]="PartInstance";a[a.Part=2]="Part";a[a.BodyInstance=3]="BodyInstance";a[a.PmiBody=4]="PmiBody";a[a.PMIBody=4]="PMIBody";a[a.ViewFrame=5]="ViewFrame";a[a.Body=6]="Body";a[a.BrepBody=7]="BrepBody";a[a.TessBody=8]="TessBody";a[a.WireBody=9]="WireBody";a[a.PointsBody=10]="PointsBody";
a[a.Pmi=11]="Pmi";a[a.PMI=11]="PMI";a[a.CadView=12]="CadView";a[a.CADView=12]="CADView";a[a.DrawingSheet=13]="DrawingSheet";a[a.Unknown=14]="Unknown"})(d.NodeType||(d.NodeType={}));var h;(function(a){a[a.Unknown=0]="Unknown";a[a.Text=1]="Text";a[a.Dimension=2]="Dimension";a[a.Arrow=3]="Arrow";a[a.Balloon=4]="Balloon";a[a.CircleCenter=5]="CircleCenter";a[a.Coordinate=6]="Coordinate";a[a.Datum=7]="Datum";a[a.Fastener=8]="Fastener";a[a.Gdt=9]="Gdt";a[a.Locator=10]="Locator";a[a.MeasurementPoint=11]=
"MeasurementPoint";a[a.Roughness=12]="Roughness";a[a.Welding=13]="Welding";a[a.Table=14]="Table";a[a.Other=15]="Other";a[a.GeometricalTolerance=16]="GeometricalTolerance"})(h=d.PmiType||(d.PmiType={}));d.PMIType=h;(function(a){a[a.Unknown=0]="Unknown";a[a.DatumIdent=1]="DatumIdent";a[a.DatumTarget=2]="DatumTarget";a[a.DimensionDistance=1]="DimensionDistance";a[a.DimensionDistanceOffset=2]="DimensionDistanceOffset";a[a.DimensionDistanceCumulate=3]="DimensionDistanceCumulate";a[a.DimensionChamfer=4]=
"DimensionChamfer";a[a.DimensionSlope=5]="DimensionSlope";a[a.DimensionOrdinate=6]="DimensionOrdinate";a[a.DimensionRadius=7]="DimensionRadius";a[a.DimensionRadiusTangent=8]="DimensionRadiusTangent";a[a.DimensionRadiusCylinder=9]="DimensionRadiusCylinder";a[a.DimensionRadiusEdge=10]="DimensionRadiusEdge";a[a.DimensionDiameter=11]="DimensionDiameter";a[a.DimensionDiameterTangent=12]="DimensionDiameterTangent";a[a.DimensionDiameterCylinder=13]="DimensionDiameterCylinder";a[a.DimensionDiameterEdge=14]=
"DimensionDiameterEdge";a[a.DimensionDiameterCone=15]="DimensionDiameterCone";a[a.DimensionLength=16]="DimensionLength";a[a.DimensionLengthCurvilinear=17]="DimensionLengthCurvilinear";a[a.DimensionLengthCircular=18]="DimensionLengthCircular";a[a.DimensionAngle=19]="DimensionAngle";a[a.GdtFcf=1]="GdtFcf";a[a.WeldingLine=1]="WeldingLine";a[a.WeldingSpot=2]="WeldingSpot";a[a.OtherSymbolUser=1]="OtherSymbolUser";a[a.OtherSymbolUtility=2]="OtherSymbolUtility";a[a.OtherSymbolCustom=3]="OtherSymbolCustom";
a[a.OtherGeometricReference=4]="OtherGeometricReference";a[a.OtherRegion=5]="OtherRegion"})(h=d.PmiSubType||(d.PmiSubType={}));d.PMISubType=h;var g;(function(a){a[a.Unknown=-1]="Unknown";a[a.Context=1]="Context";a[a.Item=2]="Item";a[a.MultipleVertex=3]="MultipleVertex";a[a.UniqueVertex=4]="UniqueVertex";a[a.WireEdge=5]="WireEdge";a[a.Edge=6]="Edge";a[a.CoEdge=7]="CoEdge";a[a.Loop=8]="Loop";a[a.Face=9]="Face";a[a.Shell=10]="Shell";a[a.Connex=11]="Connex";a[a.Body=12]="Body";a[a.SingleWireBody=13]=
"SingleWireBody";a[a.BrepData=14]="BrepData";a[a.WireBody=17]="WireBody"})(g=d.PmiTopoRef||(d.PmiTopoRef={}));d.PMITopoRef=g;(function(a){a[a.Unknown=0]="Unknown";a[a.Clockwise=1]="Clockwise";a[a.CounterClockwise=2]="CounterClockwise"})(d.FaceWinding||(d.FaceWinding={}));(function(a){a[a.UpperLeftCorner=0]="UpperLeftCorner";a[a.LowerLeftCorner=1]="LowerLeftCorner";a[a.LowerRightCorner=2]="LowerRightCorner";a[a.UpperRightCorner=3]="UpperRightCorner";a[a.TopCenter=4]="TopCenter";a[a.LeftCenter=5]="LeftCenter";
a[a.RightCenter=6]="RightCenter";a[a.BottomCenter=7]="BottomCenter";a[a.Center=8]="Center"})(d.OverlayAnchor||(d.OverlayAnchor={}));(function(a){a[a.Pixels=0]="Pixels";a[a.ProportionOfCanvas=1]="ProportionOfCanvas";a[a.ProportionOfOtherDimension=2]="ProportionOfOtherDimension"})(d.OverlayUnit||(d.OverlayUnit={}));(function(a){a[a.ScreenPixels=0]="ScreenPixels";a[a.CSSPixels=1]="CSSPixels";a[a.World=2]="World";a[a.ProportionOfScreenWidth=3]="ProportionOfScreenWidth";a[a.ProportionOfScreenHeight=4]=
"ProportionOfScreenHeight";a[a.ProportionOfBoundingDiagonal=5]="ProportionOfBoundingDiagonal"})(d.PointSizeUnit||(d.PointSizeUnit={}));(function(a){a[a.Square=0]="Square";a[a.Disk=1]="Disk";a[a.Sphere=2]="Sphere"})(d.PointShape||(d.PointShape={}));h=function(){function a(){this.bodyId=d.InvalidNodeId;this.subElementType=g.Unknown;this.subElementIndex=-1}Object.defineProperty(a.prototype,"bodyID",{get:function(){return this.bodyId},set:function(a){this.bodyId=a},enumerable:!0,configurable:!0});return a}();
d.RefOnTopoItem=h;(function(a){a[a.Hidden=0]="Hidden";a[a.Shown=1]="Shown";a[a.Mixed=2]="Mixed"})(d.BranchVisibility||(d.BranchVisibility={}));(function(a){a[a.Object=0]="Object";a[a.World=1]="World"})(d.CullingVectorSpace||(d.CullingVectorSpace={}));(function(a){a[a.First=8]="First";a[a.Handles=8]="Handles";a[a.AxisTriad=9]="AxisTriad";a[a.NavCube=10]="NavCube";a[a.Floorplan=11]="Floorplan";a[a.TestFramework=12]="TestFramework"})(d.BuiltinOverlayIndex||(d.BuiltinOverlayIndex={}));h=function(){return function(){this.pos1=
d.Point3.zero();this.pos2=d.Point3.zero();this.distance=0}}();d.FaceFaceDistanceItem=h;h=function(){return function(){this.frontVector=new d.Point3(-1,0,0);this.upVector=new d.Point3(0,0,1)}}();d.ViewAxes=h;(function(a){a[a.Object=0]="Object";a[a.World=1]="World";a[a.ProportionOfScreenWidth=2]="ProportionOfScreenWidth";a[a.ProportionOfScreenHeight=3]="ProportionOfScreenHeight"})(d.LinePatternLengthUnit||(d.LinePatternLengthUnit={}));(function(a){a[a.Selected=0]="Selected";a[a.Unselected=1]="Unselected"})(d.XRayGroup||
(d.XRayGroup={}));(function(a){a[a.Pixels=0]="Pixels";a[a.ProportionOfWidth=1]="ProportionOfWidth";a[a.ProportionOfHeight=2]="ProportionOfHeight"})(d.BlurIntervalUnit||(d.BlurIntervalUnit={}));(function(a){a[a.Undefined=0]="Undefined";a[a.Int=1]="Int";a[a.Float=2]="Float";a[a.Time=3]="Time";a[a.String=4]="String";a[a.Ignored=5]="Ignored"})(d.AttributeType||(d.AttributeType={}));h=function(){return function(a,d){this.isInclusive=a;this.nodeIds=d}}();d.FilteredNodes=h;h=function(){return function(a,
d){this.defaultVisibility=a;this.visibilityExceptions=d}}();d.VisibilityState=h;h=function(){function a(){this.additionalMatrix=null;this.attachInvisibly=this.allowMissingExternalModels=!1;this._allowSubtreeLoadedCallback=this.implicitlyLoadXmlExternalModels=!0}a.prototype.copy=function(){var d=new a;d.additionalMatrix=this.additionalMatrix;null!==d.additionalMatrix&&(d.additionalMatrix=d.additionalMatrix.copy());d.allowMissingExternalModels=this.allowMissingExternalModels;d.attachInvisibly=this.attachInvisibly;
d.implicitlyLoadXmlExternalModels=this.implicitlyLoadXmlExternalModels;d._allowSubtreeLoadedCallback=this._allowSubtreeLoadedCallback;return d};return a}();d.LoadSubtreeConfig=h;(function(a){a[a.Unknown=0]="Unknown";a[a.Catia=2]="Catia";a[a.CatiaV5=3]="CatiaV5";a[a.Cadds=4]="Cadds";a[a.Unigraphics=5]="Unigraphics";a[a.Parasolid=6]="Parasolid";a[a.Euclid=7]="Euclid";a[a.Iges=9]="Iges";a[a.Unisurf=10]="Unisurf";a[a.Vda=11]="Vda";a[a.Stl=12]="Stl";a[a.Wrl=13]="Wrl";a[a.Dxf=14]="Dxf";a[a.Acis=15]="Acis";
a[a.ProE=16]="ProE";a[a.Step=18]="Step";a[a.Ideas=19]="Ideas";a[a.Jt=20]="Jt";a[a.Slw=22]="Slw";a[a.Cgr=23]="Cgr";a[a.Prc=24]="Prc";a[a.Xvl=25]="Xvl";a[a.Hpgl=26]="Hpgl";a[a.TopSolid=27]="TopSolid";a[a.OneSpaceDesigner=28]="OneSpaceDesigner";a[a._3dxml=29]="_3dxml";a[a.Inventor=30]="Inventor";a[a.PostScript=31]="PostScript";a[a.Pdp=32]="Pdp";a[a.U3d=33]="U3d";a[a.Ifc=34]="Ifc";a[a.Dwg=35]="Dwg";a[a.Dwf=36]="Dwf";a[a.Se=37]="Se";a[a.Obj=38]="Obj";a[a.Kmz=39]="Kmz";a[a.Dae=40]="Dae";a[a._3ds=41]="_3ds";
a[a.Rhino=43]="Rhino";a[a.Xml=44]="Xml";a[a._3mf=45]="_3mf";a[a.Scs=46]="Scs";a[a._3dHtml=47]="_3dHtml";a[a.Hsf=48]="Hsf";a[a.Gltf=49]="Gltf";a[a.Revit=50]="Revit";a[a.Fbx=51]="Fbx"})(d.FileType||(d.FileType={}));(function(a){a[a.World=0]="World";a[a.ProportionOfBoundingHeight=1]="ProportionOfBoundingHeight"})(d.SimpleReflectionAttenuationUnit||(d.SimpleReflectionAttenuationUnit={}));(function(a){a[a.Default=0]="Default";a[a.PerNode=1]="PerNode"})(d.TreeWalkMode||(d.TreeWalkMode={}));(function(a){a[a.NorthUp=
0]="NorthUp";a[a.AvatarUp=1]="AvatarUp"})(d.FloorplanOrientation||(d.FloorplanOrientation={}));(function(a){a[a.ContainedInSpatialStructure=0]="ContainedInSpatialStructure";a[a.Aggregates=1]="Aggregates";a[a.VoidsElement=2]="VoidsElement";a[a.FillsElement=3]="FillsElement";a[a.SpaceBoundary=4]="SpaceBoundary";a[a.Undefined=5]="Undefined"})(d.RelationshipType||(d.RelationshipType={}))})(Communicator||(Communicator={}));
(function(d){d=d.Internal||(d.Internal={});d=d.AttachType||(d.AttachType={});d[d.Direct=0]="Direct";d[d.Indirect=1]="Indirect"})(Communicator||(Communicator={}));(function(d){d=d.Internal||(d.Internal={});d=d.CameraFlags||(d.CameraFlags={});d[d.None=0]="None";d[d.Position=1]="Position";d[d.Target=2]="Target";d[d.Up=4]="Up";d[d.Width=8]="Width";d[d.Height=16]="Height";d[d.Projection=32]="Projection";d[d.NearLimit=64]="NearLimit"})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(){this._position=new d.Point3(0,0,1);this._target=d.Point3.zero();this._up=new d.Point3(0,1,0);this._height=this._width=0;this._projection=d.Projection.Orthographic;this._nearLimit=.01;this._cameraFlags=d.Internal.CameraFlags.None}g.prototype._clearFlags=function(){this._cameraFlags=d.Internal.CameraFlags.None};g.prototype._getFlags=function(){return this._cameraFlags};g.prototype.copy=function(){return g.create(this._position,this._target,this._up,this._projection,
this._width,this._height,this._nearLimit)};g.prototype.setPosition=function(a){this._position.assign(a);this._cameraFlags|=d.Internal.CameraFlags.Position};g.prototype.getPosition=function(){return this._position.copy()};g.prototype.setTarget=function(a){this._target.assign(a);this._cameraFlags|=d.Internal.CameraFlags.Target};g.prototype.getTarget=function(){return this._target.copy()};g.prototype.setUp=function(a){this._up.assign(a);this._cameraFlags|=d.Internal.CameraFlags.Up};g.prototype.getUp=
function(){return this._up.copy()};g.prototype.setWidth=function(a){this._width=a;this._cameraFlags|=d.Internal.CameraFlags.Width};g.prototype.getWidth=function(){return this._width};g.prototype.setHeight=function(a){this._height=a;this._cameraFlags|=d.Internal.CameraFlags.Height};g.prototype.getHeight=function(){return this._height};g.prototype.setProjection=function(a){this._projection=a;this._cameraFlags|=d.Internal.CameraFlags.Projection};g.prototype.getProjection=function(){return this._projection};
g.prototype.setNearLimit=function(a){this._nearLimit=a;this._cameraFlags|=d.Internal.CameraFlags.NearLimit};g.prototype.getNearLimit=function(){return this._nearLimit};g.prototype.equals=function(a){return this._position.equals(a._position)&&this._target.equals(a._target)&&this._up.equals(a._up)&&this._width===a._width&&this._height===a._height&&this._projection===a._projection&&this._nearLimit===a._nearLimit};g.prototype.dolly=function(a){this._position.subtract(a);this._target.subtract(a)};g.prototype.getCameraPlaneIntersectionPoint=
function(a,e){var c=d.Point3.subtract(this._position,this._target).normalize();c=d.Plane.createFromPointAndNormal(this._target,c);a=e.raycastFromPoint(a);if(null===a)return null;e=d.Point3.zero();return c.intersectsRay(a,e)?e:null};g.prototype.getViewMatrix=function(a){return a._getScEngine().getViewMatrix(this)};g.prototype.getProjectionMatrix=function(a){return a._getScEngine().getProjectionMatrix(this)};g.prototype.getFullMatrix=function(a){return a._getScEngine().getFullCameraMatrix(this)};g.prototype.getMatrixFromCamera=
function(){var a=d.Point3.subtract(this.getTarget(),this.getPosition()).normalize(),e=this.getUp().normalize();e=d.Point3.cross(e,a);var c=d.Point3.cross(a,e);return d.Matrix.createFromBasis(e,c,a)};g.create=function(a,d,c,b,f,k,l){var e=new g;e._position.assign(a);e._target.assign(d);e._up.assign(c);e._projection=b;e._width=f;e._height=k;void 0!==l&&(e._nearLimit=l);return e};g.prototype.toJson=function(){return this._toJson()};g.prototype._toJson=function(){return{position:this._position.toJson(),
target:this._target.toJson(),up:this._up.toJson(),width:this._width,height:this._height,projection:this._projection,nearLimit:this._nearLimit,className:"Communicator.Camera"}};g.prototype.forJson=function(){return this.toJson()};g.fromJson=function(a){var e=d.Point3.fromJson(a.position),c=d.Point3.fromJson(a.target),b=d.Point3.fromJson(a.up);return g.create(e,c,b,a.projection,a.width,a.height,a.nearLimit)};g.construct=function(a){return g.fromJson(a)};g.prototype.transform=function(a){if(a.isIdentity())return this.copy();
var e=Math.abs(this._width),c=Math.abs(this._height),b=this.getUp().normalize().scale(c);c=d.Point3.subtract(this._position,this._target);var f=d.Point3.cross(b,c).normalize().scale(e);e=this.getTarget();f=d.Point3.add(e,f);b=d.Point3.add(e,b);var k=d.Point3.add(e,c);a.transform(e,e);a.transform(f,f);a.transform(b,b);a.transform(k,k);a=d.Point3.subtract(f,e);c=d.Point3.subtract(b,e);b=d.Point3.subtract(k,e);b=d.Point3.add(e,b);f=c.copy().normalize();a=a.length();c=c.length();0>this._width&&(a=-a);
0>this._height&&(c=-c);return g.create(b,e,f,this._projection,a,c,this._nearLimit)};return g}();d.Camera=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a,e,c,b){var f=this;this._cuttingSections=[];this._isInit=!1;this._standinGeometryPickable=!0;this._cappingFaceColor=d.Color.createFromFloat(.5,.5,.5);this._cappingLineColor=d.Color.createFromFloat(.5,.5,.5);this._cappingIdleCallbackEnabled=!1;this._cappingIdlePromise=null;this._conservativeIsCappingIdle=!1;this._viewer=a;this._model=e;this._callbackManager=c;this._engine=b;a.setCallbacks({cappingIdle:function(b){(f._conservativeIsCappingIdle=b)&&null!==f._cappingIdlePromise&&
(f._cappingIdlePromise.resolve(),f._cappingIdlePromise=null)},_resetAssemblyTreeBegin:function(){null!==f._cappingIdlePromise&&(f._cappingIdlePromise.reject(new d.CommunicatorError("Model became reset.")),f._cappingIdlePromise=null);return Promise.resolve()}})}g.prototype.createReferenceGeometryFromAxis=function(a,e){var c=[];switch(a){case d.Axis.X:c.push(new d.Point3(0,e.max.y,e.min.z));c.push(new d.Point3(0,e.max.y,e.max.z));c.push(new d.Point3(0,e.min.y,e.max.z));c.push(new d.Point3(0,e.min.y,
e.min.z));break;case d.Axis.Y:c.push(new d.Point3(e.min.x,0,e.min.z));c.push(new d.Point3(e.max.x,0,e.min.z));c.push(new d.Point3(e.max.x,0,e.max.z));c.push(new d.Point3(e.min.x,0,e.max.z));break;case d.Axis.Z:c.push(new d.Point3(e.min.x,e.max.y,0)),c.push(new d.Point3(e.max.x,e.max.y,0)),c.push(new d.Point3(e.max.x,e.min.y,0)),c.push(new d.Point3(e.min.x,e.min.y,0))}return c};g.prototype.createReferenceGeometryFromFaceNormal=function(a,e,c){var b=[],f=(new d.Plane).setFromPointAndNormal(e,a).d;f=
e.copy().add(d.Point3.scale(a,f));e=c.center();e=d.Point3.add(e,d.Point3.scale(a,d.Point3.dot(a,d.Point3.subtract(f,e))));c=c.extents().length()/2;f=d.Point3.subtract(e,f);var k=d.Point3.cross(a,f),l=f.copy().scale(-1),n=k.copy().scale(-1);a=d.Point3.add(f,k).normalize().scale(c).add(e);k=d.Point3.add(l,k).normalize().scale(c).add(e);l=d.Point3.add(l,n).normalize().scale(c).add(e);e=d.Point3.add(f,n).normalize().scale(c).add(e);b.push(a);b.push(k);b.push(l);b.push(e);return b};g.prototype.activateCuttingSections=
function(){for(var a=[],e=0,c=this._cuttingSections;e<c.length;e++)a.push(c[e].activate());return d.Util.waitForAll(a)};g.prototype.deactivateCuttingSections=function(a){void 0===a&&(a=!1);for(var e=[],c=0,b=this._cuttingSections;c<b.length;c++){var f=b[c];a?e.push(f.clear()):e.push(f.deactivate())}return d.Util.waitForAll(e)};g.prototype.setCuttingPlaneColor=function(a){for(var d=0,c=this._cuttingSections;d<c.length;d++)c[d].setColor(a);return Promise.resolve()};g.prototype.setCappingFaceColor=function(a){this._cappingFaceColor=
a?a.copy():null;this._engine.setCappingFaceColor(this._cappingFaceColor);return Promise.resolve()};g.prototype.getCappingFaceColor=function(){return this._cappingFaceColor?this._cappingFaceColor.copy():null};g.prototype.setCappingLineColor=function(a){this._cappingLineColor=a?a.copy():null;this._engine.setCappingLineColor(this._cappingLineColor);return Promise.resolve()};g.prototype.getCappingLineColor=function(){return this._cappingLineColor?this._cappingLineColor.copy():null};g.prototype.getCuttingSection=
function(a){return this._isInit&&a<this._cuttingSections.length?this._cuttingSections[a]:null};g.prototype.getCuttingSectionCapacity=function(){return void 0!==this._cuttingLimits?this._cuttingLimits.maxCuttingPlanesPerSection:0};g.prototype.getCuttingSectionCount=function(){return void 0!==this._cuttingLimits?this._cuttingLimits.maxCuttingSections:0};g.prototype.getCuttingSectionFromNodeId=function(a){if(null!==a)for(var d=0,c=this._cuttingSections;d<c.length;d++){var b=c[d];if(0<=b._getInstanceNodeIds().indexOf(a))return b}return null};
g.prototype.setStandinGeometryPickable=function(a){this._standinGeometryPickable=a;var e=this._gatherStandinGeometryIds();this._model.setInstanceModifier(d.InstanceModifier.DoNotSelect,e,!a);return Promise.resolve()};g.prototype.getStandinGeometryPickable=function(){return this._standinGeometryPickable};g.prototype._setStandinGeometryVisible=function(a){var d=this,c=this._gatherStandinGeometryIds(),b=this._model._gatherInstanceIncsFromNodeIds(c);this._engine.pauseRendering(function(){d._engine.setPartVisibility(b,
a,!1)})};g.prototype.setCappingDelay=function(a){this._engine.setCappingDelay(a)};g.prototype.delayCapping=function(){this._engine.delayCapping()};g.prototype.enableCappingIdleCallback=function(a){a!==this._cappingIdleCallbackEnabled&&(this._cappingIdleCallbackEnabled=a,this._conservativeIsCappingIdle=!1,a||null===this._cappingIdlePromise||(this._cappingIdlePromise.reject(new d.CommunicatorError("Capping idle callback became disabled.")),this._cappingIdlePromise=null));return this._engine.enableCappingIdleCallback(a)};
g.prototype.waitForCappingIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){if(!this._cappingIdleCallbackEnabled)throw console.assert(null===this._cappingIdlePromise),new d.CommunicatorError("Capping idle callback is not enabled.");if(this._conservativeIsCappingIdle)return[2];null===this._cappingIdlePromise&&(this._cappingIdlePromise=d.Util.OpenPromise.create());return[2,this._cappingIdlePromise]})})};g.prototype.setCappingGeometryVisibility=function(a){this._engine.setCappingGeometryVisibility(a);
return Promise.resolve()};g.prototype.getCappingGeometryVisibility=function(){return this._engine.getCappingGeometryVisibility()};g.prototype.getActiveCuttingSectionCount=function(){var a=0;if(this._cuttingLimits)for(var d=0;d<this._cuttingLimits.maxCuttingSections;d++){var c=this.getCuttingSection(d);null!==c&&c.isActive()&&(a+=c.getCount())}return a};g.prototype._init=function(){if(!this._isInit){this._cuttingLimits=this._engine.getCuttingSectionLimits();for(var a=0;a<this._cuttingLimits.maxCuttingSections;a++){var e=
new d.CuttingSection(this._viewer,this._model,this._callbackManager,this,this._engine);this._cuttingSections.push(e)}this._isInit=!0}};g.prototype._isInitialized=function(){return this._isInit};g.prototype.refreshPlaneGeometry=function(){for(var a=[],e=0,c=this._cuttingSections;e<c.length;e++)for(var b=c[e],f=0;f<b.getCount();f++){var k=b.getPlane(f);null!==k&&a.push(b.updatePlane(f,k,new d.Matrix,!1,!1))}return d.Util.waitForAll(a)};g.prototype.hasActiveCuttingSection=function(){if(this._cuttingLimits)for(var a=
0;a<this._cuttingLimits.maxCuttingSections;a++){var d=this.getCuttingSection(a);if(null!==d&&d.isActive())return!0}return!1};g.prototype.toJson=function(){return this._toJson()};g.prototype._toJson=function(){for(var a=[],d=0;d<this._cuttingSections.length;d++)a[d]=this._cuttingSections[d].toJson();return{cuttingSections:a,cappingGeometryVisibility:this.getCappingGeometryVisibility(),cappingFaceColor:this.getCappingFaceColor(),cappingLineColor:this.getCappingLineColor(),pickable:this.getStandinGeometryPickable()}};
g.prototype.forJson=function(){return this.toJson()};g.prototype.fromJson=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,f,k,l;return __generator(this,function(n){switch(n.label){case 0:e=d.Internal.deepClone(a);c=[];b=e.cuttingSections;for(f=0;f<b.length;f++)k=b[f],l=this._cuttingSections[f],c.push(l.fromJson(k));this.setStandinGeometryPickable(e.pickable);c.push(this.setCappingGeometryVisibility(e.cappingGeometryVisibility));c.push(this.setCappingFaceColor(d.Color.fromJson(e.cappingFaceColor)));
c.push(this.setCappingLineColor(d.Color.fromJson(e.cappingLineColor)));return[4,Promise.all(c)];case 1:return n.sent(),this._callbackManager.trigger("cuttingSectionsLoaded"),[2]}})})};g.prototype._gatherStandinGeometryIds=function(){for(var a=[],d=0,c=this._cuttingSections;d<c.length;d++)for(var b=0,f=c[d]._getInstanceNodeIds();b<f.length;b++)a.push(f[b]);return a};return g}();d.CuttingManager=h})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(a,c,b,f,k){this._container=a;this._canvasContainerElement=c;this._markupSvgElement=b;this._redlineSvgElement=f;this._redlineElement=k}a.prototype.getCanvasContainerElement=function(){return this._canvasContainerElement};a.prototype.getMarkupSvgElement=function(){return this._markupSvgElement};a.prototype.getRedlineSvgElement=function(){return this._redlineSvgElement};a.prototype.getRedlineElement=function(){return this._redlineElement};a.prototype.shutdown=
function(){this._container.removeChild(this._markupSvgElement);this._container.removeChild(this._redlineSvgElement);this._container.removeChild(this._redlineElement);this._container.removeChild(this._canvasContainerElement)};a.createFromElement=function(e){var c=e.id;0===c.length&&(c=d.UUID.create());var b=c+"-canvas-container",f=c+"-svg",k=c+"-redline-svg";c+="-redline";var l=document.createElement("div");l.id=b;l.style.width="100%";l.style.height="100%";l.style.position="absolute";l.tabIndex=-1;
l.classList.add("webviewer-canvas");l.oncontextmenu=function(){return!1};e.appendChild(l);b=a._createSvgElement(f);e.appendChild(b);k=a._createSvgElement(k);e.appendChild(k);f=document.createElement("div");f.id=c;f.style.position="absolute";f.style.width="100%";f.style.height="100%";f.style.pointerEvents="none";e.appendChild(f);return new a(e,l,b,k,f)};a.createFromId=function(a){a=document.getElementById(a);return null===a?null:this.createFromElement(a)};a._createSvgElement=function(a){var c=document.createElementNS("http://www.w3.org/2000/svg",
"svg");c.id=a;c.style.width="100%";c.style.height="100%";c.style.position="absolute";c.style.pointerEvents="none";c.style.overflow="hidden";c.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");return c};return a}();h.DomElements=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
var __extends=this&&this.__extends||function(){var d=function(h,g){d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,d){a.__proto__=d}||function(a,d){for(var c in d)d.hasOwnProperty(c)&&(a[c]=d[c])};return d(h,g)};return function(h,g){function a(){this.constructor=h}d(h,g);h.prototype=null===g?Object.create(g):(a.prototype=g.prototype,new a)}}();
(function(d){var h=function(a){function c(b){b=a.call(this,b)||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(Error);d.CommunicatorError=h;var g=function(a){function c(b){b=a.call(this,"Invalid index ("+b+").")||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);d.InvalidIndexError=g;g=function(a){function c(){var b=a.call(this,"Selection invalidated.")||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);d.SelectionInvalidatedError=
g;g=function(a){function c(){var b=a.call(this,"Internal logic error.")||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);d.InternalLogicError=g;g=function(a){function c(b){var f=a.call(this,"Invalid node ("+b+").")||this;Object.setPrototypeOf(f,c.prototype);f.nodeId=b;return f}__extends(c,a);return c}(h);d.InvalidNodeIdError=g;g=function(a){function c(b,f){for(var k=[],e=2;e<arguments.length;e++)k[e-2]=arguments[e];k.push(f);e=[];for(var n=0;n<k.length;n++){var g=k[n];
switch(g){case 0:e.push(d.NodeType.DrawingSheet,d.NodeType.PartInstance,d.NodeType.AssemblyNode);break;case 1:e.push(d.NodeType.BodyInstance);e.push(d.NodeType.PmiBody);e.push(d.NodeType.ViewFrame);break;case 2:e.push(d.NodeType.BodyInstance);break;case 3:e.push(d.NodeType.CadView);break;default:d.Util.TypeAssertNever(g)}}e.sort();k=[];for(n=0;n<e.length;n++)k.push(d.NodeType[e[n]]);k=a.call(this,"Expected node ("+b+") to be of "+(1===k.length?"type ("+k[0]+")":"types "+k)+".")||this;Object.setPrototypeOf(k,
c.prototype);k.nodeId=b;k.expectedTypes=e;return k}__extends(c,a);return c}(h);d.InvalidNodeTypeError=g;g=function(a){function c(b){b=a.call(this,b)||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);d.LoadError=g;var a=function(a){function c(){var b=a.call(this,"Load cancelled.")||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(g);d.LoadCancelledError=a;g=function(a){function c(b){b=a.call(this,"Missing model: '"+b+"'.")||this;Object.setPrototypeOf(b,
c.prototype);return b}__extends(c,a);return c}(g);d.MissingModelError=g;h=function(a){function c(b){b=a.call(this,b)||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);d.ParseError=h;g=function(a){function c(b){b=a.call(this,b)||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);d.AssemblyDataParseError=g;d.MetaDataParseError=g;h=function(a){function c(b){b=a.call(this,b)||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);
d.XmlParseError=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(a,d,c){var b=this;this._explodeActive=!1;this._explodeMagnitude=0;this._model=a;this._engine=d;c.bind({_modelSwitched:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){this.stop();return[2]})})}})}d.prototype.start=function(a,d){this.getActive()&&this.stop();return this._doExplode(a,d)};d.prototype.setMagnitude=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return 0<
a&&!this._explodeActive?[4,this.start()]:[3,2];case 1:return d.sent(),[3,3];case 2:0===a&&this._explodeActive&&this.stop(),d.label=3;case 3:return this._explodeActive?(this._explodeMagnitude=a,[2,this._engine.setExplodeMagnitude(a)]):[2]}})})};d.prototype.stop=function(){this._engine.stopExplode();this._explodeMagnitude=0;this._explodeActive=!1;this._engine.setExplodeMagnitude(0);return Promise.resolve()};d.prototype.getMagnitude=function(){return this._explodeMagnitude};d.prototype.getActive=function(){return this._explodeActive};
d.prototype._doExplode=function(a,d){return __awaiter(this,void 0,void 0,function(){var c,b;return __generator(this,function(f){switch(f.label){case 0:return this._explodeActive=!0,c=void 0!==a&&0<a.length?this._model._gatherInstanceIncsFromNodeIds(a):[],d?[3,2]:[4,this._model.getModelBounding(!0,!1)];case 1:return b=f.sent(),this._engine.startExplode(c,b.center()),[3,3];case 2:this._engine.startExplode(c,d),f.label=3;case 3:return[2]}})})};return d}();d.ExplodeManager=h})(Communicator||(Communicator=
{}));
(function(d){function h(b){if(0===b.length)return new d.Matrix;if(1===b.length)return b[0];for(var c=d.Matrix.multiply(b[1],b[0]),f=2;f<b.length;++f)c=d.Matrix.multiply(b[f],c);return c}function g(b,c){return b.x>=c.min.x&&b.x<=c.max.x&&b.y>=c.min.y&&b.y<=c.max.y&&b.z>=c.min.z&&b.z<=c.max.z}function a(b,c){return b.z>=c.min.z&&b.z<=c.max.z}var e=function(){function b(){this.overlayAnchor=d.OverlayAnchor.LowerRightCorner;this.overlaySize=new d.Point2(.25,1);this.overlayWidthUnit=d.OverlayUnit.ProportionOfCanvas;this.overlayHeightUnit=
d.OverlayUnit.ProportionOfOtherDimension;this.overlayOffset=new d.Point2(0,0);this.overlayOffsetYUnit=this.overlayOffsetXUnit=d.OverlayUnit.Pixels;this.backgroundColor=d.Color.white();this.backgroundOpacity=.25;this.borderColor=d.Color.black();this.borderOpacity=1;this.avatarColor=d.Color.createFromFloat(1,0,1);this.avatarOutlineColor=d.Color.black();this.avatarScale=this.avatarOpacity=1;this.fixedAvatarScale=!0;this.overlayFeetPerPixel=.1;this.zoomLevel=1;this.autoActivate=c.BimWalk;this.floorplanOrientation=
d.FloorplanOrientation.NorthUp;this.customAvatar=null;this.trackCameraEnabled=!1}b.prototype.copy=function(){var c=new b;c.overlayAnchor=this.overlayAnchor;c.overlaySize=this.overlaySize.copy();c.overlayWidthUnit=this.overlayWidthUnit;c.overlayHeightUnit=this.overlayHeightUnit;c.overlayOffset=this.overlayOffset.copy();c.overlayOffsetXUnit=this.overlayOffsetXUnit;c.overlayOffsetYUnit=this.overlayOffsetYUnit;c.backgroundColor=this.backgroundColor.copy();c.backgroundOpacity=this.backgroundOpacity;c.borderColor=
this.borderColor.copy();c.borderOpacity=this.borderOpacity;c.avatarColor=this.avatarColor.copy();c.avatarOutlineColor=this.avatarOutlineColor.copy();c.avatarOpacity=this.avatarOpacity;c.avatarScale=this.avatarScale;c.fixedAvatarScale=this.fixedAvatarScale;c.customAvatar=this.customAvatar;c.overlayFeetPerPixel=this.overlayFeetPerPixel;c.zoomLevel=this.zoomLevel;c.trackCameraEnabled=this.trackCameraEnabled;c.autoActivate=this.autoActivate;c.floorplanOrientation=this.floorplanOrientation;return c};return b}();
d.FloorplanConfig=e;var c;(function(b){b[b.Never=0]="Never";b[b.Bim=1]="Bim";b[b.BimWalk=2]="BimWalk"})(c=d.FloorplanAutoActivation||(d.FloorplanAutoActivation={}));var b=function(){return function(b,c,f,a,d){this.floorplanNode=null;this.floorNode=b;this.bounds=c;this.slabNodes=f;this.spaceNodes=a;this.floorplanMeshCreationNodes=d}}(),f=function(){function f(b,c,f,a,k,g){var l=this;this._active="inactive";this._isCallbacksSet=this._isOverlayVisible=this._isModelLoaded=this._isSceneReady=!1;this._onCameraUpdateFunc=
this._doCameraUpdate.bind(this);this._onFrameDrawnFunc=this._onFrameDrawn.bind(this);this._currentFloorInfo=this._floorplanNode=null;this._config=new e;this._tightBoundings=this._floorLock=!1;this._genericStoreyType="IFCBUILDINGSTOREY";this._floorInfos=new Map;this._floorInfosArray=[];this._avatarNode=null;this._avatarDirty=!0;this._borderNode=null;this._borderDirty=!0;this._backgroundNode=null;this._backgroundDirty=!0;this._canvasSize=new d.Point2(1,1);this._sync=new d.Internal.PromiseQueue(1,!0);
this._setFloorplanSync=new d.Internal.SingleMostRecentPromiseQueue(!1);this._viewer=b;this._model=c;this._engine=a;this._modelStructure=k;this._overlayManager=f;this._config=g.copy();this._viewer.setCallbacks({sceneReady:function(){return __awaiter(l,void 0,void 0,function(){var b=this;return __generator(this,function(c){switch(c.label){case 0:return console.assert("active"!==this._active,"Got sceneReady while Floorplan is Active"),this._isSceneReady=!0,"activating"!==this._active?[3,2]:[4,this._sync.push(function(){return b._doUpdateActivation()})];
case 1:c.sent(),c.label=2;case 2:return[2]}})})},modelSwitchStart:function(){return __awaiter(l,void 0,void 0,function(){var b=this;return __generator(this,function(c){switch(c.label){case 0:return this._isModelLoaded=!1,[4,this._sync.push(function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){return[2,this._deactivate()]})})})];case 1:return c.sent(),[2]}})})},firstModelLoaded:function(b){return __awaiter(l,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._isModelLoaded=
!0,[4,this._onModelLoaded()];case 1:return b.sent(),[2]}})})},subtreeLoaded:function(b,c){return __awaiter(l,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._isModelLoaded=!0,[4,this._onModelLoaded()];case 1:return b.sent(),[2]}})})}})}f.prototype.setCustomAvatar=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._config.customAvatar===b?[2]:[4,this._doSetCustomAvatar(b)];
case 1:return c.sent(),this._avatarDirty=!0,[2,this._onConfigurationChanged()]}})})};f.prototype.setOverlaySize=function(b,c,f){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){this._config.overlaySize=b.copy();this._config.overlayWidthUnit=c;this._config.overlayHeightUnit=f;return[2,this._onConfigurationChanged()]})})};f.prototype.setOverlayAnchor=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.overlayAnchor=
b;return[2,this._onConfigurationChanged()]})})};f.prototype.setOverlayOffset=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.overlayOffset=b.copy();return[2,this._onConfigurationChanged()]})})};f.prototype.setOverlayFeetPerPixel=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.overlayFeetPerPixel=b;return[2,this._onConfigurationChanged()]})})};f.prototype.setZoomLevel=function(b){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(c){this._config.zoomLevel=b;return[2,this._onConfigurationChanged()]})})};f.prototype.setBackgroundColor=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.backgroundColor=b;this._backgroundDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setBackgroundOpacity=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.backgroundOpacity=
b;this._backgroundDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setBorderColor=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.borderColor=b;this._borderDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setBorderOpacity=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.borderOpacity=b;this._borderDirty=!0;return[2,this._onConfigurationChanged()]})})};
f.prototype.setAvatarColor=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.avatarColor=b;this._avatarDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setAvatarOutlineColor=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.avatarOutlineColor=b;this._avatarDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setAvatarOpacity=function(b){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(c){this._config.avatarOpacity=b;this._avatarDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setAvatarScale=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.avatarScale=b;this._avatarDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setFixedAvatarScale=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._config.fixedAvatarScale===
b?[2]:[4,this._deleteAvatarNode()];case 1:return c.sent(),this._config.fixedAvatarScale=b,this._avatarDirty=!0,[2,this._onConfigurationChanged()]}})})};f.prototype.setTrackCameraEnabled=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.trackCameraEnabled=b;return[2,this._onConfigurationChanged()]})})};f.prototype.setFloorplanOrientation=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.floorplanOrientation=
b;return[2,this._onConfigurationChanged()]})})};f.prototype.setAutoActivate=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.autoActivate=b;return[2,this._onConfigurationChanged()]})})};f.prototype.setFloorLock=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(f){switch(f.label){case 0:this._floorLock=b;if(!this.isActive()||b)return[3,2];c=this._viewer.view.getCamera().getPosition();return[4,
this._setFloorplanFromPosition(c)];case 1:f.sent(),f.label=2;case 2:return[2]}})})};f.prototype.getFloorLock=function(){return this._floorLock};f.prototype.setUseTightBoundings=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return b===this._tightBoundings?[2]:[4,this._deleteAllFloorplans()];case 1:return c.sent(),this._tightBoundings=b,this.isActive()?[4,this._onProcessIfc()]:[3,3];case 2:c.sent(),c.label=3;case 3:return[2]}})})};
f.prototype.setConfiguration=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(f){switch(f.label){case 0:return c=this._config.customAvatar,this._config=b.copy(),c===this._config.customAvatar?[3,2]:[4,this._doSetCustomAvatar(this._config.customAvatar)];case 1:f.sent(),f.label=2;case 2:return this._avatarDirty=this._backgroundDirty=this._borderDirty=!0,[2,this._onConfigurationChanged()]}})})};f.prototype.getConfiguration=function(){return this._config.copy()};
f.prototype.getCurrentFloorNodeId=function(){return null!==this._currentFloorInfo?this._currentFloorInfo.floorNode:null};f.prototype.getAvatarNodeId=function(){return this._avatarNode};f.prototype.insideOverlay=function(b){var c=this._getOverlaySizeInPixels(),f=this._getOverlayOffsetInPixels();return b.x>=f.x&&b.y>=f.y&&b.x<=f.x+c.x&&b.y<=f.y+c.y};f.prototype.activate=function(){return __awaiter(this,void 0,void 0,function(){var b=this;return __generator(this,function(c){switch(c.label){case 0:return[4,
this._sync.push(function(){return b._activate()})];case 1:return c.sent(),[2]}})})};f.prototype.deactivate=function(){return __awaiter(this,void 0,void 0,function(){var b=this;return __generator(this,function(c){switch(c.label){case 0:return[4,this._sync.push(function(){return b._deactivate()})];case 1:return c.sent(),[2]}})})};f.prototype._deleteAvatarNode=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:if(null===this._avatarNode)return[3,
5];c.label=1;case 1:return c.trys.push([1,3,,4]),this._modelStructure.allowNodeDeletion(this._avatarNode),[4,this._model.deleteNode(this._avatarNode)];case 2:return c.sent(),[3,4];case 3:return b=c.sent(),console.log("Problem deleting existing avatar: "+b.message),[3,4];case 4:this._avatarNode=null,c.label=5;case 5:return[2]}})})};f.prototype._doSetCustomAvatar=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this._deleteAvatarNode()];
case 1:return c.sent(),this._config.customAvatar=b,[2]}})})};f.prototype._onConfigurationChanged=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:this._config.zoomLevel=Math.max(.1,Math.min(10,this._config.zoomLevel));this._config.avatarScale=Math.max(.1,Math.min(10,this._config.avatarScale));this._config.backgroundOpacity=Math.max(0,Math.min(1,this._config.backgroundOpacity));this._config.borderOpacity=Math.max(0,Math.min(1,this._config.borderOpacity));
this._config.avatarOpacity=Math.max(0,Math.min(1,this._config.avatarOpacity));if(this._isModelLoaded&&"inactive"===this._active&&this._config.autoActivate===c.Bim)return[2,this._onModelLoaded()];if(!this._isOverlayVisible)return[3,2];this._isOverlayVisible=!1;return[4,this._setupOverlay()];case 1:b.sent(),b.label=2;case 2:return[2,this._doCameraUpdate()]}})})};f.prototype._setFloorplanFromPosition=function(b){return __awaiter(this,void 0,void 0,function(){var c=this;return __generator(this,function(f){return[2,
this._setFloorplanSync.push(function(){return c._doSetFloorplanFromPosition(b)})]})})};f.prototype._doSetFloorplanFromPosition=function(b){return __awaiter(this,void 0,void 0,function(){var c,d,k,e,l,h,t,v,w=this;return __generator(this,function(n){switch(n.label){case 0:c=null;d=[];k=0;for(e=this._floorInfosArray;k<e.length;k++)l=e[k],g(b,l.bounds)&&d.push(l);h=function(c){return __awaiter(w,void 0,void 0,function(){var d,k,e,l,n,g,m,p,h,q,r,u,t,v;return __generator(this,function(w){switch(w.label){case 0:return[4,
this._performDownwardSelection(b)];case 1:d=w.sent(),k=0,e=d,w.label=2;case 2:if(!(k<e.length))return[3,6];l=e[k];n=l.getNodeId();g=this._model.getNodeParent(n);if(null===g)return[3,5];m=this._viewer.model.getNodeGenericType(g);return null===m?[3,5]:f._ifcSpaceTypes.has(m)?[4,this._viewer.model.getNodesBounding([g])]:[3,4];case 3:p=w.sent();h=a(b,p);if(!h)return[3,5];q=0;for(r=c;q<r.length;q++)if(u=r[q],-1!==u.spaceNodes.indexOf(g))return[2,u];return[3,5];case 4:if(f._ifcFloorTypes.has(m))for(t=0,
v=c;t<v.length;t++)if(u=v[t],-1!==u.slabNodes.indexOf(g))return[2,u];w.label=5;case 5:return k++,[3,2];case 6:return[2,null]}})})};return[4,h(d)];case 1:c=n.sent();if(null===c)for(t=0,v=this._floorInfosArray;t<v.length;t++)if(l=v[t],a(b,l.bounds)){c=l;break}return null!==c&&(this._currentFloorInfo=c,null===this._floorplanNode||this._floorplanNode!==c.floorplanNode)?[2,this._setFloorplanFromFloorNode(c.floorNode)]:[2]}})})};f.prototype._performDownwardSelection=function(b){return __awaiter(this,void 0,
void 0,function(){var c,f,a,k,e,l,g,h,w,y;return __generator(this,function(n){switch(n.label){case 0:return c=new d.PickConfig,c.respectVisibility=!1,c.oneEntityPerTypePerInstance=!0,f=new d.Ray(b,new d.Point3(0,0,-1)),[4,this._viewer.view.pickAllFromRay(f,c)];case 1:a=n.sent(),k=new Map,e=0,l=a,n.label=2;case 2:if(!(e<l.length))return[3,5];g=l[e];h=g.getNodeId();return[4,this._model.getNodesBounding([h])];case 3:w=n.sent(),k.set(h,w.max.z),n.label=4;case 4:return e++,[3,2];case 5:return y=function(b,
c){b=k.get(b.getNodeId());c=k.get(c.getNodeId());return void 0===b||void 0===c?-1:c-b},[2,a.sort(y)]}})})};f.prototype._activate=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:if("inactive"!==this._active)return[2];this._active="activating";return[4,this._doUpdateActivation()];case 1:return b.sent(),[2]}})})};f.prototype._deactivate=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:if("inactive"===
this._active)return[2];this._active="inactive";this._isCallbacksSet&&(this._isCallbacksSet=!1,this._viewer.unsetCallbacks({camera:this._onCameraUpdateFunc,frameDrawn:this._onFrameDrawnFunc,transitionEnd:this._onCameraUpdateFunc}));this._isOverlayVisible=!1;return[4,this._overlayManager.setVisibility(d.BuiltinOverlayIndex.Floorplan,this._isOverlayVisible)];case 1:return b.sent(),this._borderNode?[4,this._model.deleteNode(this._borderNode)]:[3,3];case 2:b.sent(),this._borderNode=null,b.label=3;case 3:return this._backgroundNode?
[4,this._model.deleteNode(this._backgroundNode)]:[3,5];case 4:b.sent(),this._backgroundNode=null,b.label=5;case 5:return[4,this._deleteAllFloorplans()];case 6:return b.sent(),[2]}})})};f.prototype._onModelLoaded=function(){return __awaiter(this,void 0,void 0,function(){var b=this;return __generator(this,function(c){switch(c.label){case 0:return[4,this._sync.push(function(){return b._doOnModelLoaded()})];case 1:return c.sent(),[2]}})})};f.prototype._doOnModelLoaded=function(){return __awaiter(this,
void 0,void 0,function(){var b,f;return __generator(this,function(a){switch(a.label){case 0:return console.assert(this._isModelLoaded,"Model not loaded as expected"),(f=(b=this._model.getNodesByGenericType(this._genericStoreyType))&&0<b.size)?[3,2]:[4,this._deactivate()];case 1:return a.sent(),[2];case 2:return"inactive"===this._active?f&&this._config.autoActivate===c.Bim&&(this._active="activating"):"active"===this._active&&(this._active="activating"),"activating"!==this._active?[3,4]:[4,this._doUpdateActivation()];
case 3:a.sent(),a.label=4;case 4:return[2]}})})};f.prototype._doUpdateActivation=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:if("activating"!==this._active||!this._isSceneReady||!this._isModelLoaded)return[2];this._active="active";return this._isOverlayVisible?[3,2]:[4,this._setupOverlay()];case 1:b.sent(),b.label=2;case 2:return[4,this._onProcessIfc()];case 3:return b.sent(),this._isCallbacksSet||(this._isCallbacksSet=!0,this._viewer.setCallbacks({camera:this._onCameraUpdateFunc,
frameDrawn:this._onFrameDrawnFunc,transitionEnd:this._onCameraUpdateFunc})),[2]}})})};f.prototype._deleteAllFloorplans=function(){return __awaiter(this,void 0,void 0,function(){var b,c,f,a;return __generator(this,function(d){switch(d.label){case 0:b=this._floorInfosArray.slice(),this._floorInfos.clear(),this._floorInfosArray.length=0,this._currentFloorInfo=this._floorplanNode=null,c=0,f=b,d.label=1;case 1:if(!(c<f.length))return[3,4];a=f[c];return a.floorplanNode?[4,this._model.deleteNode(a.floorplanNode)]:
[3,3];case 2:d.sent(),d.label=3;case 3:return c++,[3,1];case 4:return[2]}})})};f.prototype._hideActiveFloorplan=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return null===this._floorplanNode?[2]:[4,this._hideOverlayNode(this._floorplanNode)];case 1:return b.sent(),this._currentFloorInfo=this._floorplanNode=null,[2]}})})};f.prototype._onProcessIfc=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(b){switch(b.label){case 0:return console.assert("active"===this._active),[4,this._gatherFloorInfos()];case 1:return b.sent(),[4,this._doCameraUpdate()];case 2:return b.sent(),[2]}})})};f.prototype._hasFloorInfo=function(b){return this._floorInfos.has(b)};f.prototype._getFloorInfo=function(b){b=this._floorInfos.get(b);return void 0===b?null:b};f.prototype._createFloorInfo=function(c){return __awaiter(this,void 0,void 0,function(){var a,d,k,e,l;return __generator(this,function(g){switch(g.label){case 0:return a=
[],this._gatherDescendentIfcNodes(c,f._ifcFloorTypes,a),d=[],this._gatherDescendentIfcNodes(c,f._ifcSpaceTypes,d),k=[],this._gatherDescendentIfcNodes(c,f._ifcFloorplanCreationTypes,k),0===k.length?[2,null]:[4,this._model.getNodesBounding(k,{bodyInstance:!0,pmiBody:!1,viewFrame:!1,tightBounding:this._tightBoundings})];case 1:return e=g.sent(),l=new b(c,e,a,d,k),this._floorInfos.set(c,l),this._floorInfosArray.push(l),[2,l]}})})};f.prototype._gatherFloorInfos=function(){return __awaiter(this,void 0,
void 0,function(){var b,c,a,k;return __generator(this,function(e){switch(e.label){case 0:return b=this._model.getNodesByGenericType(f._genericStoreyType),null!==b&&0!==b.size?[3,2]:[4,this._deactivate()];case 1:return e.sent(),[2];case 2:c=0,a=d.Util.setToArray(b),e.label=3;case 3:if(!(c<a.length))return[3,6];k=a[c];return this._hasFloorInfo(k)?[3,5]:[4,this._createFloorInfo(k)];case 4:e.sent(),e.label=5;case 5:return c++,[3,3];case 6:return 0!==this._floorInfos.size?[3,8]:[4,this._deactivate()];
case 7:e.sent(),e.label=8;case 8:return[2]}})})};f.prototype._gatherDescendentIfcNodes=function(b,c,f){var a=0;for(b=this._model.getNodeChildren(b);a<b.length;a++){var d=b[a],k=this._model.getNodeGenericType(d);null!==k&&c.has(k)&&f.push(d);this._gatherDescendentIfcNodes(d,c,f)}};f.prototype._createFloorplanFromFloorInfo=function(b){return __awaiter(this,void 0,void 0,function(){var c,f,a,d,k;return __generator(this,function(e){switch(e.label){case 0:return c=this._model._gatherInstanceIncsFromNodeIds(b.floorplanMeshCreationNodes),
[4,this._engine.createFloorplanMesh(c)];case 1:return f=e.sent(),a=f[0],d=f[1],k=this._modelStructure.createMeshInstance(a,d,"floorplan",null,!0,!0),[2,k]}})})};f.prototype._onFrameDrawn=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:b=this._viewer.view.getCanvasSize();if(b.equals(this._canvasSize))return[3,2];this._canvasSize=b.copy();if(!this._isOverlayVisible)return[3,2];this._isOverlayVisible=!1;return[4,this._setupOverlay()];
case 1:c.sent(),c.label=2;case 2:return[2]}})})};f.prototype._doCameraUpdate=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this.isActive()?this._floorLock?[3,2]:[4,this._setFloorplanFromPosition(this._viewer.view.getCamera().getPosition())]:[2];case 1:b.sent(),b.label=2;case 2:return b.trys.push([2,,4,5]),this._viewer.pauseRendering(),[4,this._updateOverlay()];case 3:return b.sent(),[3,5];case 4:return this._viewer.resumeRendering(),
[7];case 5:return[2]}})})};f.prototype.isActive=function(){return"active"===this._active};f.prototype._updateOverlay=function(){return __awaiter(this,void 0,void 0,function(){var b,c,f;return __generator(this,function(a){switch(a.label){case 0:if(!this.isActive())return[2];b=this._viewer.view.getCamera();c=b.getPosition();f=d.Point3.subtract(b.getTarget(),c);f.z=0;f.normalize();if(isNaN(f.x)||0===f.length())f=new d.Point3(0,1,0);return[4,this._updateOverlayCamera(c,f)];case 1:return a.sent(),[4,this._updateOverlayNodes(c,
f)];case 2:return a.sent(),[2]}})})};f.prototype._updateOverlayNodes=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,k,e,l,g,n,v,w,y,x,z,B,A,D,C,E,F,H,G,I;return __generator(this,function(m){switch(m.label){case 0:return a=this._model,k=this._config,e=304.8*this._model.getNodeUnitMultiplier(this._model.getAbsoluteRootNode()),l=this._getOverlaySizeInPixels(),g=l.x/l.y,n=e*k.overlayFeetPerPixel/k.zoomLevel,v=n/g,w=n*l.x,y=w/g,k.trackCameraEnabled||(x=this._getFixedCameraSize(g),null!==
x&&(w=x.x,y=x.y)),z=(new d.Matrix).setTranslationComponent(b.x,b.y,f._avatarZ),B=e*k.avatarScale,A=(new d.Matrix).setScaleComponent(B,B,B),D=new d.Matrix,D.m[0]=c.y,D.m[1]=-c.x,D.m[2]=0,D.m[4]=c.x,D.m[5]=c.y,D.m[6]=0,D.m[8]=0,D.m[9]=0,D.m[10]=1,[4,this._viewer.model.setNodeMatrix(this._avatarNode,h([z,D,A]))];case 1:return m.sent(),this._avatarDirty&&(null===k.customAvatar&&(a.setNodesFaceColor([this._avatarNode],k.avatarColor),a.setNodesLineColor([this._avatarNode],k.avatarOutlineColor),a.setNodesOpacity([this._avatarNode],
k.avatarOpacity)),this._avatarDirty=!1),this._borderDirty&&(a.setNodesLineColor([this._borderNode],k.borderColor),a.setNodesOpacity([this._borderNode],k.borderOpacity),this._borderDirty=!1),this._backgroundDirty&&(a.setNodesFaceColor([this._backgroundNode],k.backgroundColor),a.setNodesOpacity([this._backgroundNode],k.backgroundOpacity),this._backgroundDirty=!1),C=w-n,E=y-v,F=(new d.Matrix).setScaleComponent(C,E,1),H=new d.Matrix,this._config.trackCameraEnabled||null===this._currentFloorInfo?H.setTranslationComponent(b.x,
b.y,0):(G=this._currentFloorInfo.bounds.center(),H.setTranslationComponent(G.x,G.y,0)),I=this._config.floorplanOrientation===d.FloorplanOrientation.AvatarUp?h([H,D,F]):d.Matrix.multiply(F,H),[4,this._viewer.model.setNodeMatrix(this._borderNode,I)];case 2:return m.sent(),[4,this._viewer.model.setNodeMatrix(this._backgroundNode,I)];case 3:return m.sent(),[2]}})})};f.prototype.snapAvatarToPoint=function(b){if(null!==this._currentFloorInfo&&this.insideOverlay(b))if(this._config.trackCameraEnabled)console.log("FP: snapAvatarToPoint: currently only supported when trackCameraEnabled is false");
else{var c=this._getOverlaySizeInPixels(),f=this._getOverlayOffsetInPixels(),a=new d.Point2(b.x-f.x,b.y-f.y),k=this._currentFloorInfo.bounds,e=k.extents(),l=e.x/e.y,g=c.x/c.y;b=this._viewer.view.getCamera();f=b.getPosition();var h=b.getTarget(),w=new d.Matrix;if(this._config.floorplanOrientation!==d.FloorplanOrientation.NorthUp){w=d.Point3.subtract(h,f);w=(new d.Point3(w.x,w.y,0)).normalize();var y=new d.Point3(0,1,0),x=new d.Point3(-1,0,0);x=90<d.Util.computeAngleBetweenVector(x,w)?new d.Point3(0,
0,-1):new d.Point3(0,0,1);w=d.Util.computeAngleBetweenVector(y,w);w=d.Matrix.createFromOffAxisRotation(x,w)}g>l?(c=e.y/c.y,k=new d.Point2(k.center().x-e.y/2*g,k.center().y+e.y/2)):(c=e.x/c.x,k=new d.Point2(k.center().x-e.x/2,k.center().y+e.x/2/g));c=new d.Point3(a.x*c+k.x,k.y-a.y*c,f.z);c=w.transform(c);f=d.Point3.subtract(h,f);f=d.Point3.add(c,f);b.setPosition(c);b.setTarget(f);b.setProjection(d.Projection.Perspective);this._viewer.view.setCamera(b)}};f.prototype._getOverlaySizeInPixels=function(){var b=
new d.OverlayUnitPoint(this._config.overlaySize.x,this._config.overlayWidthUnit,this._config.overlaySize.y,this._config.overlayHeightUnit);return this._viewer.overlayManager._toPixelPoint(b)};f.prototype._getOverlayOffsetInPixels=function(){var b=this._overlayManager.getViewportPixelOffsetInCanvas(d.BuiltinOverlayIndex.Floorplan);return null===b?d.Point2.zero():b};f.prototype._getFixedCameraSize=function(b){if(null!==this._currentFloorInfo){var c=this._currentFloorInfo.bounds.extents();return c.x/
c.y>b?new d.Point2(c.x,c.x/b):new d.Point2(c.y*b,c.y)}return null};f.prototype._updateOverlayCamera=function(b,c){return __awaiter(this,void 0,void 0,function(){var f,a,k,e,l,g,n,h,y,x;return __generator(this,function(m){switch(m.label){case 0:return f=this._config,a=this._getOverlaySizeInPixels(),k=a.x/a.y,e=304.8*this._model.getNodeUnitMultiplier(this._model.getAbsoluteRootNode()),l=e*f.overlayFeetPerPixel/f.zoomLevel,g=l*a.x,n=g/k,f.trackCameraEnabled||(h=this._getFixedCameraSize(k),null!==h&&
(g=h.x,n=h.y)),y=new d.Camera,y.setWidth(g),y.setHeight(n),this._config.trackCameraEnabled||null===this._currentFloorInfo?(y.setTarget(new d.Point3(b.x,b.y,0)),y.setPosition(new d.Point3(b.x,b.y,10))):(x=this._currentFloorInfo.bounds.center(),y.setTarget(new d.Point3(x.x,x.y,0)),y.setPosition(new d.Point3(x.x,x.y,10))),f.floorplanOrientation===d.FloorplanOrientation.AvatarUp?y.setUp(c):f.floorplanOrientation===d.FloorplanOrientation.NorthUp&&y.setUp(new d.Point3(0,1,0)),[4,this._overlayManager.setCamera(d.BuiltinOverlayIndex.Floorplan,
y)];case 1:return m.sent(),[2]}})})};f.prototype._setFloorplanFromFloorNode=function(b){return __awaiter(this,void 0,void 0,function(){var c,f,a,k;return __generator(this,function(e){switch(e.label){case 0:return[4,this._hideActiveFloorplan()];case 1:e.sent();if(!this._hasFloorInfo(b))return[3,2];f=this._getFloorInfo(b);return[3,4];case 2:return[4,this._createFloorInfo(b)];case 3:f=e.sent(),e.label=4;case 4:return c=f,null===c?[2]:null!==c.floorplanNode?[3,9]:[4,this._createFloorplanFromFloorInfo(c)];
case 5:return a=e.sent(),k=new d.Matrix,[4,this._model.setNodeMatrix(a,k,!0)];case 6:return e.sent(),[4,this._overlayManager.addNodes(d.BuiltinOverlayIndex.Floorplan,[a])];case 7:return e.sent(),this._floorplanNode=c.floorplanNode=a,this._currentFloorInfo=c,[4,this._showOverlayNode(a)];case 8:return e.sent(),[3,11];case 9:return this._floorplanNode=c.floorplanNode,this._currentFloorInfo=c,[4,this._showOverlayNode(c.floorplanNode)];case 10:e.sent(),e.label=11;case 11:return[4,this._updateOverlay()];
case 12:return e.sent(),[2]}})})};f.prototype._setupOverlay=function(){return __awaiter(this,void 0,void 0,function(){var b,c,a,k,e,g;return __generator(this,function(l){switch(l.label){case 0:return b=this._config,console.assert(this.isActive()),c=this._overlayManager,this._isOverlayVisible=!0,[4,c.setViewport(d.BuiltinOverlayIndex.Floorplan,b.overlayAnchor,b.overlayOffset.x,b.overlayOffsetXUnit,b.overlayOffset.y,b.overlayOffsetYUnit,b.overlaySize.x,b.overlayWidthUnit,b.overlaySize.y,b.overlayHeightUnit)];
case 1:return l.sent(),[4,c.setVisibility(d.BuiltinOverlayIndex.Floorplan,this._isOverlayVisible)];case 2:l.sent();if(this._avatarNode)return[3,7];a=this;if(null===this._config.customAvatar)return[3,3];k=this._config.customAvatar;return[3,5];case 3:return[4,this._createAvatar()];case 4:k=l.sent(),l.label=5;case 5:return a._avatarNode=k,this._modelStructure.preventNodeDeletion(this._avatarNode),[4,this._overlayManager.addNodes(d.BuiltinOverlayIndex.Floorplan,[this._avatarNode])];case 6:l.sent(),l.label=
7;case 7:if(this._borderNode)return[3,10];e=this;return[4,this._create2dBox(!0,!1,f._borderZ)];case 8:return e._borderNode=l.sent(),[4,this._overlayManager.addNodes(d.BuiltinOverlayIndex.Floorplan,[this._borderNode])];case 9:l.sent(),this._borderDirty=!0,l.label=10;case 10:if(this._backgroundNode)return[3,13];g=this;return[4,this._create2dBox(!1,!0,f._backgroundZ)];case 11:return g._backgroundNode=l.sent(),[4,this._overlayManager.addNodes(d.BuiltinOverlayIndex.Floorplan,[this._backgroundNode])];case 12:l.sent(),
this._backgroundDirty=!0,l.label=13;case 13:return[4,this._updateOverlay()];case 14:return l.sent(),[2]}})})};f.prototype._hideOverlayNode=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(f){switch(f.label){case 0:return c=new d.Matrix,c.setTranslationComponent(1E30,0,0),[4,this._model.setNodeMatrix(b,c,!0)];case 1:return f.sent(),[2]}})})};f.prototype._showOverlayNode=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(c){switch(c.label){case 0:return[4,this._model.setNodeMatrix(b,new d.Matrix,!0)];case 1:return c.sent(),[2]}})})};f.prototype._createAvatar=function(){return __awaiter(this,void 0,void 0,function(){var b,c,f,a,k,e,g,h,v,w,y;return __generator(this,function(l){switch(l.label){case 0:return b=this._config.fixedAvatarScale?1E4:1,c=1.2/b,f=1.5/b,a=-1.1/b,k=[0,f,0,-c,-f,0,0,a,0,0,f,0,0,a,0,c,-f,0],e=[-c,-f,0,0,f,0,c,-f,0,0,a,0,-c,-f,0],g=new d.MeshData,g.setBackfacesEnabled(!1),g.addFaces(k,void 0,
void 0,void 0),g.addPolyline(e,void 0),[4,this._viewer.model.createMesh(g)];case 1:return h=l.sent(),v=new d.MeshInstanceData(h),w=(this._config.fixedAvatarScale?d.MeshInstanceCreationFlags.SuppressCameraScale:d.MeshInstanceCreationFlags.None)|d.MeshInstanceCreationFlags.ExcludeBounding,v.setCreationFlags(w),[4,this._viewer.model.createMeshInstance(v,null,!0,!0)];case 2:return y=l.sent(),[2,y]}})})};f.prototype._create2dBox=function(b,c,f){return __awaiter(this,void 0,void 0,function(){var a,k,e,
l,g,n,m;return __generator(this,function(p){switch(p.label){case 0:return a=new d.MeshData,b&&(k=[-.5,-.5,f,-.5,.5,f,.5,.5,f,.5,-.5,f,-.5,-.5,f],a.addPolyline(k,void 0)),c&&(e=[.5,-.5,f,.5,.5,f,-.5,.5,f,-.5,.5,f,-.5,-.5,f,.5,-.5,f],l=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],a.addFaces(e,l),a.setBackfacesEnabled(!1)),[4,this._viewer.model.createMesh(a)];case 1:return g=p.sent(),n=new d.MeshInstanceData(g),n.setCreationFlags(d.MeshInstanceCreationFlags.ExcludeBounding),[4,this._viewer.model.createMeshInstance(n,
null,!0,!0)];case 2:return m=p.sent(),[2,m]}})})};f._genericStoreyType="IFCBUILDINGSTOREY";f._ifcFloorTypes=new Set(["IFCSLAB"]);f._ifcSpaceTypes=new Set(["IFCSPACE"]);f._ifcFloorplanCreationTypes=new Set(["IFCWALL","IFCWALLSTANDARDCASE","IFCCURTAINWALL","IFCSLAB","IFCCOLUMN"]);f._backgroundZ=-1;f._avatarZ=1;f._borderZ=2;return f}();d.FloorplanManager=f})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(){this._obscuredLineColor=d.Color.black();this._obscuredLineOpacity=.2;this._visibleLineColor=d.Color.black();this._visibleLineOpacity=1;this._backgroundColor=d.Color.white()}a.prototype.getObscuredLineColor=function(){return this._obscuredLineColor.copy()};a.prototype.setObscuredLineColor=function(a){this._obscuredLineColor.assign(a)};a.prototype.getObscuredLineOpacity=function(){return this._obscuredLineOpacity};a.prototype.getObscuredLineTransparency=
function(){return this.getObscuredLineOpacity()};a.prototype.setObscuredLineOpacity=function(a){0<=a&&1>=a&&(this._obscuredLineOpacity=a)};a.prototype.setObscuredLineTransparency=function(a){this.setObscuredLineOpacity(a)};a.prototype.getVisibleLineColor=function(){return this._visibleLineColor.copy()};a.prototype.setVisibleLineColor=function(a){this._visibleLineColor.assign(a)};a.prototype.getVisibleLineOpacity=function(){return this._visibleLineOpacity};a.prototype.getVisibleLineTransparency=function(){return this.getVisibleLineOpacity()};
a.prototype.setVisibleLineOpacity=function(a){0<=a&&1>=a&&(this._visibleLineOpacity=a)};a.prototype.setVisibleLineTransparency=function(a){this.setVisibleLineOpacity(a)};a.prototype.getBackgroundColor=function(){return this._backgroundColor.copy()};a.prototype.setBackgroundColor=function(a){this._backgroundColor.assign(a)};return a}();h.HiddenLineSettings=g})(d.Settings||(d.Settings={}))})(Communicator||(Communicator={}));
(function(d){(function(h){h.isMouseEventType=function(a){switch(a){case d.EventType.MouseDown:return!0;case d.EventType.MouseMove:return!0;case d.EventType.MouseUp:return!0;case d.EventType.Mousewheel:return!0;case d.EventType.TouchStart:return!1;case d.EventType.TouchMove:return!1;case d.EventType.TouchEnd:return!1;case d.EventType.KeyDown:return!1;case d.EventType.KeyUp:return!1;case d.EventType.ViewOrientationChange:return!1}};var g=function(){function a(){this._date=new Date;this._handled=!1}
a.prototype.getHandled=function(){return this._handled};a.prototype.setHandled=function(a){this._handled=a};a.prototype.getDate=function(){return this._date};return a}();h.InputEvent=g})(d.Event||(d.Event={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(a){function d(c,b,f){b=a.call(this)||this;b._keyCode=c;b._eventType=f;return b}__extends(d,a);d.prototype.getKeyCode=function(){return this._keyCode};d.prototype.getEventType=function(){return this._eventType};return d}(d.InputEvent);d.KeyInputEvent=g})(d.Event||(d.Event={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function e(c,b){this._callbackManager=c;this._operatorManager=b;this._contextEventChecker=new a(this._callbackManager)}e.prototype.injectMouseDownEvent=function(c,b,f,a,e){c=new d.Event.MouseInputEvent(c,b,f,a,e,d.MouseInputType.Down);b=d.EventType.MouseDown;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager.injectEvent(c,b);this._contextEventChecker.onMouseDownEvent(c)};e.prototype.injectMouseMoveEvent=function(c,b,f,a,e){c=new d.Event.MouseInputEvent(c,
b,f,a,e,d.MouseInputType.Move);b=d.EventType.MouseMove;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager.injectEvent(c,b)};e.prototype.injectMouseUpEvent=function(c,b,f,a,e){c=new d.Event.MouseInputEvent(c,b,f,a,e,d.MouseInputType.Up);b=d.EventType.MouseUp;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager.injectEvent(c,b);this._contextEventChecker.onMouseUpEvent(c)};e.prototype.injectMousewheelEvent=function(c,b,f,a,e){c=new d.Event.MouseWheelInputEvent(c,
b,f,a,e,d.MouseInputType.Wheel);b=d.EventType.Mousewheel;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager.injectEvent(c,b)};e.prototype.injectKeyDownEvent=function(c,b){c=new d.Event.KeyInputEvent(c,b,d.KeyInputType.Down);b=d.EventType.KeyDown;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager.injectEvent(c,b)};e.prototype.injectKeyUpEvent=function(c,b){c=new d.Event.KeyInputEvent(c,b,d.KeyInputType.Up);b=d.EventType.KeyUp;this._callbackManager.trigger("_inputInteraction",
c,b);this._operatorManager.injectEvent(c,b)};e.prototype.injectTouchStartEvent=function(c,b,f,a){c=new d.Event.TouchInputEvent(c,b,f,a,d.TouchInputType.Start);b=d.EventType.TouchStart;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager.injectEvent(c,b);this._contextEventChecker.onTouchStartEvent(c)};e.prototype.injectTouchMoveEvent=function(c,b,f,a){c=new d.Event.TouchInputEvent(c,b,f,a,d.TouchInputType.Start);b=d.EventType.TouchMove;this._callbackManager.trigger("_inputInteraction",
c,b);this._operatorManager.injectEvent(c,b);this._contextEventChecker.onTouchMoveEvent(c)};e.prototype.injectTouchEndEvent=function(c,b,f,a){c=new d.Event.TouchInputEvent(c,b,f,a,d.TouchInputType.End);b=d.EventType.TouchEnd;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager.injectEvent(c,b);this._contextEventChecker.onTouchEndEvent(c)};e.prototype.injectViewOrientationChangeEvent=function(){this._operatorManager._injectViewOrientationChangeEvent()};return e}();h.EventDispatcher=
g;var a=function(){function a(c){this._contextMenuMouseButton=d.Button.Right;this._contextMenuPositionStart=d.Point2.zero();this._touchTimer=new d.Util.Timer;this._activeTouchCount=0;this._initialPosition=d.Point2.zero();this._callbackManager=c}a.prototype.onMouseDownEvent=function(c){c.getHandled()||this._contextMenuPositionStart.assign(c.getPosition())};a.prototype.onMouseUpEvent=function(c){if(!c.getHandled()){var b=c.getPosition();c.getButton()===this._contextMenuMouseButton&&this._contextMenuPositionStart.equals(b)&&
this._callbackManager.trigger("contextMenu",b,c.getModifiers())}};a.prototype.onTouchStartEvent=function(c){var b=this,f=c.getPosition().copy();0===this._activeTouchCount&&(this._initialPosition=f);++this._activeTouchCount;c.getHandled()||this._touchTimer.set(600,function(){b._callbackManager.trigger("contextMenu",f,d.KeyModifiers.None)})};a.prototype.onTouchMoveEvent=function(c){if(!this._touchTimer.isIdle(0)){c=d.Point2.subtract(this._initialPosition,c.getPosition());c=Math.abs(c.squaredLength());
var b=.02*window.outerHeight;c>b*b&&this._touchTimer.clear()}};a.prototype.onTouchEndEvent=function(c){0<this._activeTouchCount&&--this._activeTouchCount;this._touchTimer.clear()};return a}()})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(a,d){this.x=a;this.y=d}d.prototype.assign=function(a){this.x=a.x;this.y=a.y;return this};d.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};d.prototype.subtract=function(a){this.x-=a.x;this.y-=a.y;return this};d.prototype.scale=function(a){this.x*=a;this.y*=a;return this};d.prototype.equals=function(a){return this.x===a.x&&this.y===a.y};d.prototype.set=function(a,d){this.x=a;this.y=d;return this};d.prototype.copy=function(){return new d(this.x,
this.y)};d.prototype.length=function(){return Math.sqrt(this.squaredLength())};d.prototype.squaredLength=function(){return this.x*this.x+this.y*this.y};d.prototype.toJson=function(){return this._toJson()};d.prototype._toJson=function(){return{x:this.x,y:this.y}};d.prototype.forJson=function(){return this.toJson()};d.fromJson=function(a){return new d(a.x,a.y)};d.subtract=function(a,e){return new d(a.x-e.x,a.y-e.y)};d.add=function(a,e){return new d(a.x+e.x,a.y+e.y)};d.distance=function(a,e){return d.subtract(e,
a).length()};d.zero=function(){return new d(0,0)};d.fromPoint3=function(a){return new d(a.x,a.y)};return d}();d.Point2=h})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){return function(){this.top=this.left=0}}(),a=function(){function a(c,b){this._isFirefox=this._isIE=!1;this._canvas=null;this._canvasEventFunctions=new Map;this._documentEventFunctions=new Map;this._pointerEventsEnabled=!0;this._captureInput=this._dragStarted=this._eventsBound=this._processInput=!1;this._elementOffset=new g;this._pointerUp=!1;this._buttons=d.Buttons.None;this._eventDispatcher=c;this._timeoutMonitor=b;this._document=document;c=navigator.userAgent.toLowerCase();
this._isIE=0<=c.indexOf("trident")||0<=c.indexOf("edge");this._isFirefox=-1<c.indexOf("firefox")}a.prototype._tryLockEventDispatcher=function(){return a._activeEventDispatcherLocked&&a._activeEventDispatcher!==this._eventDispatcher?!1:(this._calculateElementOffset(),a._activeEventDispatcher=this._eventDispatcher,a._activeOffset=this._elementOffset,a._activeEventDispatcherLocked=!0)};a.prototype._unlockEventDispatcher=function(){a._activeEventDispatcherLocked=!1};a.prototype.shutdown=function(){this.unbindEvents()};
a.prototype.setDocument=function(c){this._unbindDocumentEvents();this._document=c;this._initDocumentEvents()};a.prototype.setOptions=function(c){c.hasOwnProperty("usePointerEvents")&&this.setPointerEventsEnabled(!!c.usePointerEvents)};a.prototype.elementResize=function(){this._calculateElementOffset()};a.prototype.setPointerEventsEnabled=function(c){this._pointerEventsEnabled=c};a.prototype.getPointerEventsEnabled=function(){return this._pointerEventsEnabled};a.prototype._browserSupportsPointerEvents=
function(){return window.hasOwnProperty("PointerEvent")};a.prototype._usePointerEvents=function(){return this._browserSupportsPointerEvents()&&this._pointerEventsEnabled&&this._isIE};a.prototype._calculateElementOffset=function(){if(null!==this._canvas){var c=this._canvas.getBoundingClientRect();this._elementOffset.left=c.left;this._elementOffset.top=c.top}};a.prototype._initDocumentEvents=function(){var c=this;this._usePointerEvents()?(this._bindDocumentEvent("pointermove",function(b){c._processDocumentPointerMove(b)}),
this._bindDocumentEvent("pointerup",function(b){c._processDocumentPointerUp(b)})):(this._bindDocumentEvent("mousemove",function(b){c._processDocumentMouseMove(b)}),this._bindDocumentEvent("mouseup",function(b){c._processDocumentMouseUp(b)}))};a.prototype._initCanvasEvents=function(){var c=this;this._usePointerEvents()?(this._bindCanvasEvent("pointerdown",function(b){c._processPointerDown(b)}),this._bindCanvasEvent("pointermove",function(b){c._processPointerMove(b)}),this._bindCanvasEvent("pointerup",
function(b){c._processPointerUp(b)}),this._bindCanvasEvent("pointerenter",function(b){c._processPointerEnter(b)}),this._bindCanvasEvent("pointerleave",function(b){c._processPointerLeave(b)})):(this._bindCanvasEvent("mousedown",function(b){c._processMouseDown(b)}),this._bindCanvasEvent("mousemove",function(b){c._processMouseMove(b)}),this._bindCanvasEvent("mouseup",function(b){c._processMouseUp(b)}),this._bindCanvasEvent("mouseenter",function(b){c._processMouseEnter(b)}),this._bindCanvasEvent("mouseleave",
function(b){c._processMouseLeave(b)}),this._bindCanvasEvent("touchstart",function(b){c._processTouchStart(b)}),this._bindCanvasEvent("touchmove",function(b){c._processTouchMove(b)}),this._bindCanvasEvent("touchend",function(b){c._processTouchEnd(b)}),this._bindCanvasEvent("touchcancel",function(b){c._processTouchEnd(b)}));this._isFirefox?this._bindCanvasEvent("DOMMouseScroll",function(b){c._processMousewheel(b)}):this._bindCanvasEvent("mousewheel",function(b){c._processMousewheel(b)});this._bindCanvasEvent("keydown",
function(b){c._processKeyDownEvent(b)});this._bindCanvasEvent("keyup",function(b){c._processKeyUpEvent(b)})};a.prototype.bindEvents=function(c){this._eventsBound||(this._canvas=c,this._processInput=!0,this._initCanvasEvents(),this._initDocumentEvents(),this._eventsBound=!0,this._tryLockEventDispatcher())};a.prototype._bindDocumentEvent=function(c,b){if(null!==this._document){var f=this._documentEventFunctions.get(c);void 0!==f&&this._document.removeEventListener(c,f);this._documentEventFunctions.set(c,
b);this._document.addEventListener(c,b)}};a.prototype._bindCanvasEvent=function(c,b){if(null!==this._canvas){var f=this._canvasEventFunctions.get(c);void 0!==f&&this._canvas.removeEventListener(c,f);this._canvasEventFunctions.set(c,b);this._canvas.addEventListener(c,b)}};a.prototype._unbindDocumentEvents=function(){var c=this;this._documentEventFunctions.forEach(function(b,f){c._document.removeEventListener(f,b)});this._documentEventFunctions.clear()};a.prototype._unbindCanvasEvents=function(){var c=
this;null!==this._canvas&&(this._canvasEventFunctions.forEach(function(b,f){c._canvas.removeEventListener(f,b)}),this._canvasEventFunctions.clear());console.assert(0===this._canvasEventFunctions.size)};a.prototype.unbindEvents=function(){this._unbindCanvasEvents();this._unbindDocumentEvents();this._eventsBound=this._processInput=!1;a._activeEventDispatcher===this._eventDispatcher&&this._unlockEventDispatcher()};a.prototype._convertEventCoordsToTargetCoords=function(c,b){var f=null!==a._activeOffset?
a._activeOffset:this._elementOffset;return new d.Point2(c-f.left,b-f.top)};a.prototype.focusInput=function(c){null!==this._canvas&&(c?this._canvas.focus():this._canvas.blur())};a.prototype._setButtons=function(c){c.buttons&&(this._buttons=c.buttons)};a.prototype._processMouseDown=function(c){if(this._tryLockEventDispatcher()){switch(c.button){case 0:this._buttons|=d.Buttons.Left;break;case 1:this._buttons|=d.Buttons.Middle;break;case 2:this._buttons|=d.Buttons.Right}c.preventDefault();this._timeoutMonitor.resetTimeout();
if(this._processInput){var b=this._convertEventCoordsToTargetCoords(c.clientX,c.clientY),f=this._getEventModifiers(c);a._activeEventDispatcher.injectMouseDownEvent(b.x,b.y,c.button,this._buttons,f);this._dragStarted=!0}}};a.prototype._processMouseMove=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._convertEventCoordsToTargetCoords(c.clientX,c.clientY);c=this._getEventModifiers(c);null!==a._activeEventDispatcher&&a._activeEventDispatcher.injectMouseMoveEvent(b.x,
b.y,d.Button.None,this._buttons,c)}};a.prototype._processMouseUp=function(c){this._unlockEventDispatcher();switch(c.button){case 0:this._buttons&=~d.Buttons.Left;break;case 1:this._buttons&=~d.Buttons.Middle;break;case 2:this._buttons&=~d.Buttons.Right}c.preventDefault();c.stopPropagation();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._convertEventCoordsToTargetCoords(c.clientX,c.clientY),f=this._getEventModifiers(c);null!==a._activeEventDispatcher?a._activeEventDispatcher.injectMouseUpEvent(b.x,
b.y,c.button,this._buttons,f):this._eventDispatcher.injectMouseUpEvent(b.x,b.y,c.button,this._buttons,f);this._captureInput=this._dragStarted=!1}};a.prototype._processMousewheel=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._convertEventCoordsToTargetCoords(c.clientX,c.clientY),f=this._getEventModifiers(c);this._eventDispatcher.injectMousewheelEvent(b.x,b.y,this._isFirefox?0<c.detail?-1:1:0<c.wheelDelta?1:-1,this._buttons,f)}};a.prototype._processDocumentMouseMove=
function(c){this._dragStarted&&this._captureInput&&this._processMouseMove(c)};a.prototype._processDocumentMouseUp=function(c){this._dragStarted&&this._captureInput&&this._processMouseUp(c)};a.prototype._processMouseLeave=function(c){this._unlockEventDispatcher();this._dragStarted&&(this._captureInput=!0)};a.prototype._processMouseEnter=function(c){this._tryLockEventDispatcher()&&this._dragStarted&&(this._captureInput=!1)};a.prototype._isFunctionKey=function(c){return 112<=c.which&&123>=c.which};a.prototype._processKeyDownEvent=
function(c){this._isFunctionKey(c)||c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._getEventModifiers(c);this._eventDispatcher.injectKeyDownEvent(c.which,b)}};a.prototype._processKeyUpEvent=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._getEventModifiers(c);this._eventDispatcher.injectKeyUpEvent(c.which,b)}};a.prototype._processTouchStart=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();
if(this._processInput)for(var b=0;b<c.changedTouches.length;b++){var f=c.changedTouches.item(b),a=this._convertEventCoordsToTargetCoords(f.clientX,f.clientY);this._eventDispatcher.injectTouchStartEvent(f.identifier,a.x,a.y,this._buttons)}};a.prototype._processTouchMove=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput)for(var b=0;b<c.changedTouches.length;b++){var f=c.changedTouches.item(b),a=this._convertEventCoordsToTargetCoords(f.clientX,f.clientY);this._eventDispatcher.injectTouchMoveEvent(f.identifier,
a.x,a.y,this._buttons)}};a.prototype._processTouchEnd=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput)for(var b=0;b<c.changedTouches.length;b++){var f=c.changedTouches.item(b),a=this._convertEventCoordsToTargetCoords(f.clientX,f.clientY);this._eventDispatcher.injectTouchEndEvent(f.identifier,a.x,a.y,this._buttons)}};a.prototype._processPointerDown=function(c){if(this._tryLockEventDispatcher()&&(this._setButtons(c),c.preventDefault(),this._timeoutMonitor.resetTimeout(),
this._processInput)){var b=this._convertEventCoordsToTargetCoords(c.clientX,c.clientY),f=this._getEventModifiers(c);"mouse"===c.pointerType?a._activeEventDispatcher.injectMouseDownEvent(b.x,b.y,c.button,this._buttons,f):"touch"===c.pointerType&&a._activeEventDispatcher.injectTouchStartEvent(c.pointerId,b.x,b.y,this._buttons);this._pointerUp=!1}};a.prototype._processPointerMove=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();this._setButtons(c);if(this._processInput){var b=this._convertEventCoordsToTargetCoords(c.clientX,
c.clientY),f=this._getEventModifiers(c);null!==a._activeEventDispatcher&&("mouse"===c.pointerType?a._activeEventDispatcher.injectMouseMoveEvent(b.x,b.y,c.button,this._buttons,f):"touch"===c.pointerType&&a._activeEventDispatcher.injectTouchMoveEvent(c.pointerId,b.x,b.y,this._buttons))}};a.prototype._processPointerUp=function(c){this._unlockEventDispatcher();this._setButtons(c);c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._convertEventCoordsToTargetCoords(c.clientX,
c.clientY),f=this._getEventModifiers(c);"mouse"!==c.pointerType||this._pointerUp?"touch"===c.pointerType&&this._eventDispatcher.injectTouchEndEvent(c.pointerId,b.x,b.y,this._buttons):null!==a._activeEventDispatcher?a._activeEventDispatcher.injectMouseUpEvent(b.x,b.y,c.button,this._buttons,f):this._eventDispatcher.injectMouseUpEvent(b.x,b.y,c.button,this._buttons,f);this._captureInput=this._dragStarted=!1;this._pointerUp=!0;this._buttons=d.Buttons.None}};a.prototype._processPointerEnter=function(c){this._pointerUp||
(this._captureInput=!1)};a.prototype._processPointerLeave=function(c){this._pointerUp||(this._captureInput=!0)};a.prototype._processDocumentPointerMove=function(c){!this._pointerUp&&this._captureInput&&this._processPointerMove(c)};a.prototype._processDocumentPointerUp=function(c){!this._pointerUp&&this._captureInput&&this._processPointerUp(c)};a.prototype._getEventModifiers=function(c){var b=d.KeyModifiers.None;c.altKey&&(b|=d.KeyModifiers.Alt);c.ctrlKey&&(b|=d.KeyModifiers.Control);c.shiftKey&&(b|=
d.KeyModifiers.Shift);c.metaKey&&(b|=d.KeyModifiers.Command);return b};a._activeEventDispatcher=null;a._activeEventDispatcherLocked=!1;a._activeOffset=null;return a}();h.InputMonitor=a})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){d[d.Directional=0]="Directional"})(d.LightType||(d.LightType={}));(function(d){d[d.World=0]="World";d[d.Camera=1]="Camera"})(d.LightSpace||(d.LightSpace={}));var h=function(){return function(d,a,e,c){this.type=d;this.space=a;this.position=e;this.color=c}}();d.Light=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(){}d.prototype.exportMarkup=function(){return[]};d.prototype.loadData=function(a){a;return Promise.resolve([])};return d}();d.MarkupTypeManager=h})(Communicator||(Communicator={}));
(function(d){var h=function(g){function a(a,c){var b=g.call(this)||this;b._markupArray=[];b._viewer=a;b._callbackManager=c;b._callbackManager.bind({modelSwitched:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.removeAllLines()];case 1:return b.sent(),[2]}})})}});return b}__extends(a,g);a.prototype.addLine=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._markupArray.push(a),
[4,a.updateLine()];case 1:return c.sent(),this._callbackManager.trigger("lineCreated",a),[2]}})})};a.prototype.removeLine=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:c=0,b.label=1;case 1:return c<this._markupArray.length?this._markupArray[c].getId()!==a.getId()?[3,3]:[4,a.removeLine()]:[3,4];case 2:b.sent(),this._markupArray.splice(c,1),this._callbackManager.trigger("lineDeleted",a),b.label=3;case 3:return c++,[3,1];case 4:return[2]}})})};
a.prototype.removeAllLines=function(){for(var a=this,c=[],b=function(b){var d=f._markupArray[b];c.push(d.removeLine().then(function(){a._callbackManager.trigger("lineDeleted",d)}));f._markupArray.splice(b,1)},f=this,k=this._markupArray.length-1;0<=k;k--)b(k);return d.Util.waitForAll(c)};a.prototype.getAllLines=function(){return this._markupArray.slice(0)};a.prototype.removeLastLine=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return 0<
this._markupArray.length?[4,this.removeLine(this._markupArray[this._markupArray.length-1])]:[3,2];case 1:a.sent(),a.label=2;case 2:return[2]}})})};a.prototype.getLineByNodeId=function(a){for(var c=0,b=this._markupArray;c<b.length;c++){var f=b[c],d=f.getNodeId();if(null!==d&&d===a)return f}return null};a.prototype.exportMarkup=function(){for(var a=[],c=0,b=this._markupArray;c<b.length;c++)a.push(b[c].toJson());return a};a.prototype._handleLoadLine=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(c){switch(c.label){case 0:return a instanceof d.Markup.Line.LineMarkup?[4,this.addLine(a)]:[3,2];case 1:return c.sent(),this._callbackManager.trigger("lineLoaded",a),[2,!0];case 2:return[2,!1]}})})};a.prototype.loadData=function(a){for(var c=this,b=[],f=0;f<a.length;f++){var k=a[f];if(k.hasOwnProperty("className")){var e=d.Internal.classFromString(k.className);e&&(k=e.fromJson(k,this._viewer),k instanceof Promise?b.push(k.then(function(b){return c._handleLoadLine(b)})):b.push(this._handleLoadLine(k)))}}return Promise.all(b)};
return a}(d.MarkupTypeManager);d.LineManager=h})(Communicator||(Communicator={}));var __decorate=this&&this.__decorate||function(d,h,g,a){var e=arguments.length,c=3>e?h:null===a?a=Object.getOwnPropertyDescriptor(h,g):a,b;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)c=Reflect.decorate(d,h,g,a);else for(var f=d.length-1;0<=f;f--)if(b=d[f])c=(3>e?b(c):3<e?b(h,g,c):b(h,g))||c;return 3<e&&c&&Object.defineProperty(h,g,c),c};
(function(d){var h=function(){function g(a,e,c,b,f,k,l){this._markupTypeMap=new Map;this._domElements=a;this._callbackManager=b;this._viewer=l;this._sheetManager=f;this._sheetManager.setMarkupManager(this);this._noteTextManager=k;this._renderer=new d.Internal.SVG.SVGMarkupRenderer;this._itemManager=new d.Internal.MarkupItemManager(this._callbackManager,this._domElements,this._renderer);this._viewManager=new d.Internal.MarkupViewManager(this._viewer,this._itemManager,this._callbackManager,l.explodeManager,
l.cuttingManager,this._sheetManager);this._measurementManager=e;this._lineManager=c}g.deprecated=function(a,d,c){var b=c.value;c.value=function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];this._callbackManager.trigger("deprecated","MarkupManager",d);return b.apply(this,c)};return c};g.prototype.registerMarkupTypeManager=function(a,d){this._markupTypeMap.set(a,d)};g.prototype.createMarkupView=function(a,d,c,b,f){void 0===d&&(d=!0);void 0===c&&(c=null);void 0===b&&(b=null);void 0===
f&&(f=null);var k=this._viewer.sheetManager.getActiveSheetId();return this._viewManager.createView(a,d,k,c,b,f).getUniqueId()};g.prototype.getMarkupView=function(a){return this._viewManager.getView(a)};g.prototype.getMarkupViewKeys=function(){return this._viewManager.getViewKeys()};g.prototype.activateMarkupViewWithPromise=function(a,e){void 0===e&&(e=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){return[2,this._viewManager.activateView(a,
e)]})})};g.prototype.activateMarkupView=function(a,e){void 0===e&&(e=d.DefaultTransitionDuration);return this._viewManager.deprecatedActivateView(a,e)};g.prototype.getActiveMarkupView=function(){return this._itemManager.getActiveView()};g.prototype.deleteMarkupView=function(a){return this._viewManager.deleteView(a)};g.prototype.registerMarkup=function(a){a=this._itemManager.registerMarkupItem(a);this.updateLater();return a};g.prototype.unregisterMarkup=function(a){this._itemManager.unregisterMarkupItem(a);
this.updateLater()};g.prototype.addMarkupElement=function(a){var e=d.UUID.create();a.id=e;this._domElements.getRedlineElement().appendChild(a);return e};g.prototype.removeMarkupElement=function(a){for(var d=this._domElements.getRedlineElement(),c=0;c<d.children.length;c++){var b=d.children.item(c);null!==b&&b.id===a&&d.removeChild(b)}};g.prototype.refreshMarkup=function(){this.updateLater()};g.prototype.updateLater=function(){this._itemManager.updateLater()};g.prototype.pickMarkupItem=function(a){return this._itemManager.pick(a)};
g.prototype.getPickTolerance=function(){return this._itemManager.getPickTolerance()};g.prototype.setPickTolerance=function(a){return this._itemManager.setPickTolerance(a)};g.prototype.selectMarkup=function(a){this._itemManager.select(a)};g.prototype.getSelectedMarkup=function(){return this._itemManager.getSelected()};g.prototype.exportMarkup=function(){var a={views:this._viewManager.exportMarkup(),notes:this._noteTextManager.exportMarkup(),measurement:this._measurementManager.exportMarkup(),lines:this._lineManager.exportMarkup()};
this._markupTypeMap.forEach(function(d,c){a[c]=d.exportMarkup()});return a};g.prototype.loadMarkupData=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){"string"===typeof a&&(a=JSON.parse(a));return[2,this._loadMarkupData(a)]})})};g.prototype._loadMarkupData=function(a){return __awaiter(this,void 0,void 0,function(){var e,c;return __generator(this,function(b){e=[];a.hasOwnProperty("views")&&(c=this._viewManager.loadData(a.views).then(d.Internal.all),e.push(c));
a.hasOwnProperty("notes")&&(c=this._noteTextManager.loadData(a.notes).then(d.Internal.all),e.push(c));a.hasOwnProperty("measurement")&&(c=this._measurementManager.loadData(a.measurement).then(d.Internal.all),e.push(c));a.hasOwnProperty("lines")&&(c=this._lineManager.loadData(a.lines).then(d.Internal.all),e.push(c));this._markupTypeMap.forEach(function(b,c){a.hasOwnProperty(c)&&(b=b.loadData(a[c]).then(d.Internal.all),e.push(b))});return[2,Promise.all(e).then(d.Internal.all)]})})};g.prototype.getRenderer=
function(){return this._renderer};g.prototype._shutdown=function(){this._itemManager.shutdown();this._renderer._clear()};g.prototype._update=function(){this._itemManager.update()};g.prototype._setActiveMarkupView=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){return[2,this._itemManager.setActiveView(a)]})})};g.prototype._getItemManager=function(){return this._itemManager};__decorate([g.deprecated],g.prototype,"activateMarkupView",null);return g}();d.MarkupManager=
h})(Communicator||(Communicator={}));
(function(d){var h=function(g){function a(a,c){var b=g.call(this)||this;b._markupArray=[];b._color=new d.Color(0,0,0);b._edgeColor=new d.Color(0,0,0);b._viewer=a;b._callbackManager=c;b._callbackManager.bind({modelSwitched:function(){b.removeAllMeasurements()}});return b}__extends(a,g);a.prototype.addMeasurement=function(a){this._markupArray.push(a);var c=this._viewer.markupManager.registerMarkup(a);a._setId(c);return c};a.prototype.finalizeMeasurement=function(a){this._callbackManager.trigger("measurementCreated",a)};
a.prototype.removeMeasurement=function(a){for(var c=0;c<this._markupArray.length;c++)if(this._markupArray[c]._getId()===a._getId()){this._markupArray.splice(c,1);this._viewer.markupManager.unregisterMarkup(a._getId());this._callbackManager.trigger("measurementDeleted",a);break}};a.prototype.removeAllMeasurements=function(){for(var a=this._markupArray.length-1;0<=a;a--){var c=this._markupArray[a];this._viewer.markupManager.unregisterMarkup(c._getId());this._markupArray.splice(a,1);this._callbackManager.trigger("measurementDeleted",
c)}};a.prototype.getAllMeasurements=function(){return this._markupArray.slice(0)};a.prototype.removeLastMeasurement=function(){0<this._markupArray.length&&this.removeMeasurement(this._markupArray[this._markupArray.length-1])};a.prototype.setMeasurementColor=function(a){this._color.assign(a)};a.prototype.getMeasurementColor=function(){return this._color.copy()};a.prototype.setMeasurementEdgeColor=function(a){this._edgeColor.assign(a)};a.prototype.getMeasurementEdgeColor=function(){return this._edgeColor.copy()};
a.prototype.exportMarkup=function(){for(var a=[],c=0,b=this._markupArray;c<b.length;c++)a.push(b[c].toJson());return a};a.prototype._handleLoadMeasurement=function(a){return a instanceof d.Markup.Measure.MeasureMarkup?(this.addMeasurement(a),this._callbackManager.trigger("measurementLoaded",a),!0):!1};a.prototype.loadData=function(a){for(var c=this,b=[],f=0;f<a.length;f++){var k=a[f];if(k.hasOwnProperty("className")){var e=d.Internal.classFromString(k.className);e&&(k=e.fromJson(k,this._viewer),k instanceof
Promise?b.push(k.then(function(b){return c._handleLoadMeasurement(b)})):b.push(Promise.resolve(this._handleLoadMeasurement(k))))}}return Promise.all(b)};return a}(d.MarkupTypeManager);d.MeasureManager=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(){this._faceMeshData=[];this._pointMeshData=[];this._polylineMeshData=[];this._faceWinding=d.FaceWinding.CounterClockwise;this._isManifold=this._backfacesEnabled=!1}g.prototype.addFaces=function(a,e,c,b,f){void 0===f&&(f=0);this._faceMeshData.push(new d.Internal.FaceMeshData(a,e,c,b,f))};g.prototype.addPoints=function(a,e,c){void 0===c&&(c=0);this._pointMeshData.push(new d.Internal.PointMeshData(a,e,c))};g.prototype.addPolyline=function(a,e,c){void 0===c&&
(c=0);this._polylineMeshData.push(new d.Internal.PolylineMeshData(a,e,c))};g.prototype.clear=function(){this._faceMeshData.length=0;this._pointMeshData.length=0;this._polylineMeshData.length=0};g.prototype.setFaceWinding=function(a){this._faceWinding=a};g.prototype.getFaceWinding=function(){return this._faceWinding};g.prototype.setBackfacesEnabled=function(a){this._backfacesEnabled=a};g.prototype.getBackfacesEnabled=function(){return this._backfacesEnabled};g.prototype.setManifold=function(a){this._isManifold=
a};g.prototype.isManifold=function(){return this._isManifold};g.prototype._getFaceData=function(){return this._faceMeshData};g.prototype._getPointData=function(){return this._pointMeshData};g.prototype._getPolylineData=function(){return this._polylineMeshData};return g}();d.MeshData=h;h=function(){function g(a,e,c,b,f,k,l){this._instanceName=this._pointColor=this._lineColor=this._faceColor=this._matrix=this._meshId=null;this._pointOpacity=this._lineOpacity=this._faceOpacity=1;this._creationFlags=
d.MeshInstanceCreationFlags.None;this._overlayIndex=0;a&&(this._meshId=a.slice());e&&(this._matrix=e.copy());c&&(this._instanceName=c);b&&(this._faceColor=b.copy());f&&(this._lineColor=f.copy());k&&(this._pointColor=k.copy());l&&(this._creationFlags=l)}g.prototype.copy=function(){var a=new g(this.getMeshId(),this.getMatrix(),this.getInstanceName(),this.getFaceColor(),this.getLineColor(),this.getPointColor(),this.getCreationFlags());a.setPointOpacity(this.getOpacity());a.setLineOpacity(this.getLineOpacity());
a.setOpacity(this.getOpacity());a.setOverlayIndex(this.getOverlayIndex());return a};g.prototype.clear=function(){this._instanceName=this._pointColor=this._lineColor=this._faceColor=this._matrix=this._meshId=null;this._pointOpacity=this._lineOpacity=this._faceOpacity=1;this._creationFlags=d.MeshInstanceCreationFlags.None;this._overlayIndex=0};g.prototype.getMeshId=function(){return null!==this._meshId?this._meshId.slice():null};g.prototype.getMeshKey=function(){return this.getMeshId()};g.prototype.setMeshId=
function(a){this._meshId=a.slice()};g.prototype.setMeshKey=function(a){this.setMeshId(a)};g.prototype.getMatrix=function(){return null!==this._matrix?this._matrix.copy():null};g.prototype.getCreationFlags=function(){return this._creationFlags};g.prototype.setCreationFlags=function(a){this._creationFlags=a};g.prototype.setMatrix=function(a){this._matrix=a.copy()};g.prototype.getInstanceName=function(){return this._instanceName};g.prototype.setInstanceName=function(a){this._instanceName=a};g.prototype.setFaceColor=
function(a){this._faceColor=a.copy()};g.prototype.getFaceColor=function(){return null!==this._faceColor?this._faceColor.copy():null};g.prototype.setLineColor=function(a){this._lineColor=a.copy()};g.prototype.getLineColor=function(){return null!==this._lineColor?this._lineColor.copy():null};g.prototype.setPointColor=function(a){this._pointColor=a.copy()};g.prototype.getPointColor=function(){return null!==this._pointColor?this._pointColor.copy():null};g.prototype.setPointOpacity=function(a){this._pointOpacity=
a};g.prototype.getPointOpacity=function(){return this._pointOpacity};g.prototype.setLineOpacity=function(a){this._lineOpacity=a};g.prototype.getLineOpacity=function(){return this._lineOpacity};g.prototype.setOpacity=function(a){this._faceOpacity=a};g.prototype.setTransparency=function(a){this._faceOpacity=a};g.prototype.getOpacity=function(){return this._faceOpacity};g.prototype.getTransparency=function(){return this._faceOpacity};g.prototype.setOverlayIndex=function(a){this._overlayIndex=a};g.prototype.getOverlayIndex=
function(){return this._overlayIndex};return g}();d.MeshInstanceData=h})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){return function(a,d,c,b,f){void 0===f&&(f=0);this.vertexData=a;this.normalData=d;this.rgba32data=c;this.uvData=b;this.bits=f}}();d.FaceMeshData=g;g=function(){return function(a,d,c){void 0===c&&(c=0);this.vertexData=a;this.rgba32data=d;this.bits=c}}();d.PolylineMeshData=g;g=function(){return function(a,d,c){void 0===c&&(c=0);this.vertexData=a;this.rgba32data=d;this.bits=c}}();d.PointMeshData=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator=
{}));(function(d){(function(d){(function(d){function a(a){console.assert(a!==d.invalidNodeId);return a>d.invalidNodeId}d.invalidNodeId=-1;d.isAuthoredId=a;d.getAuthoredId=function(d){console.assert(a(d));return d};d.getRuntimeId=function(e,c){return a(e)?d.towardInclusionContext(c).toRuntimeId(e):e}})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){d.DefaultTransitionDuration=400;d.EmptyModelName="_empty";d.InvalidNodeId=d.Internal.Tree.invalidNodeId;var h=function(){function g(a,e){var c=this;this._pmiColor=d.Color.black();this._pmiColorOverride=!1;this._viewAxes=new d.ViewAxes;this._viewAxesSet=!1;this._firstModelRootId=d.InvalidNodeId;this._engine=a;this._callbackManager=e;this._callbackManager.bind({_firstModelLoaded:function(b){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(c){this._firstModelRootId=
b[0];return[2]})})},_resetAssemblyTreeBegin:function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(b){this._viewAxes=new d.ViewAxes;this._viewAxesSet=!1;return[2]})})}})}g.deprecated=function(a,d,c){var b=c.value;c.value=function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];this._callbackManager.trigger("deprecated","Model",d);return b.apply(this,c)};return c};g.prototype._setModelStructure=function(a){console.assert(void 0===this._modelStructure);this._modelStructure=
a};g.prototype.getClientDimensions=function(){return this._engine.getClientDimensions()};g.prototype.setViewAxes=function(a,e){if(a.isAxis()&&e.isAxis()&&!a.equals(e))this._viewAxes.frontVector=a,this._viewAxes.upVector=e,this._callbackManager.trigger("viewAxes",a,e),this._viewAxesSet=!0;else throw new d.CommunicatorError("The upVector and frontVector must be unique, cardinal axes.");};g.prototype.viewAxesHaveBeenSet=function(){return this._viewAxesSet};g.prototype.getViewAxes=function(){return this._viewAxes};
g.prototype.getModelBounding=function(a,e,c){void 0===c&&(c=!1);return __awaiter(this,void 0,void 0,function(){var b,f,k,l;return __generator(this,function(g){switch(g.label){case 0:b=new d.Box,g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this._engine.getModelBounding(a,e,c)];case 2:return b=g.sent(),[3,4];case 3:return f=g.sent(),k=!1,SC.isError(f)&&(l=SC.getStateFailure(f),1===l&&(k=!0)),console.assert(k),[3,4];case 4:return[2,b]}})})};g.prototype.getLooseBounding=function(){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(a){return[2,this._engine.getLooseBounding()]})})};g.prototype._allowNodeDeletion=function(a){return this._modelStructure.allowNodeDeletion(a)};g.prototype._preventNodeDeletion=function(a){return this._modelStructure.preventNodeDeletion(a)};g.prototype._preventMeshDeletion=function(a){console.assert(0===a[0]);return this._modelStructure.preventMeshDeletion(a[1])};g.prototype._getNodeFromInstanceInc=function(a,d,c,b){return this._modelStructure.getNodeFromInstanceInc(a,
d,c,b)};g.prototype.getNodesBounding=function(a,d){var c=7,b=!1,f=!1;void 0!==d&&(!1===d.bodyInstance&&(c&=-2),!1===d.pmiBody&&(c&=-3),!1===d.viewFrame&&(c&=-5),d.ignoreInvisible&&(b=!0),d.tightBounding&&(f=!0));return this._modelStructure.getBounding(a,c,b,f)};g.prototype.getNodeRealBounding=function(a){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(c){e=this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.None);if(0===e.length)throw new d.CommunicatorError("Cannot get bounding of node without geometry.");
return[2,this._engine.getDrawnPartsBounding(e)]})})};g.prototype.setNodesVisibilities=function(a,e,c){void 0===e&&(e=null);void 0===c&&(c=d.TreeWalkMode.Default);a=d.Internal.fromIntegerMap(a);return this._modelStructure.setVisibilitiesByMap(a,e,c)};g.prototype.setNodesVisibility=function(a,e,c,b){void 0===c&&(c=null);void 0===b&&(b=d.TreeWalkMode.Default);return this._modelStructure.setVisibilitiesByValue(a,e,c,b)};g.prototype.resetNodesVisibility=function(){return this.isDrawing()?this._callbackManager.promiseTrigger("_resetDrawing",
null):this._modelStructure.resetAllVisibilities()};g.prototype.getVisibilityState=function(a){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(c){e=this._modelStructure.lookupAnyTreeNode(a);if(null===e)throw new d.InvalidNodeIdError(a);return[2,d.Internal.Tree.getVisibilityState(e)]})})};g.prototype.resetNodesTransform=function(){return this._modelStructure.resetAllTransforms()};g.prototype.reset=function(){return this._modelStructure.reset()};g.prototype.clear=
function(){return this._modelStructure.clear()};g.prototype.setNodesFaceColor=function(a,d){this._setNodesFaceColor(a,d);return Promise.resolve()};g.prototype._setNodesFaceColor=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.setPartColor(a,d.ElementType.Faces,e)};g.prototype._unsetNodesColor=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);0<a.length&&
this._engine.unsetPartColor(a,e)};g.prototype.unsetNodesFaceColor=function(a){this._unsetNodesColor(a,d.ElementType.Faces);return Promise.resolve()};g.prototype.setNodesLineColor=function(a,d){this._setNodesLineColor(a,d);return Promise.resolve()};g.prototype._setNodesLineColor=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.setPartColor(a,d.ElementType.Lines,e)};g.prototype.unsetNodesLineColor=function(a){this._unsetNodesColor(a,
d.ElementType.Lines);return Promise.resolve()};g.prototype.setNodesHighlighted=function(a,e){if(0===a.length)return Promise.resolve();a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.LoadedNodesOnly);0<a.length&&this._engine.highlightParts(a,e);return Promise.resolve()};g.prototype.getNodesHighlighted=function(a){a=this._getInstanceIncsFromLeafNodes(a);return 0<a.length?this._engine.getPartHighlighted(a):Promise.resolve([])};g.prototype.setNodesColors=function(a,
e){var c=this;void 0===e&&(e=!1);var b=new Set,f=new Map,k=function(a,k){a=c._modelStructure.lookupAnyTreeNode(a);if(null!==a&&(a=d.Internal.Tree.gatherInstanceIncsSync(a,7,!1,b,d.Internal.Tree.WalkRestriction.None),0<a.length)){k=(k.r<<16)+(k.g<<8)+k.b;var e=f.get(k);e?f.set(k,e.concat(a)):f.set(k,a)}};if(a instanceof Map)a.forEach(function(b,c){k(c,b)});else for(var l=0,g=Object.keys(a);l<g.length;l++){var m=parseInt(g[l],10);k(m,a[m])}f.forEach(function(b,f){f=new d.Color(f>>16,(f&65280)>>8,f&
255);c._engine.setPartColor(b,d.ElementType.Faces,f);e&&c._engine.setPartColor(b,d.ElementType.Lines,f)});return Promise.resolve()};g.prototype.getPmiTopologyReferences=function(a){var e=[],c=function(b,c,f){var a=new d.RefOnTopoItem;a.bodyId=b;a.subElementType=c;a.subElementIndex=f;return a};a=this._modelStructure.getPmiTopologyReferences(a);if(null!==a)for(var b=0;b<a.length;b++){for(var f=a[b],k=f.body.getRuntimeId(),l=0,g=f.faceIds;l<g.length;l++)e.push(c(k,d.PmiTopoRef.Face,g[l]));l=0;for(f=
f.edgeIds;l<f.length;l++)e.push(c(k,d.PmiTopoRef.Edge,f[l]))}return 0===e.length?null:e};g.prototype.getPmis=function(){return this._modelStructure.getPmis()};g.prototype.getPMIs=function(){return this.getPmis()};g.prototype.getPmiType=function(a){return this._modelStructure.getPmiType(a)};g.prototype.getPMIType=function(a){return this.getPmiType(a)};g.prototype.getPmiSubtype=function(a){return this._modelStructure.getPmiSubType(a)};g.prototype.getPMISubtype=function(a){return this.getPmiSubtype(a)};
g.prototype.setPmiColor=function(a){this._pmiColor.assign(a)};g.prototype.setPMIColor=function(a){this.setPmiColor(a)};g.prototype.getPmiColor=function(){return this._pmiColor.copy()};g.prototype.getPMIColor=function(){return this.getPmiColor()};g.prototype.setPmiColorOverride=function(a,d){(this._pmiColorOverride=a)?this._modelStructure.setPmiColor(this._pmiColor,d):this._modelStructure.resetPmiColor(d);return Promise.resolve()};g.prototype.setPMIColorOverride=function(a){return this.setPmiColorOverride(a)};
g.prototype.getPmiColorOverride=function(){return this._pmiColorOverride};g.prototype.getPMIColorOverride=function(){return this.getPmiColorOverride()};g.prototype.computeMinimumBodyBodyDistance=function(a,e){var c=this._modelStructure.lookupAnyBody(a);if(null===c)throw new d.InvalidNodeTypeError(a,1);a=this._modelStructure.lookupAnyBody(e);if(null===a)throw new d.InvalidNodeTypeError(e,1);e=c.getInstanceInc();c=a.getInstanceInc();return this._engine.computeMinimumBodyBodyDistance(e,c)};g.prototype.computeMinimumFaceFaceDistance=
function(a,e,c,b){var f=this._modelStructure.lookupAnyBody(a);if(null===f)throw new d.InvalidNodeTypeError(a,1);a=this._modelStructure.lookupAnyBody(c);if(null===a)throw new d.InvalidNodeTypeError(c,1);c=f.getInstanceInc();f=a.getInstanceInc();return this._engine.computeMininimumFaceFaceDistance([c[0],c[1]],e,[f[0],f[1]],b)};g.prototype.computeMinimumFaceRayDistance=function(a,e,c){var b=this._modelStructure.lookupAnyBody(a);if(null===b)throw new d.InvalidNodeTypeError(a,1);a=b.getInstanceInc();return this._engine.computeMinimumFaceRayDistance(a,
e,c)};g.prototype.computeMinimumFaceLineDistance=function(a,e,c){var b=this._modelStructure.lookupAnyBody(a);if(null===b)throw new d.InvalidNodeTypeError(a,1);a=b.getInstanceInc();return this._engine.computeMinimumFaceLineDistance(a,e,c)};g.prototype.setNodeFaceColor=function(a,d,c){this._setNodeFaceColor(a,d,c);return Promise.resolve()};g.prototype._setNodeFaceColor=function(a,e,c){a=this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.None);2===a.length&&this._engine.setElementColor(a,
d.ElementType.Faces,e,1,c)};g.prototype.setNodeFaceVisibility=function(a,e,c){this._setNodeElementVisibility(a,e,c,d.ElementType.Faces)};g.prototype.clearNodeFaceVisibility=function(a){this._clearNodeElementVisibility(a,d.ElementType.Faces)};g.prototype._setNodeElementVisibility=function(a,e,c,b){a=this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.None);2===a.length&&this._engine.setElementVisibility(a,b,e,1,c)};g.prototype._clearNodeElementVisibility=function(a,
e){a=this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.None);2===a.length&&this._engine.clearElementVisibility(a,e)};g.prototype._unsetElementColor=function(a,d,c){a=this._getInstanceIncFromSingleLeafNode(a);this._engine.unsetElementColor(a,d,c,1)};g.prototype.unsetNodeFaceColor=function(a,e){this._unsetElementColor(a,d.ElementType.Faces,e);return Promise.resolve()};g.prototype.setNodeFaceHighlighted=function(a,d,c){this._setNodeFaceHighlighted(a,d,c);return Promise.resolve()};
g.prototype._setNodeFaceHighlighted=function(a,e,c){a=this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.LoadedNodesOnly);0<a.length&&this._engine.highlightElements(a,d.ElementType.Faces,e,1,c)};g.prototype._getElementHighlighted=function(a,d,c){return __awaiter(this,void 0,void 0,function(){var b,f;return __generator(this,function(k){switch(k.label){case 0:return b=this._getInstanceIncFromSingleLeafNode(a),[4,this._engine.getElementHighlighted(b,d,c)];case 1:return f=
k.sent()[0],[2,f]}})})};g.prototype.getNodeFaceHighlighted=function(a,e){return this._getElementHighlighted(a,d.ElementType.Faces,e)};g.prototype.setNodeLineColor=function(a,d,c){this._setNodeLineColor(a,d,c);return Promise.resolve()};g.prototype._setNodeLineColor=function(a,e,c){var b=this._modelStructure.lookupAnyBody(a);if(null===b)throw new d.InvalidNodeTypeError(a,1);a=b.getInstanceInc();this._engine.setElementColor(a,d.ElementType.Lines,e,1,c)};g.prototype.unsetNodeLineColor=function(a,e){this._unsetElementColor(a,
d.ElementType.Lines,e);return Promise.resolve()};g.prototype.setNodeLineVisibility=function(a,e,c){this._setNodeElementVisibility(a,e,c,d.ElementType.Lines)};g.prototype.clearNodeLineVisibility=function(a){this._clearNodeElementVisibility(a,d.ElementType.Lines)};g.prototype.setNodeLineHighlighted=function(a,d,c){this._setNodeLineHighlighted(a,d,c);return Promise.resolve()};g.prototype._setNodeLineHighlighted=function(a,e,c){a=this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.LoadedNodesOnly);
0<a.length&&this._engine.highlightElements(a,d.ElementType.Lines,e,1,c)};g.prototype.getNodeLineHighlighted=function(a,e){return this._getElementHighlighted(a,d.ElementType.Lines,e)};g.prototype.setNodePointVisibility=function(a,e,c){this._setNodeElementVisibility(a,e,c,d.ElementType.Points)};g.prototype.clearNodePointVisibility=function(a){this._clearNodeElementVisibility(a,d.ElementType.Points)};g.prototype.setNodePointHighlighted=function(a,d,c){this._setNodePointHighlighted(a,d,c);return Promise.resolve()};
g.prototype._setNodePointHighlighted=function(a,e,c){var b=this._modelStructure.lookupAnyBody(a);if(null===b)throw new d.InvalidNodeTypeError(a,1);a=b.getInstanceInc();this._engine.highlightElements(a,d.ElementType.Points,e,1,c)};g.prototype.getNodePointHighlighted=function(a,e){return this._getElementHighlighted(a,d.ElementType.Points,e)};g.prototype.resetNodesColor=function(){this._engine.resetColors();return Promise.resolve()};g.prototype.setNodesOpacity=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,
7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.setPartOpacity(a,e)};g.prototype.setNodesTransparency=function(a,d){this.setNodesOpacity(a,d);return Promise.resolve()};g.prototype.getNodesHaveTransparency=function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);return 0<a.length?this._engine.getPartHasTransparency(a):Promise.resolve([])};g.prototype.setNodesOpacities=function(a){var e=this;a=d.Internal.fromIntegerMap(a);var c=new Set;
a.forEach(function(b,f){f=e._modelStructure.lookupAnyTreeNode(f);null!==f&&(f=d.Internal.Tree.gatherInstanceIncsSync(f,1,!1,c,d.Internal.Tree.WalkRestriction.None),0<f.length&&e._engine.setPartOpacity(f,b))})};g.prototype.setNodesTransparencies=function(a){this.setNodesOpacities(a);return Promise.resolve()};g.prototype.resetModelOpacity=function(){this._engine.resetOpacity();this._callbackManager.trigger("_resetOpacity")};g.prototype.resetModelTransparency=function(){this.resetModelOpacity();return Promise.resolve()};
g.prototype.resetModelHighlight=function(){this._engine.clearHighlight();return Promise.resolve()};g.prototype.resetNodesOpacity=function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.unsetPartOpacity(a)};g.prototype.resetNodesTransparency=function(a){this.resetNodesOpacity(a);return Promise.resolve()};g.prototype._getNodesColor=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);
return 0<a.length?this._engine.getPartColor(a,e):Promise.resolve([])};g.prototype._getNodesEffectiveColor=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);return 0<a.length?this._engine.getEffectivePartColor(a,e):Promise.resolve([])};g.prototype.getNodesFaceColor=function(a){return this._getNodesColor(a,d.ElementType.Faces)};g.prototype.getNodesEffectiveFaceColor=function(a){return this._getNodesEffectiveColor(a,d.ElementType.Faces)};g.prototype.getNodesLineColor=
function(a){return this._getNodesColor(a,d.ElementType.Lines)};g.prototype.getNodesEffectiveLineColor=function(a){return this._getNodesEffectiveColor(a,d.ElementType.Lines)};g.prototype.getNodeColorMap=function(a,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){c=this._modelStructure.lookupAnyTreeNode(a);if(null!==c)return[2,d.Internal.Tree.getNodeColorMap(c,this._engine,e)];throw new d.InvalidNodeIdError(a);})})};g.prototype.getNodesOpacity=function(a){return Promise.resolve(this._getNodesOpacity(a))};
g.prototype.getNodesTransparency=function(a){return this.getNodesOpacity(a)};g.prototype._getNodesOpacity=function(a){a=this._getInstanceIncsFromLeafNodes(a);return 0<a.length?this._engine.getPartOpacity(a):[]};g.prototype.getNodesEffectiveOpacity=function(a,d){return(a=this._getInstanceIncsFromLeafNodes(a))&&0<a.length?this._engine.getEffectivePartOpacity(a,d):Promise.resolve([])};g.prototype.getNodesEffectiveTransparency=function(a,d){return this.getNodesEffectiveOpacity(a,d)};g.prototype._getNodeElementColor=
function(a,d,c){return __awaiter(this,void 0,void 0,function(){var b,f;return __generator(this,function(k){switch(k.label){case 0:return b=this._getInstanceIncFromSingleLeafNode(a),[4,this._engine.getElementColor(b,d,c)];case 1:return f=k.sent()[0],[2,f]}})})};g.prototype._getNodeEffectiveElementColor=function(a,d,c){return __awaiter(this,void 0,void 0,function(){var b,f;return __generator(this,function(k){switch(k.label){case 0:return b=this._getInstanceIncFromSingleLeafNode(a),[4,this._engine.getEffectiveElementColor(b,
d,c)];case 1:return f=k.sent()[0],[2,f]}})})};g.prototype.getNodeFaceColor=function(a,e){return this._getNodeElementColor(a,d.ElementType.Faces,e)};g.prototype.getNodeEffectiveFaceColor=function(a,e){return this._getNodeEffectiveElementColor(a,d.ElementType.Faces,e)};g.prototype.getNodeLineColor=function(a,e){return this._getNodeElementColor(a,d.ElementType.Lines,e)};g.prototype.getNodeEffectiveLineColor=function(a,e){return this._getNodeEffectiveElementColor(a,d.ElementType.Lines,e)};g.prototype.getOutOfHierarchy=
function(a){return this._modelStructure.isOutOfHierarchy(a)};g.prototype.getAbsoluteRootNode=function(){return this._modelStructure.getAbsoluteRootNodeId()};g.prototype.getRootNode=function(){return this.getAbsoluteRootNode()};g.prototype.getNodeChildren=function(a,d){return this._modelStructure.getChildIds(a,d||!1)};g.prototype.getNodesInstancingSamePart=function(a){return this._modelStructure.getPartReferrers(a)};g.prototype.getUnitMultiplier=function(){var a=this._firstModelRootId!==d.InvalidNodeId?
this._firstModelRootId:this.getAbsoluteRootNode();return this.getNodeUnitMultiplier(a)};g.prototype.getNodeUnitMultiplier=function(a){return this._modelStructure.getUnit(a)};g.prototype.createCadView=function(a,d,c,b,f,k,l,g,m){b||(b=[]);f||(f=[]);k||(k=[]);l||(l=[]);void 0===g&&(g=null);void 0===m&&(m=null);a=this._modelStructure.createCadView(a,d,c,b,f,k,l,g,m);null!==a&&this._callbackManager.trigger("cadViewCreated",a,d);return a};g.prototype.createCADView=function(a,d,c,b,f,k,l,g,m){return this.createCadView(a,
d,c,b,f,k,l,g,m)};g.prototype.getCadViewMap=function(){return this._modelStructure.getCadViewMap()};g.prototype.getCadViews=function(){return d.Internal.toIntegerMap(this.getCadViewMap())};g.prototype.getCADViews=function(){return this.getCadViews()};g.prototype.activateCadView=function(a,e){void 0===e&&(e=d.DefaultTransitionDuration);return this._modelStructure.activateCadView(a,e)};g.prototype.activateCADView=function(a,d){return this.activateCadView(a,d)};g.prototype.getCadViewPmis=function(a){return this._modelStructure.getCadViewPmis(a)};
g.prototype.getCADViewPMIs=function(a){return this.getCadViewPmis(a)};g.prototype.cadConfigurationsEnabled=function(){return this._modelStructure.cadConfigurationsEnabled()};g.prototype.getCadConfigurations=function(){return this._modelStructure.getCadConfigurations()};g.prototype.getCADConfigurations=function(){return this.getCadConfigurations()};g.prototype.getDefaultCadConfiguration=function(){return this._modelStructure.getDefaultCadConfiguration()};g.prototype.getCADDefaultConfiguration=function(){return this.getDefaultCadConfiguration()};
g.prototype.getActiveCadConfiguration=function(){return this._modelStructure.getActiveCadConfiguration()};g.prototype.getCADActiveConfiguration=function(){return this.getActiveCadConfiguration()};g.prototype.activateCadConfiguration=function(a){return this._modelStructure.activateCadConfiguration(a)};g.prototype.activateCADConfiguration=function(a){return this.activateCadConfiguration(a)};g.prototype.activateDefaultCadConfiguration=function(){return this._modelStructure.activateDefaultCadConfiguration()};
g.prototype.activateCADDefaultConfiguration=function(){return this.activateDefaultCadConfiguration()};g.prototype.getPointAttributes=function(a,d){return this._modelStructure.getPointAttributes(a,d)};g.prototype.getEdgeCount=function(a){return this._modelStructure.getEdgeCount(a)};g.prototype.getEdgeAttributes=function(a,d){return this._modelStructure.getEdgeAttributes(a,d)};g.prototype.getEdgeProperty=function(a,d){return this._modelStructure.getEdgeProperty(a,d)};g.prototype.getFaceCount=function(a){return this._modelStructure.getFaceCount(a)};
g.prototype.getFaceAttributes=function(a,d){return this._modelStructure.getFaceAttributes(a,d)};g.prototype.getFaceProperty=function(a,d){return this._modelStructure.getFaceProperty(a,d)};g.prototype.setEdgeProperty=function(a,d,c){this._modelStructure.setEdgeProperty(a,d,c)};g.prototype.setFaceProperty=function(a,d,c){this._modelStructure.setFaceProperty(a,d,c)};g.prototype.getNodeMeshData=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b;return __generator(this,function(f){switch(f.label){case 0:e=
this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.None);if(0===e.length)throw new d.CommunicatorError("Node does not refer to a mesh instance");if(2<e.length)throw new d.CommunicatorError("Node refers to multiple mesh instances");c=e;return[4,this._engine.getInstancesMeshData(c)];case 1:return b=f.sent(),[2,this._engine.getMeshData(b)]}})})};g.prototype.getNodeMatrix=function(a){return this._modelStructure.getMatrix(a)};g.prototype.setNodeMatrix=function(a,d,
c){void 0===c&&(c=!1);return this._modelStructure.setMatrix(a,d,c)};g.prototype._setNodesMatrices=function(a,d,c){void 0===c&&(c=!1);return this._modelStructure.setMatrices(a,d,c)};g.prototype.resetNodeMatrixToInitial=function(a){return this._modelStructure.resetToInitialMatrix(a)};g.prototype.getNodeNetMatrix=function(a){return d.Matrix.createFromArray(this._modelStructure.getNetMatrix(a))};g.prototype.getNodeParent=function(a){return this._modelStructure.getParentId(a)};g.prototype.getNodeType=
function(a){return this._modelStructure.getType(a)};g.prototype.getNodeProperties=function(a){return this._modelStructure.getProperties(a)};g.prototype.addPropertyToNode=function(a,d,c){return this._modelStructure.addProperty(a,d,c)};g.prototype.setPhysicalProperties=function(a,d,c,b){return this._modelStructure.setPhysicalProperties(a,d,c,b)};g.prototype.requestNodes=function(a){return this._modelStructure.requestNodes(a)};g.prototype.getNodeName=function(a){return this._modelStructure.getName(a)||
null};g.prototype.getNodeExchangeId=function(a){return this._modelStructure.getNodeExchangeId(a)};g.prototype.getFilters=function(){return this._modelStructure.getFilters()};g.prototype.getFilterName=function(a){return this._modelStructure.getFilterName(a)};g.prototype.getFiltersWithNode=function(a){return this._modelStructure.getFiltersWithNode(a)};g.prototype.getNodesFromFiltersId=function(a){return this._modelStructure.getNodesFromFilterIds(a)};g.prototype.getLayers=function(){return this._modelStructure.getLayers()};
g.prototype.getUniqueLayerNames=function(){return this._modelStructure.getUniqueLayerNames()};g.prototype.getLayerName=function(a){return this._modelStructure.getLayerName(a)};g.prototype.getLayerIdsFromName=function(a){return this._modelStructure.getLayerIdsFromName(a)};g.prototype.getNodeLayerId=function(a){return this._modelStructure.getNodeLayerId(a)};g.prototype.getNodesFromLayer=function(a,d){return this._modelStructure.getRuntimeNodesFromLayer(a,d)};g.prototype.getNodesFromLayers=function(a,
d){return this._modelStructure.getRuntimeNodesFromLayers(a,d)};g.prototype.getNodesFromLayerName=function(a,d){return this._modelStructure.getNodesFromLayerName(a,d)};g.prototype.getNodeVisibility=function(a){return this._modelStructure.isVisible(a)};g.prototype.getBranchVisibility=function(a){a=this._modelStructure.getBranchVisibility(a);if(2===a)return d.BranchVisibility.Shown;if(1===a)return d.BranchVisibility.Hidden;console.assert(3===a);return d.BranchVisibility.Mixed};g.prototype.getDataFromIds=
function(a){return this._engine.getDataFromIds(a)};g.prototype.getDataFromKeys=function(a){return this.getDataFromIds(a)};g.prototype.createMesh=function(a,d){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return[4,this._engine.createMesh(a)];case 1:return c=b.sent(),d&&d.doNotDelete&&this._preventMeshDeletion(c),[2,c]}})})};g._flatArrayToPairArray=function(a){for(var d=[],c=0;c<a.length;c+=2)d.push([a[c],a[c+1]]);return d};g._pairArrayToFlatArray=
function(a){for(var d=[],c=0;c<a.length;c++){var b=a[c];d.push(b[0],b[1])}return d};g.prototype.getMeshIds=function(a){return __awaiter(this,void 0,void 0,function(){var e,c;return __generator(this,function(b){switch(b.label){case 0:return e=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None),[4,this._engine.getInstancesMeshData(e)];case 1:return c=b.sent(),[2,g._flatArrayToPairArray(c)]}})})};g.prototype.replaceMesh=function(a,d){return this._engine.replaceMesh(a,
d)};g.prototype.createMeshInstance=function(a,d,c,b){void 0===d&&(d=null);c||(c=!1);b||(b=!1);return this._createMeshInstance(a,d,c,b)};g.prototype._createMeshInstance=function(a,e,c,b){return __awaiter(this,void 0,void 0,function(){var f,k,l,g,m,p,h,r,u,t;return __generator(this,function(n){switch(n.label){case 0:f=a.getMatrix();k=null!==f||null!==e;l=a.getCreationFlags();console.assert(!e||!b,"Out of hierarchy instances should not have a parent node.");g=null===e||this.getNodeVisibility(e);m=a;
if(k||!g)m=a.copy(),m.setCreationFlags(l|d.MeshInstanceCreationFlags.Invisible);return[4,this._engine.createMeshInstance(m)];case 1:p=n.sent();h=this._modelStructure.createMeshInstance(p[0],p[1],a.getInstanceName(),e,c,b);if(!k&&g)return[3,3];r=f?f:new d.Matrix;return[4,this.setNodeMatrix(h,r,!0)];case 2:n.sent(),0===(l&d.MeshInstanceCreationFlags.Invisible)&&g&&this._engine.setPartVisibility(p,!0,!0),n.label=3;case 3:return u=g,0!==(l&d.MeshInstanceCreationFlags.Invisible)&&(u=!1),t=this._modelStructure.lookupAnyTreeNode(h),
null!==t&&t.setVisibility(u),null===e?[3,5]:[4,this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",[h],d.NodeSource.CreateInstance)];case 4:n.sent(),n.label=5;case 5:return[2,h]}})})};g.prototype.createPmiInstance=function(a,e,c,b,f){return __awaiter(this,void 0,void 0,function(){var k,l,g,m,p,h,r,u;return __generator(this,function(n){switch(n.label){case 0:void 0===f&&(f=null);k=[];l=0;for(g=b;l<g.length;l++){m=g[l];p=this._modelStructure.lookupBodyInstance(m.bodyId);if(null===
p)throw new d.InvalidNodeIdError(m.bodyId);h=d.Internal.Tree.ReferenceOnTopology.fromBodyInstance(p,m.subElementType,m.subElementIndex);k.push(h)}return[4,this._engine.createMeshInstance(a)];case 1:return r=n.sent(),u=this._modelStructure.createPmiInstance(r[0],r[1],e,c,k,a.getInstanceName(),f),null===f?[3,3]:[4,this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",[u],d.NodeSource.CreatePmi)];case 2:n.sent(),n.label=3;case 3:return[2,u]}})})};g.prototype.createPMIInstance=function(a,
d,c,b,f){return this.createPmiInstance(a,d,c,b,f)};g.prototype.createImage=function(a,d){return this._engine.createImage(a,d)};g.prototype.deleteImages=function(a){return this._engine.destroyImages(g._pairArrayToFlatArray(a))};g.prototype.setNodesTexture=function(a,d){a=this._getInstanceIncsFromLeafNodes(a);return this._engine.setTexture(a,d)};g.prototype.unsetNodesTexture=function(a){a=this._getInstanceIncsFromLeafNodes(a);this._engine.unsetTexture(a)};g.prototype.deleteMeshes=function(a){return this._engine.destroyMeshes(g._pairArrayToFlatArray(a))};
g.prototype.deleteMeshInstances=function(a){var e=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None),c=[];if(0<e.length){for(var b=0;b<a.length;b++)c.push(this._modelStructure.deleteNode(a[b]));c.push(this._engine.destroyLocalInstances(e))}return d.Util.waitForAll(c)};g.prototype._obtainLoadSubtreeConfig=function(a){if(a[0]instanceof d.LoadSubtreeConfig)var e=a[0];else e=new d.LoadSubtreeConfig,e.additionalMatrix=a[0]||null,e.allowMissingExternalModels=!!a[1];
return e.copy()};g.prototype.loadSubtreeFromXmlFile=function(a,e,c){for(var b=[],f=3;f<arguments.length;f++)b[f-3]=arguments[f];b=this._obtainLoadSubtreeConfig(b);c||(c=d.Internal.identity);return this._modelStructure.loadSubtreeFromXmlFile(a,e,c,b)};g.prototype.loadSubtreeFromXmlBuffer=function(a,e,c){for(var b=[],f=3;f<arguments.length;f++)b[f-3]=arguments[f];b=this._obtainLoadSubtreeConfig(b);c||(c=d.Internal.identity);return this._modelStructure.loadSubtreeFromXmlDoc(a,e,c,b)};g.prototype.loadSubtreeFromScsXmlFile=
function(a,e,c){for(var b=[],f=3;f<arguments.length;f++)b[f-3]=arguments[f];b=this._obtainLoadSubtreeConfig(b);c||(c=d.Internal.identity);return this._modelStructure.loadSubtreeFromScsXmlFile(a,e,c,b)};g.prototype.loadSubtreeFromScsXmlBuffer=function(a,e,c){for(var b=[],f=3;f<arguments.length;f++)b[f-3]=arguments[f];b=this._obtainLoadSubtreeConfig(b);c||(c=d.Internal.identity);return this._modelStructure.loadSubtreeFromScsXmlDoc(a,e,c,b)};g.prototype.loadSubtreeFromModel=function(a,d){for(var c=[],
b=2;b<arguments.length;b++)c[b-2]=arguments[b];c=this._obtainLoadSubtreeConfig(c);return this._modelStructure.loadSubtreeFromStream(a,d,c)};g.prototype.loadSubtreeFromScsFile=function(a,d){for(var c=[],b=2;b<arguments.length;b++)c[b-2]=arguments[b];c=this._obtainLoadSubtreeConfig(c);return this._modelStructure.loadSubtreeFromScsFile(a,d,c)};g.prototype.loadSubtreeFromScsBuffer=function(a,d){for(var c=[],b=2;b<arguments.length;b++)c[b-2]=arguments[b];c=this._obtainLoadSubtreeConfig(c);return this._modelStructure.loadSubtreeFromScsBuffer(a,
d,c)};g.prototype.loadSubtreeFromUrl=function(a,d){return this.loadSubtreeFromXmlFile(a,d)};g.prototype.loadSubtreeFromXML=function(a,d){return this.loadSubtreeFromXmlBuffer(a,d)};g.prototype.switchToModel=function(a){this._callbackManager.trigger("modelLoadBegin");return this._modelStructure.switchToModel(a)};g.prototype.createNode=function(a,e,c,b,f,k){void 0===a&&(a=null);void 0===c&&(c=null);void 0===b&&(b=null);if(void 0===f||null===f)f=!0;a=this._modelStructure.createNode(a,e,c,b,f,k);null!==
a&&(e=this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",[a],d.NodeSource.CreateNode),e);return a};g.prototype.deleteNode=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return[4,this._modelStructure.deleteNode(a)];case 1:return d.sent(),this._callbackManager.trigger("subtreeDeleted",[a]),[2]}})})};g.prototype.createPart=function(a){void 0===a&&(a=null);return this._modelStructure.createPart(a)};g.prototype.setPart=
function(a,d){return void 0===a||null===a||void 0===d||null===d?!1:this._modelStructure.setPart(a,d)};g.prototype.createAndAddRepresentationItem=function(a,d){if(void 0===a||null===a)return null;void 0===d&&(d=null);return this._modelStructure.createAndAddRepItem(a,d)};g.prototype.createAndAddBody=function(a,d){return this.createAndAddRepresentationItem(a,d)};g.prototype.getLowestAvailableNodeId=function(){return this._modelStructure.getLowestAvailableNodeId()};g.prototype.getLowestAvailableNodeID=
function(){return this.getLowestAvailableNodeId()};g.prototype.setInstanceModifier=function(a,d,c){this._setInstanceModifier(a,d,c,7);return Promise.resolve()};g.prototype._setInstanceModifier=function(a,e,c,b){e=this._modelStructure.gatherInstanceIncsFromNodeIds(e,b,d.Internal.Tree.WalkRestriction.None);0<e.length&&this._engine.setInstanceModifier(a,e,c)};g.prototype.getSCInstanceKey=function(a){a=this._modelStructure.lookupBodyInstance(a);return null!==a?a.getInstanceInc():null};g.prototype.getNodeIDFromSCInstanceKey=
function(a,d){return this._modelStructure.getNodeFromInstanceInc(!1,a,d,!1)};g.prototype.getPrimaryModelKey=function(){return this._engine.getPrimaryModelKey()};g.prototype.getPrimaryModelId=function(){return this.getPrimaryModelKey()};g.prototype.getAssociatedModelKey=function(a){a=this._modelStructure.getAssociatedModelKey(a);return Promise.resolve(a)};g.prototype.hasDepthRange=function(a){a=this._getInstanceIncsFromLeafNodes(a);return this._engine.hasDepthRange(a)};g.prototype.setDepthRange=function(a,
d,c){this._setDepthRange(a,d,c);return Promise.resolve()};g.prototype._setDepthRange=function(a,e,c){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);this._engine.setDepthRange(a,e,c)};g.prototype.unsetDepthRange=function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);this._engine.unsetDepthRange(a)};g.prototype._gatherInstanceIncsFromNodeIds=function(a,e){void 0===e&&(e=7);return this._modelStructure.gatherInstanceIncsFromNodeIds(a,
e,d.Internal.Tree.WalkRestriction.None)};g.prototype._getInstanceIncsFromLeafNodes=function(a){for(var e=[],c=0;c<a.length;c++){var b=this._modelStructure.gatherInstanceIncsFromNodeIds([a[c]],7,d.Internal.Tree.WalkRestriction.None);if(2===b.length)e.push(b[0],b[1]);else throw new d.CommunicatorError("Non-leaf node encountered");}return e};g.prototype._getInstanceIncFromSingleLeafNode=function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.None);if(2===
a.length)return a;throw new d.CommunicatorError("Non-leaf node encountered");};g.prototype.setMeshLevel=function(a,d){this._modelStructure.setMeshLevel(a,d);return Promise.resolve()};g.prototype.setMetallicRoughness=function(a,e,c){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);this._engine.setMetallicRoughness(a,e,c)};g.prototype.unsetMetallicRoughness=function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);
this._engine.unsetMetallicRoughness(a)};g.prototype.setEnableAutomaticUnitScaling=function(a){return this._modelStructure.setEnableAutomaticUnitScaling(a)};g.prototype.setBehaviorInitiallyHidden=function(a){return this._modelStructure.setBehaviorInitiallyHidden(a)};g.prototype.isDrawing=function(){return this._modelStructure.isACadDrawing()};g.prototype.isMeasurable=function(){return this._modelStructure.isMeasurable()};g.prototype.getModelFileNameFromNode=function(a){return this._modelStructure.getModelFileNameFromNode(a)};
g.prototype.getModelFileTypeFromNode=function(a){return this._modelStructure.getModelFileTypeFromNode(a)};g.prototype.getNodeGenericType=function(a){return this._modelStructure.getNodeGenericType(a)};g.prototype.getNodeGenericId=function(a){return this._modelStructure.getNodeGenericId(a)};g.prototype.registerBimNodes=function(a,e,c){void 0===c&&(c=null);return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(f){b=this._modelStructure.lookupAnyTreeNode(a);if(null===b)return[2];
"boolean"===typeof c&&(c=c?"TYPE":null);return[2,d.Internal.Tree.registerBimNodes(e,this._engine,this._modelStructure,b,c)]})})};g.prototype.getGenericTypeIdMap=function(){return this._modelStructure.getGenericTypeIdMap()};g.prototype.getIfcNodeIds=function(){return this.getGenericTypeIdMap()};g.prototype.getIfcTypeByNodeId=function(a){return this._modelStructure.getNodeGenericType(a)};g.prototype.getNodesByGenericType=function(a){return this._modelStructure.getNodesByGenericType(a)};g.prototype.getNodesByIfcType=
function(a){return this.getNodesByGenericType(a)};g.prototype.getGenericTypes=function(){return this._modelStructure.getGenericTypes()};g.prototype.getIfcTypes=function(){return this.getGenericTypes()};g.prototype.hasEffectiveGenericType=function(a,d){return this._modelStructure.hasEffectiveGenericType(a,d)};g.prototype.registerIfcNodes=function(a,e){void 0===e&&(e=null);return this.registerBimNodes(a,d.Internal.Tree.ifcAttributeToBimMask,e)};g.prototype.isAnnotationView=function(a){return this._modelStructure.isAnnotationView(a)};
g.prototype.setNodesCullingVector=function(a,d,c,b){this._setNodesCullingVector(a,d,c,b);return Promise.resolve()};g.prototype._setNodesCullingVector=function(a,e,c,b){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);return this._engine.setCullingVector(a,e,c,b)};g.prototype.unsetNodesCullingVectors=function(a){this._unsetNodesCullingVectors(a);return Promise.resolve()};g.prototype._unsetNodesCullingVectors=function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,
7,d.Internal.Tree.WalkRestriction.None);this._engine.unsetCullingVector(a)};g.prototype.getNodesCullingVectors=function(a){a=this._getInstanceIncsFromLeafNodes(a);return this._engine.getCullingVector(a)};g.prototype.getNodeIdOffset=function(a){return this._modelStructure.getIdOffset(a)};g.prototype.isNodeLoaded=function(a){return this._modelStructure.isNodeLoaded(a)};g.prototype.triangulatePolygon=function(a,e){e=d.Internal.toVec3(e);return this._engine.triangulatePolygon(a,e)};g.prototype.setNodesLinePattern=
function(a,d,c,b){a=this._gatherInstanceIncsFromNodeIds(a);this._engine.setLinePattern(a,d,c,b)};g.prototype.unsetNodesLinePattern=function(a){a=this._gatherInstanceIncsFromNodeIds(a);this._engine.unsetLinePattern(a)};g.prototype._hwfAwaitAssemblyTreeReady=function(){return __awaiter(this,void 0,void 0,function(){var a,e,c;return __generator(this,function(b){switch(b.label){case 0:a=this.getAbsoluteRootNode();e=this._modelStructure.lookupAnyTreeNode(a);if(null===e)throw new d.InternalLogicError;c=
d.Internal.Tree.towardLoadContext(e);return[4,d.Internal.Tree.WalkerAsync.forceLazyPromises(c)];case 1:return b.sent(),[4,d.Internal.Tree.markContextsLoaded([c])];case 2:return b.sent(),[2]}})})};g.prototype.getNodeUserDataIndices=function(a){return this._modelStructure.getUserDataIndices(a)};g.prototype.getNodeUserData=function(a,d){return this._modelStructure.getUserData(a,d)};g.prototype.getNodeIdsByGenericIds=function(a){for(var d=[],c=0;c<a.length;c++){var b=this._modelStructure.getNodeByGenericId(a[c]);
null!==b&&d.push(b)}return d};g.prototype.getNodeIdsByIfcGuids=function(a){return this.getNodeIdsByGenericIds(a)};g.prototype._getModelStructure=function(){return this._modelStructure};g.prototype.isWithinExternalModel=function(a){return this._modelStructure.isWithinExternalModel(a)};g.prototype._firstAssemblyDataHeader=function(){return this._modelStructure.firstAssemblyDataHeader()};g.prototype.getBimIdIFromNode=function(a){return this._modelStructure.getBimIdFromNode(a)};g.prototype.getBimIdIFromGenericId=
function(a){a=this._modelStructure.getNodeByGenericId(a);return null!==a?this.getBimIdIFromNode(a):null};g.prototype.getNodeIdFromBimId=function(a,d){return this._modelStructure.getRuntimeNodeFromBimId(a,d)};g.prototype.getGenericIdFromBimId=function(a,d){a=this._modelStructure.getRuntimeNodeFromBimId(a,d);return null!==a?this._modelStructure.getNodeGenericId(a):null};g.prototype.getRelationshipTypesFromBimId=function(a,d){var c=[],b=0;for(a=this._modelStructure.getBimIdRelationshipTypes(a,d);b<a.length;b++)c.push(a[b].type);
return c};g.prototype.getBimIdRelatedElements=function(a,d,c){var b=0;for(a=this._modelStructure.getBimIdRelationshipTypes(a,d);b<a.length;b++)if(d=a[b],d.type===c)return d.relateds;return[]};g.prototype.getBimIdRelatingElements=function(a,d,c){var b=0;for(a=this._modelStructure.getBimIdRelationshipTypes(a,d);b<a.length;b++)if(d=a[b],d.type===c)return d.relatings;return[]};g.prototype.getBimIdConnectedElements=function(a,d,c){var b=0;for(a=this._modelStructure.getBimIdRelationshipTypes(a,d);b<a.length;b++)if(d=
a[b],d.type===c)return{relateds:d.relateds,relatings:d.relatings};return{relateds:[],relatings:[]}};g.prototype.getBimInfoFromBimId=function(a,d){return this._modelStructure.getInfoOfBimId(a,d)};__decorate([g.deprecated],g.prototype,"getPMIs",null);__decorate([g.deprecated],g.prototype,"getPMIType",null);__decorate([g.deprecated],g.prototype,"getPMISubtype",null);__decorate([g.deprecated],g.prototype,"setPMIColor",null);__decorate([g.deprecated],g.prototype,"getPMIColor",null);__decorate([g.deprecated],
g.prototype,"setPMIColorOverride",null);__decorate([g.deprecated],g.prototype,"getPMIColorOverride",null);__decorate([g.deprecated],g.prototype,"setNodesTransparency",null);__decorate([g.deprecated],g.prototype,"setNodesTransparencies",null);__decorate([g.deprecated],g.prototype,"resetModelTransparency",null);__decorate([g.deprecated],g.prototype,"resetNodesTransparency",null);__decorate([g.deprecated],g.prototype,"getNodesTransparency",null);__decorate([g.deprecated],g.prototype,"getNodesEffectiveTransparency",
null);__decorate([g.deprecated],g.prototype,"getRootNode",null);__decorate([g.deprecated],g.prototype,"getUnitMultiplier",null);__decorate([g.deprecated],g.prototype,"createCADView",null);__decorate([g.deprecated],g.prototype,"getCadViews",null);__decorate([g.deprecated],g.prototype,"getCADViews",null);__decorate([g.deprecated],g.prototype,"activateCADView",null);__decorate([g.deprecated],g.prototype,"getCADViewPMIs",null);__decorate([g.deprecated],g.prototype,"getCADConfigurations",null);__decorate([g.deprecated],
g.prototype,"getCADDefaultConfiguration",null);__decorate([g.deprecated],g.prototype,"getCADActiveConfiguration",null);__decorate([g.deprecated],g.prototype,"activateCADConfiguration",null);__decorate([g.deprecated],g.prototype,"activateCADDefaultConfiguration",null);__decorate([g.deprecated],g.prototype,"getDataFromKeys",null);__decorate([g.deprecated],g.prototype,"createPMIInstance",null);__decorate([g.deprecated],g.prototype,"loadSubtreeFromUrl",null);__decorate([g.deprecated],g.prototype,"loadSubtreeFromXML",
null);__decorate([g.deprecated],g.prototype,"createAndAddBody",null);__decorate([g.deprecated],g.prototype,"getLowestAvailableNodeID",null);__decorate([g.deprecated],g.prototype,"getSCInstanceKey",null);__decorate([g.deprecated],g.prototype,"getNodeIDFromSCInstanceKey",null);__decorate([g.deprecated],g.prototype,"getPrimaryModelKey",null);__decorate([g.deprecated],g.prototype,"getPrimaryModelId",null);__decorate([g.deprecated],g.prototype,"getIfcNodeIds",null);__decorate([g.deprecated],g.prototype,
"getIfcTypeByNodeId",null);__decorate([g.deprecated],g.prototype,"getNodesByIfcType",null);__decorate([g.deprecated],g.prototype,"getIfcTypes",null);__decorate([g.deprecated],g.prototype,"getNodeIdsByIfcGuids",null);return g}();d.Model=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a){var e=this;this._position=new d.OverlayUnitPoint(0,d.OverlayUnit.Pixels,0,d.OverlayUnit.Pixels);this._viewportSize=new d.OverlayUnitPoint(200,d.OverlayUnit.Pixels,200,d.OverlayUnit.Pixels);this._anchor=d.OverlayAnchor.UpperRightCorner;this._dimension=3;this._fieldSize=8;this._instanceKeys=[];this._enabled=!1;this._textImageId=null;this._selectionFaceColor=new d.Color(76,186,240);this._outlineColor=new d.Color(17,94,133);this._lastSelectedNodes=[];this._nodeIds=
[];this._adjacentFaces=[];this._preserveModelUp=!0;this._cameraRotation=0;this._lastFaceIndex=this._lastCamera=this._lastOrientation=null;this._textWidths=[];this._sceneReadyCompleted=d.Util.OpenPromise.create();this._geometryCreated=this._texturesReady=!1;this._viewer=a;this._fontSize=25;this._fontInfo=this._fontSize+"px Arial";this._textureSize=512;this._viewer.setCallbacks({sceneReady:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,
this._createViewport()];case 1:return c.sent(),this._updateVisibility(),[4,this._createGeometry()];case 2:return c.sent(),this._sceneReadyCompleted.resolve(),[2]}})})},_assemblyTreeReady:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this._sceneReadyCompleted];case 1:return c.sent(),[2,this._setTextures()]}})})},_firstAttachment:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,
this._onCameraUpdate()];case 1:return c.sent(),this._updateVisibility(),[2]}})})},camera:function(){e._onCameraUpdate()},overlayViewportSet:function(c){c===d.BuiltinOverlayIndex.NavCube&&e._onViewportSet()},transitionEnd:function(){e._onCameraUpdate()},viewAxes:function(){e._updateOrientationMatrices()},_resetOpacity:function(){e._viewer.model.setNodesOpacity(e._nodeIds.slice(1),0)},viewOrientation:function(c){e._lastOrientation=c;e._cameraRotation=0;e._lastCamera=e._viewer.view.getCamera()}})}g.prototype.setAnchor=
function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return this._anchor=a,[4,this._sceneReadyCompleted];case 1:return d.sent(),[2,this._updateViewport()]}})})};g.prototype.getAnchor=function(){return this._anchor};g.prototype.enable=function(){this._enabled=!0;this._updateVisibility();return Promise.resolve()};g.prototype.disable=function(){this._enabled=!1;this._updateVisibility();return Promise.resolve()};g.prototype.setPreserveModelUp=
function(a){this._preserveModelUp=a};g.prototype.getPreserveModelUp=function(){return this._preserveModelUp};g.prototype._updateVisibility=function(){this._enabled&&this._texturesReady?this._showOverlay():this._hideOverlay()};g.prototype._hideOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.NavCube,!1)};g.prototype._showOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.NavCube,!0)};g.prototype.getEnabled=function(){return this._enabled};
g.prototype.getOverlayId=function(){return d.BuiltinOverlayIndex.NavCube};g.prototype._setTextures=function(){return __awaiter(this,void 0,void 0,function(){var a,d,c,b,f;return __generator(this,function(k){switch(k.label){case 0:if(!this._textImageId||0<this._nodeIds.length||0>=this._instanceKeys.length)return[2];a=this._viewer.model;d=0;for(c=this._instanceKeys;d<c.length;d++)b=c[d],f=a._getNodeFromInstanceInc(!0,0,b,!0),this._nodeIds.push(f),a._preventNodeDeletion(f);a.setNodesOpacity(this._nodeIds.slice(1),
0);return[4,a.setNodesTexture([this._nodeIds[0]],{imageId:this._textImageId})];case 1:return k.sent(),this._texturesReady=!0,this._updateVisibility(),[2]}})})};g.prototype._updateViewport=function(){this._viewer.overlayManager.setViewport(d.BuiltinOverlayIndex.NavCube,this._anchor,this._position.x,d.OverlayUnit.Pixels,this._position.y,d.OverlayUnit.Pixels,this._viewportSize.x,d.OverlayUnit.Pixels,this._viewportSize.y,d.OverlayUnit.Pixels)};g.prototype._createViewport=function(){var a=this._viewer.overlayManager;
this._updateViewport();var e=new d.Camera;e.setPosition(new d.Point3(0,0,10));e.setTarget(d.Point3.zero());e.setUp(new d.Point3(0,1,0));e.setWidth(this._fieldSize);e.setHeight(this._fieldSize);e.setProjection(d.Projection.Orthographic);a.setCamera(d.BuiltinOverlayIndex.NavCube,e)};g.prototype._onViewportSet=function(){var a=this._viewer.overlayManager,e=a._getViewportPosition(d.BuiltinOverlayIndex.NavCube),c=a._getViewportSize(d.BuiltinOverlayIndex.NavCube);a=a.getViewportAnchor(d.BuiltinOverlayIndex.NavCube);
null!==e&&null!==c&&null!==a&&(this._position=e,this._viewportSize=c,this._anchor=a)};g.prototype._createGeometry=function(){return __awaiter(this,void 0,void 0,function(){var a,e,c,b,f,k,l,g,m,p,h,r,u,t,v,w,y,x,z,B,A,D,C,E,F,H,G,I,K,J,L,M,N;return __generator(this,function(n){switch(n.label){case 0:if(this._geometryCreated)return[2];a=this._initializeTextures();e=0;c=[];c.push(this._createCube(e++,this._dimension));b=[];b.push(this._makeRotationMatrixX(-.5*Math.PI));b.push(this._makeRotationMatrixX(.5*
Math.PI));b.push(this._makeRotationMatrixY(.5*Math.PI));b.push(this._makeRotationMatrixY(-.5*Math.PI));b.push(this._makeRotationMatrixZ(.5*Math.PI));b.push(this._makeRotationMatrixZ(-.5*Math.PI));f=this._dimension/4;k=this._dimension/2;l=[];g=new d.Point3(0,0,0);m=new d.Point3(0,0,0);p=new d.Point3(0,0,0);for(h=0;h<b.length;h++)r=this._dimension,u=b[h],t=!1,h===b.length-1&&(t=!0,g.z+=this._dimension+.02),m=new d.Point3(.5*r-f,-.5*r+f,-.5*r+-.01),p=new d.Point3(m.x+f,m.y-f,m.z),c.push(this._createSelectionFace(e++,
m,p,u,t,g,l)),m=new d.Point3(-.5*r,-.5*r+f,-.5*r+-.01),p=new d.Point3(m.x+f,m.y-f,m.z),c.push(this._createSelectionFace(e++,m,p,u,t,g,l)),m=new d.Point3(-.5*r,.5*r,-.5*r+-.01),p=new d.Point3(m.x+f,m.y-f,m.z),c.push(this._createSelectionFace(e++,m,p,u,t,g,l)),m=new d.Point3(.5*r-f,.5*r,-.5*r+-.01),p=new d.Point3(m.x+f,m.y-f,m.z),c.push(this._createSelectionFace(e++,m,p,u,t,g,l)),m=new d.Point3(-.5*r+f,.5*r,-.5*r+-.01),p=new d.Point3(m.x+k,m.y-f,m.z),c.push(this._createSelectionFace(e++,m,p,u,t,g,l)),
m=new d.Point3(-.5*r+f,-.5*r+f,-.5*r+-.01),p=new d.Point3(m.x+k,m.y-f,m.z),c.push(this._createSelectionFace(e++,m,p,u,t,g,l)),m=new d.Point3(-.5*r,.5*r-f,-.5*r+-.01),p=new d.Point3(m.x+f,m.y-k,m.z),c.push(this._createSelectionFace(e++,m,p,u,t,g,l)),m=new d.Point3(.5*r-f,.5*r-f,-.5*r+-.01),p=new d.Point3(m.x+f,m.y-k,m.z),c.push(this._createSelectionFace(e++,m,p,u,t,g,l)),m=new d.Point3(-.5*r+f,.5*r-f,-.5*r+-.01),p=new d.Point3(m.x+k,m.y-k,m.z),c.push(this._createSelectionFace(e++,m,p,u,t,g,l));for(v=
0;v<l.length;v++){w=Math.floor(v/9);y=[];x=l[v];for(z=0;z<x.length;z+=2)for(B=x[z],A=x[z+1],D=0;D<l.length;D++)if(C=Math.floor(D/9),C!==w)for(E=l[D],F=0;F<E.length;F+=2)H=E[F],G=E[F+1],this._isSameEdge(B,A,H,G)&&y.push(D);this._adjacentFaces.push(y)}return[4,Promise.all(c)];case 1:I=n.sent();this._updateOrientationMatrices();this._onCameraUpdate();K=[];J=0;for(L=I;J<L.length;J++)M=L[J],K.push(0,M);N=this._getScEngine();N.setPartVisibility(K,!0,!0);this._geometryCreated=!0;return[2,a]}})})};g.prototype._createTexture=
function(a,e){a=a.getImageData(0,0,e,e).data;e=new ArrayBuffer(e*e*3);e=new Uint8Array(e);for(var c=0,b=0;b<a.length;b+=4)e[c]=a[b],e[c+1]=a[b],e[c+2]=a[b],c+=3;return this._viewer.model.createImage({format:d.ImageFormat.Rgb24,data:e,width:this._textureSize,height:this._textureSize})};g.prototype._geometryHasBeenCreated=function(){return this._geometryCreated};g.prototype.insideOverlay=function(a){var d=this._viewer.overlayManager._toPixelPoint(this._viewportSize),c=this._getOverlayOffset();return a.x>=
c.x&&a.y>=c.y&&a.x<=c.x+d.x&&a.y<=c.y+d.y};g.prototype._getOverlayOffset=function(){var a=this._viewer.overlayManager._toPixelPoint(this._viewportSize);return this._viewer.overlayManager._getOverlayOffset(this._anchor,a)};g.prototype._getViewportSize=function(){return this._viewportSize};g.prototype._getViewportPixelSize=function(){return this._viewer.overlayManager._toPixelPoint(this._viewportSize)};g.prototype._onNoSelection=function(){this._enabled&&0<this._lastSelectedNodes.length&&(this._viewer.model.setNodesOpacity(this._lastSelectedNodes,
0),this._lastSelectedNodes.length=0)};g.prototype.onClickSelection=function(a){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(c){switch(c.label){case 0:console.assert(this._enabled);if(null===a||!a.isFaceSelection()||a.overlayIndex()!==d.BuiltinOverlayIndex.NavCube)return this._onNoSelection(),[2];e=this._getFaceIndexFromNodeId(a.getNodeId());return e<this._nodeIds.length&&0<e?[4,this._setViewOrientation(e)]:[3,2];case 1:c.sent(),c.label=2;case 2:return[2]}})})};
g.prototype.onMoveSelection=function(a){var e=this;console.assert(this._enabled);if(null!==a&&a.isFaceSelection()&&a.overlayIndex()===d.BuiltinOverlayIndex.NavCube){var c=a.getNodeId(),b=this._getFaceIndexFromNodeId(c)-1;0<=b&&c!==this._nodeIds[0]&&this._viewer.pauseRendering(function(){var f=e._viewer.model;f.setNodesOpacity(e._lastSelectedNodes,0);e._lastSelectedNodes.length=0;e._lastSelectedNodes.push(c);console.assert(b<e._adjacentFaces.length);for(var a=0,d=e._adjacentFaces[b];a<d.length;a++){var g=
e._getNodeIdFromFaceIndex(d[a]+1);e._lastSelectedNodes.push(g)}f.setNodesOpacity(e._lastSelectedNodes,1)})}else this._onNoSelection()};g.prototype._getViewOrientationFromFaceIndex=function(a){switch(a){case 1:a=d.ViewOrientation.LeftBottomBack;break;case 2:a=d.ViewOrientation.LeftBottomFront;break;case 3:a=d.ViewOrientation.LeftTopFront;break;case 4:a=d.ViewOrientation.LeftTopBack;break;case 5:a=d.ViewOrientation.LeftTop;break;case 6:a=d.ViewOrientation.LeftBottom;break;case 7:a=d.ViewOrientation.LeftFront;
break;case 8:a=d.ViewOrientation.LeftBack;break;case 9:a=d.ViewOrientation.Left;break;case 10:a=d.ViewOrientation.RightTopBack;break;case 11:a=d.ViewOrientation.RightTopFront;break;case 12:a=d.ViewOrientation.RightBottomFront;break;case 13:a=d.ViewOrientation.RightBottomBack;break;case 14:a=d.ViewOrientation.RightBottom;break;case 15:a=d.ViewOrientation.RightTop;break;case 16:a=d.ViewOrientation.RightFront;break;case 17:a=d.ViewOrientation.RightBack;break;case 18:a=d.ViewOrientation.Right;break;case 19:a=
d.ViewOrientation.BackTopRight;break;case 20:a=d.ViewOrientation.BackBottomRight;break;case 21:a=d.ViewOrientation.BackBottomLeft;break;case 22:a=d.ViewOrientation.BackTopLeft;break;case 23:a=d.ViewOrientation.BackLeft;break;case 24:a=d.ViewOrientation.BackRight;break;case 25:a=d.ViewOrientation.BackBottom;break;case 26:a=d.ViewOrientation.BackTop;break;case 27:a=d.ViewOrientation.Back;break;case 28:a=d.ViewOrientation.FrontBottomRight;break;case 29:a=d.ViewOrientation.FrontTopRight;break;case 30:a=
d.ViewOrientation.FrontTopLeft;break;case 31:a=d.ViewOrientation.FrontBottomLeft;break;case 32:a=d.ViewOrientation.FrontLeft;break;case 33:a=d.ViewOrientation.FrontRight;break;case 34:a=d.ViewOrientation.FrontTop;break;case 35:a=d.ViewOrientation.FrontBottom;break;case 36:a=d.ViewOrientation.Front;break;case 37:a=d.ViewOrientation.BottomRightFront;break;case 38:a=d.ViewOrientation.BottomLeftFront;break;case 39:a=d.ViewOrientation.BottomLeftBack;break;case 40:a=d.ViewOrientation.BottomRightBack;break;
case 41:a=d.ViewOrientation.BottomBack;break;case 42:a=d.ViewOrientation.BottomFront;break;case 43:a=d.ViewOrientation.BottomLeft;break;case 44:a=d.ViewOrientation.BottomRight;break;case 45:a=d.ViewOrientation.Bottom;break;case 46:a=d.ViewOrientation.TopLeftBack;break;case 47:a=d.ViewOrientation.TopRightBack;break;case 48:a=d.ViewOrientation.TopRightFront;break;case 49:a=d.ViewOrientation.TopLeftFront;break;case 50:a=d.ViewOrientation.TopFront;break;case 51:a=d.ViewOrientation.TopBack;break;case 52:a=
d.ViewOrientation.TopRight;break;case 53:a=d.ViewOrientation.TopLeft;break;case 54:a=d.ViewOrientation.Top;break;default:a=d.ViewOrientation.Front}return a};g.prototype._setViewOrientation=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,f,k,l,g,m,p,h,r,u,t,v,w;return __generator(this,function(n){switch(n.label){case 0:return e=this._viewer.view,c=this._getViewOrientationFromFaceIndex(a),[4,e.getViewOrientationCamera(c,void 0,this._preserveModelUp)];case 1:b=n.sent();f=!1;console.assert(0<=
a-1);console.assert(a-1<this._adjacentFaces.length);k=this._adjacentFaces[a-1];l=0;for(g=k;l<g.length;l++)if(m=g[l],p=m+1,p===this._lastFaceIndex){f=!0;break}this._lastFaceIndex=a;h=null!==this._lastCamera&&this._lastCamera.equals(e.getCamera());this._cameraRotation=(r=this._lastOrientation===c||f)&&h?this._preserveModelUp?(this._cameraRotation+90)%360:90:0;this._lastOrientation=c;0<this._cameraRotation&&(u=d.Point3.subtract(b.getPosition(),b.getTarget()).normalize(),t=d.Matrix.createFromOffAxisRotation(u,
this._cameraRotation),v=b.getUp(),t.transform(v,v),b.setUp(v));return[4,e.fitWorld(d.DefaultTransitionDuration,b)];case 2:n.sent();w=this._viewer.model.getAbsoluteRootNode();if(0===this._viewer.model.getNodeChildren(w).length)return[2,this._getScEngine().markCameraAsEmpty()];this._lastCamera=e.getCamera();return[2]}})})};g.prototype._getScEngine=function(){return this._viewer._getScEngine()};g.prototype._createInstance=function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b,f,k,l;return __generator(this,
function(g){switch(g.label){case 0:return[4,this._viewer.model.createMesh(a)];case 1:return c=g.sent(),b=new d.MeshInstanceData(c),b.setCreationFlags(d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.ExcludeBounding|d.MeshInstanceCreationFlags.DoNotLight|d.MeshInstanceCreationFlags.Invisible),b.setOverlayIndex(d.BuiltinOverlayIndex.NavCube),f=this._getScEngine(),[4,f.createMeshInstance(b)];case 2:return k=g.sent(),l=k[1],this._instanceKeys[e]=
l,[2,l]}})})};g.prototype._createCube=function(a,e){for(var c=[],b=[],f=[],k=[],l=this._textWidths[0],g=0,m=this._textWidths;g<m.length;g++){var p=m[g];p>l&&(l=p)}l+=10;c.push(new d.Point3(.5*e,.5*e,.5*e));c.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,.5*e));c.push(new d.Point3(.5*e,.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,.5*e,.5*e));b.push(new d.Point3(0,1,0));b.push(new d.Point3(0,1,0));b.push(new d.Point3(0,1,0));b.push(new d.Point3(0,
1,0));b.push(new d.Point3(0,1,0));b.push(new d.Point3(0,1,0));g=22/this._textureSize;m=82/this._textureSize;g=1-g;m=1-m;var h=(l-this._textWidths[0])/2;p=-(h/this._textureSize);h=(this._textWidths[0]+h)/this._textureSize;f.push(new d.Point2(p,g));f.push(new d.Point2(h,m));f.push(new d.Point2(h,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,m));f.push(new d.Point2(p,g));k.push(new d.Point3(-.5*e,.5*e,-.5*e));k.push(new d.Point3(.5*e,.5*e,-.5*e));k.push(new d.Point3(.5*e,.5*e,-.5*e));k.push(new d.Point3(.5*
e,.5*e,.5*e));k.push(new d.Point3(.5*e,.5*e,.5*e));k.push(new d.Point3(-.5*e,.5*e,.5*e));k.push(new d.Point3(-.5*e,.5*e,.5*e));k.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(-.5*e,-.5*e,.5*e));c.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(.5*e,-.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,.5*e));c.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(.5*e,-.5*e,-.5*e));b.push(new d.Point3(0,-1,0));b.push(new d.Point3(0,-1,0));b.push(new d.Point3(0,-1,0));b.push(new d.Point3(0,
-1,0));b.push(new d.Point3(0,-1,0));b.push(new d.Point3(0,-1,0));g-=60/this._textureSize;m-=60/this._textureSize;h=(l-this._textWidths[1])/2;p=-(h/this._textureSize);h=(this._textWidths[1]+h)/this._textureSize;f.push(new d.Point2(p,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,g));f.push(new d.Point2(h,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,m));k.push(new d.Point3(-.5*e,-.5*e,-.5*e));k.push(new d.Point3(.5*e,-.5*e,-.5*e));k.push(new d.Point3(.5*e,-.5*e,-.5*e));k.push(new d.Point3(.5*
e,-.5*e,.5*e));k.push(new d.Point3(.5*e,-.5*e,.5*e));k.push(new d.Point3(-.5*e,-.5*e,.5*e));k.push(new d.Point3(-.5*e,-.5*e,.5*e));k.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,.5*e));c.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,.5*e));c.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,-.5*e,.5*e));b.push(new d.Point3(-1,0,0));b.push(new d.Point3(-1,0,0));b.push(new d.Point3(-1,0,0));b.push(new d.Point3(-1,
0,0));b.push(new d.Point3(-1,0,0));b.push(new d.Point3(-1,0,0));g-=60/this._textureSize;m-=60/this._textureSize;h=(l-this._textWidths[2])/2;p=-(h/this._textureSize);h=(this._textWidths[2]+h)/this._textureSize;f.push(new d.Point2(p,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,m));f.push(new d.Point2(p,g));f.push(new d.Point2(h,m));f.push(new d.Point2(h,g));k.push(new d.Point3(-.5*e,.5*e,-.5*e));k.push(new d.Point3(-.5*e,.5*e,.5*e));k.push(new d.Point3(-.5*e,.5*e,.5*e));k.push(new d.Point3(-.5*
e,-.5*e,.5*e));k.push(new d.Point3(-.5*e,-.5*e,.5*e));k.push(new d.Point3(-.5*e,-.5*e,-.5*e));k.push(new d.Point3(-.5*e,-.5*e,-.5*e));k.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,-.5*e));c.push(new d.Point3(.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,-.5*e));b.push(new d.Point3(1,0,0));b.push(new d.Point3(1,0,0));b.push(new d.Point3(1,0,0));b.push(new d.Point3(1,
0,0));b.push(new d.Point3(1,0,0));b.push(new d.Point3(1,0,0));g-=60/this._textureSize;m-=60/this._textureSize;h=(l-this._textWidths[3])/2;p=-(h/this._textureSize);h=(this._textWidths[3]+h)/this._textureSize;f.push(new d.Point2(h,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,m));f.push(new d.Point2(h,g));f.push(new d.Point2(p,g));f.push(new d.Point2(p,m));k.push(new d.Point3(.5*e,.5*e,-.5*e));k.push(new d.Point3(.5*e,.5*e,.5*e));k.push(new d.Point3(.5*e,.5*e,.5*e));k.push(new d.Point3(.5*e,-.5*
e,.5*e));k.push(new d.Point3(.5*e,-.5*e,.5*e));k.push(new d.Point3(.5*e,-.5*e,-.5*e));k.push(new d.Point3(.5*e,-.5*e,-.5*e));k.push(new d.Point3(.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,-.5*e));b.push(new d.Point3(0,0,-1));b.push(new d.Point3(0,0,-1));b.push(new d.Point3(0,0,-1));b.push(new d.Point3(0,
0,-1));b.push(new d.Point3(0,0,-1));b.push(new d.Point3(0,0,-1));g-=60/this._textureSize;m-=60/this._textureSize;h=(l-this._textWidths[4])/2;p=-(h/this._textureSize);h=(this._textWidths[4]+h)/this._textureSize;f.push(new d.Point2(p,m));f.push(new d.Point2(h,m));f.push(new d.Point2(h,g));f.push(new d.Point2(p,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,g));c.push(new d.Point3(-.5*e,.5*e,.5*e));c.push(new d.Point3(-.5*e,-.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,.5*e));c.push(new d.Point3(-.5*
e,.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,.5*e));c.push(new d.Point3(.5*e,.5*e,.5*e));b.push(new d.Point3(0,0,1));b.push(new d.Point3(0,0,1));b.push(new d.Point3(0,0,1));b.push(new d.Point3(0,0,1));b.push(new d.Point3(0,0,1));b.push(new d.Point3(0,0,1));g-=60/this._textureSize;m-=60/this._textureSize;h=(l-this._textWidths[5])/2;p=-(h/this._textureSize);h=(this._textWidths[5]+h)/this._textureSize;f.push(new d.Point2(p,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,m));f.push(new d.Point2(p,
g));f.push(new d.Point2(h,m));f.push(new d.Point2(h,g));e=new d.MeshData;e.setFaceWinding(d.FaceWinding.CounterClockwise);l=[];m=[];p=[];for(g=h=0;g<c.length;g++){var r=c[g];l.push(r.x);l.push(r.y);l.push(r.z);r=b[g];m.push(r.x);m.push(r.y);m.push(r.z);r=f[g];p.push(r.x);p.push(r.y);if(18<=l.length){r=[[0,255,0,255],[0,255,0,255],[255,0,0,255],[255,0,0,255],[0,0,255,255],[0,0,255,255]][h];for(var u=[],t=0;6>t;t++)u.push(r[0]),u.push(r[1]),u.push(r[2]),u.push(r[3]);e.addFaces(l,m,new Uint8Array(u),
p);l=[];m=[];p=[];++h}}l=[];c=new Uint8Array(4*k.length);for(g=0;g<k.length;g++)b=k[g],l.push(b.x),l.push(b.y),l.push(b.z),b=4*g,c[b]=this._outlineColor.r,c[b+1]=this._outlineColor.g,c[b+2]=this._outlineColor.b,c[b+3]=255;e.addPolyline(l,c);return this._createInstance(e,a)};g.prototype._onCameraUpdate=function(){var a=new d.Camera,e=this._viewer.view.getCamera();a.setPosition(e.getPosition().subtract(e.getTarget()).normalize());a.setTarget(d.Point3.zero());a.setUp(e.getUp());a.setProjection(d.Projection.Orthographic);
a.setWidth(this._fieldSize);a.setHeight(this._fieldSize);this._viewer.overlayManager.setCamera(d.BuiltinOverlayIndex.NavCube,a)};g.prototype._updateOrientationMatrices=function(){var a=this._viewer.model.getViewAxes(),e=a.upVector.copy(),c=a.frontVector.copy(),b=d.Point3.cross(e,c.copy().scale(-1));a=new d.Matrix;a.m[0]=-c.x;a.m[1]=-c.y;a.m[2]=-c.z;a.m[4]=b.x;a.m[5]=b.y;a.m[6]=b.z;a.m[8]=e.x;a.m[9]=e.y;a.m[10]=e.z;e=this._getScEngine();c=[];b=0;for(var f=this._instanceKeys;b<f.length;b++)c.push(0,
f[b]);e.setInstancesMatrix(c,a)};g.prototype._createSelectionFace=function(a,e,c,b,f,k,l){var g=new d.MeshData;g.setFaceWinding(d.FaceWinding.CounterClockwise);var m=[];this._createQuad(e,c,m,b,k,f);e=[];c=[];b=[];for(k=0;k<m.length;k++){var p=m[k];e.push(p.x);e.push(p.y);e.push(p.z);c.push(0);c.push(0);c.push(-1);b.push(this._selectionFaceColor.r);b.push(this._selectionFaceColor.g);b.push(this._selectionFaceColor.b);b.push(128)}k=[];p=[this._outlineColor.r,this._outlineColor.g,this._outlineColor.b,
255,this._outlineColor.r,this._outlineColor.g,this._outlineColor.b,255];g.addFaces(e,c,new Uint8Array(b));e=[];f?(e.push(m[4].x,m[4].y,m[4].z),e.push(m[5].x,m[5].y,m[5].z)):(e.push(m[0].x,m[0].y,m[0].z),e.push(m[1].x,m[1].y,m[1].z));g.addPolyline(e,new Uint8Array(p));k.push(new d.Point3(e[0],e[1],e[2]),new d.Point3(e[3],e[4],e[5]));e=[];e.push(m[1].x,m[1].y,m[1].z);e.push(m[2].x,m[2].y,m[2].z);g.addPolyline(e,new Uint8Array(p));k.push(new d.Point3(e[0],e[1],e[2]),new d.Point3(e[3],e[4],e[5]));e=[];
e.push(m[3].x,m[3].y,m[3].z);e.push(m[4].x,m[4].y,m[4].z);g.addPolyline(e,new Uint8Array(p));k.push(new d.Point3(e[0],e[1],e[2]),new d.Point3(e[3],e[4],e[5]));e=[];f?(e.push(m[3].x,m[3].y,m[3].z),e.push(m[2].x,m[2].y,m[2].z)):(e.push(m[5].x,m[5].y,m[5].z),e.push(m[3].x,m[3].y,m[3].z));g.addPolyline(e,new Uint8Array(p));k.push(new d.Point3(e[0],e[1],e[2]),new d.Point3(e[3],e[4],e[5]));l.push(k);return this._createInstance(g,a)};g.prototype._createQuad=function(a,e,c,b,f,k){void 0===k&&(k=!1);a=new d.Point3(a.x,
a.y,a.z);e=new d.Point3(e.x,e.y,e.z);f&&(a.x+=f.x,a.y+=f.y,a.z+=f.z,e.x+=f.x,e.y+=f.y,e.z+=f.z);f=c.length;var l=new d.Point3(e.x,e.y,a.z);l=b.transform(l);c.push(l);l=new d.Point3(a.x,e.y,a.z);l=b.transform(l);c.push(l);l=new d.Point3(a.x,a.y,a.z);l=b.transform(l);c.push(l);l=new d.Point3(e.x,a.y,a.z);l=b.transform(l);c.push(l);l=new d.Point3(e.x,e.y,a.z);l=b.transform(l);c.push(l);l=new d.Point3(a.x,a.y,a.z);l=b.transform(l);c.push(l);if(k)for(b=0;3>b;b++)k=f+b,a=c[f+b],a=new d.Point3(a.x,a.y,a.z),
e=f+(6-b-1),c[k].x=c[e].x,c[k].y=c[e].y,c[k].z=c[e].z,c[e].x=a.x,c[e].y=a.y,c[e].z=a.z};g.prototype._makeRotationMatrixX=function(a){var e=Math.cos(a);a=Math.sin(a);var c=new d.Matrix;c.m[5]=e;c.m[6]=-a;c.m[9]=a;c.m[10]=e;return c};g.prototype._makeRotationMatrixY=function(a){var e=Math.cos(a);a=Math.sin(a);var c=new d.Matrix;c.m[0]=e;c.m[2]=a;c.m[8]=-a;c.m[10]=e;return c};g.prototype._makeRotationMatrixZ=function(a){var e=Math.cos(a);a=Math.sin(a);var c=new d.Matrix;c.m[0]=e;c.m[1]=-a;c.m[4]=a;c.m[5]=
e;return c};g.prototype._getFaceIndexFromNodeId=function(a){for(var d=0;d<this._nodeIds.length;d++)if(this._nodeIds[d]===a)return d;return-1};g.prototype._getNodeIdFromFaceIndex=function(a){return this._nodeIds[a]};g.prototype._isSameEdge=function(a,e,c,b){var f=d.Point3.subtract(a,c).squaredLength()+d.Point3.subtract(e,b).squaredLength();a=d.Point3.subtract(e,c).squaredLength()+d.Point3.subtract(a,b).squaredLength();return.03>Math.min(f,a)};g.prototype._initializeTextures=function(){return __awaiter(this,
void 0,void 0,function(){var a,d,c,b,f,k,l;return __generator(this,function(e){switch(e.label){case 0:a=document.createElement("canvas");a.width=this._textureSize;a.height=this._textureSize;d=a.getContext("2d");c=2*(this._fontSize+5);d.beginPath();d.rect(0,0,this._textureSize,this._textureSize);d.fillStyle="gray";d.fill();d.fillStyle="black";d.font=this._fontInfo;for(b=0;b<g._faceTexts.length;b++)f=g._faceTexts[b],d.fillText(f,0,c*(b+1)),k=d.measureText(f),this._textWidths.push(k.width);return[4,
this._createTexture(d,this._textureSize)];case 1:return this._textImageId=l=e.sent(),[2]}})})};g._faceTexts="LEFT RIGHT FRONT BACK BOTTOM TOP".split(" ");return g}();d.NavCube=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a){var e=this;this._operatorStack=[];this._operators=new Map;this._customOperatorIdCount=0;this._customOperatorIdIndex=1E4;this._eventSequencePromise=Promise.resolve();this._events=[];this._viewer=a;this._viewer.setCallbacks({_resetAssemblyTreeBegin:function(){return __awaiter(e,void 0,void 0,function(){var c,b=this;return __generator(this,function(f){c=[];this._operators.forEach(function(f,a){f=b._deactivateOperator(a);void 0!==f&&c.push(f);f=b._activateOperator(a);
void 0!==f&&c.push(f)});return[2,d.Util.waitForAll(c)]})})}})}g.prototype._shutdown=function(){for(;void 0!==this.pop(););};g.prototype._registerOperator=function(a,d){this._operators.set(a,d)};g.prototype.registerCustomOperator=function(a){var d=this._customOperatorIdIndex+this._customOperatorIdCount++;this._operators.set(d,a);return d};g.prototype.unregisterCustomOperator=function(a){a>=this._customOperatorIdIndex&&this._operators.delete(a)};g.prototype.replaceOperator=function(a,d){d=this.getOperator(d);
return null!==d?(this._operators.set(a,d),!0):!1};g.prototype.indexOf=function(a){for(var d=this.size()-1;0<=d;d--)if(this._operatorStack[d]===a)return d;return-1};g.prototype.push=function(a){return this._isValid(a)&&!this._contains(a)?(this._operatorStack.push(a),this._activateOperator(a),!0):!1};g.prototype.set=function(a,d){var c=this._operatorStack[d];return a===c?!1:this._isValid(a)&&!this._contains(a)?(this._deactivateOperator(c),this._activateOperator(a),this._operatorStack[d]=a,!0):!1};g.prototype.pop=
function(){var a=this._operatorStack.pop();void 0!==a&&this._deactivateOperator(a);return a};g.prototype.remove=function(a){var d=this.indexOf(a);-1!==d&&(this._operatorStack.splice(d,1),this._deactivateOperator(a))};g.prototype.peek=function(){return 0<this.size()?this._operatorStack[this.size()-1]:d.OperatorId.Invalid};g.prototype.clear=function(){for(var a=this.size()-1;0<=a;a--)this.pop()};g.prototype.size=function(){return this._operatorStack.length};g.prototype.getOperator=function(a){a=this._operators.get(a);
return void 0!==a?a:null};g.prototype._injectEvent=function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b,f;return __generator(this,function(k){switch(k.label){case 0:c=this.size()-1,k.label=1;case 1:if(!(0<=c))return[3,37];b=this._operators.get(this._operatorStack[c]);if(void 0===b)return[3,33];f=e;switch(f){case d.EventType.KeyDown:return[3,2];case d.EventType.KeyUp:return[3,5];case d.EventType.MouseDown:return[3,8];case d.EventType.MouseMove:return[3,11];case d.EventType.MouseUp:return[3,
14];case d.EventType.Mousewheel:return[3,17];case d.EventType.TouchStart:return[3,20];case d.EventType.TouchMove:return[3,23];case d.EventType.TouchEnd:return[3,26];case d.EventType.ViewOrientationChange:return[3,29]}return[3,32];case 2:return b.onKeyDown?[4,b.onKeyDown(a)]:[3,4];case 3:k.sent(),k.label=4;case 4:return[3,33];case 5:return b.onKeyUp?[4,b.onKeyUp(a)]:[3,7];case 6:k.sent(),k.label=7;case 7:return[3,33];case 8:return b.onMouseDown?[4,b.onMouseDown(a)]:[3,10];case 9:k.sent(),k.label=10;
case 10:return[3,33];case 11:return b.onMouseMove?[4,b.onMouseMove(a)]:[3,13];case 12:k.sent(),k.label=13;case 13:return[3,33];case 14:return b.onMouseUp?[4,b.onMouseUp(a)]:[3,16];case 15:k.sent(),k.label=16;case 16:return[3,33];case 17:return b.onMousewheel?[4,b.onMousewheel(a)]:[3,19];case 18:k.sent(),k.label=19;case 19:return[3,33];case 20:return b.onTouchStart?[4,b.onTouchStart(a)]:[3,22];case 21:k.sent(),k.label=22;case 22:return[3,33];case 23:return b.onTouchMove?[4,b.onTouchMove(a)]:[3,25];
case 24:k.sent(),k.label=25;case 25:return[3,33];case 26:return b.onTouchEnd?[4,b.onTouchEnd(a)]:[3,28];case 27:k.sent(),k.label=28;case 28:return[3,33];case 29:return b.onViewOrientationChange?[4,b.onViewOrientationChange()]:[3,31];case 30:k.sent(),k.label=31;case 31:return[3,33];case 32:d.Util.TypeAssertNever(e),k.label=33;case 33:return a.getHandled()?e!==d.EventType.MouseUp&&e!==d.EventType.TouchEnd?[3,35]:[4,this._stopInteraction()]:[3,36];case 34:k.sent(),k.label=35;case 35:return[3,37];case 36:return c--,
[3,1];case 37:return[2]}})})};g.prototype.injectEvent=function(a,d){return __awaiter(this,void 0,void 0,function(){var c=this;return __generator(this,function(b){this._events.push({event:a,eventType:d});this._eventSequencePromise=this._eventSequencePromise.then(function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this._injectNextEvent()];case 1:return b.sent(),[2]}})})});return[2,this._eventSequencePromise]})})};g.prototype._injectNextEvent=
function(){return __awaiter(this,void 0,void 0,function(){var a,e,c,b;return __generator(this,function(f){switch(f.label){case 0:a=this._events.shift();if(void 0===a)return[2];e=a.eventType;if(e===d.EventType.MouseMove)for(;0<this._events.length;)if(c=this._events[0],c.eventType===e)a=c,this._events.shift();else break;f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this._injectEvent(a.event,a.eventType)];case 2:return f.sent(),[3,4];case 3:return b=f.sent(),console.log(b),[3,4];case 4:return[2]}})})};
g.prototype._stopInteraction=function(){return __awaiter(this,void 0,void 0,function(){var a,e,c,b;return __generator(this,function(f){a=[];for(e=this.size()-1;0<=e;e--)(c=this._operators.get(this._operatorStack[e]))&&c.stopInteraction&&(b=c.stopInteraction(),void 0!==b&&a.push(b));return[2,d.Util.waitForAll(a)]})})};g.prototype._injectViewOrientationChangeEvent=function(){for(var a=this.size()-1;0<=a;a--){var d=this._operators.get(this._operatorStack[a]);if(void 0!==d&&d.onViewOrientationChange)d.onViewOrientationChange()}};
g.prototype._isValid=function(a){return this._operators.has(a)||a===d.OperatorId.None};g.prototype._contains=function(a){return-1!==this.indexOf(a)};g.prototype._activateOperator=function(a){a=this._operators.get(a);if(void 0!==a&&a.onActivate)return a.onActivate()};g.prototype._deactivateOperator=function(a){a=this._operators.get(a);if(void 0!==a&&a.onDeactivate)return a.onDeactivate()};return g}();d.OperatorManager=h})(Communicator||(Communicator={}));
(function(d){var h=function(){return function(a,c,b,f){this.x=a;this.xUnit=c;this.y=b;this.yUnit=f}}();d.OverlayUnitPoint=h;var g=function(){function a(c,b,f){this._anchor=c;this._position=b;this._size=f}a.prototype.getAnchor=function(){return this._anchor};a.prototype.getPosition=function(){return this._position};a.prototype.getSize=function(){return this._size};return a}(),a=function(){function a(c,b){this._viewer=c;this._engine=b;this._viewports=[];for(c=0;c<=this.maxIndex();c++)this._viewports.push(null)}
a.prototype.maxIndex=function(){return d.BuiltinOverlayIndex.First-1};a.prototype.setViewport=function(c,b,f,a,e,n,m,p,q,r){if(0===c)throw new d.CommunicatorError("Index 0 is reserved and may not be used to specify an overlay.");if(0>c)throw new d.CommunicatorError("Invalid index "+c+" specified when setting viewport.");if(a===d.OverlayUnit.ProportionOfOtherDimension&&n===d.OverlayUnit.ProportionOfOtherDimension)throw new d.CommunicatorError("Both x and y may not be set proportional to each other");
if(p===d.OverlayUnit.ProportionOfOtherDimension&&r===d.OverlayUnit.ProportionOfOtherDimension)throw new d.CommunicatorError("Both width and height may not be set proportional to each other");this._validateUnit(f,a,"x");this._validateUnit(e,n,"y");this._validateUnit(m,p,"width");this._validateUnit(q,r,"height");var k=new h(f,a,e,n),l=new h(m,p,q,r);k=new g(b,k,l);this._viewports[c]=k;this._engine.setOverlayViewport(c,b,f,a,e,n,m,p,q,r);this._viewer._getCallbackManager().trigger("overlayViewportSet",
c);return Promise.resolve()};a.prototype._getViewportPosition=function(c){c=this._viewports[c];return null===c?null:c.getPosition()};a.prototype.getViewportPixelPosition=function(c){c=this._viewports[c];if(null===c)return null;c=c.getPosition();return this._toPixelPoint(c)};a.prototype.getViewportPixelOffsetInCanvas=function(c){var b=this.getViewportPixelPosition(c);if(null===b)return null;var f=this.getViewportPixelSize(c);if(null===f)return null;c=this.getViewportAnchor(c);if(null===c)return null;
f=this._getOverlayOffset(c,f);var a=d.Point2.add(f,b);switch(c){case d.OverlayAnchor.UpperRightCorner:case d.OverlayAnchor.RightCenter:case d.OverlayAnchor.LowerRightCorner:a.x=f.x-b.x}switch(c){case d.OverlayAnchor.LeftCenter:case d.OverlayAnchor.Center:case d.OverlayAnchor.RightCenter:case d.OverlayAnchor.LowerLeftCorner:case d.OverlayAnchor.BottomCenter:case d.OverlayAnchor.LowerRightCorner:a.y=f.y-b.y}return a};a.prototype._getViewportSize=function(c){c=this._viewports[c];return null===c?null:
c.getSize()};a.prototype.getViewportPixelSize=function(c){c=this._viewports[c];if(null===c)return null;c=c.getSize();return this._toPixelPoint(c)};a.prototype.getViewportAnchor=function(c){c=this._viewports[c];return null===c?null:c.getAnchor()};a.prototype.setVisibility=function(c,b){this._engine.setOverlayVisibility(c,b);return Promise.resolve()};a.prototype.destroy=function(c){this._engine.destroyOverlay(c);this._viewports[c]=null;return Promise.resolve()};a.prototype.addNodes=function(c,b){b=
this._viewer.model._gatherInstanceIncsFromNodeIds(b);0<b.length&&this._engine.addNodesToOverlay(b,c);return Promise.resolve()};a.prototype.setCamera=function(c,b){this._engine.setOverlayCamera(c,b);return Promise.resolve()};a.prototype._getOverlayOffset=function(c,b){var f=this._viewer.view.getCanvasSize(),a=d.Point2.zero();if(c===d.OverlayAnchor.LowerRightCorner||c===d.OverlayAnchor.UpperRightCorner||c===d.OverlayAnchor.RightCenter)a.x=f.x-b.x;else if(c===d.OverlayAnchor.Center||c===d.OverlayAnchor.TopCenter||
c===d.OverlayAnchor.BottomCenter)a.x=.5*(f.x-b.x);if(c===d.OverlayAnchor.LowerLeftCorner||c===d.OverlayAnchor.LowerRightCorner||c===d.OverlayAnchor.BottomCenter)a.y=f.y-b.y;else if(c===d.OverlayAnchor.Center||c===d.OverlayAnchor.LeftCenter||c===d.OverlayAnchor.RightCenter)a.y=.5*(f.y-b.y);return a};a.prototype._toPixelPoint=function(c){var b=this._viewer.view.getCanvasSize(),f=d.Point2.zero(),a=!1;switch(c.xUnit){case d.OverlayUnit.Pixels:f.x=c.x;break;case d.OverlayUnit.ProportionOfCanvas:f.x=b.x*
c.x;break;case d.OverlayUnit.ProportionOfOtherDimension:a=!0}switch(c.yUnit){case d.OverlayUnit.Pixels:f.y=c.y;break;case d.OverlayUnit.ProportionOfCanvas:f.y=b.y*c.y;break;case d.OverlayUnit.ProportionOfOtherDimension:f.y=f.x*c.y}a&&(f.x=c.x*c.y);return f};a.prototype._validateUnit=function(c,b,f){if(b!==d.OverlayUnit.Pixels&&(0>c||1<c))throw new d.ParseError("value for "+f+" should be between 0.0 and 1.0 when specifying non pixel value");};return a}();d.OverlayManager=a})(Communicator||(Communicator=
{}));
(function(d){(function(d){d[d.None=0]="None";d[d.Floor=1]="Floor";d[d.Wall=2]="Wall";d[d.Door=4]="Door"})(d.BimMask||(d.BimMask={}));var h=function(){function g(a){void 0===a&&(a=d.SelectionMask.Face);this.respectVisibility=!0;this.forceEffectiveSceneVisibilityMask=this.forceEffectiveVisibilityMask=d.SelectionMask.None;this.restrictLinesAndPointsToSelectedFaceInstances=this.oneEntityPerTypePerInstance=this.respectDepthRange=!0;this.restrictToOverlays=this.ignoreOverlays=this.ignoreCappingGeometry=this.enableProximityFaces=
!1;this.selectionMask=a}g.prototype.copy=function(){var a=new g;d.Internal.copyOwnProperties(this,a);return a};Object.defineProperty(g.prototype,"allowFaces",{get:function(){return 0!==(this.selectionMask&d.SelectionMask.Face)},set:function(a){this.selectionMask=d.Internal.setBit(this.selectionMask,d.SelectionMask.Face,a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"allowLines",{get:function(){return 0!==(this.selectionMask&d.SelectionMask.Line)},set:function(a){this.selectionMask=
d.Internal.setBit(this.selectionMask,d.SelectionMask.Line,a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"allowPoints",{get:function(){return 0!==(this.selectionMask&d.SelectionMask.Point)},set:function(a){this.selectionMask=d.Internal.setBit(this.selectionMask,d.SelectionMask.Point,a)},enumerable:!0,configurable:!0});return g}();d.PickConfig=h;h=function(){return function(g){void 0===g&&(g=d.SelectionMask.All);this.mustBeFullyContained=!1;this.respectVisibility=!0;this.forceEffectiveSceneVisibilityMask=
this.forceEffectiveVisibilityMask=d.SelectionMask.None;this.ignoreCuttingSections=this.allowPoints=this.allowLines=this.allowFaces=!0;this.ignoreUnrequestedInstances=this.onlyStreamedInstances=!1;this.allowFaces=0!==(g&d.SelectionMask.Face);this.allowLines=0!==(g&d.SelectionMask.Line);this.allowPoints=0!==(g&d.SelectionMask.Point)}}();d.IncrementalPickConfig=h})(Communicator||(Communicator={}));var SC;
(function(d){d.UnspecifiedMeasurementUnit=0;d.isError=function(d){return"object"===typeof d&&null!==d&&!0};d.getStateFailure=function(d){d=d.data;return"object"===typeof d&&null!==d&&"scStateFailure"in d?d.scStateFailure:null}})(SC||(SC={}));
(function(d){(function(h){function g(b){return null!==b?d.Color.createFromFloatArray(b):b}function a(b){return h.mapInPlace(b,g)}var e;(function(b){b[b.Add=0]="Add";b[b.Update=1]="Update"})(e||(e={}));var c=function(){return function(b){this.promise=h.OpenPromise.create();this.ids=b}}(),b=function(){function b(b,c){this._engineReadyPromise=h.OpenPromise.create();this._sessionStartedPromise=h.OpenPromise.create();this._connectionlessEmpty=!1;this._uri="ws://localhost:9999";this._streamingMode=d.StreamingMode.Default;
this._rendererType=d.RendererType.Client;this._memoryLimit=this._meshLevel=0;this._boundingPreviewMode=d.BoundingPreviewMode.All;this._streamCutoffScale=1;this._loadFinished=!1;this._statistics=new h.StatisticMap;this._cachedElementCount=this._cachedTriangleCount=null;this._windowSize=new d.Point2(0,0);this._cuttingSectionToKeyMap=new Map;this._cappingQuantizationGranularity=-1E4;this._cappingFaceColor=d.Color.createFromFloat(.5,.5,.5);this._cappingLineColor=d.Color.createFromFloat(.5,.5,.5);this._cappingNeedsUpdate=
this._cappingGeometryVisibility=!0;this._cappingDelayTimeoutId=null;this._cappingDelay=500;this._requestBatchCountByType=[];this._pendingRequestsByType=[];this._callbackManager=b;this._applyOptions(c);for(b=0;1>b;++b)this._requestBatchCountByType.push(0),this._pendingRequestsByType.push([])}b.prototype.getNetworkModelName=function(){console.assert(1===this._sessionType);if(void 0!==this._model)return this._model;throw new d.InternalLogicError;};b.prototype.logMessage=function(b){console.log(b)};b.prototype.setTimeout=
function(b,c){return setTimeout(b,c)};b.prototype.sleep=function(b){return d.Util.sleep(b)};b.prototype.getScsInfo=function(){console.assert(2===this._sessionType);return void 0!==this._buffer?this._buffer:/^wss?:\/\//i.test(this._uri)?null:this._uri};b.prototype._applyOptions=function(b){void 0!==b.empty&&(this._connectionlessEmpty=b.empty);void 0!==b.endpointUri&&(this._uri=b.endpointUri);b.model&&(this._model=b.model);void 0!==b.sessionToken&&(this._sessionToken=b.sessionToken);void 0!==b.buffer&&
(this._buffer=b.buffer);void 0!==b.streamingMode&&(this._streamingMode=b.streamingMode);void 0!==b.rendererType&&(this._rendererType=b.rendererType);void 0!==b.defaultMeshLevel&&(this._meshLevel=b.defaultMeshLevel);void 0!==b.memoryLimit&&(this._memoryLimit=b.memoryLimit);void 0!==b.boundingPreviewMode&&(this._boundingPreviewMode=b.boundingPreviewMode);void 0!==b.streamCutoffScale&&this._setStreamCutoffScale(b.streamCutoffScale)};b.prototype.start=function(b,c){var a=this;this._canvasContainer=b;
this._initOptions=c;_SC.createInstance({container:b,onReady:function(b){a._onEngineReady(b)},onError:function(b){a._callbackManager.trigger("modelLoadFailure",a._model||"","failed to load engine: "+b)},enginePath:c.enginePath});return!0};b.prototype.setPickTolerance=function(b){this._scSelectionManager.setPickTolerance(b)};b.prototype.getPickTolerance=function(){return this._scSelectionManager.getPickTolerance()};b.prototype._onEngineReady=function(b){var c=this;this._sc=b;this._sessionType=0;this._matrixCache=
new h.ScMatrixCache(this);this._scSelectionManager=new h.ScSelectionManager(this._sc);this.resize();this._callbackManager.bind({_firstBoundingReady:function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(b){this._regenerateCapping();return[2]})})}});this._sc.setEventHandler("session_started",function(){var b=function(){c._callbackManager.unbind(a);return c._sessionStartedPromise},a={_sessionStarted:function(){return c._onSessionStarted()},_assemblyTreeReady:b,_modelSwitched:b};
c._callbackManager.bind(a);c._sessionStartedPromise.resolve(c._callbackManager.promiseTrigger("_sessionStarted",null))});this._sc.setEventHandler("announce_model",function(b,a,f){c._callbackManager.trigger("_announceModel",a,f)});this._sc.setEventHandler("first_instance",function(){c._callbackManager.trigger("_firstInstance")});this._sc.setEventHandler("inclusion",function(b,a,f,d){c._callbackManager.trigger("_inclusion",a,f,d)});this._sc.setEventHandler("remap_model",function(b,a,f,d){c._callbackManager.trigger("_remapModel",
a,f,d)});this._sc.setEventHandler("remap_inclusion",function(b,a,f,d,k){c._callbackManager.trigger("_remapInclusion",a,f,d,k)});this._sc.setEventHandler("capping_idle",function(b,a,f){c._callbackManager.trigger("cappingIdle",a,f)});this._sc.setEventHandler("stream_active",this._initOptions.streamingActivated);this._sc.setEventHandler("stream_idle",this._initOptions.streamingDeactivated);this._sc.setEventHandler("open_model_failed",function(b,a){switch(a.reason){case "UNKNOWN_MODEL":b="Unknown model";
break;case "BAD_NETWORK_VERSION":b="Client/Server network version mismatch";break;case "BAD_STREAM_VERSION":case "BAD_STORE_VERSION":b="Unsupported file version";break;default:b="Internal Error"}c._callbackManager.trigger("modelLoadFailure",c._model||"",b)});this._sc.setEventHandler("missing_model",function(b,a,f){c._callbackManager.trigger("_missingModel",a,f);c._callbackManager.trigger("missingModel",f)});this._sc.setEventHandler("bad_data",function(b,a){switch(a.type){case "TRUNCATED_BLOCK":b=
"Failed to parse truncated data block.";break;case "ZFRAME_DECOMPRESS_FAILED":b="Failed to decompress data.";break;case "UNMATCHED_CODE":b="Unknown opcode.";break;case "STORE_VERSION_MISMATCHED":b="Store version mismatched. Expected='"+(a.expected+"'.");b+=" Actual='"+a.actual+"'.";break;case "STREAM_VERSION_MISMATCHED":b="Stream version mismatched. Expected='"+(a.expected+"'.");b+=" Actual='"+a.actual+"'.";break;case "PARSE_BOUNDING_TREE_FAILED":b="Failed to parse bounding tree.";break;default:b=
"Unknown error."}c._callbackManager.trigger("modelLoadFailure",c._model||"",b)});this._sc.setEventHandler("socket_open_failed",function(){c._callbackManager.trigger("modelLoadFailure",c._model||"","WebSocket connection failed.")});this._sc.setEventHandler("post_draw",function(b,a,f,d){c._syncedCamera=f;c._statistics=a;c._initOptions.renderComplete();c._fillStatTotalCounts();b=c._fromScCamera(f);c._callbackManager.trigger("frameDrawn",b,d)});this._sc.setEventHandler("priority_meta_data_sent",function(b,
a,f){c._initOptions.priorityMetaDataSent(a,f)});this.setAllowHighDpi(!0);this._sc.setEventHandler("meta_data",function(b,a,f,d){0>a&&(a+=4294967296);c._callbackManager.trigger("_metaData",a,f,d)});this._sc.setEventHandler("draw_complete",function(){c._callbackManager.trigger("_drawComplete")});this._sc.setEventHandler("webgl_context_lost",function(){c._callbackManager.trigger("webGlContextLost")});this._sc.setEventHandler("websocket_connection_closed",function(){c._callbackManager.trigger("websocketConnectionClosed")});
this._initOptions.engineReady(this._sessionStartedPromise);this._engineReadyPromise.resolve()};b.prototype.loadFinished=function(){return this._loadFinished};b.prototype.resetCachedStatistics=function(){this._cachedTriangleCount=this._cachedElementCount=null};b.prototype.setAmbientOcclusionEnabled=function(b){this._sc.setAmbientOcclusionEnabled(b)};b.prototype.setAmbientOcclusionRadius=function(b){this._sc.setAmbientOcclusionRadius(b)};b.prototype.setLightingEnabled=function(b){this._sc.setLightingEnabled(b)};
b.prototype._fillStatTotalCounts=function(){null!==this._cachedElementCount&&null!==this._cachedTriangleCount&&(this._statistics.total_element_count=this._cachedElementCount,this._statistics.total_triangle_count=this._cachedTriangleCount)};b.prototype._updateCachedStats=function(){return __awaiter(this,void 0,void 0,function(){var b,c,a;return __generator(this,function(f){switch(f.label){case 0:return b=this._sc.getElementCount(),c=this._sc.getTriangleCount(),[4,Promise.all([b,c])];case 1:return a=
f.sent(),this._cachedElementCount=a[0],this._cachedTriangleCount=a[1],this._fillStatTotalCounts(),[2]}})})};b.prototype._toVector3=function(b){var c=[0,0,0];b.toArray(c);return c};b.prototype.startExplode=function(b,c){this.delayCapping();this._sc.startExplode(b,this._toVector3(c))};b.prototype.setExplodeMagnitude=function(b){this._callbackManager.trigger("explode",b);this.delayCapping();this._sc.explode(b)};b.prototype.stopExplode=function(){this.delayCapping();this._sc.resetExplode()};b.prototype.getStatistics=
function(b){void 0===b&&(b=!1);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return!b||this.loadFinished()?[3,2]:[4,this._updateCachedStats()];case 1:return c.sent(),this._fillStatTotalCounts(),[2,this._statistics];case 2:return this.loadFinished()&&null===this._cachedTriangleCount?[4,this._updateCachedStats()]:[3,4];case 3:return c.sent(),this._fillStatTotalCounts(),[2,this._statistics];case 4:return this._fillStatTotalCounts(),[2,this._statistics]}})})};
b.prototype.setStreamIdleMarker=function(){return this._sc.setStreamIdleMarker()};b.prototype.hasDepthRange=function(b){return this._sc.MeshInstance.hasDepthRange(b)};b.prototype.setDepthRange=function(b,c,a){this._sc.MeshInstance.setDepthRange(b,c,a)};b.prototype.unsetDepthRange=function(b){this._sc.MeshInstance.unsetDepthRange(b)};b.prototype.setDefaultDepthRange=function(b,c){this._sc.setDefaultDepthRange(b,c)};b.prototype._getScPlaneArray=function(b){for(var c=[],a=0;a<b.getCount();a++){var f=
b.getPlane(a);if(null!==f){var d=[];f.normal.toArray(d);d[3]=f.d;c.push(d)}}return c};b.prototype.getCuttingSectionLimits=function(){return this._sc.cuttingSectionLimits()};b.prototype._addCuttingSection=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,f,k;return __generator(this,function(l){switch(l.label){case 0:return console.assert(!this._cuttingSectionToKeyMap.has(b)),a=4294967295,f=this._getScPlaneArray(b),0<f.length?[4,this._sc.addCuttingSection(f)]:[3,2];case 1:a=l.sent();
if(4294967295===a)throw k=c===e.Add?"add":"update",new d.CommunicatorError("Failed to "+k+" cutting section.");l.label=2;case 2:return console.assert(!this._cuttingSectionToKeyMap.has(b)),this._cuttingSectionToKeyMap.set(b,a),c===e.Add&&this._callbackManager.trigger("addCuttingSection",b),[2]}})})};b.prototype.addCuttingSection=function(b){return this._addCuttingSection(b,e.Add)};b.prototype.removeCuttingSection=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,
function(a){c=this._cuttingSectionToKeyMap.get(b);if(void 0===c)return console.assert(!1),[2];this._cuttingSectionToKeyMap.delete(b);this._callbackManager.trigger("removeCuttingSection");return 4294967295===c?[2]:[2,this._sc.removeCuttingSections([c])]})})};b.prototype.removeAllCuttingSections=function(){this._cuttingSectionToKeyMap.clear();this._callbackManager.trigger("removeCuttingSection");return this._sc.removeAllCuttingSections()};b.prototype.updateCuttingSection=function(b){return __awaiter(this,
void 0,void 0,function(){var c,a;return __generator(this,function(f){c=this._cuttingSectionToKeyMap.get(b);if(void 0===c)return console.assert(!1),[2];if(4294967295===c)return[2,this._addCuttingSection(b,e.Update)];a=this._getScPlaneArray(b);return[2,this._sc.replaceCuttingSection(a,c)]})})};b.prototype.setCappingDelay=function(b){this._cappingDelay=b};b.prototype.enableCappingIdleCallback=function(b){return this._sc.setCappingIdleHookEnabled(b)};b.prototype.delayCapping=function(){var b=this;null===
this._cappingDelayTimeoutId?this._sc.pauseCapping():clearTimeout(this._cappingDelayTimeoutId);this._cappingDelayTimeoutId=setTimeout(function(){b._cappingDelayTimeoutId=null;b._sc.resumeCapping()},this._cappingDelay)};b.prototype.setCappingGeometryVisibility=function(b){if(this._cappingGeometryVisibility!==b||this._cappingNeedsUpdate)if(null!==this._cappingDelayTimeoutId&&(clearTimeout(this._cappingDelayTimeoutId),this._cappingDelayTimeoutId=null),this._cappingNeedsUpdate=!1,this._cappingGeometryVisibility=
b){b=null!==this._cappingLineColor?this._toRgba(this._cappingLineColor,1):[-1,-1,-1,-1];var c=null!==this._cappingFaceColor?this._toRgba(this._cappingFaceColor,1):[-1,-1,-1,-1];this._sc.enableCapping(b,c,this._cappingQuantizationGranularity)}else this._sc.disableCapping()};b.prototype._regenerateCapping=function(){this._cappingNeedsUpdate=!0;this.setCappingGeometryVisibility(this._cappingGeometryVisibility)};b.prototype.getCappingGeometryVisibility=function(){return this._cappingGeometryVisibility};
b.prototype._toRgb=function(b){var c=[0,0,0];b.toFloatArray(c);return c};b.prototype._toRgba=function(b,c){c=[0,0,0,c];b.toFloatArray(c);return c};b.prototype.setCappingFaceColor=function(b){null===b&&null===this._cappingFaceColor||null!==b&&null!==this._cappingFaceColor&&b.equals(this._cappingFaceColor)||(this._cappingFaceColor=null!==b?b.copy():null,this._regenerateCapping())};b.prototype.setCappingLineColor=function(b){null===b&&null===this._cappingLineColor||null!==b&&null!==this._cappingLineColor&&
b.equals(this._cappingLineColor)||(this._cappingLineColor=null!==b?b.copy():null,this._regenerateCapping())};b.prototype._onSessionStarted=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return this._sc.suspendDrawing(),this._sc.setDrawMode(1),this._sc.setHighlightedInstanceFilter(3),this._sc.setUnhighlightedFilter(0),this._sc.setHighlightMode(1),this._sc.setAntiAliasingMode(1),b=[],b.push(this._matrixCache.init()),this._regenerateCapping(),
[4,Promise.all(b)];case 1:return c.sent(),this._initOptions.sceneReady(),this._sc.resumeDrawing(),[2]}})})};b.prototype.isInit=function(){return void 0!==this._sc};b.prototype.setRemoteEndpoint=function(b,c){this._uri=b;this._model=c};b.prototype.getSessionType=function(){return this._sessionType};b.prototype._awaitEmptyLoad=function(){var b=this,c=h.OpenPromise.create(),a={_attached:function(f){b._callbackManager.unbind(a);0===f?c.resolve():c.reject(new d.InternalLogicError)}};this._callbackManager.bind(a);
return c};b.prototype.loadEmpty=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,this._engineReadyPromise];case 1:c.sent();try{if(0!==this._sessionType)throw new d.LoadError("Incompatible load types.");b=this._awaitEmptyLoad();this._sessionType=this._connectionlessEmpty||void 0!==this._buffer||void 0===this._model?this._loadEmptyScs():this._loadEmptyNetwork();return[2,b]}catch(n){throw this._callbackManager.trigger("modelLoadFailure",
this._model||"",n.message),n;}}})})};b.prototype._loadEmpty=function(b){var c=this;console.assert(void 0===b.XHRonprogress);console.assert(void 0===b.XHRonerror);console.assert(void 0===b.XHRonloadend);b.XHRonprogress=function(b){c._callbackManager.trigger("XHRonprogress",b)};b.XHRonerror=function(b){c._callbackManager.trigger("XHRonerror",b)};b.XHRonloadend=function(b,a,f){c._callbackManager.trigger("XHRonloadend",b,a,f)};return this._sc.load(b)};b.prototype._loadEmptyScs=function(){console.assert(void 0===
this._model);var b={empty:!0};this._streamingMode===d.StreamingMode.OnDemand&&(b.streamInstancesOnDemand=!0);return this._loadEmpty(b)};b.prototype._loadEmptyNetwork=function(){console.assert(void 0!==this._model);var b={model:d.EmptyModelName,uri:this._uri,serverSideRendering:this._rendererType===d.RendererType.Server,meshLevel:this._meshLevel,streamCutoffScale:this._streamCutoffScale};void 0!==this._sessionToken&&(b.sessionToken=this._sessionToken);0<this._memoryLimit&&(b.limitMiB=this._memoryLimit);
(this._boundingPreviewMode&d.BoundingPreviewMode.Model)===d.BoundingPreviewMode.Model&&(b.streamModelBoundingPreviews=!0);(this._boundingPreviewMode&d.BoundingPreviewMode.Instance)===d.BoundingPreviewMode.Instance&&(b.streamInstanceBoundingPreviews=!0);(this._boundingPreviewMode&d.BoundingPreviewMode.Ejected)===d.BoundingPreviewMode.Ejected&&(b.streamEjectedBoundingPreviews=!0);switch(this._streamingMode){case d.StreamingMode.OnDemand:b.streamInstancesOnDemand=!0;break;case d.StreamingMode.All:b.streamCulled=
!0,b.streamMetaDataOnIdle=!0}return this._loadEmpty(b)};b.prototype.setProjection=function(b){var c=this.getCamera();c.getProjection()!==b&&(c.setProjection(b),this.setCamera(c))};b.prototype.getViewMatrix=function(b){b=void 0!==b?this._toCamera(b):this._sc.getCamera();return d.Matrix.createFromArray(b.viewMatrix())};b.prototype.getProjectionMatrix=function(b){b=void 0!==b?this._toCamera(b):this._sc.getCamera();return d.Matrix.createFromArray(b.projectionMatrix())};b.prototype.getFullCameraMatrix=
function(b){b=void 0!==b?this._toCamera(b):this._sc.getCamera();return d.Matrix.createFromArray(b.fullMatrix())};b.prototype.getSynchedViewMatrix=function(){return this._syncedCamera?d.Matrix.createFromArray(this._syncedCamera.viewMatrix()):new d.Matrix};b.prototype.getSynchedProjectionMatrix=function(){return this._syncedCamera?d.Matrix.createFromArray(this._syncedCamera.projectionMatrix()):new d.Matrix};b.prototype.getPrimaryModelKey=function(){return this._sc.primaryModelKey()};b.prototype.getPartsBounding=
function(b,c,a){return this.getBounding(b,c,!1,a)};b.prototype.getDrawnPartsBounding=function(b){return __awaiter(this,void 0,void 0,function(){var c,a;return __generator(this,function(f){switch(f.label){case 0:return[4,this._sc.MeshInstance.getDrawnWorldSpaceBounding(b)];case 1:return c=f.sent(),a=new d.Box,a.min.fromArray(c.min),a.max.fromArray(c.max),[2,a]}})})};b.prototype.getBounding=function(b,c,a,f){return __awaiter(this,void 0,void 0,function(){var k,e;return __generator(this,function(l){switch(l.label){case 0:return[4,
this._sc.MeshInstance.getWorldSpaceBounding(b,c,a,f)];case 1:return k=l.sent(),e=new d.Box,e.min.fromArray(k.min),e.max.fromArray(k.max),[2,e]}})})};b.prototype.getLooseBounding=function(){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(a){switch(a.label){case 0:return[4,this._sc.getLooseBounding()];case 1:return b=a.sent(),c=new d.Box,c.min.fromArray(b.min),c.max.fromArray(b.max),[2,c]}})})};b.prototype.getClientDimensions=function(){var b=this._sc.container;
return[b.clientWidth,b.clientHeight]};b.prototype.getModelBounding=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){return[2,this.getBounding([],b,c,a)]})})};b.prototype.pickFromScreen=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){return[2,this._scSelectionManager.pickFromScreen(b,c,a)]})})};b.prototype.pickAllFromScreen=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(f){return[2,this._scSelectionManager.pickAllFromScreen(b,c,a)]})})};b.prototype.compositePickFromScreen=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){return[2,this._scSelectionManager.compositePickFromScreen(b,c,a)]})})};b.prototype.beginScreenAreaSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){return[2,this._scSelectionManager.beginScreenAreaSelection(b,c,a)]})})};b.prototype.beginRayDrillSelection=
function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){return[2,this._scSelectionManager.beginRayDrillSelection(b,c,a)]})})};b.prototype.beginConvexPolyhedronSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){return[2,this._scSelectionManager.beginConvexPolyhedronSelection(b,c,a)]})})};b.prototype.beginSphereSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(f){return[2,this._scSelectionManager.beginSphereSelection(b,c,a)]})})};b.prototype.endIncrementalSelection=function(b){this._scSelectionManager.endIncrementalSelection(b)};b.prototype.advanceIncrementalSelection=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){return[2,this._scSelectionManager.advanceIncrementalSelection(b,!1)]})})};b.prototype.flushMetaDataCache=function(){this._sc.flushMetaDataCache()};b.prototype.safeGetMetaDatas=function(b,
c){for(var a=[],f=0;f<c.length;f++)a.push(b,c[f]);return this.getDataFromIds(a).then(h.identity,function(){return null})};b.prototype.safeGetMetaData=function(b,c){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(f){switch(f.label){case 0:return[4,this.safeGetMetaDatas(b,[c])];case 1:return a=f.sent(),null!==a?[2,a[0]]:[2,null]}})})};b.prototype.safeLoadMetaDatas=function(b){return this.getDataFromIds(b).then(h.nop,h.nop)};b.prototype.getDataFromIds=function(b){if(0===
this._requestBatchCountByType[0])return this._getDataFromIds(b);b=new c(b);this._pendingRequestsByType[0].push(b);return b.promise};b.prototype._getDataFromIds=function(b){return this._sc.getMetaData(b)};b.prototype.pickFromRay=function(b,c){return this._scSelectionManager.pickFromRay(b,c)};b.prototype.pickAllFromRay=function(b,c){return this._scSelectionManager.pickAllFromRay(b,c)};b.prototype.updateCamera=function(b){var c=b._getFlags(),a=this._sc.getCamera();(c&h.CameraFlags.Position)===h.CameraFlags.Position&&
a.setPosition(this._toVector3(b.getPosition()));(c&h.CameraFlags.Target)===h.CameraFlags.Target&&a.setTarget(this._toVector3(b.getTarget()));(c&h.CameraFlags.Up)===h.CameraFlags.Up&&a.setUpVector(this._toVector3(b.getUp()));this._setCamera(a);return this.getCamera()};b.prototype._toProjection=function(b){switch(b){default:case d.Projection.Orthographic:return 1;case d.Projection.Perspective:return 0}};b.prototype._toCamera=function(b){var c=this._sc.getCamera();c.reset(this._toProjection(b.getProjection()),
this._toVector3(b.getPosition()),this._toVector3(b.getTarget()),this._toVector3(b.getUp()),b.getWidth(),b.getHeight());c.setNearLimit(b.getNearLimit());return c};b.prototype.setCamera=function(b){b=this._toCamera(b);this._setCamera(b)};b.prototype._setCamera=function(b){this.delayCapping();this._sc.setCamera(b)};b.prototype.markCameraAsEmpty=function(){this._sc.markCameraAsEmpty()};b.prototype.setInstancesMatrix=function(b,c){this._sc.MeshInstance.setAnonymousMatrix(b,c.m)};b.prototype.setMatrices=
function(b,c){for(var a=[],f=0;f<c.length;f++)a.push.apply(a,c[f].m);this._sc.MeshInstance.setAnonymousMatrices(b,a)};b.prototype.highlightParts=function(b,c){this._sc.MeshInstance.setHighlighted(b,c);this._sc.MeshInstance.setXRay(b,c)};b.prototype.highlightElements=function(b,c,a,f,d){c=this._toElementType(c);this._sc.MeshInstance.setElementHighlighted(b,c,a,f,d);this._sc.MeshInstance.setElementXRay(b,c,a,f,d)};b.prototype.getPartHighlighted=function(b){return this._sc.MeshInstance.getHighlighted(b)};
b.prototype.getElementHighlighted=function(b,c,a){return this._sc.MeshInstance.getElementHighlighted(b,this._toElementType(c),a)};b.prototype.setNodeHighlightColor=function(b,c){b?(this._sc.setHighlightedInstanceFilter(3),b=this._toRgba(b,1),this._sc.setHiddenLineHighlightedInstanceFillColor(b),this._sc.setHighlightedInstanceColor(b)):this._sc.setHighlightedInstanceFilter(0);b=c?this._toRgba(c,1):[0,0,0,0];this._sc.setHiddenLineHighlightedInstanceOutlineColor(b);this._sc.setHighlightedInstanceOutlineColor(b)};
b.prototype.setElementHighlightColor=function(b,c){b?(this._sc.setHighlightedElementFilter(3),b=this._toRgba(b,1),this._sc.setHighlightedElementColor(b),this._sc.setHiddenLineHighlightedElementFillColor(b)):this._sc.setHighlightedElementFilter(0);b=c?this._toRgba(c,1):[0,0,0,0];this._sc.setHighlightedElementOutlineColor(b);this._sc.setHiddenLineHighlightedElementOutlineColor(b)};b.prototype.setHighlightColorizeCompression=function(b){this._sc.setHighlightColorizeCompression(b)};b.prototype.computeMinimumBodyBodyDistance=
function(b,c){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(f){switch(f.label){case 0:if(2!==b.length||2!==c.length)throw new d.CommunicatorError("Invalid instance inc.");return[4,this._sc.MeshInstance.computeMinimalBodyBodyDistance(b,c)];case 1:return a=f.sent(),[2,h.makeFaceFaceDistanceItem(a)]}})})};b.prototype.computeMininimumFaceFaceDistance=function(b,c,a,f){return __awaiter(this,void 0,void 0,function(){var k;return __generator(this,function(e){switch(e.label){case 0:if(2!==
b.length||2!==a.length)throw new d.CommunicatorError("Invalid instance inc.");return[4,this._sc.MeshInstance.computeMinimalFaceFaceDistance(b,c,a,f)];case 1:return k=e.sent(),[2,h.makeFaceFaceDistanceItem(k)]}})})};b.prototype.computeMinimumFaceRayDistance=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,k;return __generator(this,function(e){switch(e.label){case 0:if(2!==b.length)throw new d.CommunicatorError("Invalid instance inc.");f=h.toScRay(a);return[4,this._sc.MeshInstance.computeMinimalFaceRayDistance(b,
c,f)];case 1:return k=e.sent(),[2,h.makeFaceFaceDistanceItem(k)]}})})};b.prototype.computeMinimumFaceLineDistance=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,k;return __generator(this,function(e){switch(e.label){case 0:if(2!==b.length)throw new d.CommunicatorError("Invalid instance inc.");f=h.toScRay(a);return[4,this._sc.MeshInstance.computeMinimalFaceLineDistance(b,c,f)];case 1:return k=e.sent(),[2,h.makeFaceFaceDistanceItem(k)]}})})};b.prototype.pauseRendering=function(b){this._sc.suspendDrawing();
if("function"===typeof b)try{b()}finally{this._sc.resumeDrawing()}};b.prototype.resumeRendering=function(){this._sc.resumeDrawing()};b.prototype.beginRequestBatch=function(b){++this._requestBatchCountByType[b]};b.prototype.endRequestBatch=function(b){0<this._requestBatchCountByType[b]&&--this._requestBatchCountByType[b];this._flushBatchedRequests(b)};b.prototype._flushBatchedRequests=function(b){var c=this._pendingRequestsByType[b];this._pendingRequestsByType[b]=[];for(var a=[],f=0;f<c.length;f++)for(var k=
0,e=c[f].ids;k<e.length;k++)a.push(e[k]);switch(b){case 0:return this._flushBatchedMetaDataRequests(c,a);default:return d.Util.TypeAssert(b),console.assert(!1),Promise.resolve()}};b.prototype._flushBatchedMetaDataRequests=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,f,d,k,e,l,g,h,w;return __generator(this,function(n){switch(n.label){case 0:return[4,this._getDataFromIds(c)];case 1:a=n.sent();d=f=0;for(k=b;d<k.length;d++){e=k[d];l=[];g=e.ids.length/2;for(h=0;h<g;++h)w=a[f++],l.push(w);
e.promise.resolve(l)}console.assert(f===a.length);return[2]}})})};b.prototype.clearHighlight=function(){this._sc.unsetAllHighlighted();this._sc.unsetAllXRay()};b.prototype.resetColors=function(){this._sc.unsetAllColors()};b.prototype.resetOpacity=function(){this._sc.unsetAllOpacity()};b.prototype.setPartOpacity=function(b,c){var a=this;this.pauseRendering(function(){a._sc.MeshInstance.setOpacity(b,0,c);a._sc.MeshInstance.setOpacity(b,1,c)})};b.prototype.unsetPartOpacity=function(b){var c=this;this.pauseRendering(function(){c._sc.MeshInstance.unsetOpacity(b,
0);c._sc.MeshInstance.unsetOpacity(b,1)})};b.prototype.getPartOpacity=function(b){return this._sc.MeshInstance.getOpacity(b,0)};b.prototype.getEffectivePartOpacity=function(b,c){return this._sc.MeshInstance.getEffectiveOpacity(b,this._toElementType(c))};b.prototype.getPartHasTransparency=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,f,d,k;return __generator(this,function(e){switch(e.label){case 0:return c=[],c.push(this._sc.MeshInstance.hasTransparency(b,0)),c.push(this._sc.MeshInstance.hasTransparency(b,
1)),[4,Promise.all(c)];case 1:a=e.sent();f=a[0];d=a[1];for(k=0;k<f.length;++k)f[k]||(f[k]=d[k]);return[2,f]}})})};b.prototype.setPartColor=function(b,c,a){this._sc.MeshInstance.setColor(b,this._toElementType(c),a.getFloatArray())};b.prototype.unsetPartColor=function(b,c){this._sc.MeshInstance.unsetColor(b,this._toElementType(c))};b.prototype.getPartColor=function(b,c){return this._sc.MeshInstance.getColor(b,this._toElementType(c)).then(a)};b.prototype.getEffectivePartColor=function(b,c){return __awaiter(this,
void 0,void 0,function(){var f,d;return __generator(this,function(k){switch(k.label){case 0:return f=this._toElementType(c),[4,this._sc.MeshInstance.getEffectiveColor(b,f)];case 1:return d=k.sent(),[2,a(d)]}})})};b.prototype.setElementColor=function(b,c,a,f,d){this._sc.MeshInstance.setElementColor(b,this._toElementType(c),a,f,d.getFloatArray())};b.prototype.unsetElementColor=function(b,c,a,f){this._sc.MeshInstance.unsetElementColor(b,this._toElementType(c),a,f)};b.prototype.getElementColor=function(b,
c,f){return this._sc.MeshInstance.getElementColor(b,this._toElementType(c),f).then(a)};b.prototype.getEffectiveElementColor=function(b,c,f){return __awaiter(this,void 0,void 0,function(){var d,k;return __generator(this,function(e){switch(e.label){case 0:return d=this._toElementType(c),[4,this._sc.MeshInstance.getEffectiveElementColor(b,d,f)];case 1:return k=e.sent(),[2,a(k)]}})})};b.prototype.synchronizeVisibilities=function(b,c){0<b.length&&this._sc.MeshInstance.synchronizeVisibilities(b,c)};b.prototype.setPartVisibility=
function(b,c,a){0<b.length&&this._sc.MeshInstance.setVisible(b,c,a)};b.prototype.setElementVisibility=function(b,c,a,f,d){0<b.length&&this._sc.MeshInstance.setElementVisible(b,this._toElementType(c),a,f,d)};b.prototype.clearElementVisibility=function(b,c){0<b.length&&this._sc.MeshInstance.clearElementVisible(b,this._toElementType(c))};b.prototype.setVisibilityByAttachment=function(b,c){this._sc.setVisibilityByAttachment(b,c)};b.prototype.requestMeshInstances=function(b){this._sc.demandMeshInstances(b)};
b.prototype.getRendererType=function(){return this._rendererType};b.prototype._toMeshDataBuilder=function(b){for(var c=b._getFaceData(),a=b._getPointData(),f=b._getPolylineData(),k=new this._sc.MeshDataBuilder,e=0;e<c.length;e++){var g=c[e];k.addFace(g.vertexData,{normals:g.normalData,rgba32s:g.rgba32data,uvs:g.uvData,bits:g.bits})}for(c=0;c<a.length;c++)g=a[c],k.addPoints(g.vertexData,{rgba32s:g.rgba32data,bits:g.bits});for(a=0;a<f.length;a++)g=f[a],k.addPolyline(g.vertexData,{rgba32s:g.rgba32data,
bits:g.bits});switch(b.getFaceWinding()){case d.FaceWinding.Clockwise:f=1;break;case d.FaceWinding.CounterClockwise:f=2;break;default:f=0}g=b.getBackfacesEnabled()?4:0;b=b.isManifold()?65536:0;k.formatBits=k.formatBits|f|g|b;return k};b.prototype.createMesh=function(b){b=this._toMeshDataBuilder(b);return this._sc.MeshData.create(b)};b.prototype.replaceMesh=function(b,c){c=this._toMeshDataBuilder(c);return this._sc.MeshData.replace(b,c)};b.prototype.destroyMeshes=function(b){return this._sc.MeshData.destroy(b)};
b.prototype._toImageFormat=function(b){switch(b){case d.ImageFormat.Gray8:return 2;case d.ImageFormat.GrayAlpha16:return 3;case d.ImageFormat.Rgb24:return 1;case d.ImageFormat.Rgba32:return 0;case d.ImageFormat.Jpeg:return 4;case d.ImageFormat.Png:return 5}};b.prototype._validateImage=function(b){if(void 0===b.format)throw new d.ParseError("missing 'format' property");if(void 0===b.data)throw new d.ParseError("missing 'data' property");if((b.format===d.ImageFormat.Gray8||b.format===d.ImageFormat.GrayAlpha16||
b.format===d.ImageFormat.Rgb24||b.format===d.ImageFormat.Rgba32)&&(void 0===b.width||0>=b.width||void 0===b.height||0>=b.height))throw new d.ParseError("uncompressed format requested but missing width or height");};b.prototype.createImage=function(b,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){this._validateImage(b);return void 0!==c?(this._validateImage(c),[2,this._sc.Image.create(this._toImageFormat(b.format),b.data,b.width,b.height,this._toImageFormat(c.format),
c.data,c.width,c.height)]):[2,this._sc.Image.create(this._toImageFormat(b.format),b.data,b.width,b.height)]})})};b.prototype.destroyImages=function(b){return this._sc.Image.destroy(b)};b.prototype._toTextureTiling=function(b){switch(b){default:case d.TextureTiling.Repeat:return 0;case d.TextureTiling.Clamp:return 1}};b.prototype._toTextureInterpolation=function(b){return!1===b?1:0};b.prototype._toTextureMipMapping=function(b){return!1===b?1:0};b.prototype._toTextureParameterization=function(b){switch(b){default:case d.TextureParameterization.UV:return 0}};
b.prototype._toTextureModifier=function(b){switch(b){default:case 0:return 0;case d.TextureModifier.Decal:return 1}};b.prototype.setTexture=function(b,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){if(void 0===c.imageId)throw new d.ParseError("missing 'imageId' property");return[2,this._sc.MeshInstance.setTexture(b,0,c.imageId,void 0!==c.matrix?c.matrix.m:(new d.Matrix).m,this._toTextureTiling(c.tiling),this._toTextureInterpolation(c.interpolation),this._toTextureMipMapping(c.mipMapping),
this._toTextureParameterization(c.parameterization),this._toTextureModifier(c.modifiers))]})})};b.prototype.unsetTexture=function(b){this._sc.MeshInstance.unsetTexture(b,0)};b.prototype.createMatrix=function(b){return this._sc.Matrix.create(b)};b.prototype.createIdentityMatrix=function(){return this._sc.Matrix.create()};b.prototype.createMeshInstance=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,f,k,e,g,h,t,v,w;return __generator(this,function(l){switch(l.label){case 0:c=b.getMeshId();
if(null===c)throw new d.CommunicatorError("MeshId is not set");a=this._matrixCache.getIdentityInc();f=[];if(k=b.getMatrix())e=this.createMatrix(k.m).then(function(b){a=b}),f.push(e);g=new d.Color(255,0,0);h=this._toRgba(b.getFaceColor()||g,b.getOpacity());t=this._toRgba(b.getLineColor()||g,b.getLineOpacity());v=this._toRgba(b.getPointColor()||g,b.getPointOpacity());return[4,Promise.all(f)];case 1:return l.sent(),[4,this._sc.MeshInstance.create(c,a,h,t,v,b.getCreationFlags(),b.getOverlayIndex())];
case 2:return w=l.sent(),this._callbackManager.trigger("_geometryCreated",w),[2,w]}})})};b.prototype.destroyLocalInstances=function(b){return this._sc.MeshInstance.destroy(b)};b.prototype._fromScCamera=function(b){var c=d.Projection.Orthographic;0===b.projection()&&(c=d.Projection.Perspective);return d.Camera.create(d.Point3.createFromArray(b.position()),d.Point3.createFromArray(b.target()),d.Point3.createFromArray(b.upVector()),c,b.fieldWidth(),b.fieldHeight(),b.nearLimit())};b.prototype.getCameraPromise=
function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,this._sc.getCameraPromise()];case 1:return b=c.sent(),[2,this._fromScCamera(b)]}})})};b.prototype.getCamera=function(){var b=this._sc.getCamera();return this._fromScCamera(b)};b.prototype.resize=function(){this._sc.onResize();this._windowSize.set(this._canvasContainer.offsetWidth,this._canvasContainer.offsetHeight)};b.prototype.setFaceVisibility=function(b){this._sc.setFacesVisible(b)};
b.prototype.setLineVisibility=function(b){this._sc.setLinesVisible(b)};b.prototype.getCanvasSize=function(){return this._windowSize.copy()};b.prototype.setBackgroundGradient=function(b,c){this._sc.setBackgroundGradient(b?this._toRgba(b,1):[0,0,0,0],c?this._toRgba(c,1):[0,0,0,0])};b.prototype.setServerRenderQuality=function(b,c,a,f){this._sc.setSsrQuality({jpegQualityLow:b,jpegQualityHigh:c,scaleLow:a,scaleHigh:f})};b.prototype.setMinimumFramerate=function(b){this._sc.setMinFrameRate(b)};b.prototype.getMinimumFramerate=
function(){return this._sc.getMinFrameRate()};b.prototype.setBackFacesVisible=function(b){this._sc.setBackFacesVisible(b)};b.prototype.setDrawMode=function(b){this._sc.setDrawMode(b)};b.prototype.enableHiddenLineRendering=function(b){this.setDrawMode(2);this._sc.setHiddenLineVisibleLineColor(this._toRgba(b.getVisibleLineColor(),b.getVisibleLineOpacity()));this._sc.setHiddenLineHiddenLineColor(this._toRgba(b.getObscuredLineColor(),b.getObscuredLineOpacity()))};b.prototype.setAntiAliasingMode=function(b){switch(b){case d.AntiAliasingMode.None:this._sc.setAntiAliasingMode(0);
break;case d.AntiAliasingMode.SMAA:this._sc.setAntiAliasingMode(1)}};b.prototype.setInstanceModifier=function(b,c,a){switch(b){case d.InstanceModifier.DoNotCut:this._sc.MeshInstance.setDoNotCut(c,a);break;case d.InstanceModifier.DoNotExplode:this._sc.MeshInstance.setDoNotExplode(c,a);break;case d.InstanceModifier.DoNotSelect:this._sc.MeshInstance.setDoNotSelect(c,a);break;case d.InstanceModifier.SuppressCameraScale:this._sc.MeshInstance.setSuppressCameraScale(c,a);break;case d.InstanceModifier.OverrideSceneVisibility:this._sc.MeshInstance.setOverrideSceneVisibility(c,
a);break;case d.InstanceModifier.DoNotLight:this._sc.MeshInstance.setDoNotLight(c,a);break;case d.InstanceModifier.DoNotOutlineHighlight:this._sc.MeshInstance.setDoNotOutlineHighlight(c,a);break;case d.InstanceModifier.ExcludeBounding:this._sc.MeshInstance.setExcludeBounding(c,a);break;case d.InstanceModifier.DoNotUseVertexColors:this._sc.MeshInstance.setDoNotUseVertexColors(c,a);break;case d.InstanceModifier.AlwaysDraw:this._sc.MeshInstance.setAlwaysDraw(c,a);break;case d.InstanceModifier.DoNotXRay:this._sc.MeshInstance.setDoNotXRay(c,
a);break;case d.InstanceModifier.ScreenOriented:this._sc.MeshInstance.setScreenOriented(c,a);break;case d.InstanceModifier.ScreenSpace:this._sc.MeshInstance.setScreenSpace(c,a);break;case d.InstanceModifier.ScreenSpaceStretched:this._sc.MeshInstance.setScreenSpaceStretched(c,a)}};b.prototype.attachModel=function(b,c,a,f,d){return this._attachModels(b,[[c,a]],f,d)};b.prototype.attachScsModelByKey=function(b,c,a,f,d){console.assert(2===this._sessionType);return this._sc.attachScsModelByKey(b,a,c,f,
d)};b.prototype._attachModels=function(b,c,a,f){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return[4,this._sc.attachModels(b,c,a,f)];case 1:return d.sent(),this._callbackManager.trigger("_attached",b),[2]}})})};b.prototype.attachScsBuffer=function(b,c,a,f,d,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(k){switch(k.label){case 0:return[4,this._sc.attachScsBuffer(b,c,a,f,d,e)];case 1:return k.sent(),this._callbackManager.trigger("_attached",
b),[2]}})})};b.prototype.feedScsBuffer=function(b,c){this._sc.feedScsBuffer(b,c)};b.prototype._parseKeyInfo=function(b,c,a){if(b||c)return a;b=new Map;for(c=0;c<a.length;++c){for(var f=a[c++],d=[];c<a.length&&4294967295!==a[c];++c)d.push(a[c]);b.set(f,d)}return b};b.prototype.instanceKeyInfo=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,d,k;return __generator(this,function(e){switch(e.label){case 0:return f=1===c,d=1===a,[4,this._sc.meshInstanceKeyInfo(b,f,d)];case 1:return k=
e.sent(),[2,this._parseKeyInfo(f,d,k)]}})})};b.prototype.metaDataKeyInfo=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return[4,this._sc.metaDataKeyInfo(b,c,a)];case 1:return f=d.sent(),[2,this._parseKeyInfo(c,a,f)]}})})};b.prototype.modelKeysFromInclusionKeys=function(b){return this._sc.modelKeysFromInclusionKeys(b)};b.prototype.detachInclusions=function(b){return this._sc.detachInclusions(b)};b.prototype.resetToEmpty=
function(b,c){return __awaiter(this,void 0,void 0,function(){var a,f,d,k;return __generator(this,function(e){switch(e.label){case 0:for(a=0;a<this._requestBatchCountByType.length;++a){f=this._requestBatchCountByType[a]=0;for(d=this._pendingRequestsByType[a];f<d.length;f++)k=d[f],k.promise.reject(k.ids);this._pendingRequestsByType[a].length=0}return[4,this._sc.resetToEmpty(b,c)];case 1:return e.sent(),this.flushMetaDataCache(),[2]}})})};b.prototype.redraw=function(){this._sc.queueRedraw()};b.prototype.disconnectNetwork=
function(){this._sc.disconnectNetwork()};b.prototype.shutdown=function(){null!==this._cappingDelayTimeoutId&&(clearTimeout(this._cappingDelayTimeoutId),this._cappingDelayTimeoutId=null);this._sessionType=0;this._sc.shutDown()};b.prototype.getVersionString=function(){return this._sc.getStreamVersion().toString()};b.prototype.setAllowHighDpi=function(b){this._sc.allowHighDpi=b;this.resize()};b.prototype.getAllowHighDpi=function(){return this._sc.allowHighDpi};b.prototype.setMeshLevel=function(b,c){this._sc.MeshInstance.setMeshLevel(b,
c)};b.prototype.setMetallicRoughness=function(b,c,a){this._sc.MeshInstance.setMetallicRoughness(b,c,a)};b.prototype.setMetallicRoughnessMaterialOverride=function(b,c){this._sc.setMetallicRoughnessMaterialOverride(b,c)};b.prototype.unsetMetallicRoughness=function(b){this._sc.MeshInstance.unsetMetallicRoughness(b)};b.prototype.setOverlayVisibility=function(b,c){this._sc.Overlay.setVisible(b,c)};b.prototype.setOverlayCamera=function(b,c){c=this._toCamera(c);this._sc.Overlay.setCamera(b,c)};b.prototype.destroyOverlay=
function(b){this._sc.Overlay.destroy(b)};b.prototype._overlayUnit=function(b){switch(b){case d.OverlayUnit.ProportionOfCanvas:return 1;case d.OverlayUnit.ProportionOfOtherDimension:return 2;default:return 0}};b.prototype.getMaxOverlayIndex=function(){return this._sc.Overlay.maxIndex()};b.prototype._overlayAnchor=function(b){switch(b){case d.OverlayAnchor.BottomCenter:return 7;case d.OverlayAnchor.Center:return 8;case d.OverlayAnchor.LeftCenter:return 5;case d.OverlayAnchor.LowerLeftCorner:return 1;
case d.OverlayAnchor.LowerRightCorner:return 2;case d.OverlayAnchor.RightCenter:return 6;case d.OverlayAnchor.TopCenter:return 4;case d.OverlayAnchor.UpperRightCorner:return 3;default:return 0}};b.prototype.setOverlayViewport=function(b,c,a,f,d,e,g,h,t,v){this._sc.Overlay.setViewport(b,this._overlayAnchor(c),a,this._overlayUnit(f),d,this._overlayUnit(e),g,this._overlayUnit(h),t,this._overlayUnit(v))};b.prototype.addNodesToOverlay=function(b,c){this._sc.MeshInstance.setOverlayIndex(b,c)};b.prototype.getInstancesMeshData=
function(b){return this._sc.MeshInstance.getMeshData(b)};b.prototype.getMeshData=function(b){return this._sc.MeshData.getData(b)};b.prototype._toElementType=function(b){switch(b){case d.ElementType.Faces:return 0;case d.ElementType.Lines:return 1;case d.ElementType.Points:return 2}};b.prototype._toXRayGroup=function(b){switch(b){case d.XRayGroup.Selected:return 0;case d.XRayGroup.Unselected:return 1}};b.prototype.setXRayColor=function(b,c,a){this._sc.setXRayMaterial(this._toXRayGroup(b),this._toElementType(c),
this._toRgba(a,1))};b.prototype.unsetXRayColor=function(b,c){return this._sc.unsetXRayMaterial(this._toXRayGroup(b),this._toElementType(c))};b.prototype.setXRayOpacity=function(b,c){void 0!==c?this._sc.setXRayOpacity(this._toElementType(c),b):(this._sc.setXRayOpacity(0,b),this._sc.setXRayOpacity(1,b),this._sc.setXRayOpacity(2,b))};b.prototype._xRayTransparencyMode=function(b){switch(b){case d.XRayTransparencyMode.Unsorted:return 0;case d.XRayTransparencyMode.SingleLayer:return 1}};b.prototype.setXRayTransparencyMode=
function(b){this._sc.setXRayTransparencyMode(this._xRayTransparencyMode(b))};b.prototype.setGoochBlue=function(b){this._sc.setGoochBlue(b)};b.prototype.setGoochBaseColorProminence=function(b){this._sc.setGoochBaseColorProminence(b)};b.prototype.setGoochYellow=function(b){this._sc.setGoochYellow(b)};b.prototype.setGoochLuminanceShiftStrength=function(b){this._sc.setGoochLuminanceShiftStrength(b)};b.prototype.setToonShadingBandCount=function(b){this._sc.setToonBandCount(b)};b.prototype.setToonShadingSpecularFactor=
function(b){this._sc.setToonSpecularFactor(b)};b.prototype._transparencyMode=function(b){switch(b){case d.TransparencyMode.Unsorted:return 0;case d.TransparencyMode.SingleLayer:return 1}};b.prototype.setTransparencyMode=function(b){this._sc.setTransparencyMode(this._transparencyMode(b))};b.prototype._toPointSizeUnit=function(b){switch(b){case d.PointSizeUnit.ScreenPixels:return 0;case d.PointSizeUnit.CSSPixels:return 1;case d.PointSizeUnit.World:return 2;case d.PointSizeUnit.ProportionOfScreenWidth:return 3;
case d.PointSizeUnit.ProportionOfScreenHeight:return 4;case d.PointSizeUnit.ProportionOfBoundingDiagonal:return 5}};b.prototype._toPointShape=function(b){switch(b){case d.PointShape.Square:return 0;case d.PointShape.Disk:return 1;case d.PointShape.Sphere:return 2}};b.prototype._fromPointSizeUnit=function(b){switch(b){default:case 0:return d.PointSizeUnit.ScreenPixels;case 1:return d.PointSizeUnit.CSSPixels;case 2:return d.PointSizeUnit.World;case 3:return d.PointSizeUnit.ProportionOfScreenWidth;case 4:return d.PointSizeUnit.ProportionOfScreenHeight;
case 5:return d.PointSizeUnit.ProportionOfBoundingDiagonal}};b.prototype._fromPointShape=function(b){switch(b){default:case 0:return d.PointShape.Square;case 1:return d.PointShape.Disk;case 2:return d.PointShape.Sphere}};b.prototype.setPointSize=function(b,c){this._sc.setPointSize(b,this._toPointSizeUnit(c))};b.prototype.getPointSize=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,Promise.all([this._sc.getPointSize(),
this._sc.getPointSizeUnit()])];case 1:return b=c.sent(),[2,[b[0],this._fromPointSizeUnit(b[1])]]}})})};b.prototype.setPointShape=function(b){this._sc.setPointShape(this._toPointShape(b))};b.prototype.getPointShape=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return b=this._fromPointShape,[4,this._sc.getPointShape()];case 1:return[2,b.apply(this,[c.sent()])]}})})};b.prototype.setEyeDomeLightingEnabled=function(b){this._sc.setEyeDomeLightingEnabled(b)};
b.prototype.getEyeDomeLightingEnabled=function(){return this._sc.getEyeDomeLightingEnabled()};b.prototype.setEyeDomeLightingBlurSamples=function(b){this._sc.setEyeDomeLightingBlurSamples(b)};b.prototype.getEyeDomeLightingBlurSamples=function(){return this._sc.getEyeDomeLightingBlurSamples()};b.prototype.setEyeDomeLightingBlurInterval=function(b){this._sc.setEyeDomeLightingBlurInterval(b)};b.prototype.getEyeDomeLightingBlurInterval=function(){return this._sc.getEyeDomeLightingBlurInterval()};b.prototype.setEyeDomeLightingBlurEdgeDistance=
function(b){this._sc.setEyeDomeLightingBlurEdgeDistance(b)};b.prototype.getEyeDomeLightingBlurEdgeDistance=function(){return this._sc.getEyeDomeLightingBlurEdgeDistance()};b.prototype.setEyeDomeLightingShadingEdgeDistance=function(b){this._sc.setEyeDomeLightingShadingEdgeDistance(b)};b.prototype.getEyeDomeLightingShadingEdgeDistance=function(){return this._sc.getEyeDomeLightingShadingEdgeDistance()};b.prototype.setEyeDomeLightingOpacity=function(b){this._sc.setEyeDomeLightingOpacity(b)};b.prototype.getEyeDomeLightingOpacity=
function(){return this._sc.getEyeDomeLightingOpacity()};b.prototype.setDisplayIncompleteFrames=function(b){this._sc.setDisplayIncompleteFrames(b)};b.prototype.setInteractiveDrawDelay=function(b){this._sc.setPostInputDelay(b)};b.prototype.setInteractiveDrawLimitIncreaseEnabled=function(b){this._sc.setInteractiveDrawLimitIncreaseEnabled(b)};b.prototype.getInteractiveDrawLimitIncreaseEnabled=function(){return this._sc.getInteractiveDrawLimitIncreaseEnabled()};b.prototype._toCullingVectorSpace=function(b){switch(b){case d.CullingVectorSpace.Object:return 0;
case d.CullingVectorSpace.World:return 1}};b.prototype._fromCullingVectorSpace=function(b){switch(b){default:case 0:return d.CullingVectorSpace.Object;case 1:return d.CullingVectorSpace.World}};b.prototype.setCullingVector=function(b,c,a,f){this._sc.MeshInstance.setCullingVector(b,this._toCullingVectorSpace(c),[a.x,a.y,a.z],f)};b.prototype.unsetCullingVector=function(b){this._sc.MeshInstance.unsetCullingVector(b)};b.prototype.getCullingVector=function(b){return __awaiter(this,void 0,void 0,function(){var c,
a,f,k,e;return __generator(this,function(l){switch(l.label){case 0:return[4,this._sc.MeshInstance.getCullingVector(b)];case 1:c=l.sent();a=[];f=0;for(k=c;f<k.length;f++)e=k[f],0===e.vector[0]&&0===e.vector[1]&&0===e.vector[2]?a.push(null):a.push({space:this._fromCullingVectorSpace(e.space),vector:d.Point3.createFromArray(e.vector),toleranceDegrees:e.toleranceDegrees});return[2,a]}})})};b.prototype._setStreamCutoffScale=function(b){this._streamCutoffScale=Math.max(0,Math.min(b,2))};b.prototype.setStreamCutoffScale=
function(b){this._setStreamCutoffScale(b);this._sc.setStreamCutoffScale(this._streamCutoffScale)};b.prototype.getStreamCutoffScale=function(){return this._streamCutoffScale};b.prototype.loseWebGlContext=function(){return this._sc._loseWebGlContext()};b.prototype.triangulatePolygon=function(b,c){b=this._sc.triangulatePolygon(b,c);return new Float32Array(b)};b.prototype.debug_log=function(b){return this._sc.debug_log(b)};b.prototype.debug_stateFailure=function(b){return this._sc.debug_stateFailure(b)};
b.prototype.debug_sync=function(){return this._sc.debug_sync()};b.prototype._toLinePatternLengthUnit=function(b){switch(b){case d.LinePatternLengthUnit.Object:return 0;case d.LinePatternLengthUnit.World:return 1;case d.LinePatternLengthUnit.ProportionOfScreenWidth:return 2;case d.LinePatternLengthUnit.ProportionOfScreenHeight:return 3}};b.prototype.setLinePattern=function(b,c,a,f){this._sc.MeshInstance.setLinePattern(b,c,a,this._toLinePatternLengthUnit(f))};b.prototype.unsetLinePattern=function(b){this._sc.MeshInstance.unsetLinePattern(b)};
b.prototype.createFloorplanMesh=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){return[2,this._sc.createFloorplanMesh(b)]})})};b.prototype.exportToSvg=function(b){return __awaiter(this,void 0,void 0,function(){var c,a;return __generator(this,function(f){switch(f.label){case 0:return[4,this._sc.exportToSvg(b)];case 1:return c=f.sent(),a=c.map(function(b){return String.fromCharCode(b)}),[2,a.join("")]}})})};b.prototype.waitForImageDecoding=function(){return this._sc.waitForImageDecoding()};
b.prototype.registerBimInstances=function(b,c){return this._sc.registerBimInstances(b,c)};b.prototype.setAmbientLightColor=function(b){this._sc.setAmbientLightColor(this._toRgb(b))};b.prototype.clearLights=function(){this._sc.clearLights()};b.prototype._toLightType=function(b){switch(b){default:case d.LightType.Directional:return 0}};b.prototype._toLightSpace=function(b){switch(b){case d.LightSpace.World:return 0;default:case d.LightSpace.Camera:return 1}};b.prototype.addLight=function(b){return this._sc.addLight(this._toLightType(b.type),
this._toLightSpace(b.space),this._toVector3(b.position),this._toRgb(b.color))};b.prototype.removeLight=function(b){this._sc.removeLight(b)};b.prototype.updateLight=function(b,c){this._sc.updateLight(b,this._toLightType(c.type),this._toLightSpace(c.space),this._toVector3(c.position),this._toRgb(c.color))};b.prototype.setBloomEnabled=function(b){this._sc.setBloomEnabled(b)};b.prototype.setBloomThreshold=function(b){this._sc.setBloomThreshold(b)};b.prototype.setBloomThresholdRampWidth=function(b){this._sc.setBloomThresholdRampWidth(b)};
b.prototype.setBloomIntensityScale=function(b){this._sc.setBloomIntensityScale(b)};b.prototype._toBlurIntervalUnit=function(b){switch(b){default:case d.BlurIntervalUnit.Pixels:return 0;case d.BlurIntervalUnit.ProportionOfWidth:return 1;case d.BlurIntervalUnit.ProportionOfHeight:return 2}};b.prototype.setBloomLayers=function(b){for(var c=0;c<b.length;c++){var a=b[c];if(void 0!==a.blurInterval&&2!==a.blurInterval.length)throw new d.CommunicatorError("'blurInterval' must be an array containing a number followed by a BlurIntervalUnit");
}this._sc.suspendDrawing();this._sc.setBloomLayerCount(b.length);for(c=0;c<b.length;++c)a=b[c],void 0!==a.intensity&&this._sc.setBloomIntensity(c,a.intensity),void 0!==a.blurSamples&&this._sc.setBloomBlurSamples(c,a.blurSamples),void 0!==a.blurInterval&&this._sc.setBloomBlurInterval(c,a.blurInterval[0],this._toBlurIntervalUnit(a.blurInterval[1]));this._sc.resumeDrawing()};b.prototype.startComparison=function(b,c,a){var f=a&&a.sameColor?this._toRgb(a.sameColor):[0,0,0],d=a&&a.only1Color?this._toRgb(a.only1Color):
[1,0,0];a=a&&a.only2Color?this._toRgb(a.only2Color):[0,1,0];this._sc.setComparisonColors(f,d,a);this._sc.startComparison(b,c)};b.prototype.endComparison=function(){this._sc.endComparison()};b.prototype.setSimpleShadowColor=function(b){this._sc.setSimpleShadowColor(this._toRgb(b))};b.prototype.setSimpleShadowEnabled=function(b){this._sc.setSimpleShadowEnabled(b)};b.prototype.setSimpleShadowOpacity=function(b){this._sc.setSimpleShadowOpacity(b)};b.prototype.setGroundPlane=function(b,c){void 0!==c?this._sc.setGroundPlaneWithPosition(this._toVector3(b),
this._toVector3(c)):this._sc.setGroundPlane(this._toVector3(b))};b.prototype.setSimpleShadowResolution=function(b){this._sc.setSimpleShadowResolution(b)};b.prototype.setSimpleShadowBlurSamples=function(b){this._sc.setSimpleShadowBlurSamples(b)};b.prototype.setSimpleShadowBlurInterval=function(b){this._sc.setSimpleShadowBlurInterval(b)};b.prototype.setSimpleShadowInteractiveUpdateEnabled=function(b){void 0===b&&(b=!0);this._sc.setSimpleShadowInteractiveUpdateEnabled(b)};b.prototype.setSilhouetteColor=
function(b){this._sc.setSilhouetteColor(this._toRgb(b))};b.prototype.setSilhouetteEnabled=function(b){void 0===b&&(b=!0);this._sc.setSilhouetteEnabled(b)};b.prototype.setSilhouetteOpacity=function(b){this._sc.setSilhouetteOpacity(b)};b.prototype.setSilhouetteThreshold=function(b){this._sc.setSilhouetteThreshold(b)};b.prototype.setSilhouetteThresholdRampWidth=function(b){this._sc.setSilhouetteThresholdRampWidth(b)};b.prototype.setHardEdgeColor=function(b){this._sc.setHardEdgeColor(this._toRgb(b))};
b.prototype.setHardEdgesEnabled=function(b){void 0===b&&(b=!0);this._sc.setHardEdgesEnabled(b)};b.prototype.setHardEdgeOpacity=function(b){this._sc.setHardEdgeOpacity(b)};b.prototype.setHardEdgeThreshold=function(b){this._sc.setHardEdgeThreshold(b)};b.prototype.setHardEdgeThresholdRampWidth=function(b){this._sc.setHardEdgeThresholdRampWidth(b)};b.prototype.setSimpleReflectionEnabled=function(b){void 0===b&&(b=!0);this._sc.setSimpleReflectionEnabled(b)};b.prototype.setSimpleReflectionBlurInterval=
function(b,c){this._sc.setSimpleReflectionBlurInterval(b,this._toBlurIntervalUnit(c))};b.prototype.setSimpleReflectionBlurSamples=function(b){this._sc.setSimpleReflectionBlurSamples(b)};b.prototype.setSimpleReflectionFadeAngle=function(b){this._sc.setSimpleReflectionFadeAngle(b)};b.prototype.setSimpleReflectionOpacity=function(b){this._sc.setSimpleReflectionOpacity(b)};b.prototype.setSimpleReflectionAttenuation=function(b,c,a){void 0===a&&(a=d.SimpleReflectionAttenuationUnit.World);this._sc.setSimpleReflectionAttenuation(b,
c,a)};b.prototype.throttleLoad=function(b,c){this._sc.throttleLoad(b,c)};b.prototype._toVector3Array=function(b){for(var c=[],a=0;a<b.length;a++){var f=b[a];c.push([f.x,f.y,f.z])}return c};b.prototype.testPointVisibility=function(b){return this._sc.testPointVisibility(this._toVector3Array(b))};b.prototype.setPointVisibilityTest=function(b){this._sc.setPointVisibilityTest(this._toVector3Array(b))};b.prototype.setImageBasedLightingEnabled=function(b){this._sc.setImageBasedLightingEnabled(b)};b.prototype.setImageBasedLightingIntensity=
function(b){this._sc.setImageBasedLightingIntensity(b)};b.prototype._toMatrix9=function(b){return[b.m[0],b.m[1],b.m[2],b.m[4],b.m[5],b.m[6],b.m[8],b.m[9],b.m[10]]};b.prototype.setImageBasedLightingMatrix=function(b){this._sc.setImageBasedLightingMatrix(this._toMatrix9(b))};b.prototype.setImageBasedLightingEnvironment=function(b){this._sc.setImageBasedLightingEnvironment(b)};b.prototype.setImageBasedLightingEnvironmentToDefault=function(){this._sc.setImageBasedLightingEnvironmentToDefault()};b.prototype.setLineJitterEnabled=
function(b){this._sc.setLineJitterEnabled(b)};b.prototype.setLineJitterInstanceCount=function(b){this._sc.setLineJitterInstanceCount(b)};b.prototype.setLineJitterRadius=function(b){this._sc.setLineJitterRadius(b)};b.prototype.setLineJitterFrequency=function(b){this._sc.setLineJitterFrequency(b)};return b}();h.ScEngine=b})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function b(b,c,a,d,e,g,h){this._position=b.copy();this._normal=c.copy();this._elementIndex=a;this._elementBits=e;this._bounding=g.copy();this._overlayIndex=d;this._isProximityFace=h}b.prototype.isProximityFace=function(){return this._isProximityFace};b.prototype.isCappingGeometry=function(){return-1===this._elementIndex};b.prototype.toJson=function(){return this._toJson()};b.prototype._toJson=function(){return{position:this._position.toJson(),normal:this._normal.toJson(),
cadFaceIndex:this._elementIndex,cadFaceBits:this._elementBits,bounding:this._bounding.toJson(),overlayIndex:this._overlayIndex,isProximityFace:this._isProximityFace}};b.prototype.forJson=function(){return this.toJson()};b.fromJson=function(c){var a=d.Point3.fromJson(c.position),f=d.Point3.fromJson(c.normal),e=d.Box.fromJson(c.bounding);return new b(a,f,c.cadFaceIndex,c.overlayIndex,c.cadFaceBits,e,!0===c.isProximityFace)};b.construct=function(c){return b.fromJson(c)};b.prototype.getPosition=function(){return this._position.copy()};
b.prototype.getNormal=function(){return this._normal.copy()};b.prototype.getCadFaceIndex=function(){return this._elementIndex};b.prototype.getCadFaceBits=function(){return this._elementBits};b.prototype.getBounding=function(){return this._bounding.copy()};b.prototype.overlayIndex=function(){return this._overlayIndex};return b}();h.FaceEntity=g;var a=function(){function b(b,c,a,e,g,p,h){this._lineSegmentVertices=[];this._elementIndex=b;this._elementBits=h;this._position=c.copy();this._bounding=g.copy();
this._overlayIndex=p;if(a)for(0<=e&&(b=3*e,this._bestLineSegmentVertexIndex=new d.Point3(a[b],a[b+1],a[b+2])),this._lineSegmentVertices.push(new d.Point3(a[0],a[1],a[2])),b=3;b<a.length;b+=6)this._lineSegmentVertices.push(new d.Point3(a[b],a[b+1],a[b+2]))}b.prototype.isCappingGeometry=function(){return-1===this._elementIndex};b.prototype.toJson=function(){return this._toJson()};b.prototype._toJson=function(){for(var b=[],c=0,a=this._lineSegmentVertices;c<a.length;c++)b.push(a[c].toJson());return{lineId:this._elementIndex,
lineBits:this._elementBits,position:this._position.toJson(),linePoints:b,bounding:this._bounding.copy(),overlayIndex:this._overlayIndex}};b.prototype.forJson=function(){return this.toJson()};b.fromJson=function(c){var a=d.Point3.fromJson(c.position),f=d.Box.fromJson(c.bounding);a=new b(c.lineId,a,null,-1,f,c.overlayIndex,0);f=0;for(c=c.linePoints;f<c.length;f++){var e=d.Point3.fromJson(c[f]);a._lineSegmentVertices.push(e)}return a};b.construct=function(c){return b.fromJson(c)};b.prototype.getLineId=
function(){return this._elementIndex};b.prototype.getPosition=function(){return this._position.copy()};b.prototype.getPoints=function(){return this._lineSegmentVertices};b.prototype.getBestVertex=function(){return this._bestLineSegmentVertexIndex?this._bestLineSegmentVertexIndex.copy():null};b.prototype.getLineBits=function(){return this._elementBits};b.prototype.getBounding=function(){return this._bounding.copy()};b.prototype.overlayIndex=function(){return this._overlayIndex};return b}();h.LineEntity=
a;var e=function(){function b(b,c,a,d){this._position=b.copy();this._elementIndex=c;this._overlayIndex=a;this._elementBits=d}b.fromJson=function(c){var a=d.Point3.fromJson(c.position);return new b(a,c.pointId,c.pointBits,c.overlayIndex)};b.construct=function(c){return b.fromJson(c)};b.prototype.toJson=function(){return this._toJson()};b.prototype._toJson=function(){return{pointId:this._elementIndex,pointBits:this._elementBits,position:this._position.toJson(),overlayIndex:this._overlayIndex}};b.prototype.forJson=
function(){return this.toJson()};b.prototype.getPosition=function(){return this._position.copy()};b.prototype.getPointBits=function(){return this._elementBits};b.prototype.getPointId=function(){return this._elementIndex};b.prototype.overlayIndex=function(){return this._overlayIndex};return b}();h.PointEntity=e;var c=function(){return function(b){this._handle=b}}();h.IncrementalSelectionId=c;c=function(){function b(b,c,a,d,e){void 0===b&&(b=null);void 0===c&&(c=null);void 0===a&&(a=null);void 0===
d&&(d=null);void 0===e&&(e=null);this._nodeId=b;this._inclusionKey=c;this._faceEntity=a;this._lineEntity=d;this._pointEntity=e}b.create=function(c,a,d,e,g){return new b(c,a,d,e,g)};b.prototype.getSelectionType=function(){return null===this._nodeId?d.SelectionType.None:null!==this._faceEntity?d.SelectionType.Face:null!==this._lineEntity?d.SelectionType.Line:null!==this._pointEntity?d.SelectionType.Point:d.SelectionType.Part};b.prototype.toJson=function(){return this._toJson()};b.prototype._toJson=
function(){return{nodeId:this._nodeId,includeId:this._inclusionKey,faceEntity:this._faceEntity?this._faceEntity.toJson():null,lineEntity:this._lineEntity?this._lineEntity.toJson():null,pointEntity:this._pointEntity?this._pointEntity.toJson():null}};b.prototype.forJson=function(){return this.toJson()};b._fromJson=function(c){return new b(c.nodeId,c.includeId,c.faceEntity?g.fromJson(c.faceEntity):null,c.lineEntity?a.fromJson(c.lineEntity):null,c.pointEntity?e.fromJson(c.pointEntity):null)};b.prototype.getFaceEntity=
function(){return this._faceEntity};b.prototype.getLineEntity=function(){return this._lineEntity};b.prototype.getPointEntity=function(){return this._pointEntity};b.prototype.getNodeId=function(){return this._nodeId};b.prototype.getInclusionKey=function(){return this._inclusionKey};b.prototype.getIncludeId=function(){return this.getInclusionKey()};b.prototype.getPosition=function(){return null!==this._faceEntity?this._faceEntity.getPosition():null!==this._lineEntity?this._lineEntity.getPosition():
null!==this._pointEntity?this._pointEntity.getPosition():null};b.prototype.overlayIndex=function(){return this._faceEntity?this._faceEntity.overlayIndex():this._lineEntity?this._lineEntity.overlayIndex():this._pointEntity?this._pointEntity.overlayIndex():null};b.prototype._setNodeId=function(b){this._nodeId=b};b.prototype.equals=function(b){return this._nodeId!==b._nodeId||this.getSelectionType()!==b.getSelectionType()?!1:this._faceEntity&&b._faceEntity?this._faceEntity.getCadFaceIndex()===b._faceEntity.getCadFaceIndex():
this._lineEntity&&b._lineEntity?this._lineEntity.getLineId()===b._lineEntity.getLineId():this._pointEntity&&b._pointEntity?this._pointEntity.getPointId()===b._pointEntity.getPointId():!0};b.prototype._hash=function(b){var c=null!==this._nodeId?this._nodeId.toString(36):"";if(b)return c;c+=";"+this.getSelectionType()+";";this._faceEntity&&(c+=this._faceEntity.getCadFaceIndex().toString(36));c+=";";this._lineEntity&&(c+=this._lineEntity.getLineId().toString(36));c+=";";this._pointEntity&&(c+=this._pointEntity.getPointId().toString(36));
return c};b.prototype.isEntitySelection=function(){return null!==this._faceEntity||null!==this._lineEntity||null!==this._pointEntity};b.prototype.isNodeSelection=function(){return null!==this._nodeId};b.prototype.isNodeEntitySelection=function(){return null!==this._nodeId&&this.isEntitySelection()};b.prototype.isFaceSelection=function(){return null!==this._nodeId&&null!==this._faceEntity};b.prototype.isLineSelection=function(){return null!==this._nodeId&&null!==this._lineEntity};b.prototype.isPointSelection=
function(){return null!==this._nodeId&&null!==this._pointEntity};return b}();h.SelectionItem=c;c=function(){function b(b,c,a){this.faceItem=b;this.lineItem=c;this.pointItem=a}b.prototype.fetchMostRelevant=function(b){return null!==this.pointItem&&0!==(b&d.SelectionMask.Point)?this.pointItem:null!==this.lineItem&&0!==(b&d.SelectionMask.Line)?this.lineItem:null!==this.faceItem&&0!==(b&d.SelectionMask.Face)?this.faceItem:null};return b}();h.CompositeSelectionItem=c})(d.Selection||(d.Selection={}))})(Communicator||
(Communicator={}));(function(d){(function(d){d.sleep=function(d){return new Promise(function(a){setTimeout(a,d)})}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(h){h.hasBits=function(d,a){return(d&a)===a};h.setBit=function(d,a,e){return e?d|a:d&~a};h.classFromString=function(d){d=d.split(".");for(var a=window||this,e=0;e<d.length;e++){if(void 0===a)return null;a=a[d[e]]}return"function"!==typeof a?null:a};h.projectOnto=function(g,a){g=d.Point3.dot(a,g);var e=a.squaredLength();return d.Point3.scale(a,g/e)};h.majorAxis=function(g){var a=Math.abs(g.x),e=Math.abs(g.y);g=Math.abs(g.z);a=+a.toFixed(6);e=+e.toFixed(6);g=+g.toFixed(6);return a>
e&&a>g?new d.Point3(1,0,0):e>a&&e>g?new d.Point3(0,1,0):g>a&&g>e?new d.Point3(0,0,1):null};h.deepClone=function(d){return JSON.parse(JSON.stringify(d))};h.copyOwnProperties=function(d,a){for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(a[e]=d[e])};h.getWithDefault=function(d,a){return void 0===d?a:d};h.versionAtLeast=function(d,a){for(var e=d.length>a.length?d.length:a.length,c=0;c<e;++c){var b=d[c]||0,f=a[c]||0;if(b>f)break;else if(b<f)return!1}return!0};h.versionString=function(d){if(0===
d.length)return"";for(var a=""+d[0],e=1;e<d.length;++e)a+="."+d[e];return a};h.getCrypto=function(){return window.crypto||window.msCrypto}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){return function(a){this.futureItemHash=null;this.pastItemHash=a}}(),g=function(){function a(){this.part=this.point=this.line=this.face=this.none=0}a.prototype.update=function(c,b){switch(c.getSelectionType()){case d.SelectionType.None:0===b?--this.none:++this.none;break;case d.SelectionType.Face:0===b?--this.face:++this.face;break;case d.SelectionType.Line:0===b?--this.line:++this.line;break;case d.SelectionType.Point:0===b?--this.point:++this.point;break;case d.SelectionType.Part:0===
b?--this.part:++this.part}};a.prototype.sum=function(){return this.none+this.face+this.line+this.point+this.part};return a}(),a=function(){function a(c,b,a,e,l){var f=this;this._selectedItemsPruned=new Map;this._selectedItemsFull=new Map;this._selectedNodeCounts=new Map;this._temporalLinks=new Map;this._newestItemHash=this._oldestItemHash=null;this._selectedLayers=new Set;this._selectedTypes=new Set;this._nodeSelectionColor=new d.Color(255,255,0);this._nodeSelectionOutlineColor=new d.Color(255,255,
0);this._elementSelectionColor=d.Color.red();this._elementSelectionOutlineColor=d.Color.red();this._nodeElementHighlightMode=this._nodeHighlightMode=d.SelectionHighlightMode.HighlightAndOutline;this._ignoreEntityWhenTogglingChildSelection=this._pruneSelectionDescendants=this._selectParentIfSelected=this._highlightPointElementSelection=this._highlightLineElementSelection=this._highlightFaceElementSelection=this._highlightNodeSelection=!0;this._singleEntityToggleMode=!1;this._selectionFilter=null;this._incrementalBlacklistedInstanceNodes=
new Set;this._engine=b;this._view=a;this._model=e;this._modelStructure=l;this._callbackManager=c;this._callbackManager.bind({_subtreeLoaded:function(b){for(var c=0;c<b.length;c++)f._onSubtreeLoaded(b[c]);return Promise.resolve()}})}a.deprecated=function(c,b,a){var f=a.value;a.value=function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];this._callbackManager.trigger("deprecated","SelectionManager",b);return f.apply(this,c)};return a};a.prototype._init=function(){this._updateHighlightingMode();
this._engine.setHighlightColorizeCompression(.7)};a.prototype.setSelectionFilter=function(c){this._selectionFilter=c};a.prototype.getSelectionFilter=function(){return this._selectionFilter};a.prototype.setPruneSelectionDescendants=function(c){this._pruneSelectionDescendants=c;this.clear()};a.prototype.getPruneSelectionDescendants=function(){return this._pruneSelectionDescendants};a.prototype.setSelectParentIfSelected=function(c){this._selectParentIfSelected=c};a.prototype.getSelectParentIfSelected=
function(){return this._selectParentIfSelected};a.prototype.setIgnoreEntityWhenTogglingChildSelection=function(c){this._ignoreEntityWhenTogglingChildSelection=c};a.prototype.getIgnoreEntityWhenTogglingChildSelection=function(){return this._ignoreEntityWhenTogglingChildSelection};a.prototype.setSingleEntityToggleModeEnabled=function(c){this._singleEntityToggleMode=c;this.clear()};a.prototype.getSingleEntityToggleModeEnabled=function(){return this._singleEntityToggleMode};a.prototype.selectFromPoint=
function(c,b,a){void 0===a&&(a=d.SelectionMode.Set);return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return[4,this._view.pickFromPoint(c,b)];case 1:return f=d.sent(),this._onSelectionItem(f,a),[2]}})})};a.prototype.selectAllFromPoint=function(c,b,a){void 0===a&&(a=d.SelectionMode.Set);return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return[4,this._view.pickAllFromPoint(c,b)];
case 1:return f=d.sent(),this._onSelectionItems(f,a),[2]}})})};a.prototype.selectFromRay=function(c,b,a){void 0===a&&(a=d.SelectionMode.Set);return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return[4,this._view.pickFromRay(c,b)];case 1:return f=d.sent(),this._onSelectionItem(f,a),[2]}})})};a.prototype.selectAllFromRay=function(c,b,a){void 0===a&&(a=d.SelectionMode.Set);return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,
function(d){switch(d.label){case 0:return[4,this._view.pickAllFromRay(c,b)];case 1:return f=d.sent(),this._onSelectionItems(f,a),[2]}})})};a.prototype._onSelectionItem=function(c,b){c.isNodeEntitySelection()?this._processSelection(c,b):this._triggerNullSelection()};a.prototype._onSelectionItems=function(c,b){b===d.SelectionMode.Set&&this.clear(!1);if(0===c.length)this._triggerNullSelection();else switch(b){case d.SelectionMode.Add:case d.SelectionMode.Set:this.add(c);break;case d.SelectionMode.Toggle:for(b=
0;b<c.length;b++)this.toggle(c[b]);break;default:d.Util.TypeAssertNever(b)}};a.prototype.beginScreenSelectByArea=function(c,b,a){return this._view.beginScreenSelectByArea(c,b,a)};a.prototype.beginRayDrillSelection=function(c,b,a){return this._view.beginRayDrillSelection(c,b,a)};a.prototype.beginConvexPolyhedronSelection=function(c,b,a){return this._view.beginConvexPolyhedronSelection(c,b,a)};a.prototype.beginSphereSelection=function(c,b,a){return this._view.beginSphereSelection(c,b,a)};a.prototype.endIncrementalSelection=
function(c){this._callbackManager.trigger("incrementalSelectionEnd");this._view.endIncrementalSelection(c);return Promise.resolve()};a.prototype.endVolumeSelection=function(c){return this.endIncrementalSelection(c)};a.prototype.advanceIncrementalSelection=function(c,b){void 0===b&&(b=null);return __awaiter(this,void 0,void 0,function(){var a,d;return __generator(this,function(f){switch(f.label){case 0:return[4,this._view.advanceIncrementalSelection(c)];case 1:return a=f.sent(),null===a?[2,!1]:null===
b?[3,3]:[4,Promise.all(a.map(b))];case 2:d=f.sent(),a=a.filter(function(b,c){return d[c]}),f.label=3;case 3:return this.add(a),[2,!0]}})})};a.prototype.advanceVolumeSelection=function(c,b){void 0===b&&(b=null);return this.advanceIncrementalSelection(c,b)};a.prototype.isSelected=function(c){return this.contains(c)?!0:c.isNodeSelection()?null!==this._findAncestor(c):!1};a.prototype.contains=function(c){return this._selectedItemsPruned.has(c._hash(this._singleEntityToggleMode))};a.prototype.containsParent=
function(c){return this._findAncestor(c)};a.prototype._findAncestor=function(c){if(0<this._selectedItemsPruned.size)for(;;){c=this._model.getNodeParent(c.getNodeId());if(null===c)break;c=d.Selection.SelectionItem.create(c);var b=c._hash(this._singleEntityToggleMode);if(this._selectedItemsPruned.has(b))return c}return null};a.prototype.selectLayer=function(c,b){b===d.SelectionMode.Set&&this.clear();var a=[],e=this._model.getLayerIdsFromName(c);if(null!==e)for(var l=0;l<e.length;l++){var g=this._model.getNodesFromLayer(e[l],
!0);if(null!==g)for(var m=0;m<g.length;m++)a.push(d.Selection.SelectionItem.create(g[m]))}e=this._selectedLayers.has(c);b===d.SelectionMode.Toggle&&e?this.remove(a):(this.add(a),this._selectedLayers.add(c))};a.prototype.getSelectedLayers=function(){var c=[];this._selectedLayers.forEach(function(b){c.push(b)});return c};a.prototype.selectType=function(c,b){b===d.SelectionMode.Set&&this.clear();var a=[],e=this._model.getNodesByGenericType(c);null!==e&&e.forEach(function(b){a.push(d.Selection.SelectionItem.create(b))});
e=this._selectedTypes.has(c);if(b===d.SelectionMode.Toggle&&e)for(c=0;c<a.length;c++)this.remove(a[c]);else this.add(a),this._selectedTypes.add(c)};a.prototype.getSelectedTypes=function(){var c=[];this._selectedTypes.forEach(function(b){c.push(b)});return c};a.prototype.selectNode=function(c,b){void 0===b&&(b=d.SelectionMode.Set);if(null!==c&&this._modelStructure.isIdValid(c))return c=d.Selection.SelectionItem.create(c),this._processSelection(c,b),c.getSelectionType();this._processSelection(null,
b);return d.SelectionType.None};a.prototype._triggerNullSelection=function(){this._callbackManager.trigger("selectionArray",[],!1)};a.prototype._isInAxisOverlay=function(c){var b=c.getFaceEntity();return b||(b=c.getLineEntity())?1===b.overlayIndex():(c=c.getPointEntity())?1===c.overlayIndex():!1};a.prototype._getNodeCounts=function(c){c=c.getNodeId();var b=this._selectedNodeCounts.get(c);b||(b=new g,this._selectedNodeCounts.set(c,b));return b};a.prototype._addToFull=function(c,b){for(;this._selectedItemsFull.set(b,
c);){c=this._model.getNodeParent(c.getNodeId());if(null===c)break;c=d.Selection.SelectionItem.create(c);b=c._hash(this._singleEntityToggleMode)}};a.prototype._addItems=function(c){var b=c.length;if(0!==b){this._callbackManager.trigger("incrementalSelectionBatchBegin");for(var a=[],e=0;e<b;++e){var l=this._filterItem(c[e]);null!==l&&this._addImpl(l,l._hash(this._singleEntityToggleMode))&&(l=new d.Event.NodeSelectionEvent(l),a.push(l))}0===a.length?this._triggerNullSelection():this._callbackManager.trigger("selectionArray",
a,!1);this._callbackManager.trigger("incrementalSelectionBatchEnd")}};a.prototype._addItem=function(c){c=this._filterItem(c);null!==c&&this._addImpl(c,c._hash(this._singleEntityToggleMode))?(c=new d.Event.NodeSelectionEvent(c),this._callbackManager.trigger("selectionArray",[c],!1)):this._triggerNullSelection()};a.prototype.add=function(c){null===c?this._triggerNullSelection():Array.isArray(c)?this._addItems(c):this._addItem(c)};a.prototype._filterItem=function(c){if(null===this._selectionFilter)return c;
var b=c.getNodeId(),a=this._selectionFilter(b,this._model);return a===b?c:null===a?null:d.Selection.SelectionItem.create(a)};a.prototype._addImpl=function(c,b){if(c.getSelectionType()===d.SelectionType.None)return!1;if(this._isInAxisOverlay(c))return!0;if(this._selectedItemsPruned.has(b))return!1;if(this._pruneSelectionDescendants){if(null!==this._findAncestor(c))return!1;this._removeDescendants(c)}this._selectedItemsPruned.set(b,c);this._addToFull(c,b);this._getNodeCounts(c).update(c,1);var a=this._newestItemHash;
this._newestItemHash=b;this._oldestItemHash||(this._oldestItemHash=b);if(null!==a){var e=this._temporalLinks.get(a);e&&(e.futureItemHash=b)}a=new h(a);this._temporalLinks.set(b,a);this._updateItemHighlight(c,!0,!0);if(this._modelStructure.getType(c.getNodeId())===d.NodeType.Pmi&&(c=this._modelStructure.getPmiTopologyReferences(c.getNodeId()),null!==c))for(b=0;b<c.length;b++){e=c[b];a=e.body.getRuntimeId();for(var l=0,g=e.faceIds;l<g.length;l++)this._model.setNodeFaceHighlighted(a,g[l],!0);l=0;for(e=
e.edgeIds;l<e.length;l++)this._model.setNodeLineHighlighted(a,e[l],!0)}return!0};a.prototype._removeUpdateLayers=function(c){0<this._selectedLayers.size&&(c=c.getNodeId(),null!==c&&(c=this._model.getNodeLayerId(c),null!==c&&(c=this._model.getLayerName(c),null!==c&&this._selectedLayers.delete(c))))};a.prototype._removeUpdateTypes=function(c){0<this._selectedTypes.size&&(c=c.getNodeId(),null!==c&&(c=this._model.getNodeGenericType(c),null!==c&&this._selectedTypes.delete(c)))};a.prototype._removeFromFull=
function(c,b){this._removeUpdateLayers(c);this._removeUpdateTypes(c);if(this._selectedItemsFull.delete(b))for(b=0,c=this._model.getNodeChildren(c.getNodeId());b<c.length;b++){var a=d.Selection.SelectionItem.create(c[b]);this._removeFromFull(a,a._hash(this._singleEntityToggleMode))}};a.prototype._removeItems=function(c){var b=this,a=[];c.forEach(function(c){b._removeImpl(c,c._hash(b._singleEntityToggleMode))&&a.push(new d.Event.NodeSelectionEvent(c))});this._callbackManager.trigger("selectionArray",
a,!0)};a.prototype._removeItem=function(c){this._removeImpl(c,c._hash(this._singleEntityToggleMode))&&(c=new d.Event.NodeSelectionEvent(c),this._callbackManager.trigger("selectionArray",[c],!0))};a.prototype.remove=function(c){Array.isArray(c)?this._removeItems(c):this._removeItem(c)};a.prototype._removeImpl=function(c,b){if(this._singleEntityToggleMode){var a=this._selectedItemsPruned.get(b);a&&(c=a)}if(!this._selectedItemsPruned.delete(b))return!1;this._removeFromFull(c,b);a=this._getNodeCounts(c);
a.update(c,0);var d=this._temporalLinks.get(b);if(void 0!==d){this._temporalLinks.delete(b);if(null!==d.pastItemHash){var e=this._temporalLinks.get(d.pastItemHash);e&&(e.futureItemHash=d.futureItemHash)}null!==d.futureItemHash&&(e=this._temporalLinks.get(d.futureItemHash))&&(e.pastItemHash=d.pastItemHash);this._oldestItemHash===b&&(this._oldestItemHash=d.futureItemHash);this._newestItemHash===b&&(this._newestItemHash=d.pastItemHash)}b=!0;0===a.sum()&&(b=!1,a=c.getNodeId(),this._selectedNodeCounts.delete(a));
this._updateItemHighlight(c,b,!1);return!0};a._selectionItemIsFromModelBrowser=function(c){return null===c.getFaceEntity()&&null===c.getLineEntity()&&null===c.getPointEntity()};a.prototype.toggle=function(c){var b=this._findAncestor(c);null!==b?a._selectionItemIsFromModelBrowser(c)?this._removeImplicit(c,b):this._ignoreEntityWhenTogglingChildSelection||this._removeImplicit(d.Selection.SelectionItem.create(c.getNodeId()),b):(b=c._hash(this._singleEntityToggleMode),this._selectedItemsPruned.has(b)?
this._removeImpl(c,b)&&(c=new d.Event.NodeSelectionEvent(c),this._callbackManager.trigger("selectionArray",[c],!0)):(c=this._filterItem(c),null!==c&&this._addImpl(c,c._hash(this._singleEntityToggleMode))&&(c=new d.Event.NodeSelectionEvent(c),this._callbackManager.trigger("selectionArray",[c],!1))))};a.prototype.set=function(c){this.clear(!1);this.add(c)};a.prototype.getResults=function(){var c=[];this.each(function(b){c.push(b)});return c};a.prototype.getResult=function(c){var b=this.size();if(0>
c||c>=b)return null;b=b-c-1;return c<=b?this._getItemFromOldest(c):this._getItemFromNewest(b)};a.prototype._getItemFromOldest=function(c){for(var b=this._oldestItemHash;b;){if(0===c--)return this._selectedItemsPruned.get(b)||null;b=this._temporalLinks.get(b).futureItemHash}return null};a.prototype._getItemFromNewest=function(c){for(var b=this._newestItemHash;b;){if(0===c--)return this._selectedItemsPruned.get(b)||null;b=this._temporalLinks.get(b).pastItemHash}return null};a.prototype.getFirst=function(){return null!==
this._oldestItemHash?this._selectedItemsPruned.get(this._oldestItemHash)||null:null};a.prototype.getLast=function(){return null!==this._newestItemHash?this._selectedItemsPruned.get(this._newestItemHash)||null:null};a.prototype.size=function(){return this._selectedItemsPruned.size};a.prototype.each=function(c){for(var b=this._oldestItemHash;b;){var a=this._selectedItemsPruned.get(b);c(a);b=this._temporalLinks.get(b).futureItemHash}};a.prototype.clear=function(c){void 0===c&&(c=!0);this._selectedLayers.clear();
this._selectedTypes.clear();this._clearHighlight();this._selectedItemsPruned.clear();this._selectedItemsFull.clear();this._selectedNodeCounts.clear();this._temporalLinks.clear();this._newestItemHash=this._oldestItemHash=null;c&&this._triggerNullSelection()};a.prototype.setNodeSelectionColor=function(c){this._setNodeSelectionColor(c);return Promise.resolve()};a.prototype._setNodeSelectionColor=function(c){this._nodeSelectionColor.assign(c);this._updateHighlightingMode()};a.prototype.getNodeSelectionColor=
function(){return this._nodeSelectionColor.copy()};a.prototype.setNodeSelectionOutlineColor=function(c){this._setNodeSelectionOutlineColor(c);return Promise.resolve()};a.prototype._setNodeSelectionOutlineColor=function(c){this._nodeSelectionOutlineColor.assign(c);this._updateHighlightingMode()};a.prototype.getNodeSelectionOutlineColor=function(){return this._nodeSelectionOutlineColor.copy()};a.prototype.setNodeElementSelectionColor=function(c){this._setNodeElementSelectionColor(c);return Promise.resolve()};
a.prototype._setNodeElementSelectionColor=function(c){this._elementSelectionColor.assign(c);this._updateHighlightingMode()};a.prototype.getNodeElementSelectionColor=function(){return this._elementSelectionColor.copy()};a.prototype.setNodeElementSelectionOutlineColor=function(c){this._setNodeElementSelectionOutlineColor(c);return Promise.resolve()};a.prototype._setNodeElementSelectionOutlineColor=function(c){this._elementSelectionOutlineColor.assign(c);this._updateHighlightingMode()};a.prototype.getNodeElementSelectionOutlineColor=
function(){return this._elementSelectionOutlineColor.copy()};a.prototype.getHighlightFaceElementSelection=function(){return this._highlightFaceElementSelection};a.prototype.setHighlightFaceElementSelection=function(c){this._highlightFaceElementSelection=c;this._updateHighlight();return Promise.resolve()};a.prototype.setNodeSelectionHighlightMode=function(c){this._setNodeSelectionHighlightMode(c);return Promise.resolve()};a.prototype._setNodeSelectionHighlightMode=function(c){this._nodeHighlightMode=
c;this._updateHighlightingMode()};a.prototype.getNodeSelectionHighlightMode=function(){return this._nodeHighlightMode};a.prototype.setNodeElementSelectionHighlightMode=function(c){this._setNodeElementSelectionHighlightMode(c);return Promise.resolve()};a.prototype._setNodeElementSelectionHighlightMode=function(c){this._nodeElementHighlightMode=c;this._updateHighlightingMode()};a.prototype.getNodeElementSelectionHighlightMode=function(){return this._nodeElementHighlightMode};a.prototype.setHighlightNodeSelection=
function(c){this._highlightNodeSelection=c;this._updateHighlight();return Promise.resolve()};a.prototype.getHighlightNodeSelection=function(){return this._highlightNodeSelection};a.prototype.getHighlightLineElementSelection=function(){return this._highlightLineElementSelection};a.prototype.getHighlightPointElementSelection=function(){return this._highlightPointElementSelection};a.prototype.setHighlightLineElementSelection=function(c){this._highlightLineElementSelection=c;this._updateHighlight();return Promise.resolve()};
a.prototype.setHighlightPointElementSelection=function(c){this._highlightPointElementSelection=c;this._updateHighlight();return Promise.resolve()};a.prototype.setPickTolerance=function(c){this._engine.setPickTolerance(c)};a.prototype.getPickTolerance=function(){return this._engine.getPickTolerance()};a.prototype.exportSelectionData=function(){for(var c=[],b=0,a=this.getResults();b<a.length;b++)c.push(a[b].toJson());return c};a.prototype.loadSelectionData=function(c){this.clear(!1);if("string"===typeof c&&
(c=JSON.parse(c),!Array.isArray(c)))throw new d.ParseError("Expected JSON depicting an Array.");for(var b=[],a=0;a<c.length;a++){var e=d.Selection.SelectionItem._fromJson(c[a]);e.isNodeSelection()&&b.push(e)}this.add(b)};a.prototype._pathToParent=function(c,b){for(var a=[];!c.equals(b);){a.push(c);c=this._model.getNodeParent(c.getNodeId());if(null===c)break;c=d.Selection.SelectionItem.create(c)}return a};a.prototype._removeImplicit=function(c,b){for(var a=this._pathToParent(c,b),e=b;0<a.length;){this.remove(e);
b=[];var l=0;for(e=this._model.getNodeChildren(e.getNodeId());l<e.length;l++){var g=d.Selection.SelectionItem.create(e[l]);b.push(g)}this.add(b);e=a.pop()}console.assert(c===e);this.remove(c)};a.prototype._removeDescendants=function(c){var b=0;for(c=this._model.getNodeChildren(c.getNodeId());b<c.length;b++){var a=d.Selection.SelectionItem.create(c[b]);this._removeDescendantsRecursive(a)}};a.prototype._removeDescendantsRecursive=function(c){var b=c._hash(this._singleEntityToggleMode);if(this._selectedItemsFull.delete(b))for(this._removeImpl(c,
b),b=0,c=this._model.getNodeChildren(c.getNodeId());b<c.length;b++){var a=d.Selection.SelectionItem.create(c[b]);this._removeDescendantsRecursive(a)}};a.prototype._processSelection=function(c,b){switch(b){case d.SelectionMode.Add:this.add(c);break;case d.SelectionMode.Set:this.set(c);break;case d.SelectionMode.Toggle:null!==c&&this.toggle(c)}};a.prototype._clearHighlight=function(){0<this._selectedItemsPruned.size&&this._engine.clearHighlight()};a.prototype._updateHighlight=function(){var c=this;
this._clearHighlight();this._selectedItemsPruned.forEach(function(b){b&&c._updateItemHighlight(b,!0,!0)});this._highlightNodeSelection&&this._model.setNodesHighlighted([],!0)};a.prototype._updateItemHighlight=function(c,b,a){var f=c.getNodeId();this._highlightNodeSelection&&this._model.setNodesHighlighted([f],b);this._model.getNodeType(f)!==d.NodeType.Pmi&&(b=c.getFaceEntity(),this._highlightFaceElementSelection&&null!==b&&!b.isCappingGeometry()&&this._model.setNodeFaceHighlighted(f,b.getCadFaceIndex(),
a),b=c.getLineEntity(),this._highlightLineElementSelection&&null!==b&&!b.isCappingGeometry()&&this._model.setNodeLineHighlighted(f,b.getLineId(),a),c=c.getPointEntity(),this._highlightPointElementSelection&&null!==c&&this._model.setNodePointHighlighted(f,c.getPointId(),a))};a.prototype._updateHighlightingMode=function(){switch(this._nodeHighlightMode){case d.SelectionHighlightMode.HighlightOnly:this._engine.setNodeHighlightColor(this._nodeSelectionColor,null);break;case d.SelectionHighlightMode.OutlineOnly:this._engine.setNodeHighlightColor(null,
this._nodeSelectionOutlineColor);break;case d.SelectionHighlightMode.HighlightAndOutline:this._engine.setNodeHighlightColor(this._nodeSelectionColor,this._nodeSelectionOutlineColor)}switch(this._nodeElementHighlightMode){case d.SelectionHighlightMode.HighlightOnly:this._engine.setElementHighlightColor(this._elementSelectionColor,null);break;case d.SelectionHighlightMode.OutlineOnly:this._nodeHighlightMode===d.SelectionHighlightMode.OutlineOnly?this._engine.setElementHighlightColor(null,this._elementSelectionOutlineColor):
this._engine.setElementHighlightColor(this._nodeSelectionColor,this._elementSelectionOutlineColor);break;case d.SelectionHighlightMode.HighlightAndOutline:this._engine.setElementHighlightColor(this._elementSelectionColor,this._elementSelectionOutlineColor)}};a.prototype._onSubtreeLoaded=function(c){c=d.Selection.SelectionItem.create(c);if(this.isSelected(c))return this._updateItemHighlight(c,!0,!0)};a.ifcSelectionFilter=function(c,b){if(b.getNodeType(c)===d.NodeType.BodyInstance)for(var a=c;null!==
a;){if(null!==b.getNodeGenericId(a))return a;a=b.getNodeParent(a)}return c};__decorate([a.deprecated],a.prototype,"endVolumeSelection",null);__decorate([a.deprecated],a.prototype,"advanceVolumeSelection",null);return a}();d.SelectionManager=a})(Communicator||(Communicator={}));
(function(d){var h;(function(a){a[a.Background=0]="Background";a[a.Shadow=1]="Shadow";a[a.Selection=2]="Selection"})(h||(h={}));var g=function(){function a(a,c,b,f){var e=this;this._backgroundSheetMeshId=this._activeSheetId=null;this._sheetIds=[null,null,null];this._backgroundSelectionEnabled=this._backgroundSheetEnabled=!1;this._backgroundColor=new d.Color(180,180,180);this._sheetColor=d.Color.white();this._sheetShadowColor=new d.Color(75,75,75);this._viewer=a;this._engine=c;this._callbackManager=
b;var l=function(){return __awaiter(e,void 0,void 0,function(){var b,c;return __generator(this,function(a){switch(a.label){case 0:if(!this._viewer.model.isDrawing())return[2];b=this._viewer.sheetManager.getActiveSheetId();return null!=b?[3,4]:[4,this.deactivateSheets(!1)];case 1:return a.sent(),c=this.getSheetIds(),0===this.get3DNodes().length&&0<c.length?[4,this.setActiveSheetId(c[0],!0,!0)]:[3,3];case 2:a.sent(),a.label=3;case 3:return[3,6];case 4:return[4,this._activateSheetId(b,!0,!0)];case 5:a.sent(),
a.label=6;case 6:return[2]}})})};this._viewer.setCallbacks({_modelStructureHeaderParsed:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(b){return this._viewer.model.isDrawing()&&!f?[2,this.setBackgroundSheetEnabled(!0)]:[2]})})},_firstModelLoaded:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,l()];case 1:return b.sent(),[2]}})})},_resetAssemblyTreeBegin:function(){return __awaiter(e,
void 0,void 0,function(){var b,c;return __generator(this,function(a){switch(a.label){case 0:return[4,this.setBackgroundSheetEnabled(!1)];case 1:return a.sent(),[4,this.setBackgroundSelectionEnabled(!1)];case 2:return a.sent(),this._backgroundSheetMeshId=this._activeSheetId=null,b=this._viewer.view,c=b.getBackgroundColor(),b.setBackgroundColor(c.top,c.bottom),[2]}})})},_resetDrawing:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,
l()];case 1:return b.sent(),[2]}})})}})}a.prototype.getSheetIds=function(){var a=this._viewer.model,c=a.getAbsoluteRootNode();c=a.getNodeChildren(c);var b=a.getNodeChildren(c[0]);c=[];var f=0;for(b=a.getNodeChildren(b[0]);f<b.length;f++){var k=b[f];a.getNodeType(k)===d.NodeType.DrawingSheet&&c.push(k)}return c};a.prototype.get3DNodes=function(){var a=this._viewer.model,c=a.getAbsoluteRootNode();c=a.getNodeChildren(c);var b=a.getNodeChildren(c[0]);c=[];var f=0;for(b=a.getNodeChildren(b[0]);f<b.length;f++){var k=
b[f];a.getNodeType(k)!==d.NodeType.DrawingSheet&&c.push(k)}return c};a.prototype.deactivateSheets=function(a){void 0===a&&(a=!0);return __awaiter(this,void 0,void 0,function(){var c,b,f,d;return __generator(this,function(e){switch(e.label){case 0:return this._activeSheetId=null,this._viewer.pauseRendering(),c=this.get3DNodes(),b=0<c.length,[4,this._viewer.view.isolateNodes(c,0,b)];case 1:return e.sent(),[4,this._refreshBackgroundSheets()];case 2:return e.sent(),f=this._viewer.view,d=f.getBackgroundColor(),
f.setBackgroundColor(d.top,d.bottom),this._viewer.resumeRendering(),a&&this._callbackManager.trigger("sheetDeactivated"),[2]}})})};a.prototype.setActiveSheetId=function(a,c,b){void 0===c&&(c=!0);void 0===b&&(b=!0);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){switch(f.label){case 0:if(this._activeSheetId===a)return[2];this._activeSheetId=a;return[4,this._activateSheetId(a,c,b)];case 1:return f.sent(),[2]}})})};a.prototype._activateSheetId=function(a,c,b){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(f){switch(f.label){case 0:return[4,this._markupManager._setActiveMarkupView(null)];case 1:f.sent();if(!c)return[3,4];this._viewer.pauseRendering();return[4,this._viewer.view.isolateNodes([a],0,b)];case 2:return f.sent(),[4,this._refreshBackgroundSheets()];case 3:f.sent(),this._viewer.resumeRendering(),f.label=4;case 4:return this._callbackManager.trigger("sheetActivated",this._activeSheetId),[2]}})})};a.prototype.getActiveSheetId=function(){return this._activeSheetId};
a.prototype.isDrawingSheetActive=function(){return this._viewer.model.isDrawing()&&null!==this._activeSheetId};a.prototype.setMarkupManager=function(a){this._markupManager=a};a.prototype._createBackgroundSheetMesh=function(){return __awaiter(this,void 0,void 0,function(){var a,c,b;return __generator(this,function(f){a=[0,0,0,1,0,0,0,1,0,0,1,0,1,0,0,1,1,0];c=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1];b=new d.MeshData;b.addFaces(a,c);b.setBackfacesEnabled(!0);return[2,this._viewer.model.createMesh(b)]})})};
a.prototype._createBackgroundSheetMatrix=function(a,c){var b=a.min,f=a.max,e=this._viewer.view.getCamera();a=e.getPosition();var l=e.getTarget(),g=d.Point3.subtract(l,a);a=f.x-b.x;l=f.y-b.y;var m=Math.max(.1*a,.1*(f.z-b.z)),p=b.x+.5*a,h=b.y+.5*l,r=Math.max(.05*a,.05*l);a+=r;l+=r;p-=.5*a;h-=.5*l;b=0<g.z?f.z+m:b.z-m;c&&(c=e.getUp(),e=.3*r,p+=e,0<c.y&&(e=-e),h+=e,b+=0<g.z?m:-m);c=new d.Matrix;c.setTranslationComponent(p,h,b);c.setScaleComponent(a,l,1);return c};a.prototype._createBackgroundSheetInstance=
function(a,c,b,f,k,l){return __awaiter(this,void 0,void 0,function(){var e,g,p;return __generator(this,function(n){switch(n.label){case 0:return e=d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.OverrideSceneVisibility|d.MeshInstanceCreationFlags.DoNotLight|d.MeshInstanceCreationFlags.DoNotOutlineHighlight|d.MeshInstanceCreationFlags.AlwaysDraw|d.MeshInstanceCreationFlags.ExcludeBounding,l||(e|=d.MeshInstanceCreationFlags.DoNotSelect),g=new d.MeshInstanceData(a,
b,c,f,null,null,e),[4,this._viewer.model.createMeshInstance(g,null,!1,!0)];case 1:return p=n.sent(),this._viewer.model.setNodesOpacity([p],k),[2,p]}})})};a.prototype._deleteBackgroundSheetInstances=function(a){void 0===a&&(a=[h.Background,h.Selection,h.Shadow]);return __awaiter(this,void 0,void 0,function(){var c,b,f,d,e;return __generator(this,function(k){c=[];b=0;for(f=a;b<f.length;b++)d=f[b],e=this._sheetIds[d],null!==e&&(this._sheetIds[d]=null,c.push(e));return 0<c.length?[2,this._viewer.model.deleteMeshInstances(c)]:
[2]})})};a.prototype._createOrUpdateSheet=function(a,c,b,f,k,l){return __awaiter(this,void 0,void 0,function(){var e,g,p,h;return __generator(this,function(n){switch(n.label){case 0:e=this._viewer.model;if(null!==this._sheetIds[a])return[3,2];g=this._sheetIds;p=a;return[4,this._createBackgroundSheetInstance(this._backgroundSheetMeshId,c,b,f,k,l)];case 1:return g[p]=n.sent(),[2,Promise.resolve()];case 2:return h=this._sheetIds[a],e.setNodesFaceColor([h],f),e.setNodesOpacity([h],k),null!==l&&e.setInstanceModifier(d.InstanceModifier.DoNotSelect,
[h],!l),[2,e.setNodeMatrix(h,b,!0)]}})})};a.prototype._refreshBackgroundSheets=function(){return __awaiter(this,void 0,void 0,function(){var a,c,b,f,k,l;return __generator(this,function(e){switch(e.label){case 0:a=this._viewer.model;if(!this.isDrawingSheetActive())return this._backgroundSelectionEnabled=!1,[2,this._deleteBackgroundSheetInstances()];if(null!==this._backgroundSheetMeshId)return[3,2];c=this;return[4,this._createBackgroundSheetMesh()];case 1:c._backgroundSheetMeshId=e.sent(),e.label=
2;case 2:return[4,a.getModelBounding(!0,!1)];case 3:return b=e.sent(),f=this._createBackgroundSheetMatrix(b,!1),k=[],this._backgroundSelectionEnabled?[4,this._createOrUpdateSheet(h.Selection,"2d_drawing_background_selection_sheet",f,d.Color.black(),0,!0)]:[3,5];case 4:return e.sent(),[3,6];case 5:k.push(h.Selection),e.label=6;case 6:this._engine.setBackgroundGradient(this._backgroundColor,this._backgroundColor);if(!this._backgroundSheetEnabled)return[3,9];l=this._createBackgroundSheetMatrix(b,!0);
return[4,this._createOrUpdateSheet(h.Background,"2d_drawing_background_sheet",f,this._sheetColor,1,!1)];case 7:return e.sent(),[4,this._createOrUpdateSheet(h.Shadow,"2d_drawing_background_shadow_sheet",l,this._sheetShadowColor,1,!1)];case 8:return e.sent(),[3,10];case 9:k.push(h.Background,h.Shadow),e.label=10;case 10:return 0<k.length?[2,this._deleteBackgroundSheetInstances(k)]:[2]}})})};a.prototype.setSheetColors=function(a,c,b){this._backgroundColor=a.copy();this._sheetColor=c.copy();this._sheetShadowColor=
b.copy();return this._refreshBackgroundSheets()};a.prototype.getSheetBackgroundColor=function(){return this._backgroundColor};a.prototype.getSheetColor=function(){return this._sheetColor};a.prototype.getSheetShadowColor=function(){return this._sheetShadowColor};a.prototype.setBackgroundSheetEnabled=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:if(a===this._backgroundSheetEnabled)return[2];this._backgroundSheetEnabled=a;this._viewer.pauseRendering();
return[4,this._refreshBackgroundSheets()];case 1:return c.sent(),this._viewer.resumeRendering(),[2]}})})};a.prototype.getBackgroundSheetEnabled=function(){return this._backgroundSheetEnabled};a.prototype.setBackgroundSelectionEnabled=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:this.isDrawingSheetActive()||(a=!1);if(a===this._backgroundSelectionEnabled)return[2];this._backgroundSelectionEnabled=a;this._viewer.pauseRendering();
return[4,this._refreshBackgroundSheets()];case 1:return c.sent(),this._viewer.resumeRendering(),[2]}})})};a.prototype.getBackgroundSelectionEnabled=function(){return this._backgroundSelectionEnabled};a.prototype.startComparison=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return f=this._viewer.view,f.startComparison([a],[c],b),[4,this.setActiveSheetId(a,!1,!1)];case 1:return d.sent(),[4,f.isolateNodes([a,c],0,!0)];
case 2:return d.sent(),[4,this._refreshBackgroundSheets()];case 3:return d.sent(),[2]}})})};a.prototype.endComparison=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return null===this._activeSheetId?[2]:[4,this.setActiveSheetId(this._activeSheetId,!0,!1)];case 1:return a.sent(),this._viewer.view.endComparison(),[2]}})})};return a}();d.SheetManager=g})(Communicator||(Communicator={}));
(function(d){var h;(function(a){a[a.Model=1]="Model";a[a.Svg=2]="Svg";a[a.Html=4]="Html";a[a.All=7]="All"})(h=d.SnapshotLayer||(d.SnapshotLayer={}));var g=function(){return function(a,d,c){void 0===a&&(a=0);void 0===d&&(d=0);void 0===c&&(c=h.All);this.width=a;this.height=d;this.layers=c}}();d.SnapshotConfig=g})(Communicator||(Communicator={}));
(function(d){(function(h){function g(b){var c=document.createElement("canvas");c.width=b.width;c.height=b.height;c.getContext("2d").drawImage(b,0,0);return c}function a(b){if(b instanceof HTMLCanvasElement&&0<b.clientWidth&&0<b.clientHeight)return b;for(var c=0;c<b.childNodes.length;c++){var d=b.childNodes.item(c);if(d=a(d))return d}return null}function e(b,c){var a=b.getContext("2d");if(null===a)throw new d.CommunicatorError("failed to create 2D canvas context");for(var f=0;f<c.length;f++)a.drawImage(c[f],
0,0);var e=h.OpenPromise.create(),g=new Image;g.src=b.toDataURL();g.onload=function(){e.resolve(g)};return e}var c=function(){function b(b,c){this._domElements=b;this._config=c}b.prototype._extractMarkupSvgAsCanvas=function(){var b=this._domElements.getMarkupSvgElement(),c=(new XMLSerializer).serializeToString(b);b=c;var a=(new DOMParser).parseFromString(b,"text/xml");c=a.getElementsByTagName("defs");for(var d=[],e=0;e<c.length;e++)for(var p=c.item(e).getElementsByTagName("marker"),h=0;h<p.length;h++){var r=
p.item(h);d.push(r)}c=[];p=a.getElementsByTagName("line");for(e=0;e<p.length;e++)if(a=p.item(e),null!==a.style.marker&&0<a.style.marker.length){h=a.style.marker.indexOf("#")+1;r=a.style.marker.indexOf('"',h+1);r=a.style.marker.substring(h,r);var u=null,t=null;for(h=0;h<d.length;h++)if(d[h].id===r){u=d[h];t=d[h+1];break}c.push({line:a,start:u,end:t})}for(d=b.indexOf("marker: url");0<=d;){e=b.indexOf(")",d)+1;a=b.substring(d,e);h=a.indexOf("#")+1;p=a.indexOf('"',h);r=a.indexOf("&quot",h+11+1);u=p;if(0>
p||r<p)u=r;h=a.substring(h,u);p=0;for(r=c;p<r.length;p++)if(a=r[p],u=a.start,a=a.end,null!==u&&null!==a&&u.id===h){h="marker-start: url('#"+u.id+"');";h+="marker-end: url('#"+a.id+"')";b=b.slice(0,d)+h+b.slice(e);break}d=b.indexOf("marker: url",e+1)}c=b;b=document.createElement("canvas");document.body.appendChild(b);canvg(b,c);c=g(b);document.body.removeChild(b);return c};b.prototype._extractRedlineSvgAsCanvas=function(b,c){var a=this._domElements.getRedlineSvgElement();a.setAttribute("width",""+
b);a.setAttribute("height",""+c);a=(new XMLSerializer).serializeToString(a);a=a.replace("width: 100%;","width: "+b+";");a=a.replace("height: 100%;","height: "+c+";");b=document.createElement("canvas");document.body.appendChild(b);canvg(b,a);c=g(b);document.body.removeChild(b);return c};b.prototype._extractRedlineAsCanvas=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){b=this._domElements.getRedlineElement();return[2,html2canvas(b,{background:void 0})]})})};
b.prototype.capture=function(b){return __awaiter(this,void 0,void 0,function(){var c,f,n,m,p;return __generator(this,function(k){switch(k.label){case 0:c=a(b);if(null===c)throw new d.CommunicatorError("failed to find canvas");f=document.createElement("canvas");f.width=this._config.width||b.clientWidth;f.height=this._config.height||b.clientHeight;f.style.width="100%";f.style.height="100%";n=[];this._config.layers&d.SnapshotLayer.Model&&n.push(g(c));this._config.layers&d.SnapshotLayer.Svg&&(n.push(this._extractMarkupSvgAsCanvas()),
n.push(this._extractRedlineSvgAsCanvas(f.width,f.height)));if(!(this._config.layers&d.SnapshotLayer.Html))return[3,2];p=(m=n).push;return[4,this._extractRedlineAsCanvas()];case 1:p.apply(m,[k.sent()]),k.label=2;case 2:return[2,e(f,n)]}})})};return b}();h.Snapshot=c})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function b(){this._strokeWidth=1;this._strokeColor=d.Color.black()}b.prototype._assign=function(b){this._strokeWidth=b._strokeWidth;this._strokeColor.assign(b._strokeColor)};b.prototype.setStrokeColor=function(b){this._strokeColor.assign(b)};b.prototype.getStrokeColor=function(){return this._strokeColor.copy()};b.prototype.setStrokeWidth=function(b){this._strokeWidth=b};b.prototype.getStrokeWidth=function(){return this._strokeWidth};return b}();
g.StrokedShape=a;var e=function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;c._fillColor=d.Color.black();c._fillOpacity=1;return c}__extends(c,b);c.prototype._assign=function(c){b.prototype._assign.call(this,c);this._fillColor.assign(c._fillColor);this._fillOpacity=c._fillOpacity};c.prototype.getFillOpacity=function(){return this._fillOpacity};c.prototype.setFillOpacity=function(b){this._fillOpacity=b};c.prototype.setFillColor=function(b){this._fillColor.assign(b)};c.prototype.getFillColor=
function(){return this._fillColor.copy()};return c}(a);g.FilledShape=e;var c;(function(b){b[b.None=0]="None";b[b.Arrowhead=1]="Arrowhead";b[b.Circle=2]="Circle"})(c=g.EndcapType||(g.EndcapType={}));a=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a._startEndcapType=c.None;a._startEndcapColor=d.Color.black();a._startEndcapSize=9;a._endEndcapType=c.None;a._endEndcapColor=d.Color.black();a._endEndcapSize=9;a._endcapsInverted=!1;return a}__extends(a,b);a.prototype._assign=function(c){b.prototype._assign.call(this,
c);this._startEndcapType=c._startEndcapType;this._startEndcapColor.assign(c._startEndcapColor);this._startEndcapSize=c._startEndcapSize;this._endEndcapType=c._endEndcapType;this._endEndcapColor.assign(c._endEndcapColor);this._endEndcapSize=c._endEndcapSize;this._endcapsInverted=c._endcapsInverted};a.prototype.getStartEndcapType=function(){return this._startEndcapType};a.prototype.setStartEndcapType=function(b){this._startEndcapType=b};a.prototype.getStartEndcapColor=function(){return this._startEndcapColor.copy()};
a.prototype.setStartEndcapColor=function(b){this._startEndcapColor.assign(b)};a.prototype.getStartEndcapSize=function(){return this._startEndcapSize};a.prototype.setStartEndcapSize=function(b){this._startEndcapSize=b};a.prototype.getEndEndcapType=function(){return this._endEndcapType};a.prototype.setEndEndcapType=function(b){this._endEndcapType=b};a.prototype.setEndcapType=function(b){this._endEndcapType=this._startEndcapType=b};a.prototype.getEndEndcapSize=function(){return this._endEndcapSize};
a.prototype.setEndEndcapSize=function(b){this._endEndcapSize=b};a.prototype.getEndEndcapColor=function(){return this._endEndcapColor.copy()};a.prototype.setEndEndcapColor=function(b){this._endEndcapColor.assign(b)};a.prototype.getEndcapsInverted=function(){return this._endcapsInverted};a.prototype.setEndcapsInverted=function(b){this._endcapsInverted=b};return a}(a);g.EndcapShape=a})(h.Shape||(h.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;c._borderRadius=0;return c}__extends(c,b);c.prototype._assign=function(c){b.prototype._assign.call(this,c);this._borderRadius=c._borderRadius};c.prototype.getBorderRadius=function(){return this._borderRadius};c.prototype.setBorderRadius=function(b){this._borderRadius=b};return c}(g.FilledShape);g.RectangleBase=a;var e=function(b){function c(c,a){var f=b.call(this)||this;f._position=
d.Point2.zero();f._size=d.Point2.zero();c&&f._position.assign(c);a&&f._size.assign(a);return f}__extends(c,b);c.prototype._assign=function(c){b.prototype._assign.call(this,c);this._position.assign(c._position);this._size.assign(c._size)};c.prototype.setPosition=function(b){this._position.assign(b)};c.prototype.getPosition=function(){return this._position.copy()};c.prototype.setSize=function(b){this._size.assign(b)};c.prototype.getSize=function(){return this._size.copy()};return c}(a);g.Rectangle=
e;var c=function(){return function(b,c){this.position=b.copy();this.size=c.copy()}}();g._MarkupRectangleData=c;a=function(b){function a(){var c=null!==b&&b.apply(this,arguments)||this;c._rectangles=[];return c}__extends(a,b);a.prototype.clear=function(){this._rectangles=[]};a.prototype.addRectangle=function(b,a){this._rectangles.push(new c(b,a))};a.prototype.getRectangles=function(){return this._rectangles};return a}(a);g.RectangleCollection=a})(h.Shape||(h.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||
(Communicator={}));
(function(d){(function(h){(function(g){var a=function(b){function c(){var c=b.call(this)||this;c._fontFamily=null;c._fontSize=12;c.setStrokeWidth(0);return c}__extends(c,b);c.prototype._assign=function(c){b.prototype._assign.call(this,c);this._fontFamily=c._fontFamily;this._fontSize=c._fontSize};c.prototype.getFontFamily=function(){return this._fontFamily};c.prototype.setFontFamily=function(b){this._fontFamily=b};c.prototype.setFontSize=function(b){this._fontSize=b};c.prototype.getFontSize=function(){return this._fontSize};
return c}(g.FilledShape);g.TextMarkupBase=a;var e=function(b){function c(c,a){var f=b.call(this)||this;f._position=d.Point2.zero();f._text="";a&&(f._position=a.copy());c&&f.setText(c);return f}__extends(c,b);c.prototype._assign=function(c){b.prototype._assign.call(this,c);this._text=c._text;this._position.assign(c._position)};c.prototype.setPosition=function(b){this._position.assign(b)};c.prototype.getPosition=function(){return this._position};c.prototype.setText=function(b){this._text=b};c.prototype.getText=
function(){return this._text};return c}(a);g.Text=e;var c=function(){return function(b,c){this.text=b;this.position=c.copy()}}();g._MarkupTextData=c;a=function(b){function a(){var c=null!==b&&b.apply(this,arguments)||this;c._textStrings=[];return c}__extends(a,b);a.prototype.clear=function(){this._textStrings=[]};a.prototype.addString=function(b,a){this._textStrings.push(new c(b,a))};a.prototype.getStrings=function(){return this._textStrings};return a}(a);g.TextCollection=a})(h.Shape||(h.Shape={}))})(d.Markup||
(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(){this._behindView=!1}a.prototype.remove=function(){};a.prototype.draw=function(){};a.prototype.hit=function(a){a;return!1};a.prototype.hitWithTolerance=function(a,c){a;c;return!1};a.prototype.onSelect=function(){};a.prototype.onDeselect=function(){};a.prototype.toJson=function(){return{}};a.prototype.forJson=function(){return this.toJson()};a.prototype.getClassName=function(){return"Communicator.Markup.MarkupItem"};return a}();d.MarkupItem=g})(d.Markup||
(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(c){function b(b){var a=c.call(this)||this;a._position=new d.Point2(10,10);a._nextItemPosition=d.Point2.zero();a._statItemOffset=new d.Point2(5,5);a._maxStatWidth=0;a._viewer=b;a._backgroundPanel=new d.Markup.Shape.Rectangle(a._position,new d.Point2(300,100));a._backgroundPanel.setFillColor(d.Color.white());a._backgroundPanel.setStrokeWidth(0);a._statsText=new d.Markup.Shape.TextCollection;return a}__extends(b,c);b.prototype.draw=function(){this._updateBackgroundSize();
var b=this._viewer.markupManager.getRenderer();b.drawRectangle(this._backgroundPanel);b.drawTexts(this._statsText)};b.prototype.clearStatsText=function(){this._statsText.clear();this._nextItemPosition.assign(this._position)};b.prototype.setPosition=function(b){this._position.assign(b);this._backgroundPanel.setPosition(this._position)};b.prototype.addStatistic=function(b,c){var a=d.Point2.add(this._nextItemPosition,this._statItemOffset);this._statsText.addString(b+": "+c,a);this._nextItemPosition.y+=
this._statsText.getFontSize()};b.prototype._updateBackgroundSize=function(){for(var b=this._viewer.markupManager.getRenderer(),c=this._statsText.getStrings(),a=this._statsText.getFontSize(),e=0;e<c.length;e++){var g=b.measureText(c[e].text,this._statsText);this._maxStatWidth=Math.max(this._maxStatWidth,g.x)}this._backgroundPanel.setSize(new d.Point2(2*this._statItemOffset.x+this._maxStatWidth,c.length*(a+this._statItemOffset.y)))};return b}(d.Markup.MarkupItem),a=function(){return function(){this.total_triangle_count=
this.total_element_count=0}}();h.StatisticMap=a;var e=function(){function c(b,c){var f=this;this._statisticsDisplayHandle=null;this._statistics=new a;this._viewer=c;this._callbackManager=b;this._callbackManager.bind({frameDrawn:function(){return __awaiter(f,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.update()];case 1:return b.sent(),[2]}})})}});this._statisticsDisplay=new g(this._viewer)}c.prototype.update=function(){return __awaiter(this,void 0,
void 0,function(){var b,c,a,d,e,g,p;return __generator(this,function(f){switch(f.label){case 0:return[4,this._viewer.getStatistics()];case 1:this._statistics=b=f.sent();this._statisticsDisplay.clearStatsText();c=Object.keys(this._statistics);a=0;for(d=c;a<d.length;a++)g=e=d[a],p=this._statistics[g],this._statisticsDisplay.addStatistic(g,p.toString());return[2]}})})};c.prototype.isShown=function(){return null!==this._statisticsDisplayHandle};c.prototype.getStatistics=function(){return this._statistics};
c.prototype.showDisplay=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this.isShown()?[3,2]:[4,this.update()];case 1:b.sent(),this._statisticsDisplayHandle=this._viewer.markupManager.registerMarkup(this._statisticsDisplay),b.label=2;case 2:return[2]}})})};c.prototype.hideDisplay=function(){this.isShown()&&(this._viewer.markupManager.unregisterMarkup(this._statisticsDisplayHandle),this._statisticsDisplayHandle=null)};return c}();
h.Statistics=e})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){var h=function(){return function(){this.svgXmlPrologEnabled=!0;this.svgBackgroundCssColor="";this.linesDrawModelLinesEnabled=this.silhouettesEnabled=!0;this.linesStrokeWidth=20;this.linesCssColor="#000000";this.linesClipZNudgeFactor=this.linesClipProximityToPlane=5.5;this.polygonsForceDrawCssColor="";this.logDiagnostics=this.logProgress=!1}}();d.SvgConfig=h})(Communicator||(Communicator={}));
(function(d){(function(d){d[d.Rgba32=0]="Rgba32";d[d.Rgb24=1]="Rgb24";d[d.Gray8=2]="Gray8";d[d.GrayAlpha16=3]="GrayAlpha16";d[d.Jpeg=4]="Jpeg";d[d.Png=5]="Png"})(d.ImageFormat||(d.ImageFormat={}));(function(d){d[d.Clamp=0]="Clamp";d[d.Repeat=1]="Repeat";d[d.Trim=2]="Trim"})(d.TextureTiling||(d.TextureTiling={}));(function(d){d[d.UV=0]="UV"})(d.TextureParameterization||(d.TextureParameterization={}));(function(d){d[d.Decal=1]="Decal"})(d.TextureModifier||(d.TextureModifier={}))})(Communicator||(Communicator=
{}));
(function(d){(function(h){var g=function(){function a(a){this._timeoutDurationMinutes=15;this._timeoutWarningMinutes=14;this._timer=new d.Util.Timer;this._enabled=!0;this._callbackManager=a;this.resetTimeout()}a.prototype.setTimeoutDurations=function(a,c){this._timeoutDurationMinutes=a;this._timeoutWarningMinutes=c;this.resetTimeout();return!0};a.prototype.shutdown=function(){this._enabled=!1;this._timer.clear()};a.prototype.resetTimeout=function(){var a=this;this._enabled&&this._timer.set(Math.round(6E4*this._timeoutWarningMinutes),
function(){a._warn()})};a.prototype._warn=function(){var a=this;console.assert(this._timer.isIdle(0));var c=this._timeoutDurationMinutes-this._timeoutWarningMinutes,b=Math.round(6E4*c);this._callbackManager.trigger("timeoutWarning",c);this._timer.set(b,function(){a._timeout()})};a.prototype._timeout=function(){this._callbackManager.trigger("timeout");this._callbackManager.trigger("_timeout")};return a}();h.TimeoutMonitor=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){h.create=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(g){var a=new Uint32Array(1);d.Internal.getCrypto().getRandomValues(a);a=a[0]/4294967295*16|0;return("x"===g?a:a&3|8).toString(16)})}})(d.UUID||(d.UUID={}))})(Communicator||(Communicator={}));(function(d){(function(h){h.create=function(){return d.UUID.create()}})(d.GUID||(d.GUID={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a,e,c,b,f,k,l,g){this._backfacesVisible=!1;this._initialCamera=null;this._boundingCalculationIgnoresInvisible=this._faceVisibility=this._lineVisibility=!0;this._backgroundColorBottom=this._backgroundColorTop=null;this._drawMode=d.DrawMode.WireframeOnShaded;this._ambientOcclusionEnabled=!1;this._ambientOcclusionRadius=.03;this._antiAliasingMode=d.AntiAliasingMode.SMAA;this._lightingEnabled=!0;this._ambientLightColor=d.Color.black();this._bloomEnabled=!1;this._bloomIntensityScale=
this._bloomThresholdRampWidth=this._bloomThreshold=0;this._bloomLayers=[];this._hardEdgesEnabled=this._silhouetteEnabled=this._simpleReflectionEnabled=this._simpleShadowEnabled=!1;this._imageBasedLightingEnabled=!0;this._lineJitterEnabled=!1;this._hiddenLineSettings=new d.Settings.HiddenLineSettings;this._projectionMode=d.Projection.Orthographic;var n=a.getCreationParameters();this._viewer=a;this._engine=e;this._callbackManager=c;this._interpolationManager=f;this._eventDispatcher=b;this._model=a.model;
this._statistics=k;this._navCube=l;this._axisTriad=g;this._determineInitialAxes=d.Internal.getWithDefault(n.calculateDefaultViewAxes,!0);this._initEvents()}g.deprecated=function(a,d,c){var b=c.value;c.value=function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];this._callbackManager.trigger("deprecated","View",d);return b.apply(this,c)};return c};g.prototype._initEvents=function(){var a=this;this._callbackManager.bind({_resetAssemblyTreeBegin:function(){return __awaiter(a,void 0,void 0,
function(){return __generator(this,function(a){this._initialCamera=null;return[2]})})},_firstAttachment:function(e){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(c){return e===d.Internal.AttachType.Direct?[2,this._massageInitialCamera(!1)]:[2]})})},_firstModelLoaded:function(){return a._massageInitialCamera(!1)},_modelSwitched:function(d){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return d?[3,2]:[4,this._massageInitialCamera(!1)];
case 1:return c.sent(),[2,this._setInitialView(0)];case 2:return[2]}})})},hwfParseComplete:function(){return a._massageInitialCamera(!0)},_modelStructureHeaderParsed:function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){return this._viewer.sheetManager.isDrawingSheetActive()?(this._model.setViewAxes(new d.Point3(0,0,1),new d.Point3(0,1,0)),[2,this.setViewOrientation(d.ViewOrientation.Front,0)]):[2]})})},_sessionStarted:function(){return __awaiter(a,void 0,void 0,
function(){return __generator(this,function(a){this.clearLights();this.setAmbientLightColor(d.Color.createFromFloatArray([.075,.075,.075]));this.addLight(new d.Light(d.LightType.Directional,d.LightSpace.Camera,new d.Point3(.5,.5,1),d.Color.createFromFloatArray([.925,.925,.925])));this.addLight(new d.Light(d.LightType.Directional,d.LightSpace.Camera,new d.Point3(-.5,-.5,1),d.Color.createFromFloatArray([.1,.1,.2])));this.setBloomIntensityScale(1);this.setBloomThreshold(.65);this.setBloomThresholdRampWidth(.1);
this.setBloomLayers([{intensity:.5,blurSamples:5,blurInterval:[.0025,d.BlurIntervalUnit.ProportionOfHeight]},{intensity:.5,blurSamples:5,blurInterval:[.005,d.BlurIntervalUnit.ProportionOfHeight]},{intensity:.5,blurSamples:9,blurInterval:[.01,d.BlurIntervalUnit.ProportionOfHeight]},{intensity:1,blurSamples:9,blurInterval:[.02,d.BlurIntervalUnit.ProportionOfHeight]},{intensity:2,blurSamples:11,blurInterval:[.04,d.BlurIntervalUnit.ProportionOfHeight]}]);this.setGroundPlane({normal:new d.Point3(0,0,1),
followViewAxes:!0});this.setSimpleShadowColor(d.Color.black());this.setSimpleShadowOpacity(.65);this.setSimpleShadowResolution(512);this.setSimpleShadowBlurSamples(5);this.setSimpleShadowBlurInterval(1);this.setSimpleShadowInteractiveUpdateEnabled();this.setSimpleReflectionOpacity(.65);this.setSimpleReflectionFadeAngle(10);this.setSimpleReflectionBlurSamples(9);this.setSimpleReflectionBlurInterval(1,d.BlurIntervalUnit.Pixels);this.setSimpleReflectionAttenuation(0,1,d.SimpleReflectionAttenuationUnit.ProportionOfBoundingHeight);
this.setSilhouetteColor(d.Color.black());this.setSilhouetteOpacity(1);this.setSilhouetteThreshold(.05);this.setSilhouetteThresholdRampWidth(.025);this.setHardEdgeColor(d.Color.black());this.setHardEdgeOpacity(1);this.setHardEdgeThreshold(30);this.setHardEdgeThresholdRampWidth(20);this.setImageBasedLightingIntensity(1);this.setImageBasedLightingOrientation({matrix:new d.Matrix,followViewAxes:!0});this.setGoochBlue(.55);this.setGoochYellow(.3);this.setGoochBaseColorProminence(.25);this.setGoochLuminanceShiftStrength(.5);
this.setLineJitterInstanceCount(4);this.setLineJitterFrequency(5);this.setLineJitterRadius(.005);this.setToonShadingBandCount(3);this.setToonShadingSpecularFactor(1);return[2]})})},viewAxes:function(d,c){a._updateGroundPlane(d,c);a._updateImageBasedLightingOrientation(d,c)}})};g.prototype._massageInitialCamera=function(a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:if(null!==this._initialCamera)return[2];d=this;return[4,this._engine.getCameraPromise()];
case 1:return d._initialCamera=c.sent(),this._projectionMode=this._initialCamera.getProjection(),!this._determineInitialAxes||this._viewer.sheetManager.isDrawingSheetActive()||this._model.viewAxesHaveBeenSet()||this._determineViewAxes(this._initialCamera),a?[4,this.fitWorld()]:[3,3];case 2:c.sent(),this._initialCamera=this.getCamera(),c.label=3;case 3:return[2]}})})};g.prototype.setLineVisibility=function(a){this._setLineVisibility(a);return Promise.resolve()};g.prototype._setLineVisibility=function(a){a!==
this._lineVisibility&&(this._lineVisibility=a,this._engine.setLineVisibility(a))};g.prototype.getLineVisibility=function(){return this._lineVisibility};g.prototype.setFaceVisibility=function(a){this._setFaceVisibility(a);return Promise.resolve()};g.prototype._setFaceVisibility=function(a){a!==this._faceVisibility&&(this._faceVisibility=a,this._engine.setFaceVisibility(a));return Promise.resolve()};g.prototype.getFaceVisibility=function(){return this._faceVisibility};g.prototype.setProjectionMode=
function(a){this._projectionMode!==a&&(this._projectionMode=a,this._engine.isInit()&&this._engine.setProjection(a),this._eventDispatcher.injectViewOrientationChangeEvent())};g.prototype.getProjectionMode=function(){return this._projectionMode};g.prototype.getViewMatrix=function(){return this._engine.getViewMatrix()};g.prototype.getProjectionMatrix=function(){return this._engine.getProjectionMatrix()};g.prototype.getFullCameraMatrix=function(){return this._engine.getFullCameraMatrix()};g.prototype.raycastFromPoint=
function(a){var e=this.getCanvasSize(),c=this._engine.getViewMatrix(),b=this._engine.getProjectionMatrix(),f=new d.Point3(a.x,e.y-a.y,0);a=this._unproject(f,b,c,e);if(null===a)return null;f.z=.5;e=this._unproject(f,b,c,e);if(null===e)return null;e=d.Point3.subtract(e,a).normalize();return new d.Ray(a,e)};g.prototype._unproject=function(a,e,c,b){e=d.Matrix.multiply(c,e);e=d.Matrix.inverse(e);if(null===e)return null;a=new d.Point4(a.x,a.y,a.z,1);a.x/=b.x;a.y/=b.y;a.x=2*a.x-1;a.y=2*a.y-1;a.z=2*a.z-1;
b=e.transform4(a);if(0===b.w)return null;b.scale(1/b.w);return new d.Point3(b.x,b.y,b.z)};g.prototype._rectifySelectionItem=function(a){var d=a.getInclusionKey(),c=a.getNodeId();d=this._model._getNodeFromInstanceInc(!1,d,c,!0);a._setNodeId(d)};g.prototype.isOutsideCanvasArea=function(a){var d=this.getCanvasSize();return 0>a.x||0>a.y||a.x>=d.x||a.y>=d.y};g.prototype.pickFromPoint=function(a,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:if(this.isOutsideCanvasArea(a))throw new d.CommunicatorError("Cannot pick from outside the canvas area.");
return[4,this._engine.pickFromScreen(a,e,this._viewer.sheetManager.isDrawingSheetActive())];case 1:return(c=b.sent())?(this._rectifySelectionItem(c),[2,c]):[2,d.Selection.SelectionItem.create()]}})})};g.prototype.pickAllFromPoint=function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b,f,k;return __generator(this,function(l){switch(l.label){case 0:if(this.isOutsideCanvasArea(a))throw new d.CommunicatorError("Cannot pick from outside the canvas area.");return[4,this._engine.pickAllFromScreen(a,
e,this._viewer.sheetManager.isDrawingSheetActive())];case 1:c=l.sent();b=0;for(f=c;b<f.length;b++)k=f[b],this._rectifySelectionItem(k);return[2,c]}})})};g.prototype.compositePickFromPoint=function(a,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:if(this.isOutsideCanvasArea(a))throw new d.CommunicatorError("Cannot pick from outside the canvas area.");return[4,this._engine.compositePickFromScreen(a,e,this._viewer.sheetManager.isDrawingSheetActive())];
case 1:return c=b.sent(),null!==c.faceItem&&this._rectifySelectionItem(c.faceItem),null!==c.lineItem&&this._rectifySelectionItem(c.lineItem),null!==c.pointItem&&this._rectifySelectionItem(c.pointItem),[2,c]}})})};g.prototype.pickFromRay=function(a,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return[4,this._engine.pickFromRay(a,e)];case 1:return(c=b.sent())?(this._rectifySelectionItem(c),[2,c]):[2,d.Selection.SelectionItem.create()]}})})};
g.prototype.pickAllFromRay=function(a,d){return __awaiter(this,void 0,void 0,function(){var c,b,f,e;return __generator(this,function(k){switch(k.label){case 0:return[4,this._engine.pickAllFromRay(a,d)];case 1:c=k.sent();b=0;for(f=c;b<f.length;b++)e=f[b],this._rectifySelectionItem(e);return[2,c]}})})};g.prototype.beginScreenSelectByArea=function(a,e,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){if(this.isOutsideCanvasArea(a)||this.isOutsideCanvasArea(e))throw new d.CommunicatorError("Cannot pick from outside the canvas area.");
return[2,this._engine.beginScreenAreaSelection(a,e,c)]})})};g.prototype.beginRayDrillSelection=function(a,e,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){if(this.isOutsideCanvasArea(a))throw new d.CommunicatorError("Cannot pick from outside the canvas area.");return[2,this._engine.beginRayDrillSelection(a,e,c)]})})};g.prototype.beginConvexPolyhedronSelection=function(a,d,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,
this._engine.beginConvexPolyhedronSelection(a,d,c)]})})};g.prototype.beginSphereSelection=function(a,e,c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(f){b=d.Internal.toVec3(a);return[2,this._engine.beginSphereSelection(b,e,c)]})})};g.prototype.endIncrementalSelection=function(a){this._endIncrementalSelection(a);return Promise.resolve()};g.prototype._endIncrementalSelection=function(a){this._engine.endIncrementalSelection(a)};g.prototype.endVolumeSelection=
function(a){return this.endIncrementalSelection(a)};g.prototype.advanceIncrementalSelection=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,f,k,l,g,m,p,h;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._engine.advanceIncrementalSelection(a)];case 1:e=n.sent();if(null===e)return[2,null];c=this._viewer.selectionManager;b=[];f=0;for(k=e;f<k.length;f++)l=k[f],this._rectifySelectionItem(l),g=l,m=g.getNodeId(),(p=c._incrementalBlacklistedInstanceNodes.has(m))||
b.push(g);return[2,b];case 2:h=n.sent();if("advanceVolumeSelection"===h.scFunction)throw new d.SelectionInvalidatedError;throw h;case 3:return[2]}})})};g.prototype.advanceVolumeSelection=function(a){return this.advanceIncrementalSelection(a)};g.prototype.projectPoint=function(a,d){if(void 0!==d){var c=d.getProjectionMatrix(this._viewer);var b=d.getViewMatrix(this._viewer)}else c=this._engine.getSynchedProjectionMatrix(),b=this._engine.getSynchedViewMatrix();d=this.getCanvasSize();a=this._project(a,
c,b,d);a.y=d.y-a.y;return a};g.prototype._project=function(a,e,c,b){a=new d.Point4(a.x,a.y,a.z,1);c.transform4(a,a);e.transform4(a,a);e=0>=a.w;c=a.w;0>=a.w&&(a.w=.001);a.scale(1/a.w);a.x=.5*a.x+.5;a.y=.5*a.y+.5;a.z=.5*a.z+.5;a.x*=b.x;a.y*=b.y;e&&(a.z=c);return new d.Point3(a.x,a.y,a.z)};g.prototype.unprojectPoint=function(a,e){var c=this.getCanvasSize(),b=this.getProjectionMatrix(),f=this.getViewMatrix();a=new d.Point3(a.x,c.y-a.y,e);return this._unproject(a,b,f,c)};g.prototype.pointToWindowPosition=
function(a){var e=this._engine.getCanvasSize();return new d.Point2(a.x/e.x*2-1,1-a.y/e.y*2)};g.prototype.setCamera=function(a,d){void 0===d&&(d=0);return null===a?!1:this._setCameraImpl(a,d).unsafeValue};g.prototype._setCameraPromise=function(a,d){return this._setCameraImpl(a,d).readyPromise};g.prototype._setCameraImpl=function(a,e){return 0<e?this._interpolateCamera(a,e):this._engine.isInit()?(e=a.getProjection(),this._projectionMode!==e&&this.setProjectionMode(e),this._engine.setCamera(a),e=this._markupManager?
this._markupManager._setActiveMarkupView(null):Promise.resolve(),this._callbackManager.trigger("camera",a),d.Internal.UnsafePromise.create(!0,e)):d.Internal.UnsafePromise.create(!1,Promise.resolve())};g.prototype._interpolateCamera=function(a,e){var c=this;if(this._engine.isInit()){var b=this.getCamera();if(b.equals(a))return this._markupManager&&this._markupManager._update(),d.Internal.UnsafePromise.create(!1,Promise.resolve());this._callbackManager.trigger("transitionBegin",e);var f=d.Util.OpenPromise.create();
this._interpolationManager.start(new d.Internal.CameraInterpolation(b,a,e,function(){c._eventDispatcher.injectViewOrientationChangeEvent();c._callbackManager.trigger("transitionEnd");f.resolve()},this));return d.Internal.UnsafePromise.create(!0,f)}return d.Internal.UnsafePromise.create(!1,Promise.resolve())};g.prototype.updateCamera=function(a){a=this._engine.updateCamera(a);this._callbackManager.trigger("camera",a);return a};g.prototype.resetCamera=function(a){void 0===a&&(a=d.DefaultTransitionDuration);
return this._setInitialView(a)};g.prototype.getCamera=function(){if(this._engine.isInit())return this._engine.getCamera();throw new d.CommunicatorError("getCamera() called before sceneReady");};g.prototype.getViewOrientationCamera=function(a,e,c){void 0===c&&(c=!0);return __awaiter(this,void 0,void 0,function(){var b,f,k,l,g,m,p,h,r,u,t,v,w,y,x,z,B,A,D,C,E,F;return __generator(this,function(n){switch(n.label){case 0:return b=this.getCamera(),f=b.getUp().copy().normalize(),k=this._model.getViewAxes(),
l=k.upVector.copy(),g=k.frontVector.copy(),void 0!==e?[3,2]:[4,this._model.getModelBounding(this._boundingCalculationIgnoresInvisible,!1)];case 1:return e=n.sent(),[3,3];case 2:this._fitCameraToBounding(b,e),n.label=3;case 3:m=e.center();p=m.copy();h=m.copy();r=d.Point3.subtract(b.getPosition(),b.getTarget()).length();u=d.Point3.subtract(b.getPosition(),m).length();t=new d.Point3(0,0,1);v=new d.Point3(-1,0,0);null!==l&&(t=l.copy());null!==g&&(v=g.copy());w=v.copy().scale(-1);y=v.copy();x=t.copy();
z=t.copy().scale(-1);B=d.Point3.cross(x,w);A=B.copy().scale(-1);D=function(b){b=d.Point3.subtract(h,b);var c=t,a=d.Util.computeAngleBetweenVector(b,t);if(0===a||180===a)c=v;var e=d.Point3.cross(b,c),k=e.copy().negate(),l=d.Point3.cross(b,e),g=l.copy().negate();b=Infinity;c=e;a=0;for(e=[e,k,l,g];a<e.length;a++)k=e[a],l=d.Util.computeAngleBetweenVector(f,k),l<=b&&(b=l,c=k);return c.normalize()};C=null;switch(a){case d.ViewOrientation.Front:p=d.Point3.add(h,y);break;case d.ViewOrientation.Back:p=d.Point3.add(h,
w);break;case d.ViewOrientation.Left:p=d.Point3.add(h,B);break;case d.ViewOrientation.Right:p=d.Point3.add(h,A);break;case d.ViewOrientation.Bottom:p=d.Point3.add(h,z);C=w.copy();break;case d.ViewOrientation.Top:p=d.Point3.add(h,x);C=w.copy();break;case d.ViewOrientation.FrontTop:case d.ViewOrientation.TopFront:p=d.Point3.add(h,d.Point3.add(y,x));C=d.Point3.add(w,x).normalize();break;case d.ViewOrientation.FrontTopLeft:case d.ViewOrientation.LeftTopFront:case d.ViewOrientation.TopLeftFront:p=d.Point3.add(h,
d.Point3.add(y,d.Point3.add(B,x)));C=d.Point3.add(w,d.Point3.add(A,x)).normalize();break;case d.ViewOrientation.Iso:case d.ViewOrientation.FrontTopRight:case d.ViewOrientation.RightTopFront:case d.ViewOrientation.TopRightFront:p=d.Point3.add(h,d.Point3.add(y,d.Point3.add(A,x)));C=d.Point3.add(w,d.Point3.add(B,x)).normalize();break;case d.ViewOrientation.FrontLeft:case d.ViewOrientation.LeftFront:p=d.Point3.add(h,d.Point3.add(y,B));break;case d.ViewOrientation.FrontRight:case d.ViewOrientation.RightFront:p=
d.Point3.add(h,d.Point3.add(y,A));break;case d.ViewOrientation.FrontBottom:case d.ViewOrientation.BottomFront:p=d.Point3.add(h,d.Point3.add(y,z));C=d.Point3.add(y,x).normalize();break;case d.ViewOrientation.FrontBottomLeft:case d.ViewOrientation.LeftBottomFront:case d.ViewOrientation.BottomLeftFront:p=d.Point3.add(h,d.Point3.add(y,d.Point3.add(B,z)));C=d.Point3.add(y,d.Point3.add(B,x)).normalize();break;case d.ViewOrientation.FrontBottomRight:case d.ViewOrientation.RightBottomFront:case d.ViewOrientation.BottomRightFront:p=
d.Point3.add(h,d.Point3.add(y,d.Point3.add(A,z)));C=d.Point3.add(y,d.Point3.add(A,x)).normalize();break;case d.ViewOrientation.BackTop:case d.ViewOrientation.TopBack:p=d.Point3.add(h,d.Point3.add(w,x));C=d.Point3.add(y,x).normalize();break;case d.ViewOrientation.BackTopLeft:case d.ViewOrientation.LeftTopBack:case d.ViewOrientation.TopLeftBack:p=d.Point3.add(h,d.Point3.add(w,d.Point3.add(B,x)));C=d.Point3.add(y,d.Point3.add(A,x)).normalize();break;case d.ViewOrientation.BackTopRight:case d.ViewOrientation.RightTopBack:case d.ViewOrientation.TopRightBack:p=
d.Point3.add(h,d.Point3.add(w,d.Point3.add(A,x)));C=d.Point3.add(y,d.Point3.add(B,x)).normalize();break;case d.ViewOrientation.BackLeft:case d.ViewOrientation.LeftBack:p=d.Point3.add(h,d.Point3.add(w,B));break;case d.ViewOrientation.BackRight:case d.ViewOrientation.RightBack:p=d.Point3.add(h,d.Point3.add(w,A));break;case d.ViewOrientation.BackBottom:case d.ViewOrientation.BottomBack:p=d.Point3.add(h,d.Point3.add(w,z));C=d.Point3.add(w,x).normalize();break;case d.ViewOrientation.BackBottomLeft:case d.ViewOrientation.LeftBottomBack:case d.ViewOrientation.BottomLeftBack:p=
d.Point3.add(h,d.Point3.add(w,d.Point3.add(B,z)));C=d.Point3.add(w,d.Point3.add(B,x)).normalize();break;case d.ViewOrientation.BackBottomRight:case d.ViewOrientation.RightBottomBack:case d.ViewOrientation.BottomRightBack:p=d.Point3.add(h,d.Point3.add(w,d.Point3.add(A,z)));C=d.Point3.add(w,d.Point3.add(A,x)).normalize();break;case d.ViewOrientation.LeftBottom:case d.ViewOrientation.BottomLeft:p=d.Point3.add(h,d.Point3.add(B,z));C=d.Point3.add(B,x).normalize();break;case d.ViewOrientation.LeftTop:case d.ViewOrientation.TopLeft:p=
d.Point3.add(h,d.Point3.add(B,x));C=d.Point3.add(A,x).normalize();break;case d.ViewOrientation.RightBottom:case d.ViewOrientation.BottomRight:p=d.Point3.add(h,d.Point3.add(A,z));C=d.Point3.add(A,x).normalize();break;case d.ViewOrientation.RightTop:case d.ViewOrientation.TopRight:p=d.Point3.add(h,d.Point3.add(A,x));C=d.Point3.add(B,x).normalize();break;default:d.Util.TypeAssertNever(a)}c||(C=D(p));null===C&&(C=t);E=d.Point3.add(d.Point3.subtract(p,m).normalize().scale(u),m);F=d.Point3.add(d.Point3.subtract(p,
m).normalize().scale(u-r),m);b.setPosition(E);b.setTarget(F);b.setUp(C);return[2,b]}})})};g.prototype.setViewOrientation=function(a,e,c,b){void 0===e&&(e=d.DefaultTransitionDuration);void 0===b&&(b=!0);return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return[4,this.getViewOrientationCamera(a,c,b)];case 1:return f=d.sent(),void 0!==c?[3,3]:[4,this.fitWorld(e,f)];case 2:return d.sent(),[3,5];case 3:return[4,this.fitBounding(c,e,f)];case 4:d.sent(),
d.label=5;case 5:return this._callbackManager.trigger("viewOrientation",a),[2]}})})};g.prototype.centerCameraOnNode=function(a,e,c){void 0===e&&(e=0);void 0===c&&(c=this.getCamera());return __awaiter(this,void 0,void 0,function(){var b,f,k,l,g;return __generator(this,function(n){switch(n.label){case 0:return[4,this._model.getNodesBounding([a])];case 1:b=n.sent();f=b.center();k=c.getPosition();l=c.getTarget();g=d.Point3.subtract(l,f);k.subtract(g);c.setPosition(k);c.setTarget(f);if(0<e)return[2,this._setCameraPromise(c,
e)];this.setCamera(c);return[2]}})})};g.prototype._setInitialView=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){if(!this._initialCamera)return[2,this.fitWorld(a)];if(0<a)return[2,this._setCameraPromise(this._initialCamera,a)];this.setCamera(this._initialCamera);this._eventDispatcher.injectViewOrientationChangeEvent();return[2]})})};g.prototype.getCanvasSize=function(){return this._engine.getCanvasSize()};g.prototype._setMarkupManager=function(a){this._markupManager=
a};g.prototype.setStatisticsDisplayVisibility=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return a?[4,this._statistics.showDisplay()]:[3,2];case 1:return d.sent(),[3,3];case 2:this._statistics.hideDisplay(),d.label=3;case 3:return[2]}})})};g.prototype.getBackgroundColor=function(){var a=null!==this._backgroundColorTop?this._backgroundColorTop.copy():null,e=null!==this._backgroundColorBottom?this._backgroundColorBottom.copy():
null;return new d.VerticalGradient(a,e)};g.prototype.setBackgroundColor=function(a,e){void 0===a&&(a=null);void 0===e&&(e=null);this._backgroundColorTop=null!==a?a.copy():null;this._backgroundColorBottom=null!==e?e.copy():null;this._drawMode===d.DrawMode.HiddenLine||this._viewer.sheetManager.isDrawingSheetActive()||this._engine.setBackgroundGradient(this._backgroundColorTop,this._backgroundColorBottom);return Promise.resolve()};g.prototype.isolateNodes=function(a,e,c,b){void 0===e&&(e=d.DefaultTransitionDuration);
void 0===c&&(c=!0);void 0===b&&(b=null);return __awaiter(this,void 0,void 0,function(){var f,d,l,g,m;return __generator(this,function(k){switch(k.label){case 0:f=this._model.getAbsoluteRootNode();d=new Map;d.set(f,!1);l=0;for(g=a;l<g.length;l++)m=g[l],d.set(m,!0);return[4,this._model.setNodesVisibilities(d,b)];case 1:return k.sent(),c?[2,this.fitNodes(a,e)]:[2]}})})};g.prototype.fitNodes=function(a,e){void 0===e&&(e=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){var c;
return __generator(this,function(b){switch(b.label){case 0:return[4,this._model.getNodesBounding(a)];case 1:return c=b.sent(),[2,this.fitBounding(c,e)]}})})};g.prototype.fitWorld=function(a,d){void 0===a&&(a=0);return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return d||(d=this.getCamera()),[4,this._model.getModelBounding(this._boundingCalculationIgnoresInvisible,!1)];case 1:return c=b.sent(),[4,this.fitBounding(c,a,d)];case 2:return b.sent(),
[2]}})})};g.prototype._fitCameraToBounding=function(a,e){if(this._viewer.sheetManager.isDrawingSheetActive()){var c=e.extents(),b=e.center();e=new d.Point3(b.x,b.y,e.min.z+c.length());a.setProjection(d.Projection.Orthographic);a.setPosition(e);a.setTarget(b);a.setWidth(1.25*c.x);a.setHeight(1.25*c.y)}else{c=e.extents();c=c.length();b=a.getWidth();var f=d.Point3.subtract(a.getPosition(),a.getTarget()),k=f.length();k=c*k/b;b=e.center();e=d.Point3.add(b,f.normalize().scale(k));a.setTarget(b);a.setPosition(e);
a.setWidth(c);a.setHeight(c)}};g.prototype.fitBounding=function(a,e,c){void 0===e&&(e=d.DefaultTransitionDuration);void 0===c&&(c=this.getCamera());return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){if(a){a.isDegenerate()||this._fitCameraToBounding(c,a);if(0<e)return[2,this._setCameraPromise(c,e)];this.setCamera(c)}return[2]})})};g.prototype.setBackfacesVisible=function(a){this._backfacesVisible=a;this._engine.setBackFacesVisible(a);return Promise.resolve()};g.prototype.getBackfacesVisible=
function(){return this._backfacesVisible};g.prototype.setDrawMode=function(a){this._setDrawMode(a);return Promise.resolve()};g.prototype._setDrawMode=function(a){this._drawMode=a;this._drawMode!==d.DrawMode.HiddenLine&&this.setBackgroundColor(this._backgroundColorTop,this._backgroundColorBottom);switch(a){case d.DrawMode.Wireframe:this._engine.setDrawMode(1);this._setLineVisibility(!0);this._setFaceVisibility(!1);break;case d.DrawMode.Shaded:this._engine.setDrawMode(1);this._setLineVisibility(!1);
this._setFaceVisibility(!0);break;case d.DrawMode.WireframeOnShaded:this._engine.setDrawMode(1);this._setLineVisibility(!0);this._setFaceVisibility(!0);break;case d.DrawMode.HiddenLine:a=this._hiddenLineSettings.getBackgroundColor();this._setLineVisibility(!0);this._setFaceVisibility(!0);this._engine.enableHiddenLineRendering(this._hiddenLineSettings);this._engine.setBackgroundGradient(a,a);break;case d.DrawMode.XRay:this._engine.setDrawMode(3);this._setLineVisibility(!0);this._setFaceVisibility(!0);
break;case d.DrawMode.Gooch:this._engine.setDrawMode(4);break;case d.DrawMode.Toon:this._setLineVisibility(!1),this._engine.setDrawMode(5)}};g.prototype.getDrawMode=function(){return this._drawMode};g.prototype.setAntiAliasingMode=function(a){this._setAntiAliasingMode(a);return Promise.resolve()};g.prototype._setAntiAliasingMode=function(a){this._antiAliasingMode=a;this._engine.setAntiAliasingMode(a)};g.prototype.getAntiAliasingMode=function(){return this._antiAliasingMode};g.prototype.getHiddenLineSettings=
function(){return this._hiddenLineSettings};g.prototype.setAmbientOcclusionEnabled=function(a){void 0===a&&(a=!0);this._setAmbientOcclusionEnabled(a);return Promise.resolve()};g.prototype._setAmbientOcclusionEnabled=function(a){void 0===a&&(a=!0);this._ambientOcclusionEnabled=a;this._engine.setAmbientOcclusionEnabled(a)};g.prototype.getAmbientOcclusionEnabled=function(){return this._ambientOcclusionEnabled};g.prototype.setAmbientOcclusionRadius=function(a){this._setAmbientOcclusionRadius(a);return Promise.resolve()};
g.prototype._setAmbientOcclusionRadius=function(a){this._ambientOcclusionRadius=a;this._engine.setAmbientOcclusionRadius(a)};g.prototype.getAmbientOcclusionRadius=function(){return this._ambientOcclusionRadius};g.prototype.setLightingEnabled=function(a){void 0===a&&(a=!0);this._setLightingEnabled(a);return Promise.resolve()};g.prototype._setLightingEnabled=function(a){void 0===a&&(a=!0);this._lightingEnabled=a;this._engine.setLightingEnabled(a)};g.prototype.getLightingEnabled=function(){return this._lightingEnabled};
g.prototype.setTransparencyMode=function(a){this._engine.setTransparencyMode(a)};g.prototype.setXRayOpacity=function(a,d){this._setXRayOpacity(a,d);return Promise.resolve()};g.prototype._setXRayOpacity=function(a,d){this._engine.setXRayOpacity(a,d)};g.prototype.setXRayTransparencyMode=function(a){this._setXRayTransparencyMode(a);return Promise.resolve()};g.prototype._setXRayTransparencyMode=function(a){this._engine.setXRayTransparencyMode(a)};g.prototype.setXRayColor=function(a,e,c){void 0===c&&(c=
d.XRayGroup.Selected);this._engine.setXRayColor(c,a,e);return Promise.resolve()};g.prototype.unsetXRayColor=function(a,e){void 0===e&&(e=d.XRayGroup.Selected);return this._engine.unsetXRayColor(e,a)};g.prototype.setGoochBlue=function(a){this._goochBlue=a;this._engine.setGoochBlue(a)};g.prototype.getGoochBlue=function(){return this._goochBlue};g.prototype.setGoochBaseColorProminence=function(a){this._goochBaseColorProminence=a;this._engine.setGoochBaseColorProminence(a)};g.prototype.getGoochBaseColorProminence=
function(){return this._goochBaseColorProminence};g.prototype.setGoochYellow=function(a){this._goochYellow=a;this._engine.setGoochYellow(a)};g.prototype.getGoochYellow=function(){return this._goochYellow};g.prototype.setToonShadingBandCount=function(a){this._toonBandCount=a;this._engine.setToonShadingBandCount(a)};g.prototype.getToonShadingBandCount=function(){return this._toonBandCount};g.prototype.setToonShadingSpecularFactor=function(a){this._toonSpecularFactor=a;this._engine.setToonShadingSpecularFactor(a)};
g.prototype.getToonShadingSpecularFactor=function(){return this._toonSpecularFactor};g.prototype.setGoochLuminanceShiftStrength=function(a){this._goochLuminanceShiftStrength=a;this._engine.setGoochLuminanceShiftStrength(a)};g.prototype.getGoochLuminanceShiftStrength=function(){return this._goochLuminanceShiftStrength};g.prototype.setPointSize=function(a,d){this._setPointSize(a,d);return Promise.resolve()};g.prototype._setPointSize=function(a,d){this._engine.setPointSize(a,d)};g.prototype.getPointSize=
function(){return this._engine.getPointSize()};g.prototype.setPointShape=function(a){this._setPointShape(a);return Promise.resolve()};g.prototype._setPointShape=function(a){this._engine.setPointShape(a)};g.prototype.getPointShape=function(){return this._engine.getPointShape()};g.prototype.setEyeDomeLightingEnabled=function(a){void 0===a&&(a=!0);this._setEyeDomeLightingEnabled(a);return Promise.resolve()};g.prototype._setEyeDomeLightingEnabled=function(a){void 0===a&&(a=!0);this._engine.setEyeDomeLightingEnabled(a)};
g.prototype.getEyeDomeLightingEnabled=function(){return this._engine.getEyeDomeLightingEnabled()};g.prototype.setEyeDomeLightingBlurSamples=function(a){this._setEyeDomeLightingBlurSamples(a);return Promise.resolve()};g.prototype._setEyeDomeLightingBlurSamples=function(a){this._engine.setEyeDomeLightingBlurSamples(a)};g.prototype.getEyeDomeLightingBlurSamples=function(){return this._engine.getEyeDomeLightingBlurSamples()};g.prototype.setEyeDomeLightingBlurInterval=function(a){this._setEyeDomeLightingBlurInterval(a);
return Promise.resolve()};g.prototype._setEyeDomeLightingBlurInterval=function(a){this._engine.setEyeDomeLightingBlurInterval(a)};g.prototype.getEyeDomeLightingBlurInterval=function(){return this._engine.getEyeDomeLightingBlurInterval()};g.prototype.setEyeDomeLightingBlurEdgeDistance=function(a){this._setEyeDomeLightingBlurEdgeDistance(a);return Promise.resolve()};g.prototype._setEyeDomeLightingBlurEdgeDistance=function(a){this._engine.setEyeDomeLightingBlurEdgeDistance(a)};g.prototype.getEyeDomeLightingBlurEdgeDistance=
function(){return this._engine.getEyeDomeLightingBlurEdgeDistance()};g.prototype.setEyeDomeLightingShadingEdgeDistance=function(a){this._setEyeDomeLightingShadingEdgeDistance(a);return Promise.resolve()};g.prototype._setEyeDomeLightingShadingEdgeDistance=function(a){this._engine.setEyeDomeLightingShadingEdgeDistance(a)};g.prototype.getEyeDomeLightingShadingEdgeDistance=function(){return this._engine.getEyeDomeLightingShadingEdgeDistance()};g.prototype.setEyeDomeLightingOpacity=function(a){this._setEyeDomeLightingOpacity(a);
return Promise.resolve()};g.prototype._setEyeDomeLightingOpacity=function(a){this._engine.setEyeDomeLightingOpacity(a)};g.prototype.getEyeDomeLightingOpacity=function(){return this._engine.getEyeDomeLightingOpacity()};g.prototype.setBoundingCalculationIgnoresInvisible=function(a){this._boundingCalculationIgnoresInvisible=a};g.prototype.getBoundingCalculationIgnoresInvisible=function(){return this._boundingCalculationIgnoresInvisible};g.prototype.setDisplayIncompleteFrames=function(a){this._setDisplayIncompleteFrames(a);
return Promise.resolve()};g.prototype._setDisplayIncompleteFrames=function(a){this._engine.setDisplayIncompleteFrames(a)};g.prototype.setInteractiveDrawDelay=function(a){this._setInteractiveDrawDelay(a);return Promise.resolve()};g.prototype._setInteractiveDrawDelay=function(a){this._engine.setInteractiveDrawDelay(a)};g.prototype.setInteractiveDrawLimitIncreaseEnabled=function(a){this._engine.setInteractiveDrawLimitIncreaseEnabled(a)};g.prototype.getInteractiveDrawLimitIncreaseEnabled=function(){return this._engine.getInteractiveDrawLimitIncreaseEnabled()};
g.prototype.getNavCube=function(){return this._navCube};g.prototype.getAxisTriad=function(){return this._axisTriad};g.prototype._determineViewAxes=function(a){var e=a.getUp().normalize();a=d.Point3.subtract(a.getTarget(),a.getPosition()).normalize();e=d.Internal.majorAxis(e);a=d.Internal.majorAxis(a);null===e&&null===a?(e=new d.Point3(0,1,0),a=new d.Point3(0,0,1)):null===e?e=0===a.y?new d.Point3(0,1,0):new d.Point3(0,0,1):null===a&&(a=0===e.z?new d.Point3(0,0,1):new d.Point3(0,1,0));try{this._model.setViewAxes(a,
e)}catch(c){}};g.prototype.setAmbientLightColor=function(a){this._ambientLightColor=a;this._engine.setAmbientLightColor(a)};g.prototype.getAmbientLightColor=function(){return this._ambientLightColor};g.prototype.clearLights=function(){this._engine.clearLights()};g.prototype.addLight=function(a){return this._engine.addLight(a)};g.prototype.removeLight=function(a){this._engine.removeLight(a)};g.prototype.updateLight=function(a,d){this._engine.updateLight(a,d)};g.prototype.setBloomEnabled=function(a){void 0===
a&&(a=!0);this._engine.setBloomEnabled(a);this._bloomEnabled=a};g.prototype.getBloomEnabled=function(){return this._bloomEnabled};g.prototype.setBloomThreshold=function(a){this._engine.setBloomThreshold(a);this._bloomThreshold=a};g.prototype.getBloomThreshold=function(){return this._bloomThreshold};g.prototype.setBloomThresholdRampWidth=function(a){this._engine.setBloomThresholdRampWidth(a);this._bloomThresholdRampWidth=a};g.prototype.getBloomThresholdRampWidth=function(){return this._bloomThresholdRampWidth};
g.prototype.setBloomIntensityScale=function(a){this._engine.setBloomIntensityScale(a);this._bloomIntensityScale=a};g.prototype.getBloomIntensityScale=function(){return this._bloomIntensityScale};g.prototype.setBloomLayers=function(a){a=d.Internal.deepClone(a);for(var e=0;e<a.length;e++){var c=a[e];void 0===c.intensity&&(c.intensity=1);void 0===c.blurSamples&&(c.blurSamples=9);void 0===c.blurInterval&&(c.blurInterval=[1,d.BlurIntervalUnit.Pixels])}this._engine.setBloomLayers(a);this._bloomLayers=a};
g.prototype.getBloomLayers=function(){return d.Internal.deepClone(this._bloomLayers)};g.prototype.startComparison=function(a,e,c){var b=this._model._getModelStructure();a=b.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);e=b.gatherInstanceIncsFromNodeIds(e,7,d.Internal.Tree.WalkRestriction.None);this._engine.startComparison(a,e,c)};g.prototype.endComparison=function(){this._engine.endComparison()};g.prototype.setSimpleShadowEnabled=function(a){void 0===a&&(a=!0);this._simpleShadowEnabled=
a;this._engine.setSimpleShadowEnabled(a)};g.prototype.getSimpleShadowEnabled=function(){return this._simpleShadowEnabled};g.prototype.setSimpleShadowColor=function(a){this._simpleShadowColor=a.copy();this._engine.setSimpleShadowColor(a)};g.prototype.getSimpleShadowColor=function(){return this._simpleShadowColor.copy()};g.prototype.setSimpleShadowOpacity=function(a){this._simpleShadowOpacity=a;this._engine.setSimpleShadowOpacity(a)};g.prototype.getSimpleShadowOpacity=function(){return this._simpleShadowOpacity};
g.prototype.setGroundPlane=function(a){this._groundPlane=__assign({},a);this._updateGroundPlane()};g.prototype._updateGroundPlane=function(a,e){if(this._groundPlane.followViewAxes&&(void 0!==a&&void 0!==e||this._model.viewAxesHaveBeenSet())){if(void 0===a||void 0===e)e=this._model.getViewAxes(),a=e.frontVector,e=e.upVector;a=a.copy().negate();var c=d.Point3.cross(e,a);a=d.Matrix.createFromBasis(a,c,e);e=new d.Point3(0,0,0);a.transform(this._groundPlane.normal,e);this._engine.setGroundPlane(e,this._groundPlane.position)}else this._engine.setGroundPlane(this._groundPlane.normal,
this._groundPlane.position)};g.prototype.getGroundPlane=function(){return __assign({},this._groundPlane)};g.prototype.setSimpleShadowResolution=function(a){this._simpleShadowResolution=a;this._engine.setSimpleShadowResolution(a)};g.prototype.getSimpleShadowResolution=function(){return this._simpleShadowResolution};g.prototype.setSimpleShadowBlurSamples=function(a){this._simpleShadowBlurSamples=a;this._engine.setSimpleShadowBlurSamples(a)};g.prototype.getSimpleShadowBlurSamples=function(){return this._simpleShadowBlurSamples};
g.prototype.setSimpleShadowBlurInterval=function(a){this._simpleShadowBlurInterval=a;this._engine.setSimpleShadowBlurInterval(a)};g.prototype.getSimpleShadowBlurInterval=function(){return this._simpleShadowBlurInterval};g.prototype.setSimpleShadowInteractiveUpdateEnabled=function(a){void 0===a&&(a=!0);this._simpleShadowInteractiveUpdateEnabled=a;this._engine.setSimpleShadowInteractiveUpdateEnabled(a)};g.prototype.getSimpleShadowInteractiveUpdateEnabled=function(){return this._simpleShadowInteractiveUpdateEnabled};
g.prototype.setSilhouetteEnabled=function(a){void 0===a&&(a=!0);this._silhouetteEnabled=a;this._engine.setSilhouetteEnabled(a)};g.prototype.getSilhouetteEnabled=function(){return this._silhouetteEnabled};g.prototype.setSilhouetteColor=function(a){this._silhouetteColor=a.copy();this._engine.setSilhouetteColor(a)};g.prototype.getSilhouetteColor=function(){return this._silhouetteColor.copy()};g.prototype.setSilhouetteOpacity=function(a){this._silhouetteOpacity=a;this._engine.setSilhouetteOpacity(a)};
g.prototype.getSilhouetteOpacity=function(){return this._silhouetteOpacity};g.prototype.setSilhouetteThreshold=function(a){this._silhouetteThreshold=a;this._engine.setSilhouetteThreshold(a)};g.prototype.getSilhouetteThreshold=function(){return this._silhouetteThreshold};g.prototype.setSilhouetteThresholdRampWidth=function(a){this._silhouetteThresholdRampWidth=a;this._engine.setSilhouetteThresholdRampWidth(a)};g.prototype.getSilhouetteThresholdRampWidth=function(){return this._silhouetteThresholdRampWidth};
g.prototype.setHardEdgesEnabled=function(a){void 0===a&&(a=!0);this._hardEdgesEnabled=a;this._engine.setHardEdgesEnabled(a)};g.prototype.getHardEdgesEnabled=function(){return this._hardEdgesEnabled};g.prototype.setHardEdgeColor=function(a){this._hardEdgeColor=a.copy();this._engine.setHardEdgeColor(a)};g.prototype.getHardEdgeColor=function(){return this._hardEdgeColor.copy()};g.prototype.setHardEdgeOpacity=function(a){this._hardEdgeOpacity=a;this._engine.setHardEdgeOpacity(a)};g.prototype.getHardEdgeOpacity=
function(){return this._hardEdgeOpacity};g.prototype.setHardEdgeThreshold=function(a){this._hardEdgeThreshold=a;this._engine.setHardEdgeThreshold(a)};g.prototype.getHardEdgeThreshold=function(){return this._hardEdgeThreshold};g.prototype.setHardEdgeThresholdRampWidth=function(a){this._hardEdgeThresholdRampWidth=a;this._engine.setHardEdgeThresholdRampWidth(a)};g.prototype.getHardEdgeThresholdRampWidth=function(){return this._hardEdgeThresholdRampWidth};g.prototype.setSimpleReflectionEnabled=function(a){void 0===
a&&(a=!0);this._simpleReflectionEnabled=a;this._engine.setSimpleReflectionEnabled(a)};g.prototype.getSimpleReflectionEnabled=function(){return this._simpleReflectionEnabled};g.prototype.setSimpleReflectionBlurInterval=function(a,e){void 0===e&&(e=d.BlurIntervalUnit.Pixels);this._simpleReflectionBlurInterval=[a,e];this._engine.setSimpleReflectionBlurInterval(a,e)};g.prototype.getSimpleReflectionBlurInterval=function(){return[this._simpleReflectionBlurInterval[0],this._simpleReflectionBlurInterval[1]]};
g.prototype.setSimpleReflectionBlurSamples=function(a){this._simpleReflectionBlurSamples=a;this._engine.setSimpleReflectionBlurSamples(a)};g.prototype.getSimpleReflectionBlurSamples=function(){return this._simpleReflectionBlurSamples};g.prototype.setSimpleReflectionFadeAngle=function(a){this._simpleReflectionFadeAngle=a;this._engine.setSimpleReflectionFadeAngle(a)};g.prototype.getSimpleReflectionFadeAngle=function(){return this._simpleReflectionFadeAngle};g.prototype.setSimpleReflectionOpacity=function(a){this._simpleReflectionOpacity=
a;this._engine.setSimpleReflectionOpacity(a)};g.prototype.getSimpleReflectionOpacity=function(){return this._simpleReflectionOpacity};g.prototype.setSimpleReflectionAttenuation=function(a,e,c){void 0===c&&(c=d.SimpleReflectionAttenuationUnit.World);this._simpleReflectionAttenuation={nearDistance:a,farDistance:e,unit:c};this._engine.setSimpleReflectionAttenuation(a,e,c)};g.prototype.getSimpleReflectionAttenuation=function(){return __assign({},this._simpleReflectionAttenuation)};g.prototype.testPointVisibility=
function(a){return this._engine.testPointVisibility(a)};g.prototype.setPointVisibilityTest=function(a){this._engine.setPointVisibilityTest(a)};g.prototype.setImageBasedLightingEnabled=function(a){this._engine.setImageBasedLightingEnabled(a);this._imageBasedLightingEnabled=a};g.prototype.getImageBasedLightingEnabled=function(){return this._imageBasedLightingEnabled};g.prototype.setImageBasedLightingIntensity=function(a){this._engine.setImageBasedLightingIntensity(a);this._imageBasedLightingIntensity=
a};g.prototype.getImageBasedLightingIntensity=function(){return this._imageBasedLightingIntensity};g.prototype._copyImageBasedLightingOrientation=function(a){return __assign({},a,{matrix:a.matrix.copy()})};g.prototype.setImageBasedLightingOrientation=function(a){this._imageBasedLightingOrientation=this._copyImageBasedLightingOrientation(a);this._updateImageBasedLightingOrientation()};g.prototype.getImageBasedLightingOrientation=function(){return this._copyImageBasedLightingOrientation(this._imageBasedLightingOrientation)};
g.prototype._updateImageBasedLightingOrientation=function(a,e){if(this._imageBasedLightingOrientation.followViewAxes){if(void 0===a||void 0===e)this._model.viewAxesHaveBeenSet()?(e=this._model.getViewAxes(),a=e.frontVector,e=e.upVector):(a=new d.Point3(0,0,1),e=new d.Point3(0,1,0));a=d.Matrix.createFromBasis(d.Point3.cross(e,a),e,a);a=d.Matrix.multiply(this._imageBasedLightingOrientation.matrix,a)}else a=this._imageBasedLightingOrientation.matrix;this._engine.setImageBasedLightingMatrix(a)};g.prototype.setImageBasedLightingEnvironment=
function(a){null!=a?this._engine.setImageBasedLightingEnvironment(a):this._engine.setImageBasedLightingEnvironmentToDefault()};g.prototype.setLineJitterEnabled=function(a){void 0===a&&(a=!0);this._engine.setLineJitterEnabled(a);this._lineJitterEnabled=a};g.prototype.getLineJitterEnabled=function(){return this._lineJitterEnabled};g.prototype.setLineJitterInstanceCount=function(a){this._engine.setLineJitterInstanceCount(a);this._lineJitterInstanceCount=a};g.prototype.getLineJitterInstanceCount=function(){return this._lineJitterInstanceCount};
g.prototype.setLineJitterRadius=function(a){this._engine.setLineJitterRadius(a);this._lineJitterRadius=a};g.prototype.getLineJitterRadius=function(){return this._lineJitterRadius};g.prototype.setLineJitterFrequency=function(a){this._engine.setLineJitterFrequency(a);this._lineJitterFrequency=a};g.prototype.getLineJitterFrequency=function(){return this._lineJitterFrequency};__decorate([g.deprecated],g.prototype,"endVolumeSelection",null);__decorate([g.deprecated],g.prototype,"advanceVolumeSelection",
null);return g}();d.View=h})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(b){return b instanceof e?b.referencedInfo:b}g.MaxModelFileVersion=[9,2,1];var e=function(){return function(b){this.referencedInfo=b}}();g.ReferencedNodeInfo=e;g.modelFileNodeInfoAsProdOccInfo=a;var c=function(){function b(){}b.parseXml=function(b,c,a,n,m){console.assert("ModelFile"===n.localName);var f=new Map,k=new Map,l=new Map;for(n=n.firstElementChild;null!==n;){if("ProductOccurence"!==n.localName)throw new d.XmlParseError('Unexpected element "'+
n.localName+'".');if(null===g.XmlParser.parseNodeId(n,"Id"))throw new d.XmlParseError('Expected "Id" attribute.');var h=n,t=g.ProductOccurrence.parseXml(b,c,a,h,m),v=t.nodeInfo.nodeId;if(l.has(t.nodeInfo.nodeId)){var w=new e(t);f.set(v,w)}else{if(!k.has(t.nodeInfo.nodeId)&&(k.set(t.nodeInfo.nodeId,null),null!==b.additionalMatrix)){w=b.additionalMatrix.m;var y=t.nodeInfo.localTransform;y=null===y?w:g.Transform.multiply(y,w);t=__assign({},t,{nodeInfo:__assign({},t.nodeInfo,{localTransform:y})})}f.set(v,
t)}v=0;for(w=g.XmlParser.parseNodeIds(h,"Children")||[];v<w.length;v++)k.set(w[v],t);h=g.XmlParser.parseNodeId(h,"InstanceRef");null!==h&&(v=l.get(h),void 0===v?l.set(h,[t]):v.push(t));n=n.nextElementSibling}b=this._parentMapToChildMap(f,k,l);return{treeInfos:this._childMapRoseTrees(b)}};b._parentMapToChildMap=function(b,c,a){var f=new Map,k=function(b,c){var a=f.get(b);void 0===a?f.set(b,[c]):a.push(c)};c.forEach(function(c,a){a=b.get(a);if(a instanceof e)throw new d.XmlParseError('Expected a referenced node for "InstanceRef".');
k(c,a)});a.forEach(function(c,a){console.assert(0<c.length);a=b.get(a);if(!(a instanceof e))throw new d.XmlParseError('Node is both an "InstanceRef" and contained in another node\'s "Children" list.');for(var f=0;f<c.length;f++)k(c[f],a)});return f};b._childMapRoseTrees=function(b){var c=function(f){var d=[],e=a(f);e=b.get(e);if(void 0!==e){console.assert(0<e.length);for(var k=0;k<e.length;k++){var l=c(e[k]);d.push(l)}}return new h.RoseTree(f,d)},f=b.get(null);if(void 0===f)return console.assert(0===
b.size),[];for(var d=[],g=0;g<f.length;g++){var p=f[g];p instanceof e?console.assert(!1):(p=c(p),d.push(p))}return d};b.reify=function(b,c,a,g,m,h){return __awaiter(this,void 0,void 0,function(){var f,k,l,n,p,w,y,x;return __generator(this,function(q){switch(q.label){case 0:f=[];k=[];l=[];n=0;for(p=h.treeInfos;n<p.length;n++)w=p[n],w.value instanceof e?console.assert(!1):(y=this._reifyProductOccurrence(b,c,a,g,m,m,w,f),k.push(y),l.push(y.getRuntimeId()));x=c.promiseTrigger("_subtreeLoaded","subtreeLoaded",
l,d.NodeSource.LoadModel).then(function(){for(var b=0,a=l;b<a.length;b++)c.trigger("shatteredXmlStructureReady",a[b])});f.push(x);return[4,d.Util.waitForAll(f)];case 1:return q.sent(),[2,k]}})})};b._rectifyExternalModelInfo=function(b,c){c=c.referencedInfo.externalModelInfo;if(null===c)throw new d.XmlParseError('"InstanceRef" node does not contain "ExternalModel".');if(!g.ExternalModel.isNameInfo(c))throw new d.InternalLogicError;console.assert(0===c.reservedNodeIdOffset);b=b.newNodeIdOffset();return c=
__assign({},c,{reservedNodeIdOffset:b})};b._reifyProductOccurrence=function(b,c,l,n,m,h,q,r){var f=this,k=a(q.value);if(0!==k.childDataKeys.length)throw new d.InternalLogicError;if(null!==k.externalModelInfo)throw new d.LoadError('Unexpected "ExternalModel". Should be a child of an "InstanceRef".');var p=g.ProductOccurrence.reifySync(b,l,n,m,k,h);h.addProductOccurrence(p);p.markLoaded();h=0;for(q=q.kids;h<q.length;h++)k=q[h],k.value instanceof e?(console.assert(0===k.kids.length),k=this._rectifyExternalModelInfo(n,
k.value),g.ExternalModel.canImplicitlyLoad(k)?(k=l.attachByExternalModelInfo(k,p,m).then(function(b){return __awaiter(f,void 0,void 0,function(){var a;return __generator(this,function(f){switch(f.label){case 0:return null===b?[2]:[4,g.markContextsLoaded([b])];case 1:return f.sent(),p.addAttachContext(b),a=b.getChildren().map(function(b){return b.getRuntimeId()}),[4,c.promiseTrigger("_subtreeLoaded","subtreeLoaded",a,d.NodeSource.LoadModel)];case 2:return f.sent(),[2]}})})}),r.push(k)):p.addPendingExternalModel(k)):
(console.assert(null===k.value.externalModelInfo),this._reifyProductOccurrence(b,c,l,n,m,p,k,r));return p};b._parseBounding=function(b,c){var f=a(b.value),e=SC.UnspecifiedMeasurementUnit;null!==f.measurementUnit&&(e=f.measurementUnit);var k=1;e===SC.UnspecifiedMeasurementUnit?e=c:c!==SC.UnspecifiedMeasurementUnit&&(k=e/c);k=(new d.Matrix).setScaleComponent(k,k,k);var h=f.nodeInfo.localTransform;null!==h&&(h=d.Matrix.createFromArray(h),k=d.Matrix.multiply(h,k));h=d.Box.invalid();var q=0;for(b=b.kids;q<
b.length;q++){var r=this._parseBounding(b[q],e);r=k.transformBox(r);h.addBox(r)}b=f.externalModelInfo;if(null!==b){if(!g.ExternalModel.isNameInfo(b))throw new d.InternalLogicError;f=b.bounding;null===f||f.isDegenerate()||(b=b.measurementUnit||SC.UnspecifiedMeasurementUnit,c!==SC.UnspecifiedMeasurementUnit&&b!==SC.UnspecifiedMeasurementUnit&&(c=b/e,c=(new d.Matrix).setScaleComponent(c,c,c),k=d.Matrix.multiply(c,k)),f=k.transformBox(f),h.addBox(f))}return h};b.parseBounding=function(b,c){var a=d.Box.invalid(),
f=0;for(b=b.treeInfos;f<b.length;f++)for(var e=0,k=b[f].kids;e<k.length;e++){var g=this._parseBounding(k[e],c);a.addBox(g)}return a};return b}();g.ModelFile=c})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a){var e=this;this._callbackManager=new d.Internal.CallbackManager;this._interpolationManager=new d.Internal.InterpolationManager;this._streamingMode=d.StreamingMode.Interactive;this._rendererType=d.RendererType.Client;this._alreadyShutDown=!1;this._sceneReadyPromise=d.Util.OpenPromise.create();this._seenPriorityMetaDataSent=!1;this._params=__assign({},a);this._contextMenuActiveFlag=!1;if(void 0!==this._params.containerId){a=d.Internal.DomElements.createFromId(this._params.containerId);
if(null===a)throw new d.ParseError("'containerId' is invalid");this._domElements=a}else if(void 0!==this._params.container)this._domElements=d.Internal.DomElements.createFromElement(this._params.container);else throw new d.ParseError("must supply 'container' or 'containerId'");this.operatorManager=new d.OperatorManager(this);this._eventDispatcher=new d.Internal.EventDispatcher(this._callbackManager,this.operatorManager);this._timeoutMonitor=new d.Internal.TimeoutMonitor(this._callbackManager);this._inputMonitor=
new d.Internal.InputMonitor(this._eventDispatcher,this._timeoutMonitor);this._setInitialOptions(this._params);this._engine=new d.Internal.ScEngine(this._callbackManager,this._params);this._statistics=new d.Internal.Statistics(this._callbackManager,this);a=new d.NavCube(this);var c=new d.AxisTriad(this);this.model=new d.Model(this._engine,this._callbackManager);this.view=new d.View(this,this._engine,this._callbackManager,this._eventDispatcher,this._interpolationManager,this._statistics,a,c);this.cuttingManager=
new d.CuttingManager(this,this.model,this._callbackManager,this._engine);a={disableAutomaticFitWorld:d.Internal.getWithDefault(this._params.disableAutomaticFitWorld,!1),markImplicitNodesOutOfHierarchy:d.Internal.getWithDefault(this._params._markImplicitNodesOutOfHierarchy,!0),streamingMode:d.Internal.getWithDefault(this._params.streamingMode,d.StreamingMode.Default)};this._modelStructure=d.Internal.Tree.ModelStructure.unsafeCreate(a,this._engine,this._callbackManager,this.cuttingManager,this.view,
this.model,this._params._maxConcurrentAttachments||null);this.model._setModelStructure(this._modelStructure);this.measureManager=new d.MeasureManager(this,this._callbackManager);this.lineManager=new d.LineManager(this,this._callbackManager);this.explodeManager=new d.ExplodeManager(this.model,this._engine,this._callbackManager);this.overlayManager=new d.OverlayManager(this,this._engine);this.BCFManager=new d.BCFManager(this);this.selectionManager=new d.SelectionManager(this._callbackManager,this._engine,
this.view,this.model,this._modelStructure);a=new d.FloorplanConfig;d.Internal.getWithDefault(this._params.disableAutomaticFloorplanOverlay,!1)&&(a.autoActivate=d.FloorplanAutoActivation.Never);this.floorplanManager=new d.FloorplanManager(this,this.model,this.overlayManager,this._engine,this._modelStructure,a);a=d.Internal.getWithDefault(this._params.disableAutomaticBackgroundSheets,!1);this.sheetManager=new d.SheetManager(this,this._engine,this._callbackManager,a);this.noteTextManager=new d.Markup.Note.NoteTextManager(this);
this.markupManager=new d.MarkupManager(this._domElements,this.measureManager,this.lineManager,this._callbackManager,this.sheetManager,this.noteTextManager,this);this.view._setMarkupManager(this.markupManager);this.animationManager=new d.Animation.Manager(this);this._initEventDispatcher();var b=function(b){e.model.isDrawing()&&(b=e.sheetManager.get3DNodes());e.model._setInstanceModifier(d.InstanceModifier.OverrideSceneVisibility,b,!0,6);for(var c=0;c<b.length;c++)e.model.setPmiColorOverride(!0,b[c])},
f=function(b){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return b?[4,Promise.all([this.view.setPointSize(.003,d.PointSizeUnit.ProportionOfBoundingDiagonal),this.view.setEyeDomeLightingEnabled(!0),this.view.setPointShape(d.PointShape.Disk)])]:[3,2];case 1:return c.sent(),[3,4];case 2:return[4,Promise.all([this.view.setPointSize(1,d.PointSizeUnit.ScreenPixels),this.view.setEyeDomeLightingEnabled(!1),this.view.setPointShape(d.PointShape.Square)])];
case 3:c.sent(),c.label=4;case 4:return[2]}})})},k=function(b){return __awaiter(e,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return c=this.model.getModelFileTypeFromNode(b[0]),null===c||c===d.FileType.Unknown?[3,2]:[4,f(!1)];case 1:a.sent(),a.label=2;case 2:return[2]}})})},g=function(b){return __awaiter(e,void 0,void 0,function(){var c,a,f,e,k;return __generator(this,function(g){switch(g.label){case 0:c=[];if(this.model.getModelFileTypeFromNode(b[0])===
d.FileType.Ifc)for(a=0,f=b;a<f.length;a++)e=f[a],k=this.model.registerIfcNodes(e),c.push(k);return[4,Promise.all(c)];case 1:return g.sent(),[2]}})})},n=function(b){var c=e.selectionManager.getSelectionFilter();b=e.model.getModelFileTypeFromNode(b[0])===d.FileType.Ifc;!c&&b?e.selectionManager.setSelectionFilter(d.SelectionManager.ifcSelectionFilter):c!==d.SelectionManager.ifcSelectionFilter||b||e.selectionManager.setSelectionFilter(null)};this.setCallbacks({_resetAssemblyTreeBegin:function(){return __awaiter(e,
void 0,void 0,function(){return __generator(this,function(b){e.model.setPmiColor(d.Color.black());return[2]})})},_sessionStarted:function(){return f(!0)},_firstModelLoaded:function(c){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return e.model.setPmiColor(d.Color.black()),n(c),b([this.model.getAbsoluteRootNode()]),[4,Promise.all([g(c),k(c)])];case 1:return a.sent(),[2]}})})},_modelSwitched:function(c,a){return __awaiter(e,void 0,void 0,function(){return __generator(this,
function(c){switch(c.label){case 0:return n(a),b(a),[4,Promise.all([g(a),k(a)])];case 1:return c.sent(),[2]}})})},_subtreeLoaded:function(c){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return b(c),[4,g(c)];case 1:return a.sent(),[2]}})})},subtreeLoaded:function(b,c){e._callbackManager.trigger("modelLoaded",b,c)}})}g.deprecated=function(a,d,c){var b=c.value;c.value=function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];this._callbackManager.trigger("deprecated",
"WebViewer",d);return b.apply(this,c)};return c};g.prototype.setContextMenuStatus=function(a){this._contextMenuActiveFlag=a};g.prototype.getContextMenuStatus=function(){return this._contextMenuActiveFlag};g.prototype.deactivateSheets=function(){return this.sheetManager.deactivateSheets()};g.prototype.setActiveSheetId=function(a){return this.sheetManager.setActiveSheetId(a,!0,!0)};g.prototype.getActiveSheetId=function(){return this.sheetManager.getActiveSheetId()};g.prototype.getSheetIds=function(){return this.sheetManager.getSheetIds()};
g.prototype.isDrawingSheetActive=function(){return this.sheetManager.isDrawingSheetActive()};g.prototype.setBackgroundSheetEnabled=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){return[2,this.sheetManager.setBackgroundSheetEnabled(a)]})})};g.prototype.getBackgroundSheetEnabled=function(){return this.sheetManager.getBackgroundSheetEnabled()};g.prototype.setBackgroundSelectionEnabled=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(d){return[2,this.sheetManager.setBackgroundSelectionEnabled(a)]})})};g.prototype.getBackgroundSelectionEnabled=function(){return this.sheetManager.getBackgroundSelectionEnabled()};g.prototype.setSheetColors=function(a,d,c){return this.sheetManager.setSheetColors(a,d,c)};g.prototype.getSheetBackgroundColor=function(){return this.sheetManager.getSheetBackgroundColor()};g.prototype.getSheetColor=function(){return this.sheetManager.getSheetColor()};g.prototype.getSheetShadowColor=function(){return this.sheetManager.getSheetShadowColor()};
g.prototype.getCreationParameters=function(){return __assign({},this._params)};g.prototype._setInitialOptions=function(a){this._inputMonitor.setOptions(a);void 0!==a.streamingMode?this._streamingMode=a.streamingMode:a.streamingMode=this._streamingMode;void 0!==a.rendererType?this._rendererType=a.rendererType:a.rendererType=this._rendererType};g.prototype._initEventDispatcher=function(){var a=new d.Operator.CameraOrbitOperator(this),e=new d.Operator.CameraPanOperator(this),c=new d.Operator.CameraZoomOperator(this),
b=new d.Operator.CameraNavigationOperator(this,a,e,c),f=new d.Operator.CameraWalkOperator(this),k=new d.Operator.CameraKeyboardWalkOperator(this),g=new d.Operator.CameraWalkModeOperator(this,f,k),n=new d.Operator.CameraTurntableOperator(this),m=new d.Operator.SelectionOperator(this,this.noteTextManager),h=new d.Operator.AreaSelectionOperator(this),q=new d.Operator.RayDrillSelectionOperator(this),r=new d.Operator.RedlineCircleOperator(this),u=new d.Operator.RedlineTextOperator(this),t=new d.Operator.RedlineRectangleOperator(this),
v=new d.Operator.RedlinePolylineOperator(this),w=new d.Operator.MeasureEdgeLengthOperator(this,this.measureManager),y=new d.Operator.MeasureFaceFaceDistanceOperator(this,this.measureManager),x=new d.Operator.MeasureLineLineAngleOperator(this,this.measureManager),z=new d.Operator.MeasurePointPointDistanceOperator(this,this.measureManager),B=new d.Operator.MeasureBodyBodyDistanceOperator(this,this.measureManager),A=new d.Operator.MeasureFaceFaceAngleOperator(this,this.measureManager),D=new d.Operator.MeasurePolylineDistanceOperator(this,
this.measureManager),C=new d.Operator.MeasurePolygonAreaOperator(this,this.measureManager),E=new d.Operator.NoteOperator(this,this.noteTextManager),F=new d.Operator.CuttingPlaneOperator(this,this.cuttingManager),H=new d.Operator.HandleOperator(this),G=new d.Operator.NavCubeOperator(this),I=new d.Operator.AxisTriadOperator(this),K=new d.Operator.FloorplanOperator(this);this.operatorManager._registerOperator(d.OperatorId.Navigate,b);this.operatorManager._registerOperator(d.OperatorId.Orbit,a);this.operatorManager._registerOperator(d.OperatorId.Pan,
e);this.operatorManager._registerOperator(d.OperatorId.Zoom,c);this.operatorManager._registerOperator(d.OperatorId.Walk,f);this.operatorManager._registerOperator(d.OperatorId.KeyboardWalk,k);this.operatorManager._registerOperator(d.OperatorId.WalkMode,g);this.operatorManager._registerOperator(d.OperatorId.Turntable,n);this.operatorManager._registerOperator(d.OperatorId.Select,m);this.operatorManager._registerOperator(d.OperatorId.AreaSelect,h);this.operatorManager._registerOperator(d.OperatorId.RayDrillSelect,
q);this.operatorManager._registerOperator(d.OperatorId.RedlineCircle,r);this.operatorManager._registerOperator(d.OperatorId.RedlineText,u);this.operatorManager._registerOperator(d.OperatorId.RedlineRectangle,t);this.operatorManager._registerOperator(d.OperatorId.RedlinePolyline,v);this.operatorManager._registerOperator(d.OperatorId.MeasureEdgeLength,w);this.operatorManager._registerOperator(d.OperatorId.MeasureFaceFaceDistance,y);this.operatorManager._registerOperator(d.OperatorId.MeasureLineLineAngle,
x);this.operatorManager._registerOperator(d.OperatorId.MeasurePointPointDistance,z);this.operatorManager._registerOperator(d.OperatorId.MeasureBodyBodyDistance,B);this.operatorManager._registerOperator(d.OperatorId.MeasureFaceFaceAngle,A);this.operatorManager._registerOperator(d.OperatorId.MeasurePolylineDistance,D);this.operatorManager._registerOperator(d.OperatorId.MeasurePolygonArea,C);this.operatorManager._registerOperator(d.OperatorId.Note,E);this.operatorManager._registerOperator(d.OperatorId.Cutting,
F);this.operatorManager._registerOperator(d.OperatorId.Handle,H);this.operatorManager._registerOperator(d.OperatorId.NavCube,G);this.operatorManager._registerOperator(d.OperatorId.AxisTriad,I);this.operatorManager._registerOperator(d.OperatorId.Floorplan,K);b.setBimNavigationEnabled(!1);w.addMapping(d.Button.Left);y.addMapping(d.Button.Left);z.addMapping(d.Button.Left);z.addMapping(d.Button.Left,d.KeyModifiers.Alt);A.addMapping(d.Button.Left);F.addMapping(d.Button.Left);h.addMapping(d.Button.Left);
h.addMapping(d.Button.Left,d.KeyModifiers.Control);this.operatorManager.set(d.OperatorId.Navigate,0);this.operatorManager.set(d.OperatorId.Select,1);this.operatorManager.push(d.OperatorId.Cutting);this.operatorManager.push(d.OperatorId.Handle);this.operatorManager.push(d.OperatorId.NavCube);this.operatorManager.push(d.OperatorId.AxisTriad);this.operatorManager.push(d.OperatorId.Floorplan)};g.prototype.getViewerVersionString=function(){return g.VIEWER_VERSION_STRING};g.prototype.getFormatVersionString=
function(){return this._engine.getVersionString()};g.prototype.getView=function(){return this.view};g.prototype.getModel=function(){return this.model};g.prototype.getOverlayManager=function(){return this.overlayManager};g.prototype.getMeasureManager=function(){return this.measureManager};g.prototype.getLineManager=function(){return this.lineManager};g.prototype.getCuttingManager=function(){return this.cuttingManager};g.prototype.getMarkupManager=function(){return this.markupManager};g.prototype.getSelectionManager=
function(){return this.selectionManager};g.prototype.getExplodeManager=function(){return this.explodeManager};g.prototype.getOperatorManager=function(){return this.operatorManager};g.prototype._getNoteTextManager=function(){return this.noteTextManager};g.prototype.start=function(){var a=this,d=this._domElements.getCanvasContainerElement();return this._engine.start(d,{enginePath:this._params.enginePath,engineReady:function(c){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,
c];case 1:return b.sent(),[4,this._modelStructure.waitForReady()];case 2:return b.sent(),[4,this._scEngineReady()];case 3:return b.sent(),[2]}})})},sceneReady:function(){a._sceneReady()},renderComplete:function(){a._renderComplete()},streamingActivated:function(){a._streamingActivated()},streamingDeactivated:function(){a._streamingDeactivated()},priorityMetaDataSent:function(c,b){a._priorityMetaDataSent(c,b)}})};g.prototype.registerCustomOperator=function(a){return this.operatorManager.registerCustomOperator(a)};
g.prototype.unregisterCustomOperator=function(a){this.operatorManager.unregisterCustomOperator(a)};g.prototype.focusInput=function(a){this._inputMonitor.focusInput(a)};g.prototype.setCallbacks=function(a){this._callbackManager.bind(a)};g.prototype.unsetCallbacks=function(a){this._callbackManager.unbind(a)};g.prototype.resizeCanvas=function(){this._alreadyShutDown||(this._engine.resize(),this._inputMonitor.elementResize())};g.prototype.moveToWindow=function(a){this._inputMonitor.setDocument(a.document)};
g.prototype.redraw=function(a){var d=this;if(a){var c=function(){d._callbackManager.unbind({_drawComplete:c});a()};this._callbackManager.bind({_drawComplete:c})}this._engine.redraw()};g.prototype.selectPart=function(a,e){void 0===e&&(e=d.SelectionMode.Set);return this.selectionManager.selectNode(a,e)};g.prototype.trigger=function(a){for(var d=[],c=1;c<arguments.length;c++)d[c-1]=arguments[c];this._callbackManager.unsafeTrigger(a,d)};g.prototype.triggerEvent=function(a,d){this._callbackManager.unsafeTrigger(a,
d)};g.prototype._getCallbackManager=function(){return this._callbackManager};g.prototype._setStreamIdleMarker=function(){return this._engine.setStreamIdleMarker()};g.prototype.getStatistics=function(a){void 0===a&&(a=!1);return this._engine.getStatistics(a)};g.prototype.setMinimumFramerate=function(a){this._setMinimumFramerate(a);return Promise.resolve()};g.prototype._setMinimumFramerate=function(a){this._engine.setMinimumFramerate(a)};g.prototype.getMinimumFramerate=function(){return this._engine.getMinimumFramerate()};
g.prototype.setServerRenderQuality=function(a,d,c,b){return this._engine.setServerRenderQuality(a,d,c,b)};g.prototype.getStreamingMode=function(){return this._streamingMode};g.prototype.getRendererType=function(){return this._engine.getRendererType()};g.prototype.getViewElement=function(){return this._domElements.getCanvasContainerElement()};g.prototype.shutdown=function(){this._alreadyShutDown||(console.assert(this._modelStructure.isReady()),this._callbackManager.trigger("_shutdownBegin"),this.operatorManager._shutdown(),
this._inputMonitor.shutdown(),this.markupManager._shutdown(),this._timeoutMonitor.shutdown(),this._modelStructure.shutdown(),this._domElements.shutdown(),this._engine.shutdown(),this.animationManager._shutdown(),this._alreadyShutDown=!0)};g.prototype.setClientTimeout=function(a,d){return this._timeoutMonitor.setTimeoutDurations(a,d)};g.prototype.resetClientTimeout=function(){this._timeoutMonitor.resetTimeout()};g.prototype.pauseRendering=function(a){this._pauseRendering(a);return Promise.resolve()};
g.prototype._pauseRendering=function(a){this._engine.pauseRendering(a)};g.prototype.resumeRendering=function(){this._resumeRendering();return Promise.resolve()};g.prototype._resumeRendering=function(){this._engine.resumeRendering()};g.prototype.delayCapping=function(){this.cuttingManager.delayCapping()};g.prototype.reset=function(a){void 0===a&&(a=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:return[4,this.model.reset()];
case 1:return c.sent(),(d=null!==this.model.getDefaultCadConfiguration())?[4,this._modelStructure.cadConfigurationsEnabled()]:[3,3];case 2:d=c.sent(),c.label=3;case 3:return d?[4,this.model.activateDefaultCadConfiguration()]:[3,5];case 4:return c.sent(),[3,7];case 5:return this.sheetManager.isDrawingSheetActive()?[3,7]:[4,this.view.resetCamera(a)];case 6:c.sent(),c.label=7;case 7:return[2]}})})};g.prototype.closeConnection=function(){this.view.setCamera(this.view.getCamera());this._engine.disconnectNetwork();
this._timeoutMonitor.shutdown()};g.prototype.setAllowHighDpi=function(a){this._engine.setAllowHighDpi(a)};g.prototype.setAllowHighDPI=function(a){this.setAllowHighDpi(a)};g.prototype.getAllowHighDpi=function(){return this._engine.getAllowHighDpi()};g.prototype.getAllowHighDPI=function(){return this.getAllowHighDpi()};g.prototype.takeSnapshot=function(a){var e=this;void 0===a&&(a=new d.SnapshotConfig);var c=d.Util.OpenPromise.create(),b=new d.Internal.Snapshot(this._domElements,a),f=this._domElements.getCanvasContainerElement(),
k=this._domElements.getRedlineElement(),g=0<a.width&&0<a.height;if(g){var n=a.width/f.clientWidth*100+"%";a=a.height/f.clientHeight*100+"%";f.style.width=n;f.style.height=a;k.style.width=n;k.style.height=a}var m=this.getAllowHighDpi();this._engine.setAllowHighDpi(!1);this._engine.resize();this.redraw(function(){return __awaiter(e,void 0,void 0,function(){var a;return __generator(this,function(d){switch(d.label){case 0:return[4,b.capture(f)];case 1:return a=d.sent(),g&&(f.style.width="100%",f.style.height=
"100%",k.style.width="100%",k.style.height="100%"),this._engine.setAllowHighDpi(m),this._engine.resize(),c.resolve(a),[2]}})})});return c};g.prototype.fitWorld=function(a){void 0===a&&(a=d.DefaultTransitionDuration);return this.view.fitWorld(a)};g.prototype.setViewOrientation=function(a,e){void 0===e&&(e=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this.view.setViewOrientation(a,e)];case 1:return c.sent(),
this._eventDispatcher.injectViewOrientationChangeEvent(),[2]}})})};g.prototype._applyMetallicRoughnessDefaults=function(){var a=1,d=1,c=!1;void 0!=this._params.defaultMetallicFactor&&(a=this._params.defaultMetallicFactor,c=!0);void 0!=this._params.defaultRoughnessFactor&&(d=this._params.defaultRoughnessFactor,c=!0);c&&this._engine.setMetallicRoughnessMaterialOverride(a,d)};g.prototype._scEngineReady=function(){return __awaiter(this,void 0,void 0,function(){var a,e,c,b,f,k,g;return __generator(this,
function(l){switch(l.label){case 0:console.assert(this._modelStructure.isReady()),a=this.model.getAbsoluteRootNode(),e=this._engine.getSessionType(),l.label=1;case 1:return l.trys.push([1,,17,18]),this.cuttingManager._init(),[4,this._sceneReadyPromise];case 2:return l.sent(),[4,this._callbackManager.promiseTrigger("_assemblyTreeReady","assemblyTreeReady")];case 3:l.sent(),c="",l.label=4;case 4:l.trys.push([4,15,,16]);b=new d.LoadSubtreeConfig;b._allowSubtreeLoadedCallback=!1;f=0;this._applyMetallicRoughnessDefaults();
if(1!==e)return[3,8];c=this._engine.getNetworkModelName();return c!==d.EmptyModelName?[3,5]:[3,7];case 5:return[4,this.model.loadSubtreeFromModel(a,c,b)];case 6:l.sent(),l.label=7;case 7:return[3,14];case 8:if(2!==e)return[3,13];this._timeoutMonitor.shutdown();k=this._engine.getScsInfo();return"string"!==typeof k?[3,10]:[4,this.model.loadSubtreeFromScsFile(a,k,b)];case 9:return l.sent(),[3,12];case 10:return null===k?[3,12]:[4,this.model.loadSubtreeFromScsBuffer(a,k,b)];case 11:return l.sent(),[3,
12];case 12:return void 0!==this._params.streamCutoffScale&&(f=this._params.streamCutoffScale),[3,14];case 13:throw new d.InternalLogicError;case 14:return this._modelStructure.setPrefetchScsCutoffScale(f),[3,16];case 15:throw g=l.sent(),this._callbackManager.trigger("modelLoadFailure",c,""+g,g),g;case 16:return[3,18];case 17:return console.assert(this._modelStructure.isReady()),[2,this._callbackManager.promiseTrigger("_modelStructureReady","modelStructureReady")];case 18:return[2]}})})};g.prototype._sceneReady=
function(){var a=this;this._inputMonitor.bindEvents(this._domElements.getCanvasContainerElement());this.selectionManager._init();this._callbackManager.bind({_timeout:function(){a.shutdown()}});this._callbackManager.trigger("sceneReady");this._sceneReadyPromise&&this._sceneReadyPromise.resolve()};g.prototype._priorityMetaDataSent=function(a,e){this._callbackManager.trigger("_priorityMetaDataSent",a,e);if(!this._seenPriorityMetaDataSent){if(0!==a||0!==e)throw new d.InternalLogicError;this._seenPriorityMetaDataSent=
!0;this._callbackManager.trigger("_attached",0)}};g.prototype._renderComplete=function(){this.markupManager._update()};g.prototype._streamingActivated=function(){this._callbackManager.trigger("streamingActivated")};g.prototype._streamingDeactivated=function(){this._callbackManager.trigger("streamingDeactivated")};g.prototype.setStreamCutoffScale=function(a){this._setStreamCutoffScale(a);return Promise.resolve()};g.prototype._setStreamCutoffScale=function(a){this._engine.setStreamCutoffScale(a);this._modelStructure.setPrefetchScsCutoffScale(a)};
g.prototype.getStreamCutoffScale=function(){return this._engine.getStreamCutoffScale()};g.prototype._loseWebGlContext=function(){return this._engine.loseWebGlContext()};g.prototype._getScEngine=function(){return this._engine};g.prototype._debug_log=function(a){return this._engine.debug_log(a)};g.prototype._debug_stateFailure=function(a){return this._engine.debug_stateFailure(a)};g.prototype._debug_sync=function(){return this._engine.debug_sync()};g.prototype.exportToSvg=function(a){void 0===a&&(a=
new d.SvgConfig);return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:return[4,this.cuttingManager._setStandinGeometryVisible(!1)];case 1:c.sent(),c.label=2;case 2:return c.trys.push([2,,5,7]),[4,this.waitForIdle({redraw:!1})];case 3:return c.sent(),[4,this._engine.exportToSvg(a)];case 4:return d=c.sent(),[3,7];case 5:return[4,this.cuttingManager._setStandinGeometryVisible(!0)];case 6:return c.sent(),[7];case 7:return[2,d]}})})};g.prototype.waitForIdle=
function(a){void 0===a&&(a={});return __awaiter(this,void 0,void 0,function(){var e,c,b;return __generator(this,function(f){switch(f.label){case 0:return this._alreadyShutDown?[2]:[4,this._setStreamIdleMarker()];case 1:return f.sent(),e=[],this.cuttingManager.hasActiveCuttingSection()?[4,this.cuttingManager.enableCappingIdleCallback(!0)]:[3,3];case 2:(c=f.sent())||e.push(this.cuttingManager.waitForCappingIdle()),f.label=3;case 3:return e.push(this._engine.waitForImageDecoding()),[4,Promise.all(e)];
case 4:f.sent();if(!1===a.redraw)return[3,6];b=d.Util.OpenPromise.create();this.redraw(function(){b.resolve()});return[4,b];case 5:f.sent(),f.label=6;case 6:return[2]}})})};g.prototype.startSheetComparison=function(a,d,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.sheetManager.startComparison(a,d,c)];case 1:return b.sent(),[2]}})})};g.prototype.endSheetComparison=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(a){switch(a.label){case 0:return[4,this.sheetManager.endComparison()];case 1:return a.sent(),[2]}})})};g.BUILD_ID="2f40ab1";g.VIEWER_VERSION_STRING=d.Internal.versionString(d.Internal.Tree.MaxModelFileVersion)+" Build "+g.BUILD_ID;__decorate([g.deprecated],g.prototype,"deactivateSheets",null);__decorate([g.deprecated],g.prototype,"setActiveSheetId",null);__decorate([g.deprecated],g.prototype,"getActiveSheetId",null);__decorate([g.deprecated],g.prototype,"getSheetIds",null);__decorate([g.deprecated],
g.prototype,"isDrawingSheetActive",null);__decorate([g.deprecated],g.prototype,"setBackgroundSheetEnabled",null);__decorate([g.deprecated],g.prototype,"getBackgroundSheetEnabled",null);__decorate([g.deprecated],g.prototype,"setBackgroundSelectionEnabled",null);__decorate([g.deprecated],g.prototype,"getBackgroundSelectionEnabled",null);__decorate([g.deprecated],g.prototype,"setSheetColors",null);__decorate([g.deprecated],g.prototype,"getSheetBackgroundColor",null);__decorate([g.deprecated],g.prototype,
"getSheetColor",null);__decorate([g.deprecated],g.prototype,"getSheetShadowColor",null);__decorate([g.deprecated],g.prototype,"getView",null);__decorate([g.deprecated],g.prototype,"getModel",null);__decorate([g.deprecated],g.prototype,"getOverlayManager",null);__decorate([g.deprecated],g.prototype,"getMeasureManager",null);__decorate([g.deprecated],g.prototype,"getLineManager",null);__decorate([g.deprecated],g.prototype,"getCuttingManager",null);__decorate([g.deprecated],g.prototype,"getMarkupManager",
null);__decorate([g.deprecated],g.prototype,"getSelectionManager",null);__decorate([g.deprecated],g.prototype,"getExplodeManager",null);__decorate([g.deprecated],g.prototype,"getOperatorManager",null);__decorate([g.deprecated],g.prototype,"setAllowHighDPI",null);__decorate([g.deprecated],g.prototype,"getAllowHighDPI",null);__decorate([g.deprecated],g.prototype,"startSheetComparison",null);__decorate([g.deprecated],g.prototype,"endSheetComparison",null);return g}();d.WebViewer=h})(Communicator||(Communicator=
{}));
(function(d){(function(h){function g(c){for(var b=2*Math.PI/c,a=[],d=0;d<c;d++){var e=d*b,g=Math.sin(e);a.push(Math.cos(e));a.push(g)}return a}function a(c,b,a,e){void 0===e&&(e=1);var f=d.Point3.cross(a,new d.Point3(0,1,0));.001>f.length()&&(f=d.Point3.cross(a,new d.Point3(0,0,1)));a=d.Point3.cross(f,a);for(var k=2*Math.PI/c,g=[],h=0;h<c;h++){var q=h*k,r=Math.sin(q);q=Math.cos(q);r=f.copy().scale(r).add(a.copy().scale(q)).scale(e).add(b);g.push(r)}return g}function e(c,b,a,e,g){for(var f=[],k=[],
l=0;l<a.length;l++){var h=(l+1)%a.length;f.push(a[l]);f.push(a[h]);f.push(e[l]);f.push(a[h]);f.push(e[h]);f.push(e[l]);k.push(d.Point3.subtract(a[l],c));k.push(d.Point3.subtract(a[h],c));k.push(d.Point3.subtract(e[l],b));k.push(d.Point3.subtract(a[h],c));k.push(d.Point3.subtract(e[h],b));k.push(d.Point3.subtract(e[l],b))}if(g)for(c=d.Point3.subtract(c,b),b=0;b<k.length;b++)k[b].add(c).normalize();return[f,k]}h.generateSphereMeshData=function(){var c=(1+Math.sqrt(5))/2,b=Math.sqrt(10+2*Math.sqrt(5))/
(4*c),a=b/2;c=b/(2*c);var e=[];e[0]=new d.Point3(-c,a,0);e[1]=new d.Point3(c,a,0);e[2]=new d.Point3(-c,-a,0);e[3]=new d.Point3(c,-a,0);e[4]=new d.Point3(0,-c,a);e[5]=new d.Point3(0,c,a);e[6]=new d.Point3(0,-c,-a);e[7]=new d.Point3(0,c,-a);e[8]=new d.Point3(a,0,-c);e[9]=new d.Point3(a,0,c);e[10]=new d.Point3(-a,0,-c);e[11]=new d.Point3(-a,0,c);for(a=0;a<e.length;a++)e[a].normalize();var g=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,
6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],n=12;a=function(b){var c=[];g.map(function(b){var a=e[b[0]],f=e[b[1]],k=e[b[2]];e[n++]=(new d.Point3(a.x+f.x,a.y+f.y,a.z+f.z)).scale(.5).normalize();e[n++]=(new d.Point3(f.x+k.x,f.y+k.y,f.z+k.z)).scale(.5).normalize();e[n++]=(new d.Point3(k.x+a.x,k.y+a.y,k.z+a.z)).scale(.5).normalize();c.push([b[0],n-3,n-1]);c.push([n-3,n-2,n-1]);c.push([n-3,b[1],n-2]);c.push([n-2,b[2],n-1])});g=c};for(c=0;2>c;c++)a(c);a=[];c=[];b=0;for(var m=g;b<m.length;b++)for(var h=
m[b],q=0;3>q;q++){var r=h[q];a.push(e[r].x);a.push(e[r].y);a.push(e[r].z);r=e[r].normalize();c.push(r.x);c.push(r.y);c.push(r.z)}b=new d.MeshData;b.addFaces(a,c);b.setFaceWinding(d.FaceWinding.CounterClockwise);return b};h.generateConeCylinderMeshData=function(c,b,f,k,l,n){var m=new d.Matrix,h,q=f+n,r=g(b);for(h=0;h<r.length;h++)r[h]*=k;l=new d.Point3(0,q+l,0);h=new d.Point3(0,q,0);var u=m.transform(l),t=m.transform(h);l=[];var v=[];for(h=0;h<r.length;h+=2){var w=r[h],y=r[h+1],x=(h+2)%r.length,z=
r[x],B=r[x+1],A=r[h],D=r[h+1],C=r[x];x=r[x+1];var E=new d.Point3(w,q,y),F=new d.Point3(z,q,B);E=m.transform(E);F=m.transform(F);l.push(u);l.push(E);l.push(F);F=new d.Point3(0,1,0);A=new d.Point3(A,0,D);C=new d.Point3(C,0,x);D=m.transform(F);A=m.transform(A);C=m.transform(C);v.push(D);v.push(A);v.push(C);w=new d.Point3(w,q,y);z=new d.Point3(z,q,B);B=m.transform(w);z=m.transform(z);l.push(t);l.push(z);l.push(B);z=new d.Point3(0,-1,0);z=m.transform(z);v.push(z);v.push(z);v.push(z)}q=[];r=[];for(h=0;h<
l.length;h++)u=l[h],q.push(u.x),q.push(u.y),q.push(u.z),u=v[h],r.push(u.x),r.push(u.y),r.push(u.z);h=[q,r];l=[];v=[];r=g(b);for(q=0;q<r.length;q++)r[q]*=c;u=[];t=[];for(q=0;q<r.length;q+=2){z=r[q];B=r[q+1];x=(q+2)%r.length;w=r[x];y=r[x+1];C=r[q];A=r[q+1];D=r[x];x=r[x+1];u[0]=new d.Point3(z,f,B);u[1]=new d.Point3(z,0,B);u[2]=new d.Point3(w,0,y);u[3]=new d.Point3(w,0,y);u[4]=new d.Point3(w,f,y);u[5]=new d.Point3(z,f,B);t[0]=new d.Point3(C,0,A);t[1]=new d.Point3(C,0,A);t[2]=new d.Point3(D,0,x);t[3]=
new d.Point3(D,0,x);t[4]=new d.Point3(D,0,x);t[5]=new d.Point3(C,0,A);for(C=0;C<u.length;C++)A=m.transform(u[C]),l.push(A),A=m.transform(t[C]),v.push(A);u[0]=new d.Point3(w,0,y);u[1]=new d.Point3(z,0,B);u[2]=d.Point3.zero();t[0]=new d.Point3(0,-1,0);t[1]=new d.Point3(0,-1,0);t[2]=new d.Point3(0,-1,0);for(C=0;3>C;C++)A=m.transform(u[C]),l.push(A),A=m.transform(t[C]),v.push(A)}m=[];r=[];for(q=0;q<l.length;q++)u=l[q],m.push(u.x),m.push(u.y),m.push(u.z),u=v[q],r.push(u.x),r.push(u.y),r.push(u.z);m=[m,
r];l=new d.Point3(0,0,f);f=new d.Point3(0,0,f+n);n=new d.Point3(0,0,1);c=a(b,l,n,c);b=a(b,f,n,k);b=e(l,f,c,b,!0);k=[];c=[];for(f=0;f<b[0].length;f++)k.push(b[0][f].x),k.push(b[0][f].z),k.push(b[0][f].y),c.push(b[1][f].x),c.push(b[1][f].z),c.push(b[1][f].y);k=[k,c];b=h[0].concat(m[0]).concat(k[0]);k=h[1].concat(m[1]).concat(k[1]);c=new d.MeshData;c.setFaceWinding(d.FaceWinding.Clockwise);c.addFaces(b,k);return c};h.createCylinderMeshDataFromArc=function(c,b,f,k){for(var g=[],n=[],m,h=0;h<c.length-
3;h+=3){var q=new d.Point3(c[h],c[h+1],c[h+2]),r=new d.Point3(c[h+3],c[h+4],c[h+5]),u=a(f,q,b,k),t=a(f,r,b,k);m=e(q,r,u,t,!1);Array.prototype.push.apply(g,m[0]);Array.prototype.push.apply(n,m[1])}q=c.length;h=new d.Point3(c[q-3],c[q-2],c[q-1]);t=h.copy().subtract(new d.Point3(c[q-6],c[q-5],c[q-4])).normalize();q=a(2*f,h,b,k);r=h.copy().add(t.copy().scale(2/3));u=a(2*f,r,b,2*k);t=r.copy().add(t.copy().scale(2));m=e(h,r,q,u,!1);Array.prototype.push.apply(g,m[0]);Array.prototype.push.apply(n,m[1]);for(h=
0;h<q.length;h++)m=(h+1)%q.length,g.push(t),g.push(u[h]),g.push(u[m]),m=u[h].copy().subtract(r).normalize().add(t.copy().normalize()).normalize(),n.push(m),n.push(m),n.push(m);h=new d.Point3(c[0],c[1],c[2]);t=h.copy().subtract(new d.Point3(c[3],c[4],c[5])).normalize();q=a(2*f,h,b,k);r=h.copy().add(t.copy().scale(2/3));u=a(2*f,r,b,2*k);t=r.copy().add(t.copy().scale(2));m=e(r,h,u,q,!1);Array.prototype.push.apply(g,m[0]);Array.prototype.push.apply(n,m[1]);for(h=0;h<q.length;h++)m=(h+1)%q.length,g.push(t),
g.push(u[m]),g.push(u[h]),m=u[h].copy().subtract(r).normalize().add(t.copy().normalize()).normalize(),n.push(m),n.push(m),n.push(m);c=[];b=[];for(h=0;h<g.length;h++)f=g[h],c.push(f.x),c.push(f.y),c.push(f.z),m=n[h],b.push(m.x),b.push(m.y),b.push(m.z);g=new d.MeshData;g.setFaceWinding(d.FaceWinding.CounterClockwise);g.addFaces(c,b);return g}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(a,c){this._mode=a;this._impl=new d.Internal.IncrementalSelectionImpl(c)}a.create=function(d,c){return new a(d,c)};a.prototype.performSelection=function(a,c,b){var f=this._impl.viewer;"View"===this._mode?(f=f.view,void 0===b&&(b=[])):(h.TypeAssert(this._mode),f=f.selectionManager);void 0===c&&(c=null);return this._impl.performSelection(f,a,c,b)};a.prototype.isIdle=function(){return this._impl.isIdle()};a.prototype.waitForIdle=function(){return this._impl.waitForIdle()};
a.prototype.stopSelection=function(){return this._impl.stopSelection()};a.prototype.clearSelection=function(){return this._impl.clearSelection()};return a}();h.IncrementalSelection=g;(function(a){a.isScreenByAreaConfig=function(a){return"areaCssMin"in a};a.isRayDrillConfig=function(a){return"rayCssBoxRadius"in a};a.isConvexPolyhedronConfig=function(a){return"volumePlanes"in a};a.isSphereConfig=function(a){return"sphereRadius"in a}})(g=h.IncrementalSelection||(h.IncrementalSelection={}))})(d.Util||
(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(a){this._killHandles=[];this._activeSelectionCount=0;this._inactivityPromise=null;this.viewer=a}a.prototype.isIdle=function(){return 0===this._activeSelectionCount};a.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){if(0===this._activeSelectionCount)return console.assert(null===this._inactivityPromise),[2,Promise.resolve()];null===this._inactivityPromise&&(this._inactivityPromise=
h.OpenPromise.create());return[2,this._inactivityPromise]})})};a.prototype.stopSelection=function(){return __awaiter(this,void 0,void 0,function(){var a,c,b,f;return __generator(this,function(e){console.assert(this._killHandles.length===this._activeSelectionCount);a=[];c=0;for(b=this._killHandles;c<b.length;c++)f=b[c],a.push(f());return[2,d.Util.waitForAll(a)]})})};a.prototype.clearSelection=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return a=
this.viewer.selectionManager,a.clear(),[4,this.stopSelection()];case 1:return c.sent(),a.clear(),[2]}})})};a.prototype._advanceBySelectionManager=function(a,c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(f){b=this.viewer.selectionManager;return[2,b.advanceIncrementalSelection(a,c)]})})};a.prototype._advanceByView=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var f,d,e,g,m,h;return __generator(this,function(k){switch(k.label){case 0:return f=
this.viewer.view,[4,f.advanceIncrementalSelection(a)];case 1:return d=k.sent(),null===d?[2,!1]:c?[4,Promise.all(d.map(c))]:[3,3];case 2:e=k.sent(),d=d.filter(function(b,c){return e[c]}),k.label=3;case 3:g=0;for(m=d;g<m.length;g++)h=m[g],b.push(h);return[2,!0]}})})};a.prototype._wrapBeginSelection=function(a,c){return d.Util.IncrementalSelection.isScreenByAreaConfig(c)?a.beginScreenSelectByArea(c.areaCssMin,c.areaCssMax,c.pickConfig):d.Util.IncrementalSelection.isRayDrillConfig(c)?a.beginRayDrillSelection(c.rayCssOrigin,
c.rayCssBoxRadius,c.pickConfig):d.Util.IncrementalSelection.isConvexPolyhedronConfig(c)?a.beginConvexPolyhedronSelection(c.volumePlanes,c.heuristicOrigin,c.pickConfig):d.Util.IncrementalSelection.isSphereConfig(c)?a.beginSphereSelection(c.sphereCenter,c.sphereRadius,c.pickConfig):d.Util.TypeAssertNever(c)};a.prototype.performSelection=function(a,c,b,f){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return void 0!==f?[3,1]:[2,this._performSelection(a,
c,b,null)];case 1:return[4,this._performSelection(a,c,b,f)];case 2:return d.sent(),[2,f]}})})};a.prototype._performSelection=function(a,c,b,f){return __awaiter(this,void 0,void 0,function(){var e,g,n,m,p,q,r,u,t=this;return __generator(this,function(k){switch(k.label){case 0:e=this._wrapBeginSelection(a,c);if(null===e)return[2];++this._activeSelectionCount;g=this.viewer.selectionManager;n=null===f;m=!1;p=h.Lazy.create(function(){return __awaiter(t,void 0,void 0,function(){var b,c;return __generator(this,
function(a){switch(a.label){case 0:m=!0,a.label=1;case 1:return a.trys.push([1,,7,8]),[4,e];case 2:return b=a.sent(),n?[4,g.endIncrementalSelection(b)]:[3,4];case 3:return a.sent(),[3,6];case 4:return[4,this.viewer.view.endIncrementalSelection(b)];case 5:a.sent(),a.label=6;case 6:return[3,8];case 7:return c=this._killHandles.indexOf(q),console.assert(0<=c),this._killHandles.splice(c,1),--this._activeSelectionCount,0===this._activeSelectionCount&&null!==this._inactivityPromise&&(this._inactivityPromise.resolve(),
this._inactivityPromise=null),[7];case 8:return[2]}})})});q=function(){return p.get()};this._killHandles.push(q);k.label=1;case 1:return k.trys.push([1,,11,13]),[4,e];case 2:r=k.sent(),u=!0,k.label=3;case 3:return!u||m?[3,10]:n?[4,this._advanceBySelectionManager(r,b)]:[3,5];case 4:return u=k.sent(),[3,7];case 5:return[4,this._advanceByView(r,b,f)];case 6:u=k.sent(),k.label=7;case 7:return!u||m?[3,9]:[4,d.Util.sleep(1)];case 8:k.sent(),k.label=9;case 9:return[3,3];case 10:return[3,13];case 11:return[4,
q()];case 12:return k.sent(),[7];case 13:return[2]}})})};return a}();h.IncrementalSelectionImpl=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(a){this._engine=a}a.prototype.getIdentityInc=function(){return this._identityInc};a.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return[4,this._engine.createIdentityMatrix()];case 1:return this._identityInc=a=c.sent(),[2]}})})};return a}();d.ScMatrixCache=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function g(b,c,a){if(b.selectionMask===d.SelectionMask.None)throw new d.CommunicatorError("selectionMask is None");return __assign({},b,{cullSuboptimalEntities:c,enableOcclusionChecks:c,restrictLinesAndPointsToSelectedFaceInstances:a?!1:b.restrictLinesAndPointsToSelectedFaceInstances})}function a(b,c){var a=d.Point3.createFromArray(b.rayPoint),f=d.Point3.createFromArray(b.normal),e=new d.Point3(b.bounding.min[0],b.bounding.min[1],b.bounding.min[2]),k=new d.Point3(b.bounding.max[0],
b.bounding.max[1],b.bounding.max[2]);e=new d.Box(e,k);c=new d.Selection.FaceEntity(a,f,b.elementIndex,b.overlayIndex,b.elementBits,e,c);b=b.instanceInc;return d.Selection.SelectionItem.create(b[1],b[0],c,null,null)}function e(b){var c=new d.Point3(b.bounding.min[0],b.bounding.min[1],b.bounding.min[2]),a=new d.Point3(b.bounding.max[0],b.bounding.max[1],b.bounding.max[2]);c=new d.Box(c,a);c=new d.Selection.LineEntity(b.elementIndex,d.Point3.createFromArray(b.point),b.lineSegmentVertices,b.bestLineSegmentVertexIndex,
c,b.overlayIndex,b.elementBits);b=b.instanceInc;return d.Selection.SelectionItem.create(b[1],b[0],null,c,null)}function c(b){var c=new d.Selection.PointEntity(d.Point3.createFromArray(b.point),b.elementIndex,b.overlayIndex,b.elementBits);b=b.instanceInc;return d.Selection.SelectionItem.create(b[1],b[0],null,null,c)}function b(b){return null!==b.point?(b=b.point.entities[0],c(b)):null!==b.line?(b=b.line.entities[0],e(b)):null!==b.face?(b=b.face.entities[0],a(b,!1)):null!==b.proximityFace?(b=b.proximityFace.entities[0],
a(b,!0)):null}function f(b){var f=null;if(null!==b.face){var k=b.face.entities[0];f=a(k,!1)}else null!==b.proximityFace&&(k=b.proximityFace.entities[0],f=a(k,!0));var g=null;null!==b.line&&(k=b.line.entities[0],g=e(k));k=null;null!==b.point&&(k=b.point.entities[0],k=c(k));return new d.Selection.CompositeSelectionItem(f,g,k)}function k(b){var f=[];if(null!==b.face)for(var d=0,k=b.face.entities;d<k.length;d++){var g=a(k[d],!1);f.push(g)}a:for(g=b.line,d=b.point,k=b.proximityFace,b=null!==g?g.entities:
[],d=null!==d?d.entities:[],k=null!==k?k.entities:[],g=[b,d,k];;){for(var l,n=l=Number.POSITIVE_INFINITY,m=null,h=0;h<g.length;h++){var x=g[h];if(0<x.length){var z=x[0];z.radialMetric<l?(l=z.radialMetric,n=z.zMetric,m=x):z.radialMetric===l&&z.zMetric<n&&(n=z.zMetric,m=x)}}l=m;if(null===l){console.assert(0===b.length);console.assert(0===d.length);console.assert(0===k.length);break a}console.assert(0<l.length);l===b?(l=b.pop(),l=e(l)):l===d?(l=d.pop(),l=c(l)):(console.assert(l===k),l=k.pop(),l=a(l,
!0));f.push(l)}return f}var l;(function(b){b[b.Batch=1E3]="Batch";b[b.Chunk=100]="Chunk"})(l=h.AdvanceSelectionCapacity||(h.AdvanceSelectionCapacity={}));var n=function(){function c(b){this._pickTolerance=20;this._incrementalChunkedItems=new Map;this._sc=b}c.prototype.setPickTolerance=function(b){this._pickTolerance=b};c.prototype.getPickTolerance=function(){return this._pickTolerance};c.prototype.beginScreenAreaSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,e,k;return __generator(this,
function(g){switch(g.label){case 0:f=a,g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this._sc.beginScreenAreaSelection(b.x,b.y,c.x,c.y,f)];case 2:return e=g.sent(),[3,4];case 3:k=g.sent();if(SC.isError(k)&&"beginScreenAreaSelection"===k.scFunction)throw new d.SelectionInvalidatedError;throw k;case 4:return[2,new d.Selection.IncrementalSelectionId(e)]}})})};c.prototype.beginRayDrillSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,e,k;return __generator(this,function(g){switch(g.label){case 0:f=
a,g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this._sc.beginRayDrillSelection(b.x,b.y,c,f)];case 2:return e=g.sent(),[3,4];case 3:k=g.sent();if(SC.isError(k)&&"beginRayDrillSelection"===k.scFunction)throw new d.SelectionInvalidatedError;throw k;case 4:return[2,new d.Selection.IncrementalSelectionId(e)]}})})};c.prototype.beginConvexPolyhedronSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,e,k,g,l,n,m,h;return __generator(this,function(p){switch(p.label){case 0:f=
a;e=[];k=0;for(g=b;k<g.length;k++)l=g[k],e.push(l.getCoefficients());n=[c.x,c.y,c.z];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this._sc.beginConvexPolyhedronSelection(e,n,f)];case 2:return m=p.sent(),[3,4];case 3:h=p.sent();if(SC.isError(h)&&"beginConvexPolyhedronSelection"===h.scFunction)throw new d.SelectionInvalidatedError;throw h;case 4:return[2,new d.Selection.IncrementalSelectionId(m)]}})})};c.prototype.beginSphereSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,
e,k;return __generator(this,function(g){switch(g.label){case 0:f=a,g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this._sc.beginSphereSelection(b,c,f)];case 2:return e=g.sent(),[3,4];case 3:k=g.sent();if(SC.isError(k)&&"beginSphereSelection"===k.scFunction)throw new d.SelectionInvalidatedError;throw k;case 4:return[2,new d.Selection.IncrementalSelectionId(e)]}})})};c.prototype.endIncrementalSelection=function(b){this._incrementalChunkedItems.delete(b._handle);this._sc.endVolumeSelection(b._handle)};
c.prototype.advanceIncrementalSelection=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,f,e,k,g,n,m,p;return __generator(this,function(q){switch(q.label){case 0:if((a=this._incrementalChunkedItems.get(b._handle))&&a.length)return[2,a.pop()];q.label=1;case 1:return q.trys.push([1,3,,4]),[4,this._sc.advanceVolumeSelection(b._handle,l.Batch)];case 2:return f=q.sent(),[3,4];case 3:e=q.sent();if(SC.isError(e)&&"advanceVolumeSelection"===e.scFunction)throw new d.SelectionInvalidatedError;
throw e;case 4:return 2!==f.length||4294967295!==f[1]?[3,7]:c?[4,this._sc.setStreamIdleMarker()]:[3,6];case 5:return q.sent(),[2,this.advanceIncrementalSelection(b,!1)];case 6:return[2,null];case 7:k=[];for(g=0;g<f.length;g+=2)n=f[g],m=f[g+1],k.push(d.Selection.SelectionItem.create(m,n));if(k.length<=l.Chunk)return[2,k];p=h.chunkify(k,l.Chunk).reverse();this._incrementalChunkedItems.set(b._handle,p);return[2,p.pop()]}})})};c.prototype._screenSelectByRay=function(b,c,a,f){return __awaiter(this,void 0,
void 0,function(){var e,k,l,n;return __generator(this,function(m){e=g(c,a,f);k=c.selectionMask;n=(l=c.selectionMask!==d.SelectionMask.Face||c.enableProximityFaces)?this._pickTolerance:-1;return[2,this._sc.screenSelectByRay(k,b.x,b.y,n,e)]})})};c.prototype._worldSelectByRay=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,d;return __generator(this,function(e){f=g(c,a,!1);d=h.toScRay(b);return[2,this._sc.worldSelectByRay(d,f)]})})};c.prototype.pickFromScreen=function(c,a,f){return __awaiter(this,
void 0,void 0,function(){var d;return __generator(this,function(e){switch(e.label){case 0:return[4,this._screenSelectByRay(c,a,!0,f)];case 1:return d=e.sent(),[2,b(d)]}})})};c.prototype.pickAllFromScreen=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return[4,this._screenSelectByRay(b,c,!1,a)];case 1:return f=d.sent(),[2,k(f)]}})})};c.prototype.compositePickFromScreen=function(b,c,a){return __awaiter(this,void 0,void 0,
function(){var d;return __generator(this,function(e){switch(e.label){case 0:return[4,this._screenSelectByRay(b,c,!0,a)];case 1:return d=e.sent(),[2,f(d)]}})})};c.prototype.pickFromRay=function(c,a){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return[4,this._worldSelectByRay(c,a,!0)];case 1:return f=d.sent(),[2,b(f)]}})})};c.prototype.pickAllFromRay=function(b,c){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,
function(f){switch(f.label){case 0:return[4,this._worldSelectByRay(b,c,!1)];case 1:return a=f.sent(),[2,k(a)]}})})};c.prototype.pickCompositeFromRay=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d,e;return __generator(this,function(k){switch(k.label){case 0:return a=g(c,!0,!1),d=h.toScRay(b),[4,this._sc.worldSelectByRay(d,a)];case 1:return e=k.sent(),[2,f(e)]}})})};return c}();h.ScSelectionManager=n})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){d=d.Internal||(d.Internal={});(d.Test||(d.Test={})).AdvanceSelectionCapacity=d.AdvanceSelectionCapacity})(Communicator||(Communicator={}));
(function(d){(function(h){h.toScRay=function(d){var a={origin:[],direction:[]};d.origin.toArray(a.origin);d.direction.toArray(a.direction);return a};h.makeFaceFaceDistanceItem=function(g){var a=new d.FaceFaceDistanceItem;a.pos1.fromArray(g.point1);a.pos2.fromArray(g.point2);a.distance=g.distance;return a}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(a){this.attributes=a}d.prototype.copy=function(){return new d(this.attributes.map(function(a){return a.copy()}))};return d}();d.SubentityAttributes=h})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){(function(a){a.isFace=function(a){return a instanceof d.SubentityProperties.CylinderElement||a instanceof d.SubentityProperties.PlaneElement||a instanceof d.SubentityProperties.ConeElement||a instanceof d.SubentityProperties.SphereElement||a instanceof d.SubentityProperties.TorusElement||a instanceof d.SubentityProperties.Blend01Element||a instanceof d.SubentityProperties.Blend02Element||a instanceof d.SubentityProperties.Blend03Element||a instanceof d.SubentityProperties.NurbsElement||
a instanceof d.SubentityProperties.CylindricalElement||a instanceof d.SubentityProperties.OffsetElement||a instanceof d.SubentityProperties.PipeElement||a instanceof d.SubentityProperties.RuledElement||a instanceof d.SubentityProperties.RevolutionElement||a instanceof d.SubentityProperties.ExtrusionElement||a instanceof d.SubentityProperties.FromCurvesElement||a instanceof d.SubentityProperties.TransformElement||a instanceof d.SubentityProperties.OtherFaceElement};a.isEdge=function(a){return a instanceof
d.SubentityProperties.LineElement||a instanceof d.SubentityProperties.CircleElement||a instanceof d.SubentityProperties.OtherEdgeElement}})(g.MeasurementProperty||(g.MeasurementProperty={}))})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){(function(a){(function(a){a.parseBinary=function(a){var k=d.SubentityProperties.FaceType,l=a.parseFaceType();switch(l){case k.Cylinder:return c.parseBinary(a);case k.Plane:return b.parseBinary(a);case k.Cone:return f.parseBinary(a);case k.Other:return n.parseBinary(a);case k.Sphere:return e.parseBinary(a);case k.Torus:return g.parseBinary(a);case k.Blend01:return m.parseBinary(a);case k.Blend02:return h.parseBinary(a);case k.Blend03:return q.parseBinary(a);case k.Nurbs:return r.parseBinary(a);
case k.Cylindrical:return u.parseBinary(a);case k.Offset:return t.parseBinary(a);case k.Pipe:return v.parseBinary(a);case k.Ruled:return w.parseBinary(a);case k.Revolution:return y.parseBinary(a);case k.Extrusion:return x.parseBinary(a);case k.FromCurves:return z.parseBinary(a);case k.Transform:return B.parseBinary(a);default:throw d.Util.TypeAssert(l),new d.AssemblyDataParseError("Unexpected measurement face type.");}};var c=function(){function b(){}b.parseBinary=function(b){var c=b.parseFloat_32(),
a=b.parsePoint3_32();b=b.parsePoint3_32();return new d.SubentityProperties.CylinderElement(c,a,b)};return b}();a.Cylinder=c;var b=function(){function b(){}b.parseBinary=function(b){var c=b.parsePoint3_32();b=b.parsePoint3_32();return new d.SubentityProperties.PlaneElement(c,b)};return b}();a.Plane=b;var f=function(){function b(){}b.parseBinary=function(b){var c=b.parseFloat_32(),a=b.parsePoint3_32(),f=b.parsePoint3_32();b=b.parseFloat_32();return new d.SubentityProperties.ConeElement(c,a,f,b)};return b}();
a.Cone=f;var e=function(){function b(){}b.parseBinary=function(b){var c=b.parseFloat_32(),a=b.parsePoint3_32();b=b.parsePoint3_32();return new d.SubentityProperties.SphereElement(c,a,b)};return b}();a.Sphere=e;var g=function(){function b(){}b.parseBinary=function(b){var c=b.parseFloat_32(),a=b.parseFloat_32(),f=b.parsePoint3_32();b=b.parsePoint3_32();return new d.SubentityProperties.TorusElement(c,a,f,b)};return b}();a.Torus=g;var n=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.OtherFaceElement};
return b}();a.Other=n;var m=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.Blend01Element};return b}();a.Blend01=m;var h=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.Blend02Element};return b}();a.Blend02=h;var q=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.Blend03Element};return b}();a.Blend03=q;var r=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.NurbsElement};
return b}();a.Nurbs=r;var u=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.CylindricalElement};return b}();a.Cylindrical=u;var t=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.OffsetElement};return b}();a.Offset=t;var v=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.PipeElement};return b}();a.Pipe=v;var w=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.RuledElement};
return b}();a.Ruled=w;var y=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.RevolutionElement};return b}();a.Revolution=y;var x=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.ExtrusionElement};return b}();a.Extrusion=x;var z=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.FromCurvesElement};return b}();a.FromCurves=z;var B=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.TransformElement};
return b}();a.Transform=B})(a.Face||(a.Face={}))})(g.MeasurementProperty||(g.MeasurementProperty={}))})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){(function(a){(function(a){a.parseBinary=function(a){var e=d.SubentityProperties.EdgeType,k=a.parseEdgeType();switch(k){case e.Line:return c.parseBinary(a);case e.Circle:return b.parseBinary(a);case e.Other:return f.parseBinary(a);default:throw d.Util.TypeAssert(k),new d.AssemblyDataParseError("Unexpected measurement edge type.");}};var c=function(){function b(){}b.parseBinary=function(b){b=b.parseFloat_32();return new d.SubentityProperties.LineElement(b)};return b}();
a.Line=c;var b=function(){function b(){}b.parseBinary=function(b){var c=b.parseFloat_32(),a=b.parsePoint3_32();b=b.parsePoint3_32();return new d.SubentityProperties.CircleElement(c,a,b)};return b}();a.Circle=b;var f=function(){function b(){}b.parseBinary=function(b){b=b.parseFloat_32();return new d.SubentityProperties.OtherEdgeElement(b)};return b}();a.Other=f})(a.Edge||(a.Edge={}))})(g.MeasurementProperty||(g.MeasurementProperty={}))})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||
(Communicator={}));
(function(d){(function(d){var g;(function(c){c[c.Undefined=0]="Undefined";c[c.Line=1]="Line";c[c.Circle=2]="Circle";c[c.Other=6]="Other"})(g=d.EdgeType||(d.EdgeType={}));var a;(function(c){c[c.Undefined=0]="Undefined";c[c.Cylinder=3]="Cylinder";c[c.Plane=4]="Plane";c[c.Cone=5]="Cone";c[c.Other=6]="Other";c[c.Sphere=7]="Sphere";c[c.Torus=8]="Torus";c[c.Blend01=9]="Blend01";c[c.Blend02=10]="Blend02";c[c.Blend03=11]="Blend03";c[c.Nurbs=12]="Nurbs";c[c.Cylindrical=13]="Cylindrical";c[c.Offset=14]="Offset";
c[c.Pipe=15]="Pipe";c[c.Ruled=16]="Ruled";c[c.Revolution=17]="Revolution";c[c.Extrusion=18]="Extrusion";c[c.FromCurves=19]="FromCurves";c[c.Transform=20]="Transform"})(a=d.FaceType||(d.FaceType={}));var e=function(){function c(b){this.length=b}c.prototype.copy=function(){return new c(this.length)};c.prototype.type=function(){return g.Line};return c}();d.LineElement=e;e=function(){function c(b,c,a){this.radius=b;this.origin=c.copy();this.normal=a.copy()}c.prototype.copy=function(){return new c(this.radius,
this.origin,this.normal)};c.prototype.type=function(){return g.Circle};return c}();d.CircleElement=e;e=function(){function c(b){this.length=b}c.prototype.copy=function(){return new c(this.length)};c.prototype.type=function(){return g.Other};return c}();d.OtherEdgeElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Other};return c}();d.OtherFaceElement=e;e=function(){function c(b,c,a){this.radius=b;this.origin=c.copy();this.normal=a.copy()}
c.prototype.copy=function(){return new c(this.radius,this.origin,this.normal)};c.prototype.type=function(){return a.Cylinder};return c}();d.CylinderElement=e;e=function(){function c(b,c){this.origin=b.copy();this.normal=c.copy()}c.prototype.copy=function(){return new c(this.origin,this.normal)};c.prototype.type=function(){return a.Plane};return c}();d.PlaneElement=e;e=function(){function c(b,c,a,d){this.radius=b;this.origin=c.copy();this.normal=a.copy();this.halfAngle=d}c.prototype.copy=function(){return new c(this.radius,
this.origin,this.normal,this.halfAngle)};c.prototype.type=function(){return a.Cone};return c}();d.ConeElement=e;e=function(){function c(b,c,a){this.radius=b;this.origin=c.copy();this.normal=a.copy()}c.prototype.copy=function(){return new c(this.radius,this.origin,this.normal)};c.prototype.type=function(){return a.Sphere};return c}();d.SphereElement=e;e=function(){function c(b,c,a,d){this.majorRadius=b;this.minorRadius=c;this.origin=a.copy();this.normal=d.copy()}c.prototype.copy=function(){return new c(this.majorRadius,
this.minorRadius,this.origin,this.normal)};c.prototype.type=function(){return a.Torus};return c}();d.TorusElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Blend01};return c}();d.Blend01Element=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Blend02};return c}();d.Blend02Element=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Blend03};
return c}();d.Blend03Element=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Nurbs};return c}();d.NurbsElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Cylindrical};return c}();d.CylindricalElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Offset};return c}();d.OffsetElement=e;e=function(){function c(){}c.prototype.copy=
function(){return new c};c.prototype.type=function(){return a.Pipe};return c}();d.PipeElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Ruled};return c}();d.RuledElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Revolution};return c}();d.RevolutionElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Extrusion};
return c}();d.ExtrusionElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.FromCurves};return c}();d.FromCurvesElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Transform};return c}();d.TransformElement=e})(d.SubentityProperties||(d.SubentityProperties={}))})(Communicator||(Communicator={}));
(function(d){d=d.StaticGenericType||(d.StaticGenericType={});d.IfcColumn="IFCCOLUMN";d.IfcCovering="IFCCOVERING";d.IfcCurtainWall="IFCCURTAINWALL";d.IfcDoor="IFCDOOR";d.IfcRamp="IFCRAMP";d.IfcRoof="IFCROOF";d.IfcSlab="IFCSLAB";d.IfcSpace="IFCSPACE";d.IfcStair="IFCSTAIR";d.IfcStairFlight="IFCSTAIRFLIGHT";d.IfcTransportElement="IFCTRANSPORTELEMENT";d.IfcWall="IFCWALL";d.IfcWallStandardCase="IFCWALLSTANDARDCASE";d.IfcWindow="IFCWINDOW"})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(b,c,a,f){return __awaiter(this,void 0,void 0,function(){var e,k,l,n,m,h,w,y;return __generator(this,function(p){switch(p.label){case 0:return[4,c.getNodeOrRepItem(a)];case 1:e=p.sent();if(null===e||e instanceof g.RepresentationItem||e instanceof g.PartDefinition)return[2,d.BimMask.None];k=g.getNodeGenericType(e);return null!==k?[3,3]:null===f?[2,d.BimMask.None]:[4,e.getAttributes()];case 2:l=p.sent();n=0;for(m=l;n<m.length;n++)if(h=m[n],w=h.getTitle(),
w===f){k=h.getValue();break}if(null===k)return[2,d.BimMask.None];p.label=3;case 3:return y=b(k),y!==d.BimMask.None?[2,y]:[2,d.BimMask.None]}})})}function e(b){return __awaiter(this,void 0,void 0,function(){var c,a;return __generator(this,function(f){switch(f.label){case 0:return c=[],a={enterAnyBody:function(b){b instanceof g.BodyInstance&&c.push(b)}},[4,g.WalkerAsync.walk(a,b,g.WalkRestriction.None)];case 1:return f.sent(),[2,c]}})})}function c(b){return __awaiter(this,void 0,void 0,function(){var c,
a,f,k,g,h;return __generator(this,function(l){switch(l.label){case 0:return[4,e(b)];case 1:c=l.sent();a=new Set;f=0;for(k=c;f<k.length;f++)g=k[f],h=g.getParent(),a.add(h);return[2,d.Util.setToArray(a)]}})})}function b(b,c,f,e){return __awaiter(this,void 0,void 0,function(){var k,g,l,n,m,h,w,y,x,z,B;return __generator(this,function(p){switch(p.label){case 0:k=[];g=0;for(l=f;g<l.length;g++)n=l[g],m=a(b,c,n,e),k.push(m);return[4,Promise.all(k)];case 1:h=p.sent();w=[];y=[];x=[];for(z=0;z<f.length;++z)n=
f[z],B=h[z],B!==d.BimMask.None&&(0!==(B&d.BimMask.Floor)&&w.push(n),0!==(B&d.BimMask.Wall)&&y.push(n),0!==(B&d.BimMask.Door)&&x.push(n));return[2,{floors:w,walls:y,doors:x}]}})})}function f(b){for(var c=[],a=0;a<b.length;a++)for(var f=0,d=b[a].getBodyInstances();f<d.length;f++){var e=d[f].getInstanceInc();c.push(e[0],e[1])}return c}g.hasEffectiveGenericType=function(b,c){for(;null!==b;){if(b.getName()===c||g.getNodeGenericType(b)===c)return!0;b=g.towardProductOccurrence(b.getParent())}return!1};g.ifcAttributeToBimMask=
function(b){switch(b){case d.StaticGenericType.IfcColumn:case d.StaticGenericType.IfcCurtainWall:case d.StaticGenericType.IfcStair:case d.StaticGenericType.IfcStairFlight:case d.StaticGenericType.IfcWall:case d.StaticGenericType.IfcWallStandardCase:case d.StaticGenericType.IfcWindow:return d.BimMask.Wall|d.BimMask.Floor;case d.StaticGenericType.IfcCovering:case d.StaticGenericType.IfcRamp:case d.StaticGenericType.IfcRoof:case d.StaticGenericType.IfcSlab:return d.BimMask.Floor;case d.StaticGenericType.IfcDoor:case d.StaticGenericType.IfcTransportElement:return d.BimMask.Door|
d.BimMask.Floor}return d.BimMask.None};g.registerBimNodes=function(a,d,e,g,h){return __awaiter(this,void 0,void 0,function(){var k,l,n,m,p;return __generator(this,function(q){switch(q.label){case 0:return[4,c(g)];case 1:return k=q.sent(),[4,b(a,e,k,h)];case 2:return l=q.sent(),n=f(l.floors),d.registerBimInstances(n,0),m=f(l.walls),d.registerBimInstances(m,1),p=f(l.doors),d.registerBimInstances(p,2),[2]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function c(b,c,a,d,e,g,h){this.headerVersion=b;this._rootAssemblyDataKey=c;this.isDrawing=a;this.isMeasurable=d;this.originalFileName=e;this.originalFileType=g;this.doublePrecisionMatrices=h}c.prototype.supportsAttributeBits=function(){return 5<=this.headerVersion};c.prototype.rootAssemblyDataKey=function(){console.assert(4294967295!==this._rootAssemblyDataKey);return this._rootAssemblyDataKey};c.parseBinary=function(b){if(0===b.length)return null;
b=new g.AssemblyDataParser(new e(null,b));var a=new g.NodeParseBits;a.parseBits1(b);if(!a.hasBits1(8388608))return null;var k=b.parseAssemblyDataHeaderVersion();if(k>c._maxHeaderVersion)throw new d.AssemblyDataParseError("Unknown header version: "+k);if(4<=k){var l=b.parseAssemblyDataVersion(3);if(!h.versionAtLeast(g.MaxModelFileVersion,l))throw new d.AssemblyDataParseError("Invalid version: "+h.versionString(l));}a.parseBits2(b);l=b.parseDataKey();var n=b.parseBoolean(),m="",p=d.FileType.Unknown,
q=!1;var r=1<=k?b.parseBoolean():!0;3<=k&&(q=a.hasBits2(64),a.hasBits2(4)&&(m=b.parseCString()),p=b.parseIndex_32());return new c(k,l,n,r,m,p,q)};c._maxHeaderVersion=5;c.dynamic=new c(c._maxHeaderVersion,4294967295,!1,!1,"",d.FileType.Unknown,!0);return c}();g.AssemblyDataHeader=a;var e=function(){return function(c,b){this.header=c;this.bytes=b}}();g.AssemblyData=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){return function(){this.prototypes=new Map;this.partDefinitions=new Map}}(),e=function(){return function(){this.bodies=new Map;this.contexts=[]}}(),c=function(){function b(b,c,a,e,m,p){this._centralQueueClock=new h.Clock;this._productOccurrences=new Map;this._pmis=new Map;this._cadViews=new Map;this._bodyInstances=new Map;this._pmiBodies=new Map;this._viewFrames=new Map;this._partDefinitions=new Map;this._representationItems=new Map;this._partToInstance=
new Map;this._filters=[];this._layers=new Map;this._layersIds=new Map;this._nextLayerId=0;this._genericTypeToNodes=new Map;this._genericIdToNode=new Map;this._cadConfigurations=new Set;this._modelContents=new Map;this._inclusionContents=new Map;this._nodeDeletionBlackList=new Set;this._meshDeletionBlackList=new Set;this._dynamicNodeIdSeed=g.invalidNodeId;this._currentNodeIdOffset=0;this._initialEmptyNodeIdOffsetObtained=!1;this._firstProductOccurrenceWithView=this._defaultCadConfiguration=this._activeCadConfiguration=
this._activeCadView=null;this._isMeasurable=this._containsDrawings=!1;this._initiallyHiddenStayHidden=this._automaticMeasurementUnitScaling=!0;this._nextLoadId=0;this._activeLoadIds=new Set;this._requestedNodes=new Map;this._unnamedDrawingViewCount=this._unnamedDrawingSheetCount=this._unnamedGroupCount=this._unnamedProductCount=0;this._seenExternalModel=this._isInitialized=!1;this._config=__assign({},b);this._engine=c;this._callbackManager=a;this._cuttingManager=e;this._view=m;this._model=p;this._isScs=
2===this._engine.getSessionType();console.assert(!this._isScs||this._engine.getRendererType()===d.RendererType.Client)}b.prototype.initialize=function(b){var c=this;console.assert(void 0===this._rootLoadContext);console.assert(void 0===this._rootNode);console.assert(!this._isInitialized);this._isInitialized=!0;console.assert(void 0===this._centralQueue);this._centralQueue=new h.PromiseQueue(b.maxConcurrentAttachments(),!1);this._callbackManager.bind({_inputInteraction:function(b,a){c._onUserInteraction(b,
a)}});this._rootLoadContext=new g.LoadContext(null,d.EmptyModelName,null);b=new g.AttachContext(new g.ScKeyRemapper,0,!1,0,this._rootLoadContext);this._rootLoadContext.addAttachContext(b);var a=new g.InclusionContext(this,b,0,0);b.addInclusionContext(a);this._rootNode=g.ProductOccurrence.createDynamic(this,a,"Models",null,null,!0);a.addProductOccurrence(this._rootNode);console.assert(this._rootNode.isAbsoluteRoot());this.preventNodeDeletion(this._rootLoadContext);this.preventNodeDeletion(b);this.preventNodeDeletion(a);
this.preventNodeDeletion(this._rootNode);this._rootNode.markLoaded()};b.prototype.isInitialized=function(){return this._isInitialized};b.prototype.getRootNode=function(){return this._rootNode};b.prototype.getAbstractScEngine=function(){return this._engine};b.prototype.generateDynamicNodeId=function(){return--this._dynamicNodeIdSeed};b.prototype.newNodeIdOffset=function(){if(!this._initialEmptyNodeIdOffsetObtained)return this._initialEmptyNodeIdOffsetObtained=!0,console.assert(0===this._currentNodeIdOffset),
0;var b=this._currentNodeIdOffset;this._currentNodeIdOffset+=4294967296;return b};b.prototype.getLowestAvailableNodeId=function(){return this._currentNodeIdOffset};b.prototype.tryParseHeader=function(b){var c=this,a=g.AssemblyDataHeader.parseBinary(b);if(null===a)return null;this._containsDrawings=this._containsDrawings||a.isDrawing;this._isMeasurable=this._isMeasurable||a.isMeasurable;return this._callbackManager.promiseTrigger("_modelStructureHeaderParsed",null,a).then(function(){c._callbackManager.trigger("modelStructureHeaderParsed",
a.originalFileName,a.originalFileType);return a})};b.prototype._isRegistered=function(b){return this._productOccurrences.has(b)||this._pmis.has(b)||this._cadViews.has(b)||this._bodyInstances.has(b)||this._pmiBodies.has(b)||this._viewFrames.has(b)||this._partDefinitions.has(b)||this._representationItems.has(b)};b.prototype.registerProductOccurrence=function(b){if(!b.isMissing()){var c=b.getRuntimeId();console.assert(!this._isRegistered(c));this._productOccurrences.set(c,b);c=g.getNodeGenericType(b);
null!==c&&this.registerGenericType(b,c);c=b.getGenericId();null!==c&&this.registerGenericGlobalId(b,c);b.isAConfigurationNode()&&this._registerCadConfiguration(b);if(b.isADrawingSheetNode()||b.isADrawingViewNode())this._containsDrawings=!0}};b.prototype.lookupProductOccurrence=function(b){b=this._productOccurrences.get(b);return void 0!==b?b:null};b.prototype.registerPmi=function(b){var c=b.getRuntimeId();console.assert(!this._isRegistered(c));this._pmis.set(c,b)};b.prototype.lookupPmi=function(b){b=
this._pmis.get(b);return void 0!==b?b:null};b.prototype.registerCadView=function(b){null===this._firstProductOccurrenceWithView&&(this._firstProductOccurrenceWithView=b.getParent());var c=b.getRuntimeId();console.assert(!this._isRegistered(c));this._cadViews.set(c,b)};b.prototype.getFirstProductOccurrenceWithView=function(){return this._firstProductOccurrenceWithView};b.prototype.lookupCadView=function(b){b=this._cadViews.get(b);return void 0!==b?b:null};b.prototype.registerBodyInstance=function(b){var c=
b.getRuntimeId();console.assert(!this._isRegistered(c));this._bodyInstances.set(c,b);this._registerAnyBodyByInstanceInc(b)};b.prototype.lookupBodyInstance=function(b){b=this._bodyInstances.get(b);return void 0!==b?b:null};b.prototype.registerPmiBody=function(b){var c=b.getRuntimeId();console.assert(!this._isRegistered(c));this._pmiBodies.set(c,b);this._registerAnyBodyByInstanceInc(b)};b.prototype.lookupPmiBody=function(b){b=this._pmiBodies.get(b);return void 0!==b?b:null};b.prototype.registerViewFrame=
function(b){var c=b.getRuntimeId();console.assert(!this._isRegistered(c));this._viewFrames.set(c,b);this._registerAnyBodyByInstanceInc(b)};b.prototype.lookupViewFrame=function(b){b=this._viewFrames.get(b);return void 0!==b?b:null};b.prototype.registerPartDefinition=function(b){if(!b.isMissing()){var c=b.getRuntimeId();console.assert(!this._isRegistered(c));this._partDefinitions.set(c,b)}};b.prototype.lookupPartDefinition=function(b){b=this._partDefinitions.get(b);return void 0!==b?b:null};b.prototype.registerRepresentationItem=
function(b){var c=b.getRuntimeId();console.assert(!this._isRegistered(c));this._representationItems.set(c,b)};b.prototype.lookupRepresentationItem=function(b){b=this._representationItems.get(b);return void 0!==b?b:null};b.prototype.lookupAnyBody=function(b){return this.lookupBodyInstance(b)||this.lookupPmiBody(b)||this.lookupViewFrame(b)};b.prototype.lookupAnyTreeNode=function(b){return this.lookupProductOccurrence(b)||this.lookupPmi(b)||this.lookupCadView(b)||this.lookupAnyBody(b)};b.prototype.lookupAnyNonTreeNode=
function(b){return this.lookupRepresentationItem(b)||this.lookupPartDefinition(b)};b.prototype.lookupAnyNode=function(b){return this.lookupAnyTreeNode(b)||this.lookupAnyNonTreeNode(b)};b.prototype._registerCadConfiguration=function(b){console.assert(b.isAConfigurationNode());console.assert(!this._cadConfigurations.has(b));this._cadConfigurations.add(b);b.isADefaultNode()&&null===this._defaultCadConfiguration&&(this._defaultCadConfiguration=b)};b.prototype.getInstanceCountByInclusion=function(b){return this._getInclusionContent(b).bodies.size};
b.prototype.lookupAnyBodyByInstanceInc=function(b,c){b=this._getInclusionContent(b).bodies.get(c);return void 0!==b?b:null};b.prototype._registerAnyBodyByInstanceInc=function(b){var c=b.getInstanceInc(),a=this._getInclusionContent(c[0]),f=a.bodies.get(c[1]);if(void 0!==f){console.assert(b.hasAuthoredId());if(f.hasAuthoredId()){console.assert(f.constructor===b.constructor);h.CompileTime.disable&&console.assert(!1);return}console.assert(f.constructor===g.BodyInstance);f=f.getRuntimeId();b instanceof
g.BodyInstance?this._bodyInstances.set(f,b):b instanceof g.PmiBody?this._pmiBodies.set(f,b):(d.Util.TypeAssert(b),this._viewFrames.set(f,b))}a.bodies.set(c[1],b)};b.prototype._getInclusionContent=function(b){console.assert(4294967295!==b);var c=this._inclusionContents.get(b);void 0===c&&(c=new e,this._inclusionContents.set(b,c));return c};b.prototype._getModelContent=function(b,c){console.assert(4294967295!==c);var f=this._modelContents.get(b);void 0===f&&(f=new Map,this._modelContents.set(b,f));
b=f.get(c);void 0===b&&(b=new a,f.set(c,b));return b};b.prototype.registerPrototypeByDataId=function(b,c,a,d){b=this._getModelContent(b,c);console.assert(!b.prototypes.has(a));b.prototypes.set(a,d)};b.prototype.registerPartDefinitionByDataId=function(b,c,a,d){b=this._getModelContent(b,c);console.assert(!b.partDefinitions.has(a));b.partDefinitions.set(a,d)};b.prototype.lookupPrototypeByDataId=function(b,c,a){b=this._getModelContent(b,c).prototypes.get(a);return void 0!==b?b:null};b.prototype.lookupPartDefinitionByDataId=
function(b,c,a){b=this._getModelContent(b,c).partDefinitions.get(a);return void 0!==b?b:null};b.prototype.registerInclusionContext=function(b){var c=b.getInclusionKey();this._getInclusionContent(c).contexts.push(b)};b.prototype.getInclusionContexts=function(b){return this._getInclusionContent(b).contexts};b.prototype._createLayer=function(b,c,a,d){a=new g.Layer(b,c,a,d);console.assert(!this._layers.has(b));this._layers.set(b,a);null!==c&&this._updateNameToLayersMap(c,b);return a};b.prototype._updateNameToLayersMap=
function(b,c){var a=this._layersIds.get(b);void 0!==a?a.push(c):this._layersIds.set(b,[c])};b.prototype.createLayer=function(b,c,a){var f=this._nextLayerId++;c=this._createLayer(f,c,[],[]);a.addLayerIdToMap(f,b);return c};b.prototype.updateLayerName=function(b,c){var a=this._layers.get(b);void 0!==a&&(a.name=c,this._updateNameToLayersMap(c,b))};b.prototype._registerNodeInLayer=function(b,c,a){var f=g.towardLoadContext(b),d=f.getRuntimeLayerId(c);null===d&&(d=this._nextLayerId++,this._createLayer(d,
null,[b],[]),f.addLayerIdToMap(d,c));var e=this._layers.get(d);void 0!==e?a(e).push(b):(console.assert(!1,"Layer has mapping in LoadContext but not represented in AssemblyTree"),this._createLayer(d,null,[b],[]),f.addLayerIdToMap(d,c))};b.prototype.registerNodeInLayer=function(b,c){return this._registerNodeInLayer(b,c,function(b){return b.nodes})};b.prototype.registerTreeNodeInLayer=function(b,c){return this._registerNodeInLayer(b,c,function(b){return b.treeNodes})};b.prototype.addFilter=function(b,
c){this._filters.push({filter:b,loadContext:c})};b.prototype.getFilters=function(){for(var b=new Map,c=0;c<this._filters.length;c++){var a=this.getFilterName(c)||"";b.set(c,a)}return b};b.prototype.getFilterName=function(b){return b<this._filters.length?this._filters[b].filter.name||"":null};b.prototype.getFiltersWithNode=function(b){for(var c=b.getAuthoredId(),a=this._filters,d=[],f=0;f<a.length;f++){var e=a[f],g=e.filter;e=e.loadContext;if(null!==g.layers)for(var h=0,u=g.layers.authoredIds;h<u.length;h++){var t=
e.getRuntimeLayerId(u[h]);if(null!==t){var v=this.getNodesFromLayer(t);if(null!==v)for(t=0;t<v.length;t++)b===v[t]&&d.push(f)}}if(null!==g.entities)for(e=0,g=g.entities.ids;e<g.length;e++)c===g[e]&&d.push(f)}return d};b.prototype.getNodesFromFilterIds=function(b){for(var c=new Set,a=new Set,f=null,e=0;e<b.length;e++){var g=this._filters[b[e]],h=g.filter,r=g.loadContext,u=h.layers;if(null!==u){g=u.isInclusive;null===f&&(f=g);var t=0;for(u=u.authoredIds;t<u.length;t++){var v=r.getRuntimeLayerId(u[t]);
if(null!==v&&(v=this._layers.get(v))&&null!==v.nodes)for(var w=0,y=v.nodes;w<y.length;w++)v=y[w].getRuntimeId(),g?(c.add(v),a.delete(v)):(c.delete(v),a.add(v))}}r=h.entities;if(null!==r)for(g=r.isInclusive,null===f&&(f=g),h=0,r=r.ids;h<r.length;h++)v=r[h],g?(c.add(v),a.delete(v)):(c.delete(v),a.add(v))}return null===f?null:f?new d.FilteredNodes(!0,c):new d.FilteredNodes(!1,a)};b.prototype.getLayers=function(){var b=new Map;this._layers.forEach(function(c,a){b.set(a,c.name||"")});return b};b.prototype.getUniqueLayerNames=
function(){var b=new Set,c=[];this._layers.forEach(function(a){a=a.name;null===a||b.has(a)||(b.add(a),c.push(a))});return c};b.prototype.getLayerName=function(b){b=this._layers.get(b);return void 0!==b?b.name||"":null};b.prototype.getLayersIdFromName=function(b){b=this._layersIds.get(b);return void 0!==b?b:null};b.prototype.getNodesFromLayer=function(b,c){b=this._layers.get(b);return void 0!==b?c?b.treeNodes:b.nodes:null};b.prototype.getNodesFromLayers=function(b,c){for(var a=[],d=0;d<b.length;d++){var f=
this.getNodesFromLayer(b[d],c);if(null!==f)for(var e=0;e<f.length;e++)a.push(f[e])}return a};b.prototype.getNodesFromLayerName=function(b,c){b=this._layersIds.get(b);return void 0!==b?this.getNodesFromLayers(b,c):null};b.prototype.generateProductName=function(){return"Product "+this._unnamedProductCount++};b.prototype.generateGroupName=function(){return"Product "+this._unnamedGroupCount++};b.prototype.generateDrawingSheetName=function(){return"Product "+this._unnamedDrawingSheetCount++};b.prototype.generateDrawingViewName=
function(){return"Product "+this._unnamedDrawingViewCount++};b.prototype.forEachCadView=function(b){this._cadViews.forEach(b)};b.prototype.forEachPmi=function(b){this._pmis.forEach(b)};b.prototype.forEachCadConfiguration=function(b){this._cadConfigurations.forEach(b)};b.prototype.hasActiveCadView=function(){return null!==this._activeCadView};b.prototype.activateCadView=function(b,c){console.assert(null===this._activeCadView);this._activeCadView=b;return b.activate(this,this._engine,this._callbackManager,
this._cuttingManager,this._view,c,this._activeCadConfiguration)};b.prototype.deactivateActiveCadView=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return null===this._activeCadView?[2]:[4,this._activeCadView.deactivate(this._cuttingManager)];case 1:return b.sent(),console.assert(null!==this._activeCadView),this._activeCadView=null,[2]}})})};b.prototype.getCadViewPmis=function(b){var c=[];this._pmis.forEach(function(a){b.hasPmi(a)&&
c.push(a)});return c};b.prototype.isMeasureable=function(){return this._isMeasurable};b.prototype.containsDrawings=function(){return this._containsDrawings};b.prototype.getDefaultCadConfiguration=function(){return this._defaultCadConfiguration};b.prototype.getActiveCadConfiguration=function(){return this._activeCadConfiguration};b.prototype.activateCadConfiguration=function(b){console.assert(b.isAConfigurationNode());this._activeCadConfiguration=b;b=b.getRuntimeId();return this._view.isolateNodes([b],
d.DefaultTransitionDuration,!0)};b.prototype.massageAuthoredUserId=function(b,c){if(null===c)return this.generateDynamicNodeId();b=b.toRuntimeId(c);return null!==this.lookupAnyNode(b)?this.generateDynamicNodeId():c};b.prototype.createNode=function(b,c,a,d,e,h){void 0===h&&(h=null);c=g.ProductOccurrence.createDynamic(this,b,c,a,d,e,!1,h);b.addProductOccurrence(c);c.markLoaded();return c};b.prototype.createPart=function(b){b=g.PartDefinition.createDynamic(this,b,null);b.markLoaded();return b};b.prototype.setPart=
function(b,c){c.addReferrer(b);var a=this._partToInstance.get(c);if(void 0===a){a=g.towardInclusionContext(this._rootNode);var d=h.LazyObject.create(function(){console.assert(void 0!==f);return new g.SharedPrototypeContext(h.LazyPromise.create(f))});a=new g.PrototypeContext(d,a);var f=g.ProductOccurrence.createDynamic(this,a,null,null,null,!0);f.setPartDefinition(c);f.markLoaded()}b.setPrototype(a)};b.prototype._createCadView=function(b,c,a,d,e,h,q,r){c=g.CadView.createDynamic(this,b,c,a,d,e,h,q,
r);b.addCadView(c);c.markLoaded();return c};b.prototype._createCadViewInstance=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d,f,e,k,l,h,t,v,w;return __generator(this,function(n){switch(n.label){case 0:return null===a?[3,2]:[4,b.createMeshInstance(a)];case 1:d=n.sent(),f=d[0],e=d[1],k=this.generateDynamicNodeId(),l={nodeId:k,bits:786432,name:null,localTransform:null,attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,
userDatas:null},h={nodeInfo:l,inclusionKey:f,instanceKey:e,bits:0},t=g.towardAttachContext(c),v=t.getMasterModelKey(),console.assert(c.isLoaded()),w=g.ViewFrame.reify(this,v,c,h),c.setViewFrame(w),w.markLoaded(),n.label=2;case 2:return[2]}})})};b.prototype.createCadView=function(b,c,a,d,e,g,h,r,u,t){c=this._createCadView(c,a,d,e,g,h,r,u);null!==t&&(b=this._createCadViewInstance(b,c,t),b);return c};b.prototype.createMeshInstance=function(b,c,a,d,e,h,q,r){var f=0;q&&(f|=16384);r&&(f|=268435456);c=g.BodyInstance.createDynamic(this,
c,a,d,e,h,f);h.addBodyInstance(c);b&&c.markLoaded();return c};b.prototype.createPmiInstance=function(b,c,a,d,e,h,q,r){var f=g.towardInclusionContext(e);b={nodeInfo:{nodeId:this.massageAuthoredUserId(f,a),bits:1073741824,name:d,localTransform:null,attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},inclusionKey:b,instanceKey:c,bits:0};d=g.Pmi.createDynamic(this,f,e,d,h,q,[b],r);e.addPmi(d);d.markLoaded();return d};b.prototype.getRelationshipsOfItem=
function(b,c){var a=new Map,d=this.lookupAnyTreeNode(b);if(null===d)return a;b=0;for(d=g.towardInclusionContext(d).getRelationships();b<d.length;b++){var f=d[b];if(null!==f.relating&&f.relating.relationElt.id===c)g.RelationshipUtils.addFromRelatingElt(f,a);else{var e=f.related,k=-1;null!==e&&(k=g.RelationshipUtils.findIndexInRelated(c,e.relationships));0<=k&&g.RelationshipUtils.addFromRelatedElt(f,a)}}return a};b.prototype.getAutomaticMeasurementUnitScaling=function(){return this._automaticMeasurementUnitScaling};
b.prototype.setAutomaticMeasurementUnitScaling=function(b){this._automaticMeasurementUnitScaling=b};b.prototype.getInitiallyHiddenStayHidden=function(){return this._initiallyHiddenStayHidden};b.prototype.setInitiallyHiddenStayHidden=function(b){this._initiallyHiddenStayHidden=b};b.prototype._removeIdMappingsRecursive=function(b){var c=this;return g.WalkerAsync.walk({enterProductOccurrence:function(b){c._productOccurrences.delete(b.getRuntimeId())},enterAnyBody:function(b){var a=b.getRuntimeId();b instanceof
g.BodyInstance?c._bodyInstances.delete(a):b instanceof g.PmiBody?c._pmiBodies.delete(a):(d.Util.TypeAssert(b),c._viewFrames.delete(a))},enterCadView:function(b){c._cadViews.delete(b.getRuntimeId())},enterPmi:function(b){c._pmis.delete(b.getRuntimeId())}},b,g.WalkRestriction.None)};b.prototype.deleteNode=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,f,e,h,q,r;return __generator(this,function(k){switch(k.label){case 0:if(!this._canDeleteNode(b))throw c=b.getRuntimeId(),new d.CommunicatorError("Cannot delete node ("+
c+")");a=g.gatherInstanceIncsSync(b,7,!0,new Set,g.WalkRestriction.None);this._engine.setPartVisibility(a,!1,!1);this._engine.setInstanceModifier(d.InstanceModifier.DoNotSelect,a,!0);if(!(b instanceof g.ProductOccurrence))return[3,2];this._cadConfigurations.delete(b)&&(b===this._activeCadConfiguration&&(this._activeCadConfiguration=null),b===this._defaultCadConfiguration&&(this._defaultCadConfiguration=null));f=b.getParent();console.assert(null!==f);null!==f&&(e=void 0,e=f instanceof g.PrototypeContext?
f.removeReferrer(b):f.removeProductOccurrence(b),console.assert(e));this._productOccurrences.delete(b.getRuntimeId());return[4,this._removeIdMappingsRecursive(b)];case 1:return k.sent(),[2,b.purgeContents()];case 2:d.Util.TypeAssert(b),h=b.getParent(),h.removeBodyInstance(b),q=b.getInstanceInc(),r=this._getInclusionContent(q[0]),r.bodies.delete(q[1]),this._bodyInstances.delete(b.getRuntimeId()),k.label=3;case 3:return[2]}})})};b.prototype._canDeleteNode=function(b){return!this._nodeDeletionBlackList.has(b)};
b.prototype.allowNodeDeletion=function(b){this._nodeDeletionBlackList.delete(b)};b.prototype.preventNodeDeletion=function(b){var c=b.getParent();if(c instanceof g.PrototypeContext)throw new d.InternalLogicError;null!==c&&(console.assert(null===c||this._nodeDeletionBlackList.has(c)),b instanceof g.ProductOccurrence?(console.assert(!b.hasAuthoredId()),console.assert(!b.isOutOfHierarchy())):b instanceof g.BodyInstance&&(c=b.getInstanceInc(),console.assert(!b.hasAuthoredId()),console.assert(0===c[0]),
console.assert(b.isOutOfHierarchy())));this._nodeDeletionBlackList.add(b)};b.prototype.preventMeshDeletion=function(b){this._meshDeletionBlackList.add(b)};b.prototype._resetContents=function(){return __awaiter(this,void 0,void 0,function(){var b=this;return __generator(this,function(c){switch(c.label){case 0:return this.hasActiveCadView()?[4,this.deactivateActiveCadView()]:[3,2];case 1:return c.sent(),[2,this._resetContents()];case 2:return[4,this._rootLoadContext.purgeContents()];case 3:return c.sent(),
this._productOccurrences.clear(),this._pmis.clear(),this._cadViews.clear(),this._bodyInstances.clear(),this._pmiBodies.clear(),this._viewFrames.clear(),this._partDefinitions.clear(),this._representationItems.clear(),this._partToInstance.clear(),this._filters.length=0,this._layers.clear(),this._layersIds.clear(),this._genericTypeToNodes.clear(),this._genericIdToNode.clear(),this._cadConfigurations.clear(),this._modelContents.clear(),this._inclusionContents.clear(),this._currentNodeIdOffset=0,this._firstProductOccurrenceWithView=
this._defaultCadConfiguration=this._activeCadConfiguration=this._activeCadView=null,this._isMeasurable=this._containsDrawings=!1,this._requestedNodes.clear(),this._unnamedDrawingViewCount=this._unnamedDrawingSheetCount=this._unnamedGroupCount=this._unnamedProductCount=0,this._seenExternalModel=!1,this._rootNode.unsetMeasurementUnit(),this._nodeDeletionBlackList.forEach(function(c){if(c instanceof g.ProductOccurrence){var a=c.getRuntimeId();b._productOccurrences.set(a,c);a=c.getParent();a instanceof
g.PrototypeContext?console.assert(!1):a.addProductOccurrence(c);c.setVisibility(!0);c.unsetMeasurementUnit();c.hasLocalTransformOverride()&&c.removeLocalTransformOverride()}else if(c instanceof g.BodyInstance){a=c.getRuntimeId();b._bodyInstances.set(a,c);a=c.getInstanceInc();var f=a[0];console.assert(0===f);f=b._getInclusionContent(f);f.bodies.set(a[1],c);c.getParent().addBodyInstance(c)}else c instanceof g.LoadContext?(a=c.getParent(),null!==a&&a.addLoadContext(c)):c instanceof g.AttachContext?c.getParent().addAttachContext(c):
(d.Util.TypeAssert(c),f=c.getInclusionKey(),console.assert(0===f),f=b._getInclusionContent(f),f.contexts.push(c),c.getParent().addInclusionContext(c))}),[2]}})})};b.prototype.reset=function(){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(a){switch(a.label){case 0:return[4,this._callbackManager.promiseTrigger("_resetAssemblyTreeBegin",null)];case 1:return a.sent(),[4,this._resetContents()];case 2:return a.sent(),b=[],this._nodeDeletionBlackList.forEach(function(c){c instanceof
g.BodyInstance&&(c=c.getInstanceInc(),console.assert(0===c[0]),b.push(c[1]))}),c=[],this._meshDeletionBlackList.forEach(function(b){c.push(b)}),[4,this._engine.resetToEmpty(b,c)];case 3:return a.sent(),[4,this._resetContents()];case 4:return a.sent(),[2]}})})};b.prototype.setViewAxes=function(b,c){this._model.setViewAxes(b,c)};b.prototype._requestIncsOfNodes=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,f,e,h,q,r,u,t;return __generator(this,function(k){switch(k.label){case 0:if(this._config.streamingMode!==
d.StreamingMode.OnDemand)return[2];c=new Set;a=[];f=[];e=0;for(h=b;e<h.length;e++)q=h[e],r=g.gatherInstanceIncs(q,7,!1,c).then(function(b){for(var c=0;c<b.length;c++)a.push(b[c])}),f.push(r);return[4,d.Util.waitForAll(f)];case 1:return k.sent(),u=[],t=[],c.forEach(function(b){if(!b.isRequested()){b.setRequested();var c=b.isInitiallyShown();c!==b.isVisible()&&(c?(b.setVisibility(!0),u.push(b.getRuntimeId())):(b.setVisibility(!1),t.push(b.getRuntimeId())))}}),0<u.length+t.length&&this._callbackManager.trigger("visibilityChanged",
u,t),this._engine.requestMeshInstances(a),[2]}})})};b.prototype._requestExternalModelsLocal=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(f){switch(f.label){case 0:return[4,c.loadPendingExternalModels(b)];case 1:return d=f.sent(),0===d.length?[3,4]:[4,g.markContextsLoaded(d)];case 2:return f.sent(),[4,this._requestNodes(b,[c],a)];case 3:f.sent(),f.label=4;case 4:return[2,d]}})})};b.prototype._requestExternalModelsNonLocal=function(b,c,a){return __awaiter(this,
void 0,void 0,function(){var d,f,e,k,l,u,t,v;return __generator(this,function(n){switch(n.label){case 0:return[4,g.gatherParentsOfPendingExternalModels(c)];case 1:d=n.sent();if(0===d.length)return[2,[]];f=[];e=0;for(k=d;e<k.length;e++)l=k[e],u=this._requestExternalModelsLocal(b,l,a),f.push(u);v=h.concatAll;return[4,Promise.all(f)];case 2:return t=v.apply(void 0,[n.sent()]),[2,t]}})})};b.prototype._requestExternalModelsOfNodes=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d,f,
e,k,g,l,t;return __generator(this,function(n){switch(n.label){case 0:d=[];f=0;for(e=c;f<e.length;f++)k=e[f],g=this._requestExternalModelsNonLocal(b,k,a),d.push(g);t=h.concatAll;return[4,Promise.all(d)];case 1:return l=t.apply(void 0,[n.sent()]),[2,l]}})})};b.prototype._requestNodes=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d,f,e,k,l,h,t,v,w;return __generator(this,function(n){switch(n.label){case 0:if(!a)for(d=0!==this._activeLoadIds.size,f=[],d&&this._activeLoadIds.forEach(function(b){f.push(b)}),
e=0,k=c;e<k.length;e++)l=k[e],d&&this._requestedNodes.set(l,f),l instanceof g.ProductOccurrence&&b.notifyDirectRequest(l);h=this._requestIncsOfNodes(c);t=this._requestExternalModelsOfNodes(b,c,a);v=[h,t];return[4,Promise.all(v)];case 1:return w=n.sent()[1],[2,w]}})})};b.prototype.requestNodes=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,e,k,g,l,u,t;return __generator(this,function(n){switch(n.label){case 0:return[4,this._requestNodes(b,c,a)];case 1:f=n.sent();e=[];k=0;for(g=
f;k<g.length;k++)l=g[k],u=l.getChildren(),h.concatInPlace(e,u);if(!(0<e.length))return[3,3];t=e.map(function(b){return b.getRuntimeId()});return[4,this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",t,d.NodeSource.LoadModel)];case 2:n.sent(),n.label=3;case 3:return[2]}})})};b.prototype.isBeingRequested=function(b){for(;;)if(b instanceof g.NodeMixin){if(this._requestedNodes.has(b))return!0;b=b.getParent()}else if(b instanceof g.AttachContext)b=b.getParent();else if(b instanceof g.InclusionContext)b=
b.getParent();else if(b instanceof g.LoadContext){if(b=b.getParent(),null===b)return!1}else return d.Util.TypeAssert(b),console.assert(!1),!1};b.prototype.onDemandRequestsActive=function(){return 0!==this._requestedNodes.size};b.prototype.onLoadBegin=function(){var b=this._nextLoadId++;this._activeLoadIds.add(b);return b};b.prototype.onLoadEnd=function(b){var c=this;this._activeLoadIds.delete(b);var a=[];this._requestedNodes.forEach(function(b,d){for(var f=!0,e=0;e<b.length;e++)if(c._activeLoadIds.has(b[e])){f=
!1;break}f&&a.push(d)});for(b=0;b<a.length;b++)this._requestedNodes.delete(a[b])};b.prototype.markSeenExternalModel=function(){this._seenExternalModel=!0};b.prototype.seenExternalModel=function(){return this._seenExternalModel};b.prototype.getNodeByGenericId=function(b){return this._genericIdToNode.get(b)||null};b.prototype.getNodesByGenericType=function(b){return this._genericTypeToNodes.get(b)||null};b.prototype.genericTypeToNodes=function(){return this._genericTypeToNodes};b.prototype.registerGenericGlobalId=
function(b,c){this._genericIdToNode.set(c,b)};b.prototype.registerGenericType=function(b,c){var a=this._genericTypeToNodes.get(c);void 0===a&&(a=new Set);a.add(b);this._genericTypeToNodes.set(c,a)};b.prototype.disableAutomaticFitWorld=function(){return this._config.disableAutomaticFitWorld};b.prototype.markImplicitNodesOutOfHierarchy=function(){return this._config.markImplicitNodesOutOfHierarchy};b.prototype._throttleLoad=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(b){switch(b.label){case 0:return this._engine.throttleLoad(200,200),[4,this._engine.sleep(20)];case 1:return b.sent(),[2]}})})};b.prototype.enqueue=function(b){var c=this,a="function"===typeof b?h.Lazy.create(b):b;return this._centralQueue.push(function(){return __awaiter(c,void 0,void 0,function(){var b,c;return __generator(this,function(d){switch(d.label){case 0:return(b=this._isScs&&this._centralQueueClock.isTicking())?[4,this._throttleLoad()]:[3,2];case 1:d.sent(),d.label=2;case 2:return[4,
a.get()];case 3:return c=d.sent(),b?[4,this._throttleLoad()]:[3,5];case 4:d.sent(),d.label=5;case 5:return[2,c]}})})})};b.prototype._onUserInteraction=function(b,c){if(this._isScs){var a=!1;switch(c){case d.EventType.MouseDown:case d.EventType.MouseUp:case d.EventType.Mousewheel:case d.EventType.TouchStart:case d.EventType.TouchMove:case d.EventType.TouchEnd:case d.EventType.KeyDown:case d.EventType.KeyUp:case d.EventType.ViewOrientationChange:a=!0;break;case d.EventType.MouseMove:a=b.getButtons()!==
d.Buttons.None;break;default:d.Util.TypeAssertNever(c)}a&&this._centralQueueClock.tickFor(1E3)}};return b}();g.AssemblyTree=c})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(c){var b=this;return function(a,d){return __awaiter(b,void 0,void 0,function(){var b,f;return __generator(this,function(e){switch(e.label){case 0:return b=h.versionAtLeast(d,[7,3])?a+".scs":a,[4,c(b)];case 1:return f=e.sent(),"string"===typeof f?h.FetchApi.isSupported()?[2,h.FetchApi.request(f)]:[2,h.httpRequestBuffer(f)]:[2,f]}})})}}var e=function(){function c(b,c,a,d,e,m){this._clearQueue=new h.PromiseQueue(1,!1);this._clearInProgress=!1;this._cadConfigurationsEnabled=
!0;this._engine=c;this._callbackManager=a;this._cuttingManager=d;this._view=e;this._model=m;this._assemblyTree=new g.AssemblyTree(b,this._engine,this._callbackManager,this._cuttingManager,this._view,this._model);this._readyPromise=h.TrackedOpenPromise.create()}c.unsafeCreate=function(b,c,a,d,e,g,h){return this._create(b,c,a,d,e,g,h).unsafeValue};c.create=function(b,c,a,d,e,g,h){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){return[2,this._create(b,c,a,d,e,g,h)]})})};
c._create=function(b,a,d,e,g,m,p){b=new c(b,a,d,e,g,m);p=b._init(p);return h.UnsafePromise.create(b,p)};c.prototype._init=function(b){return __awaiter(this,void 0,void 0,function(){var c,a;return __generator(this,function(d){switch(d.label){case 0:return[4,g.ScAttacher.createWithEmptyModel(this._engine,this._view,this._callbackManager,b)];case 1:return c=d.sent(),this._assemblyTree.initialize(c),a=new g.TreeLoader(this._assemblyTree,c,this._engine,this._view,this._callbackManager),this._callbackManager.trigger("modelStructureLoadBegin"),
this._callbackManager.trigger("modelStructureLoadEnd"),this._callbackManager.trigger("modelStructureParseBegin"),console.assert(void 0===this._treeLoader),this._treeLoader=a,this._readyPromise.resolve(),[2]}})})};c.prototype._loadSubtreePrologue=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(e){switch(e.label){case 0:if(this._engine.getSessionType()!==b)throw new d.LoadError("Incompatible load types.");return a?[4,this._clearQueue.waitOnLatest()]:
[3,2];case 1:e.sent(),e.label=2;case 2:if(this._clearInProgress)throw new d.LoadCancelledError;f=this._assemblyTree.lookupProductOccurrence(c);if(null===f)throw new d.InvalidNodeTypeError(c,0);return[2,f]}})})};c.prototype._loadSubtreeEpilogue=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,f;return __generator(this,function(e){switch(e.label){case 0:return b.isFirstLoad()&&2===this._engine.getSessionType()?[4,this._callbackManager.promiseTrigger("_firstBoundingReady",null)]:[3,
2];case 1:e.sent(),e.label=2;case 2:return a=b.getChildren(),f=a.map(function(b){return b.getRuntimeId()}),c?[4,this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",f,d.NodeSource.LoadModel)]:[3,4];case 3:e.sent(),e.label=4;case 4:return[2,f]}})})};c.prototype.loadSubtreeFromXmlFile=function(b,c,a,d){return __awaiter(this,void 0,void 0,function(){var f,e;return __generator(this,function(k){switch(k.label){case 0:return[4,this._disableCadConfigurations()];case 1:return k.sent(),[4,
this._loadSubtreePrologue(1,b,!0)];case 2:return f=k.sent(),[4,this._treeLoader.loadByXmlFile(d,f,c,a)];case 3:return e=k.sent(),[2,this._loadSubtreeEpilogue(e,!1)]}})})};c.prototype.loadSubtreeFromXmlDoc=function(b,c,a,d){return __awaiter(this,void 0,void 0,function(){var f,e;return __generator(this,function(k){switch(k.label){case 0:return[4,this._disableCadConfigurations()];case 1:return k.sent(),[4,this._loadSubtreePrologue(1,b,!0)];case 2:return f=k.sent(),[4,this._treeLoader.loadByXmlDoc(d,
f,c,a)];case 3:return e=k.sent(),[2,this._loadSubtreeEpilogue(e,!1)]}})})};c.prototype.loadSubtreeFromScsXmlFile=function(b,c,d,e){return __awaiter(this,void 0,void 0,function(){var f,k,g;return __generator(this,function(l){switch(l.label){case 0:return[4,this._disableCadConfigurations()];case 1:return l.sent(),[4,this._loadSubtreePrologue(2,b,!0)];case 2:return f=l.sent(),k=a(d),[4,this._treeLoader.loadByXmlFile(e,f,c,k)];case 3:return g=l.sent(),[2,this._loadSubtreeEpilogue(g,!1)]}})})};c.prototype.loadSubtreeFromScsXmlDoc=
function(b,c,d,e){return __awaiter(this,void 0,void 0,function(){var f,k,g;return __generator(this,function(l){switch(l.label){case 0:return[4,this._disableCadConfigurations()];case 1:return l.sent(),[4,this._loadSubtreePrologue(2,b,!0)];case 2:return f=l.sent(),k=a(d),[4,this._treeLoader.loadByXmlDoc(e,f,c,k)];case 3:return g=l.sent(),[2,this._loadSubtreeEpilogue(g,!1)]}})})};c.prototype._loadSubtreeFromStream=function(b,c,a,d){return __awaiter(this,void 0,void 0,function(){var f,e;return __generator(this,
function(k){switch(k.label){case 0:return[4,this._loadSubtreePrologue(1,b,a)];case 1:return f=k.sent(),[4,this._treeLoader.loadByStream(d,f,c)];case 2:return e=k.sent(),[2,this._loadSubtreeEpilogue(e,d._allowSubtreeLoadedCallback)]}})})};c.prototype.loadSubtreeFromStream=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){return[2,this._loadSubtreeFromStream(b,c,!0,a)]})})};c.prototype.loadSubtreeFromScsFile=function(b,c,a){return __awaiter(this,void 0,
void 0,function(){var d,f;return __generator(this,function(e){switch(e.label){case 0:return[4,this._loadSubtreePrologue(2,b,!0)];case 1:return d=e.sent(),[4,this._treeLoader.loadByScsFile(a,d,c)];case 2:return f=e.sent(),[2,this._loadSubtreeEpilogue(f,a._allowSubtreeLoadedCallback)]}})})};c.prototype.loadSubtreeFromScsBuffer=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d,f;return __generator(this,function(e){switch(e.label){case 0:return[4,this._loadSubtreePrologue(2,b,!0)];
case 1:return d=e.sent(),[4,this._treeLoader.loadByScsBuffer(a,d,c)];case 2:return f=e.sent(),[2,this._loadSubtreeEpilogue(f,a._allowSubtreeLoadedCallback)]}})})};c.prototype.loadSubtreeFromAssemblyData=function(b,c,a,d){return __awaiter(this,void 0,void 0,function(){var f,e;return __generator(this,function(k){switch(k.label){case 0:return[4,this._loadSubtreePrologue(1,b,!0)];case 1:return f=k.sent(),[4,this._treeLoader.loadByAssemblyData(d,f,c,a)];case 2:return e=k.sent(),[2,this._loadSubtreeEpilogue(e,
d._allowSubtreeLoadedCallback)]}})})};c.prototype._clearImpl=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:console.assert(!this._clearInProgress),this._clearInProgress=!0,c.label=1;case 1:return c.trys.push([1,6,,7]),[4,this._treeLoader.cancelActiveAttachmentProcess()];case 2:return c.sent(),[4,this._treeLoader.cancelPendingLoads()];case 3:return c.sent(),console.assert(this._treeLoader.isIdle()),console.assert(this._clearInProgress),
[4,this._treeLoader.reset()];case 4:return c.sent(),console.assert(this._treeLoader.isIdle()),console.assert(this._clearInProgress),[4,this._assemblyTree.reset()];case 5:return c.sent(),console.assert(this._treeLoader.isIdle()),console.assert(this._clearInProgress),this._clearInProgress=!1,[3,7];case 6:throw b=c.sent(),console.assert(this._clearInProgress),this._clearInProgress=!1,b;case 7:return[2]}})})};c.prototype.clear=function(){var b=this;return this._clearQueue.push(function(){return __awaiter(b,
void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._callbackManager.trigger("modelSwitchStart",!0),[4,this._clearImpl()];case 1:return b.sent(),[2,this._callbackManager.promiseTrigger("_modelSwitched","modelSwitched",!0,[],h.AttachType.Direct)]}})})})};c.prototype.switchToModel=function(b){var c=this,a=b===d.EmptyModelName;return this._clearQueue.push(function(){return __awaiter(c,void 0,void 0,function(){var c;return __generator(this,function(f){switch(f.label){case 0:return this._callbackManager.trigger("modelSwitchStart",
!1),[4,this._clearImpl()];case 1:f.sent();if(!a)return[3,2];c=[];return[3,4];case 2:return[4,this._loadSubtreeFromStream(this.getAbsoluteRootNodeId(),b,!1,new d.LoadSubtreeConfig)];case 3:c=f.sent(),f.label=4;case 4:return[4,this._callbackManager.promiseTrigger("_modelSwitched","modelSwitched",a,c,h.AttachType.Direct)];case 5:return f.sent(),[2,c]}})})})};c.prototype.getAbsoluteRootNodeId=function(){return this._assemblyTree.getRootNode().getRuntimeId()};c.prototype.isIdValid=function(b){return null!==
this._assemblyTree.lookupAnyNode(b)};c.prototype._getNodeChildren=function(b,c){var a=b.getChildrenSync();c||(a=a.filter(function(b){return!b.isOutOfHierarchy()}));for(var d=0,f=b.getBodyInstances();d<f.length;d++){var e=f[d];e.isOutOfHierarchy()&&!c||a.push(e)}c=0;for(b=b.getPmis();c<b.length;c++)a.push(b[c]);return a};c.prototype.getChildIds=function(b,c){var a=this._assemblyTree.lookupProductOccurrence(b);if(null===a)return[];b=[];var d=0;for(c=this._getNodeChildren(a,c);d<c.length;d++)b.push(c[d].getRuntimeId());
return b};c.prototype.isOutOfHierarchy=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);return null!==b&&g.isOutOfHierarchy(b)};c.prototype.getParentId=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);if(null===b)return null;b=g.towardContainerNode(b.getParent());return null===b?null:b.getRuntimeId()};c.prototype.getPartReferrers=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,d,e,h,p,q,r,u,t,v,w,y;return __generator(this,function(f){switch(f.label){case 0:c=this._assemblyTree.lookupProductOccurrence(b);
if(null===c)return[2,null];a=this._assemblyTree.getRootNode();return[4,g.forcePrototypes(a)];case 1:return f.sent(),[4,g.forcePartDefinitions(a)];case 2:f.sent();d=c.getPartDefinitionSync();if(null===d)return[2,null];e=d.getReferrers();h=new Set;p=0;for(q=e;p<q.length;p++)for(r=q[p],u=r.getParent(),t=u.getReferrers(),v=0,w=t;v<w.length;v++)y=w[v],h.add(y.getRuntimeId());return[2,Array.from(h)]}})})};c.prototype.getAttributes=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,
function(a){switch(a.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:return c=a.sent(),null===c?[2,[]]:[2,c.getAttributes()]}})})};c.prototype.getProperties=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,e,n,m,p,q=this;return __generator(this,function(f){switch(f.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:c=f.sent();if(null===c)return[2,null];a=null;e=[];n=c.getAttributes().then(function(b){null===a&&(a={});for(var c=0;c<b.length;c++){var d=b[c],
f=d.getValueName(),e=d.getTitle();null!==f&&(e=""!==e?e+"/"+f:f);d=d.getValue();a[e]=d}});e.push(n);m=function(c){null===a&&(a={});var f=q.getNetMatrix(b),e=new d.Point3(f[0],f[1],f[2]),k=q.getUnit(b),g=e.length()/k;e=c.volume*g*g*g;g=d.Util.formatWithUnit(c.surfaceArea*g*g,k);a["Surface Area"]=""+g+h.Unicode.Subscript2;e=d.Util.formatWithUnit(e,k);a.Volume=""+e+h.Unicode.Subscript3;c=d.Matrix.createFromArray(f).transform(c.centerOfGravity);f=d.Point3.scale(c,1/k);k=f.x.toLocaleString();c=f.y.toLocaleString();
f=f.z.toLocaleString();a.COG="x:"+k+" y:"+c+" z:"+f};c instanceof g.RepresentationItem?(p=c.getPhysicalProperties(),null!==p&&m(p)):c instanceof g.ProductOccurrence&&(n=Promise.resolve(g.forcePartDefinition(c)).then(function(){return __awaiter(q,void 0,void 0,function(){var b;return __generator(this,function(a){switch(a.label){case 0:return[4,c.getPhysicalProperties()];case 1:return b=a.sent(),null!==b&&m(b),[2]}})})}),e.push(n));return[4,d.Util.waitForAll(e)];case 2:return f.sent(),[2,a]}})})};c.prototype.addProperty=
function(b,c,a){b=this._assemblyTree.lookupAnyNode(b);if(null===b)return!1;c=new g.Attribute(d.AttributeType.String,c,null,a);b.addAttribute(c);return!0};c.prototype.setPhysicalProperties=function(b,c,a,d){b=this._assemblyTree.lookupRepresentationItem(b);if(null===b)return!1;c=new g.PhysicalProperties(a,d,c);b.setPhysicalProperties(c);return!0};c.prototype.getUserDataIndices=function(b){var c=this._assemblyTree.lookupAnyTreeNode(b);if(null===c)throw new d.InvalidNodeIdError(b);return c.getUserDataIndices()};
c.prototype.getUserData=function(b,c){var a=this._assemblyTree.lookupAnyTreeNode(b);if(null===a)throw new d.InvalidNodeIdError(b);return a.getUserData(c)};c.prototype.getInstanceIncs=function(b,c){b=this._assemblyTree.lookupAnyTreeNode(b);if(null===b)return console.assert(!1),[];var a=g.isOutOfHierarchy(b),d=new Set;return g.gatherInstanceIncsSync(b,c,a,d,g.WalkRestriction.None)};c.prototype.getNodeFromInstanceInc=function(b,c,a,d){var f=this._assemblyTree.lookupAnyBodyByInstanceInc(c,a);null===f?
(f=b?this._rectifyParent(c,null):this._assemblyTree.getRootNode(),f=this._assemblyTree.createMeshInstance(b,c,a,null,null,f,!1,d)):f instanceof g.PmiBody?f=f.getParent():f instanceof g.ViewFrame&&(b=f.getParent(),b);return f.getRuntimeId()};c.prototype._getAssociatedModelKey=function(b){if(b instanceof g.PartDefinition)return b.getModelKey();d.Util.TypeAssert(b);return this._getAssociatedModelKey(b.getParent())};c.prototype.getAssociatedModelKey=function(b){var c=this._assemblyTree.lookupAnyTreeNode(b);
return null===c?(c=this._assemblyTree.lookupAnyNonTreeNode(b),null===c?null:this._getAssociatedModelKey(c)):g.towardAttachContext(c).getMasterModelKey()};c.prototype.getMatrix=function(b){b=this._assemblyTree.lookupAnyNode(b);if(null===b)return new d.Matrix;b=b.getLocalTransform();return null===b?new d.Matrix:d.Matrix.createFromArray(b)};c.prototype.setMatrix=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d,f;return __generator(this,function(e){d=this._assemblyTree.lookupAnyTreeNode(b);
if(null===d)return[2];a?d.setLocalTransformAsInitial(c.m):d.overrideLocalTransform(c.m);f=g.isOutOfHierarchy(d);return[2,g.updateScMatrices(this._engine,this._callbackManager,[d],f)]})})};c.prototype.setMatrices=function(b,c,a){for(var d=[],f=!1,e=0;e<b.length;e++){var k=this._assemblyTree.lookupAnyTreeNode(b[e]),h=c[e];null!==k&&(a?k.setLocalTransformAsInitial(h.m):k.overrideLocalTransform(h.m),f=f||g.isOutOfHierarchy(k),d.push(k))}return g.updateScMatrices(this._engine,this._callbackManager,d,f)};
c.prototype.resetToInitialMatrix=function(b){return __awaiter(this,void 0,void 0,function(){var c,a;return __generator(this,function(d){c=this._assemblyTree.lookupAnyTreeNode(b);return null===c?[2]:c.hasLocalTransformOverride()?(c.removeLocalTransformOverride(),a=g.isOutOfHierarchy(c),[2,g.updateScMatrices(this._engine,this._callbackManager,[c],a)]):[2]})})};c.prototype.getNetMatrix=function(b){b=this._assemblyTree.lookupAnyNode(b);return null===b?g.Transform.getIdentity():g.getNetMatrix(b)};c.prototype._getBodyInstanceIndexFrom=
function(b,c,a){void 0===a&&(a={});for(var d=0,f=b.getBodyInstances();d<f.length;d++){var e=f[d];void 0!==a.value?a.value++:a.value=0;if(e===c)return a.value}d=0;for(f=b.getChildrenSync();d<f.length;d++)if(b=this._getBodyInstanceIndexFrom(f[d],c,a),void 0!==b)return b};c.prototype.getNodeOrRepItem=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,d,e,h,p;return __generator(this,function(f){switch(f.label){case 0:if(!(b instanceof g.BodyInstance))return[3,8];c=void 0;a=b.getParent();
d=void 0;e=a;f.label=1;case 1:return e instanceof g.ProductOccurrence?[4,g.forcePartDefinition(e)]:[2,null];case 2:return f.sent(),[4,e.getPartDefinition()];case 3:return h=f.sent(),null===h?[3,5]:[4,h.value];case 4:return d=f.sent(),[3,7];case 5:e=e.getParent(),f.label=6;case 6:return[3,1];case 7:return c=this._getBodyInstanceIndexFrom(e,b),p=d.getRepresentationItems(),void 0!==c&&c<p.length?[2,p[c]]:[2,null];case 8:if(b instanceof g.ProductOccurrence||b instanceof g.Pmi||b instanceof g.CadView||
b instanceof g.PartDefinition||b instanceof g.RepresentationItem)return[2,b];f.label=9;case 9:return[2,null]}})})};c.prototype._getNodeOrRepItemFromId=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){c=this._assemblyTree.lookupAnyNode(b);return null===c?[2,null]:[2,this.getNodeOrRepItem(c)]})})};c.prototype.getPointAttributes=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d;return __generator(this,function(f){switch(f.label){case 0:return[4,
this._getNodeOrRepItemFromId(b)];case 1:return a=f.sent(),a instanceof g.RepresentationItem&&(d=a.getPointAttributes(c),null!==d)?[2,d.copy()]:[2,null]}})})};c.prototype.getEdgeCount=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:return c=a.sent(),c instanceof g.RepresentationItem?[2,c.getEdgeCount()]:[2,0]}})})};c.prototype.getEdgeAttributes=function(b,c){return __awaiter(this,
void 0,void 0,function(){var a,d;return __generator(this,function(f){switch(f.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:return a=f.sent(),a instanceof g.RepresentationItem&&(d=a.getEdgeAttributes(c),null!==d)?[2,d.copy()]:[2,null]}})})};c.prototype.getEdgeProperty=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d;return __generator(this,function(f){switch(f.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:return a=f.sent(),a instanceof g.RepresentationItem&&
(d=a.getEdgeMeasurementProperty(c),null!==d)?[2,d.copy()]:[2,null]}})})};c.prototype.getFaceCount=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:return c=a.sent(),c instanceof g.RepresentationItem?[2,c.getFaceCount()]:[2,0]}})})};c.prototype.getFaceAttributes=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d;return __generator(this,function(f){switch(f.label){case 0:return[4,
this._getNodeOrRepItemFromId(b)];case 1:return a=f.sent(),a instanceof g.RepresentationItem&&(d=a.getFaceAttributes(c),null!=d)?[2,d.copy()]:[2,null]}})})};c.prototype.getFaceProperty=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d;return __generator(this,function(f){switch(f.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:return a=f.sent(),a instanceof g.RepresentationItem&&(d=a.getFaceMeasurementProperty(c),null!==d)?[2,d.copy()]:[2,null]}})})};c.prototype.setEdgeProperty=
function(b,c,a){b=this._assemblyTree.lookupRepresentationItem(b);null!==b&&g.MeasurementProperty.isEdge(a)&&b.setEdgeMeasurementProperty(c,a)};c.prototype.setFaceProperty=function(b,c,a){b=this._assemblyTree.lookupRepresentationItem(b);null!==b&&g.MeasurementProperty.isFace(a)&&b.setFaceMeasurementProperty(c,a)};c.prototype.getName=function(b){b=this._assemblyTree.lookupAnyNode(b);return null!==b?b.getName():null};c.prototype.getNodeExchangeId=function(b){b=this._assemblyTree.lookupAnyNode(b);return null!==
b?b.getExchangeId():null};c.prototype.getFilters=function(){return this._assemblyTree.getFilters()};c.prototype.getFilterName=function(b){return this._assemblyTree.getFilterName(b)};c.prototype.getFiltersWithNode=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);return null===b?[]:this._assemblyTree.getFiltersWithNode(b)};c.prototype.getNodesFromFilterIds=function(b){return this._assemblyTree.getNodesFromFilterIds(b)};c.prototype.getLayers=function(){return this._assemblyTree.getLayers()};c.prototype.getUniqueLayerNames=
function(){return this._assemblyTree.getUniqueLayerNames()};c.prototype.getLayerName=function(b){return this._assemblyTree.getLayerName(b)};c.prototype.getLayerIdsFromName=function(b){return this._assemblyTree.getLayersIdFromName(b)};c.prototype.getNodeLayerId=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);if(null===b)return null;var c=b.getAuthoredLayerId();return null===c?null:g.towardLoadContext(b).getRuntimeLayerId(c)};c.prototype.getAuthoredNodesFromLayer=function(b,c){b=this._assemblyTree.getNodesFromLayer(b,
c);return null===b?null:b.map(function(b){return b.getAuthoredId()})};c.prototype.getAuthoredNodesFromLayers=function(b,c){b=this._assemblyTree.getNodesFromLayers(b,c);return null===b?null:b.map(function(b){return b.getAuthoredId()})};c.prototype.getRuntimeNodesFromLayer=function(b,c){b=this._assemblyTree.getNodesFromLayer(b,c);return null===b?null:b.map(function(b){return b.getRuntimeId()})};c.prototype.getRuntimeNodesFromLayers=function(b,c){b=this._assemblyTree.getNodesFromLayers(b,c);return null===
b?null:b.map(function(b){return b.getRuntimeId()})};c.prototype.getNodesFromLayerName=function(b,c){b=this._assemblyTree.getNodesFromLayerName(b,c);return null===b?null:b.map(function(b){return b.getAuthoredId()})};c.prototype.createCadView=function(b,c,a,d,e,g,h,q,r){if(null===this._assemblyTree.lookupProductOccurrence(b))return null;b=this._assemblyTree.lookupProductOccurrence(b);if(null===b)return null;for(var f=[],k=0;k<d.length;k++){var l=this._assemblyTree.lookupPmi(d[k]);null!==l&&f.push(l)}d=
new Map;for(k=0;k<h.length;k++)l=h[k],d.set(l[0],l[1].m);return this._assemblyTree.createCadView(this._engine,b,c,a,f,e,g,d,q,r).getRuntimeId()};c.prototype.getCadViewMap=function(){var b=this._assemblyTree.getFirstProductOccurrenceWithView(),c=new Map;this._assemblyTree.forEachCadView(function(a){var d=a.getRuntimeId(),f=a.getParent();a=f===b?a.getName()||"(null)":f.getName()+" - "+a.getName();c.set(d,a)});return c};c.prototype.activateCadView=function(b,c){return __awaiter(this,void 0,void 0,function(){var a;
return __generator(this,function(d){switch(d.label){case 0:return this._assemblyTree.hasActiveCadView()?[4,this._assemblyTree.deactivateActiveCadView()]:[3,2];case 1:return d.sent(),[2,this.activateCadView(b,c)];case 2:return a=this._assemblyTree.lookupCadView(b),null===a?[2]:[2,this._assemblyTree.activateCadView(a,c)]}})})};c.prototype.getCadViewPmis=function(b){var c=this._assemblyTree.lookupCadView(b);if(null===c)return[];b=[];var a=0;for(c=this._assemblyTree.getCadViewPmis(c);a<c.length;a++)b.push(c[a].getRuntimeId());
return b};c.prototype._disableCadConfigurations=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._cadConfigurationsEnabled=!1,[4,this._assemblyTree.deactivateActiveCadView()];case 1:return b.sent(),[2]}})})};c.prototype.cadConfigurationsEnabled=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._cadConfigurationsEnabled&&this._assemblyTree.seenExternalModel()?
[4,this._disableCadConfigurations()]:[3,2];case 1:b.sent(),b.label=2;case 2:return[2,this._cadConfigurationsEnabled]}})})};c.prototype.getCadConfigurations=function(){var b={};this._assemblyTree.forEachCadConfiguration(function(c){var a=c.getRuntimeId();c=c.getName()||"(null)";b[a]=c});return b};c.prototype.getDefaultCadConfiguration=function(){var b=this._assemblyTree.getDefaultCadConfiguration();return null!==b?b.getRuntimeId():null};c.prototype.getActiveCadConfiguration=function(){var b=this._assemblyTree.getActiveCadConfiguration();
return null!==b?b.getRuntimeId():null};c.prototype._activateCadConfiguration=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return[4,this._assemblyTree.activateCadConfiguration(b)];case 1:return a.sent(),c=b.getRuntimeId(),this._callbackManager.trigger("configurationActivated",c),[2]}})})};c.prototype.activateCadConfiguration=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){c=
this._assemblyTree.lookupProductOccurrence(b);return null===c?[2]:[2,this._activateCadConfiguration(c)]})})};c.prototype.activateDefaultCadConfiguration=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return b=this._assemblyTree.getDefaultCadConfiguration(),null===b?[3,2]:[4,this._activateCadConfiguration(b)];case 1:c.sent(),c.label=2;case 2:return[2]}})})};c.prototype.getPmis=function(){var b={};this._assemblyTree.forEachPmi(function(c){var a=
c.getRuntimeId();c=c.getName()||"(null)";b[a]=c});return b};c.prototype.getPmiType=function(b){b=this._assemblyTree.lookupPmi(b);return null===b?g.PmiType.Unknown:b.getPmiType()};c.prototype.getPmiSubType=function(b){b=this._assemblyTree.lookupPmi(b);return null===b?d.PmiSubType.Unknown:b.getPmiSubType()};c.prototype.getUnit=function(b){b=this._assemblyTree.lookupAnyNode(b);return b instanceof g.ProductOccurrence?b.getMeasurementUnit():b instanceof g.BodyInstance?b.getParent().getMeasurementUnit():
1};c.prototype._rectifyParent=function(b,c){if(null!==c){c=this._assemblyTree.lookupProductOccurrence(c);if(null!==c)return c;console.assert(!1)}b=this._assemblyTree.getInclusionContexts(b);return 0<b.length?(b=b[0].getChildren(),console.assert(0<b.length),b[0]):this._assemblyTree.getRootNode()};c.prototype.createMeshInstance=function(b,c,a,d,e,g){d=this._rectifyParent(b,d);return this._assemblyTree.createMeshInstance(!0,b,c,null,a,d,e,g).getRuntimeId()};c.prototype.createPmiInstance=function(b,c,
a,d,e,g,h){h=this._rectifyParent(b,h);return this._assemblyTree.createPmiInstance(b,c,null,g,h,a,d,e).getRuntimeId()};c.prototype.setVisibilitiesByMap=function(b,c,a){var d=this,f=new Map;b.forEach(function(b,c){c=d._assemblyTree.lookupAnyTreeNode(c);null!==c&&f.set(c,b)});b=this._assemblyTree.getRootNode();return g.updateVisibilities(this._assemblyTree,this._engine,this._callbackManager,b,f,!1,c,null,a)};c.prototype.setVisibilitiesByValue=function(b,c,a,d){for(var f=new Map,e=0;e<b.length;e++){var k=
this._assemblyTree.lookupAnyTreeNode(b[e]);null!==k&&f.set(k,c)}c=this._assemblyTree.getRootNode();1===b.length&&(b=this._assemblyTree.lookupAnyTreeNode(b[0]),b instanceof g.ProductOccurrence&&(c=b));return g.updateVisibilities(this._assemblyTree,this._engine,this._callbackManager,c,f,!1,a,null,d)};c.prototype.resetAllVisibilities=function(){var b=new Map,c=this._assemblyTree.getRootNode(),a=this._assemblyTree.getActiveCadConfiguration();return g.updateVisibilities(this._assemblyTree,this._engine,
this._callbackManager,c,b,!0,null,a,d.TreeWalkMode.Default)};c.prototype.resetAllTransforms=function(){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(a){switch(a.label){case 0:return b=this._assemblyTree.getRootNode(),[4,g.resetTransforms(b)];case 1:return(c=a.sent())?[2,g.updateScMatrices(this._engine,this._callbackManager,[b],!1)]:[2]}})})};c.prototype.reset=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return this._cadConfigurationsEnabled=
!0,this.isACadDrawing()?[2,this._callbackManager.promiseTrigger("_resetDrawing",null)]:this._assemblyTree.hasActiveCadView()?[4,this._assemblyTree.deactivateActiveCadView()]:[3,2];case 1:c.sent(),c.label=2;case 2:return b=[this.resetAllVisibilities(),this.resetAllTransforms()],[4,d.Util.waitForAll(b)];case 3:return c.sent(),[2]}})})};c.prototype.setPmiColor=function(b,c){void 0===c&&(c=this.getAbsoluteRootNodeId());c=this.getInstanceIncs(c,6);0<c.length&&(this._engine.setPartColor(c,d.ElementType.Faces,
b),this._engine.setPartColor(c,d.ElementType.Lines,b))};c.prototype.resetPmiColor=function(b){void 0===b&&(b=this.getAbsoluteRootNodeId());b=this.getInstanceIncs(b,6);0<b.length&&(this._engine.unsetPartColor(b,d.ElementType.Faces),this._engine.unsetPartColor(b,d.ElementType.Lines))};c.prototype.getPmiTopologyReferences=function(b){b=this._assemblyTree.lookupPmi(b);return null===b?null:b.getPmiTopologyReferences(this._assemblyTree)};c.prototype.createNode=function(b,c,a,e,n,h){void 0===e&&(e=null);
void 0===n&&(n=!0);void 0===h&&(h=null);var f=null;null!==b&&(f=this._assemblyTree.lookupProductOccurrence(b));null===f&&(f=this._assemblyTree.getRootNode());null===a||g.isAuthoredId(a)||(a=null);h&&(b=h/f.getMeasurementUnit(),b=(new d.Matrix).setScaleComponent(b,b,b),e=e?d.Matrix.multiply(e,b):b);return this._assemblyTree.createNode(f,c,a,null===e?null:e.m,n,h).getRuntimeId()};c.prototype.deleteNode=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){c=
this._assemblyTree.lookupAnyTreeNode(b);if(null!==c){if(c instanceof g.ProductOccurrence||c instanceof g.BodyInstance)return[2,this._assemblyTree.deleteNode(c)];throw new d.InvalidNodeTypeError(b,0,2);}return[2]})})};c.prototype.createPart=function(b){return this._assemblyTree.createPart(b).getRuntimeId()};c.prototype.setPart=function(b,c){b=this._assemblyTree.lookupProductOccurrence(b);if(null===b)return!1;c=this._assemblyTree.lookupPartDefinition(c);if(null===c)return!1;this._assemblyTree.setPart(b,
c);return!0};c.prototype.createAndAddRepItem=function(b,c){b=this._assemblyTree.lookupPartDefinition(b);return null===b?null:b.createRepItem(this._assemblyTree,c).getRuntimeId()};c.prototype.getLowestAvailableNodeId=function(){return this._assemblyTree.getLowestAvailableNodeId()};c.prototype.getType=function(b){b=this._assemblyTree.lookupAnyNode(b);return null===b?d.NodeType.Unknown:g.getNodeType(b)};c.prototype.isVisible=function(b){b=this._assemblyTree.lookupAnyNode(b);return null!==b?b.isVisible():
!1};c.prototype.getBranchVisibility=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);return null!==b?g.getBranchVisibility(b):1};c.prototype.setMeshLevel=function(b,c){for(var a=[],d=0;d<b.length;d++){var f=this._assemblyTree.lookupAnyTreeNode(b[d]);null!==f&&a.push(f)}return g.setMeshLevels(this._engine,a,c)};c.prototype.setEnableAutomaticUnitScaling=function(b){this._assemblyTree.setAutomaticMeasurementUnitScaling(b)};c.prototype.setBehaviorInitiallyHidden=function(b){this._assemblyTree.setInitiallyHiddenStayHidden(b)};
c.prototype.isACadDrawing=function(){return this._assemblyTree.containsDrawings()};c.prototype.isMeasurable=function(){return this._assemblyTree.isMeasureable()};c.prototype.getModelFileNameFromNode=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);return null!==b?g.towardAttachContext(b).getOriginalFileName():null};c.prototype.getModelFileTypeFromNode=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);return null!==b?g.towardAttachContext(b).getOriginalFileType():null};c.prototype.isAnnotationView=
function(b){var c=this._assemblyTree.lookupCadView(b);if(null!==c)return c.isAnnotationView();throw new d.InvalidNodeTypeError(b,3);};c.prototype.allowNodeDeletion=function(b){b=this._assemblyTree.lookupBodyInstance(b);if(null===b)throw new d.InternalLogicError;this._assemblyTree.allowNodeDeletion(b)};c.prototype.preventNodeDeletion=function(b){b=this._assemblyTree.lookupBodyInstance(b);if(null===b)throw new d.InternalLogicError;this._assemblyTree.preventNodeDeletion(b)};c.prototype.preventMeshDeletion=
function(b){this._assemblyTree.preventMeshDeletion(b)};c.prototype.getBounding=function(b,c,a,d){return g.getBoundingByNodeId(this._assemblyTree,this._engine,b,c,a,d)};c.prototype.getIdOffset=function(b){b=this._assemblyTree.lookupAnyNode(b);return null!==b?(b instanceof g.PartDefinition?b.getInclusionContextForNodeId():b instanceof g.RepresentationItem?b.getParent().getInclusionContextForNodeId():g.towardInclusionContext(b)).getIdOffset():0};c.prototype.isNodeLoaded=function(b){var c=this._assemblyTree.lookupAnyNode(b);
if(null===c)throw new d.InvalidNodeIdError(b);return c.isLoaded()};c.prototype.shutdown=function(){var b=this._treeLoader.cancelPendingLoads();b};c.prototype.isReady=function(){console.assert(2!==this._readyPromise.state);return 0!==this._readyPromise.state};c.prototype.waitForReady=function(){return this._readyPromise};c.prototype.lookupAnyTreeNode=function(b){return this._assemblyTree.lookupAnyTreeNode(b)};c.prototype.lookupAnyBody=function(b){return this._assemblyTree.lookupAnyBody(b)};c.prototype.lookupBodyInstance=
function(b){return this._assemblyTree.lookupBodyInstance(b)};c.prototype.gatherInstanceIncsFromNodeIds=function(b,c,a){return g.gatherInstanceIncsByNodeIdsSync(this._assemblyTree,b,c,a)};c.prototype.requestNodes=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,d,e,g;return __generator(this,function(f){c=[];a=0;for(d=b;a<d.length;a++)e=d[a],g=this._assemblyTree.lookupAnyTreeNode(e),null!==g&&c.push(g);return[2,this._assemblyTree.requestNodes(this._treeLoader,c,!1)]})})};c.prototype.isWithinExternalModel=
function(b){b=this._assemblyTree.lookupAnyTreeNode(b);if(null===b)return!1;for(b=g.towardProductOccurrence(b);null!==b;){if(b.isExternalModelRoot())return!0;b=g.towardProductOccurrence(b.getParent())}return!1};c.prototype.getNodeGenericType=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);return null!==b?g.getNodeGenericType(b):null};c.prototype.getNodeGenericId=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);return null!==b?b.getGenericId():null};c.prototype.getNodeByGenericId=function(b){b=
this._assemblyTree.getNodeByGenericId(b);return null!==b?b.getRuntimeId():null};c.prototype.getNodesByGenericType=function(b){b=this._assemblyTree.getNodesByGenericType(b);if(null!==b){var c=new Set;b.forEach(function(b){c.add(b.getRuntimeId())});return c}return null};c.prototype.getGenericTypes=function(){var b=[];this._assemblyTree.genericTypeToNodes().forEach(function(c,a){b.push(a)});return b};c.prototype.getGenericTypeIdMap=function(){var b=new Map;this._assemblyTree.genericTypeToNodes().forEach(function(c,
a){var d=new Set;c.forEach(function(b){d.add(b.getRuntimeId())});b.set(a,d)});return b};c.prototype.hasEffectiveGenericType=function(b,c){var a=this.lookupAnyTreeNode(b);if(null===a)throw new d.InvalidNodeIdError(b);return g.hasEffectiveGenericType(a,c)};c.prototype.registerGenericId=function(b,c){return this._assemblyTree.registerGenericGlobalId(b,c)};c.prototype.registerGenericType=function(b,c){return this._assemblyTree.registerGenericType(b,c)};c.prototype.hasRelationships=function(b){var c=this.lookupAnyTreeNode(b);
if(null===c)throw new d.InvalidNodeIdError(b);return 0<g.towardInclusionContext(c).getRelationships().length};c.prototype.getBimIdFromNode=function(b){b=this.lookupAnyTreeNode(b);return null===b?null:b.getAuthoredId().toString()};c.prototype.getRuntimeNodeFromBimId=function(b,c){b=this.lookupAnyTreeNode(b);return null===b?null:g.towardInclusionContext(b).getRuntimeNodeFromBimId(c)};c.prototype.getRelationsByTypeFromNode=function(b,c){return this._assemblyTree.getRelationshipsOfItem(b,c)};c.prototype.firstAssemblyDataHeader=
function(){return this._treeLoader.firstAssemblyDataHeader()};c.prototype.setPrefetchScsCutoffScale=function(b){this._treeLoader.setPrefetchScsCutoffScale(b)};c.prototype.getAllRelationships=function(b){b=this.lookupAnyTreeNode(b);return null===b?[]:g.towardInclusionContext(b).getRelationships()};c.prototype.getAllBimInfos=function(b){b=this.lookupAnyTreeNode(b);return null===b?[]:g.towardInclusionContext(b).getBimInfos()};c.prototype.getInfoOfBimId=function(b,c){for(var a=0,d=this.getAllBimInfos(b);a<
d.length;a++){var f=d[a];if(f.id===c)return a=f.name,d=!1,f.category===g.BimStatus.Connected&&(b=this.getRuntimeNodeFromBimId(b,c),null!==b&&null!==this.getName(b)&&(a=this.getName(b),d=!0)),{name:a,connected:d}}return{name:"",connected:!1}};c.prototype.indexOfBimInfo=function(b,c){for(var a=0,d=0;d<b.length;d++){if(c===b[d].type)return a;a++}return-1};c.prototype.getBimIdRelationshipTypes=function(b,c){var a=[],d=this.lookupAnyTreeNode(b);if(null===d)return[];b=0;for(d=g.towardInclusionContext(d).getRelationships();b<
d.length;b++){var f=d[b];if(null!==f.relating&&f.relating.relationElt.id===c){var e=this.indexOfBimInfo(a,f.type);if(0>e){e=[];if(null!==f.related)for(var h=0,q=f.related.relationships;h<q.length;h++){var r=q[h];e.push(r.id)}a.push({type:f.type,relateds:e,relatings:[]})}else if(null!==f.related)for(h=0,f=f.related.relationships;h<f.length;h++)r=f[h],0>a[e].relateds.indexOf(r.id)&&a[e].relateds.push(r.id)}else if(null!==f.related)for(h=0,q=f.related.relationships;h<q.length;h++)r=q[h],r.id===c&&(e=
this.indexOfBimInfo(a,f.type),null!==f.relating&&(0>e?a.push({type:f.type,relateds:[],relatings:[f.relating.relationElt.id]}):a[e].relatings.push(f.relating.relationElt.id)))}return a};return c}();g.ModelStructure=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(a){for(;;)if(a instanceof g.InclusionContext)a=a.getParent();else{if(a instanceof g.AttachContext)return a;if(a instanceof g.NodeMixin)a=a.getParent();else if(a instanceof g.LoadContext){if(a=a.getParent(),null===a)throw new d.InternalLogicError;}else d.Util.TypeAssert(a),a=a.getInclusionContext()}}g.getNetMatrix=function(a){for(var c=g.Transform.getIdentity();null!==a;)if(a instanceof g.NodeMixin){var b=a.getLocalTransform();b&&(c=g.Transform.multiply(c,
b));a=a instanceof g.PartDefinition?null:a.getParent()}else if(a instanceof g.InclusionContext)a=a.getParent();else if(a instanceof g.AttachContext)a=a.getParent();else if(a instanceof g.LoadContext)a=a.getParent();else{d.Util.TypeAssert(a);break}return c};g.towardContainerNode=function(a){for(;;)if(a instanceof g.NodeMixin)if(a instanceof g.BodyMixin)a=a.getParent();else return a;else if(a instanceof g.LoadContext)a=a.getParent();else if(a instanceof g.InclusionContext)a=a.getParent();else if(a instanceof
g.AttachContext)a=a.getParent();else{if(null===a)return null;d.Util.TypeAssert(a);console.assert(!1);a=a.getInclusionContext()}};g.isOutOfHierarchy=function(a){return a instanceof g.BodyMixin||a instanceof g.ProductOccurrence?a.isOutOfHierarchy():!1};g.getBranchVisibility=function(a){return a instanceof g.ProductOccurrence||a instanceof g.Pmi||a instanceof g.CadView?a.getBranchVisibility():a.isVisible()?2:1};g.getNodeType=function(a){if(a instanceof g.ProductOccurrence)return a.isADrawingSheetNode()?
d.NodeType.DrawingSheet:a.hasBodyInstances()?d.NodeType.PartInstance:d.NodeType.AssemblyNode;if(a instanceof g.PartDefinition)return d.NodeType.Part;if(a instanceof g.PmiBody)return d.NodeType.PmiBody;if(a instanceof g.ViewFrame)return d.NodeType.ViewFrame;if(a instanceof g.BodyInstance)return d.NodeType.BodyInstance;if(a instanceof g.RepresentationItem)switch(a.getBodyType()){case g.BodyType.BRep:return d.NodeType.BrepBody;case g.BodyType.Tessellation:return d.NodeType.TessBody;case g.BodyType.Wireframe:return d.NodeType.WireBody;
case g.BodyType.PointCloud:return d.NodeType.PointsBody;default:return d.NodeType.Body}else{if(a instanceof g.Pmi)return d.NodeType.Pmi;d.Util.TypeAssert(a);return d.NodeType.CadView}};g.getNodeGenericType=function(d){var c=d.getGenericTypeId();return null!==c&&(d=a(d).getGenericTypeMaps(),null!==d)?d.getRight(c)||null:null};g.towardInclusionContext=function(a){for(;;)if(a instanceof g.NodeMixin)a=a.getParent();else{if(a instanceof g.InclusionContext)return a;if(a instanceof g.PmiBody)a=a.getParent();
else if(a instanceof g.ViewFrame)a=a.getParent();else return d.Util.TypeAssert(a),a.getInclusionContext()}};g.towardLoadContext=function(a){for(;;)if(a instanceof g.AttachContext)a=a.getParent();else{if(a instanceof g.LoadContext)return a;a instanceof g.NodeMixin?a=a.getParent():a instanceof g.InclusionContext?a=a.getParent():(d.Util.TypeAssert(a),a=a.getInclusionContext())}};g.towardAttachContext=a;g.towardAttachRoot=function(a){for(var c=null;;)if(a instanceof g.ProductOccurrence)c=a,a=a.getParent();
else if(a instanceof g.NodeMixin)a=a.getParent();else{if(a instanceof g.InclusionContext){if(null===c)throw new d.InternalLogicError;return c}d.Util.TypeAssert(a);a=a.getInclusionContext()}};g.towardProductOccurrence=function(a){for(;;){if(a instanceof g.ProductOccurrence)return a;if(a instanceof g.AttachContext)a=a.getParent();else if(a instanceof g.InclusionContext)a=a.getParent();else if(a instanceof g.LoadContext){if(a=a.getParent(),null===a)return null}else if(a instanceof g.BodyMixin)a=a.getParent();
else if(a instanceof g.Pmi)a=a.getParent();else if(a instanceof g.CadView)a=a.getParent();else return d.Util.TypeAssert(a),console.assert(!1),null}}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){(function(a){})(g.GenericTypeId||(g.GenericTypeId={}));var a=function(){function a(c,b,a,e,g){this._inclusionContexts=this._reservedNodeIdOffset=null;this._originalFileName="";this._originalFileType=d.FileType.Unknown;this._genericTypeMaps=null;console.assert(4294967295!==e);this._remapper=c;this._attachScope=b;this._attachedInvisibly=a;this._masterModelKey=e;this._parent=g}a.prototype.getRootNodeMetaData=function(c){return __awaiter(this,void 0,void 0,function(){var b,
a,d,e,n,h;return __generator(this,function(f){switch(f.label){case 0:if(4294967295===this._masterModelKey)return[2,null];b=c.getAbstractScEngine();a=this._masterModelKey;return[4,b.safeGetMetaData(a,1)];case 1:d=f.sent();if(null===d)return[3,4];e=c.tryParseHeader(d);return null===e?[2,new g.AssemblyData(null,d)]:[4,e];case 2:return n=f.sent(),this._originalFileName=n.originalFileName,this._originalFileType=n.originalFileType,[4,b.safeGetMetaData(a,n.rootAssemblyDataKey())];case 3:return h=f.sent(),
null!==h?[2,new g.AssemblyData(n,h)]:[2,null];case 4:return[2,null]}})})};a.prototype.getAttachScope=function(){return this._attachScope};a.prototype.attachedInvisibly=function(){return this._attachedInvisibly};a.prototype.getMasterModelKey=function(){return this._masterModelKey};a.prototype.addInclusionContext=function(c){console.assert(c.getParent()===this);this._inclusionContexts=h.TerseArray.push(this._inclusionContexts,c)};a.prototype.getRemapper=function(){return this._remapper};a.prototype.getParent=
function(){return this._parent};a.prototype.getChildren=function(){var c=this._inclusionContexts;if(null===c)return[];if(Array.isArray(c)){console.assert(0<c.length);for(var b=c[0].getChildren(),a=1;a<c.length;++a)h.append(b,c[a].getChildren());return b}return c.getChildren()};a.prototype.split=function(c,b,d){return new a(this._remapper,c,b,this._masterModelKey,d)};a.prototype.hasChildren=function(){return null!==this._inclusionContexts};a.prototype.removeProductOccurrence=function(c){for(var b=
null,a=h.TerseArray.toArray(this._inclusionContexts),d=0,e=a;d<e.length;d++){var g=e[d];if(g.removeProductOccurrence(c)){b=g;break}}if(null===b)return!1;a=a.filter(function(b){return b.hasChildren()});this._inclusionContexts=0===a.length?null:h.TerseArray.fromArray(a);return!0};a.prototype.purgeContents=function(){for(var c=[],b=0,a=h.TerseArray.toArray(this._inclusionContexts);b<a.length;b++){var e=a[b].purgeContents();c.push(e)}this._inclusionContexts=null;return d.Util.waitForAll(c)};a.prototype.isLoaded=
function(){if(this._inclusionContexts instanceof g.InclusionContext)return this._inclusionContexts.isLoaded();if(null!==this._inclusionContexts)for(var c=0,b=this._inclusionContexts;c<b.length;c++)if(!b[c].isLoaded())return!1;return!0};a.prototype.setReservedNodeIdOffset=function(c){console.assert(null===this._reservedNodeIdOffset);this._reservedNodeIdOffset=c};a.prototype.getReservedNodeIdOffset=function(){return this._reservedNodeIdOffset};a.prototype.forgetReservedNodeIdOffset=function(){console.assert(null!==
this._reservedNodeIdOffset);this._reservedNodeIdOffset=null};a.prototype.getOriginalFileName=function(){return this._originalFileName};a.prototype.getOriginalFileType=function(){return this._originalFileType};a.prototype.setGenericTypeMaps=function(c){this._genericTypeMaps=c};a.prototype.getGenericTypeMaps=function(){return this._genericTypeMaps};return a}();g.AttachContext=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(c,b,a,d){this._productOccurrences=null;this._relationship=[];this._bimNodeIdMap=new Map;this._bimInfos=[];console.assert(void 0!==a);console.assert(0===a===(0===d));this._attachContext=b;this._inclusionKey=a;this._modelKey=d;a=b.getReservedNodeIdOffset();null!==a?b.forgetReservedNodeIdOffset():a=c.newNodeIdOffset();this._nodeIdOffset=a;c.registerInclusionContext(this)}a.prototype.split=function(c,b){return new a(c,b,this._inclusionKey,
this._modelKey)};a.prototype.getIdOffset=function(){return this._nodeIdOffset};a.prototype.toRuntimeId=function(c){console.assert(g.isAuthoredId(c));return c+this._nodeIdOffset};a.prototype.getInclusionKey=function(){return this._inclusionKey};a.prototype.getModelKey=function(){return this._modelKey};a.prototype.getParent=function(){return this._attachContext};a.prototype.getAttachContext=function(){return this._attachContext};a.prototype.addProductOccurrence=function(c){console.assert(c.getParent()===
this);this._productOccurrences=h.TerseArray.push(this._productOccurrences,c)};a.prototype.getChildren=function(){console.assert(null!==this._productOccurrences);return h.TerseArray.toArray(this._productOccurrences)};a.prototype.removeProductOccurrence=function(c){var b=h.TerseArray.toArray(this._productOccurrences),a=b.length;b=b.filter(function(b){return b!==c});0===b.length?delete this._productOccurrences:this._productOccurrences=h.TerseArray.fromArray(b);return b.length<a};a.prototype.purgeContents=
function(){for(var c=[],b=0,a=h.TerseArray.toArray(this._productOccurrences);b<a.length;b++){var e=a[b].purgeContents();c.push(e)}this._productOccurrences=null;this._relationship.length=0;return d.Util.waitForAll(c)};a.prototype.hasChildren=function(){return null!==this._productOccurrences};a.prototype.isLoaded=function(){if(this._productOccurrences instanceof g.ProductOccurrence)return this._productOccurrences.isLoaded();if(null!==this._productOccurrences)for(var c=0,b=this._productOccurrences;c<
b.length;c++)if(!b[c].isLoaded())return!1;return!0};a.prototype.addRelationship=function(c){this._relationship.push(c)};a.prototype.getRelationships=function(){return this._relationship};a.prototype.addBimInfos=function(c){this._bimInfos.push(c)};a.prototype.getBimInfos=function(){return this._bimInfos};a.prototype.addBimIdToMap=function(c,b){this._bimNodeIdMap.set(c,b)};a.prototype.getRuntimeNodeFromBimId=function(c){c=this._bimNodeIdMap.get(c);return void 0!==c?c:null};return a}();g.InclusionContext=
a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(c,b,a){this._attachContexts=this._handledExternalModels=null;this._registeredScsModelKeys=new Map;this._layerIdMap=new h.Bimap;this._parent=c;this._debugLoadString=b;this._debugLoadString;this._scsBufferCache=a}a.prototype.handleExternalModel=function(c,b,a){b=b.getInclusionKey();c=h.compressUint(a)+" "+h.compressUint(b)+" "+h.compressUint(c);null===this._handledExternalModels&&(this._handledExternalModels=new Set);if(this._handledExternalModels.has(c))return!1;
this._handledExternalModels.add(c);return!0};a.prototype.getParent=function(){return this._parent};a.prototype.addAttachContext=function(c){this._attachContexts=h.TerseArray.push(this._attachContexts,c)};a.prototype.getChildren=function(){var c=this._attachContexts;if(null===c)return[];if(Array.isArray(c)){console.assert(0<c.length);for(var b=c[0].getChildren(),a=1;a<c.length;++a)h.append(b,c[a].getChildren());return b}return c.getChildren()};a.prototype.hasChildren=function(){return null!==this._attachContexts};
a.prototype.removeProductOccurrence=function(c){for(var b=null,a=h.TerseArray.toArray(this._attachContexts),d=0,e=a;d<e.length;d++){var g=e[d];if(g.removeProductOccurrence(c)){b=g;break}}if(null===b)return!1;a=a.filter(function(b){return b.hasChildren()});this._attachContexts=0===a.length?null:h.TerseArray.fromArray(a);return!0};a.prototype.purgeContents=function(){for(var c=[],b=0,a=h.TerseArray.toArray(this._attachContexts);b<a.length;b++){var e=a[b].purgeContents();c.push(e)}this._attachContexts=
null;return d.Util.waitForAll(c)};a.prototype.isLoaded=function(){if(this._attachContexts instanceof g.AttachContext)return this._attachContexts.isLoaded();if(null!==this._attachContexts)for(var c=0,b=this._attachContexts;c<b.length;c++)if(!b[c].isLoaded())return!1;return!0};a.prototype.initializeScsModelKeysOf=function(c){console.assert(void 0===this._registeredScsModelKeys.get(c));this._registeredScsModelKeys.set(c,h.TrackedOpenPromise.create())};a.prototype.getScsModelKeysOf=function(c){c=this._registeredScsModelKeys.get(c);
return void 0===c?null:c};a.prototype.markAsFirstLoad=function(){console.assert(void 0===this._isFirstLoad);this._isFirstLoad=!0};a.prototype.isFirstLoad=function(){return!0===this._isFirstLoad};a.prototype.toScsBuffer=function(c,b){return __awaiter(this,void 0,void 0,function(){var a,e=this;return __generator(this,function(f){a=h.LazyPromise.create(function(){return __awaiter(e,void 0,void 0,function(){var a;return __generator(this,function(f){switch(f.label){case 0:return[4,b(c)];case 1:f=a=f.sent();
if("string"===typeof f)throw new d.InternalLogicError;return[2,f]}})})});return null===this._scsBufferCache?[2,a]:[2,this._scsBufferCache.load(c,a)]})})};a.prototype.onLoadComplete=function(){this._scsBufferCache=null};a.prototype.addLayerIdToMap=function(c,b){this._layerIdMap.set(c,b)};a.prototype.getAuthoredLayerId=function(c){c=this._layerIdMap.getRight(c);return void 0!==c?c:null};a.prototype.getRuntimeLayerId=function(c){c=this._layerIdMap.getLeft(c);return void 0!==c?c:null};return a}();g.LoadContext=
a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){var a=function(){function c(b){this._referrers=null;this._prototype=b}c.prototype._addReferrer=function(b){this._referrers=d.TerseArray.push(this._referrers,b)};c.prototype._getReferrers=function(){return d.TerseArray.toArray(this._referrers)};c.prototype._getPrototype=function(){return this._prototype};c.prototype._removeReferrer=function(b){var c=!1,a=d.TerseArray.toArray(this._referrers);a=a.filter(function(a){return a===b?(c=!0,!1):!0});if(!c)return!1;0===
a.length?delete this._referrers:this._referrers=d.TerseArray.fromArray(a);return!0};c.prototype._purgeContents=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return this._prototype.isUnforced()?[3,3]:[4,this._prototype];case 1:return b=c.sent(),[4,b.purgeContents()];case 2:c.sent(),c.label=3;case 3:return[2]}})})};c.prototype._isLoaded=function(){return this._prototype.isResolved()&&this._prototype.getResolved().isLoaded()};
return c}();g.SharedPrototypeContext=a;var e=function(){function c(b,c){b instanceof a&&(b=d.LazyObject.create(b));this._shared=b;this._inclusionContext=c}c.prototype.getInclusionContext=function(){return this._inclusionContext};c.prototype.addReferrer=function(b){this._shared.get()._addReferrer(b)};c.prototype.getReferrers=function(){return this._shared.get()._getReferrers()};c.prototype.getProductOccurrence=function(){return this._shared.get()._getPrototype()};c.prototype.removeReferrer=function(b){return this._shared.get()._removeReferrer(b)?
(b=b.removePrototype(),console.assert(this===b),!0):!1};c.prototype.removeAllReferrers=function(){for(var b=0,c=this.getReferrers();b<c.length;b++)this.removeReferrer(c[b])||console.assert(!1)};c.prototype.purgeContents=function(){return this._shared.get()._purgeContents()};c.prototype.isLoaded=function(){return this._shared.get()._isLoaded()};return c}();g.PrototypeContext=e})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function b(){this._bits2=this._bits1=0}b.prototype.hasBits1=function(b){return h.hasBits(this._bits1,b)};b.prototype.hasBits2=function(b){return h.hasBits(this._bits2,b)};b.prototype.parseBits1=function(b){this._bits1=b.parseIndex_32()};b.prototype.parseBits2=function(b){this.hasBits1(1073741824)&&(this._bits2=b.parseIndex_32())};return b}();g.NodeParseBits=a;var e=function(){return function(b,c){this.shown=b;this.removed=c}}();g.AssemblyVisibility=
e;var c=function(){function b(b){this._bytes=b.bytes;this._header=b.header;this._dataView=new DataView(this._bytes.buffer,this._bytes.byteOffset,this._bytes.byteLength);this._currentPos=0}b.prototype.hasNext=function(){return this._currentPos<this._bytes.length};b.prototype.parseCount_32=function(){return this._parseUint_32()};b.prototype.parseIndex_32=function(){return this._parseUint_32()};b.prototype.parseAssemblyDataVersion=function(b){for(var c=[],a=0;a<b;++a)c.push(this._parseUint_32());return c};
b.prototype.parseAssemblyDataHeaderVersion=function(){return this._parseUint_32()};b.prototype.parseVisibility=function(){var b=this._parseInt_8(),c=h.hasBits(b,2);b=h.hasBits(b,1);return new e(c,b)};b.prototype.parseProductBits=function(){var b=this._parseUint_8();return null!==this._header&&2<=this._header.headerVersion||!h.hasBits(b,6)?b:b&-7|32};b.prototype.parseCString=function(){for(var b=this._currentPos,c=this._bytes[this._currentPos++];0!==c;)c=this._bytes[this._currentPos++];return h.utf8ArrayToStr(this._bytes.subarray(b,
this._currentPos-1))};b.prototype.parseBytes=function(b){var c=this._currentPos;this._currentPos+=b;b=this._bytes.subarray(c,this._currentPos);return new Uint8Array(b)};b.prototype.parseNodeId=function(){var b=this._parseUint_32();console.assert(b!==g.invalidNodeId);return b};b.prototype.parseLayerId=function(){var b=this._parseUint_32();console.assert(b!==g.invalidNodeId);return b};b.prototype.parseGenericTypes=function(){for(var b=this._parseUint_32(),c=new h.Bimap,a=0;a<b;a++){var d=this.parseCString(),
e=this._parseUint_32();c.set(e,d)}return c};b.prototype.parseGenericTypeId=function(){return this._parseUint_32()};b.prototype.parseGenericId=function(){return this.parseCString()};b.prototype._parseScKey=function(){var b=this._parseUint_32();console.assert(4294967295!==b);return b};b.prototype.parseDataKey=function(){return this._parseScKey()};b.prototype.parseInstanceKey=function(){return this._parseScKey()};b.prototype.parseMeshKey=function(){return this._parseScKey()};b.prototype.parseModelKey=
function(b){var c=this._parseScKey();return null!==b?b.getEffectiveModelKey(c):c};b.prototype.parseInclusionKey=function(b,c){var a=this._parseScKey();return null!==b?b.getEffectiveInclusionKey(a,c):a};b.prototype.parseMatrix=function(){for(var b=this,c=null!==this._header&&this._header.doublePrecisionMatrices?function(){return b.parseFloat_64()}:function(){return b.parseFloat_32()},a=g.Transform.getIdentity(),d=0;4>d;++d)for(var e=0;3>e;++e)a[4*d+e]=c();return a};b.prototype._parseInt_8=function(){return this._dataView.getInt8(this._currentPos++)};
b.prototype._parseUint_8=function(){return this._dataView.getUint8(this._currentPos++)};b.prototype._parseUint_32=function(){var b=this._dataView.getUint32(this._currentPos,!0);this._currentPos+=4;return b};b.prototype._parseFloat_32=function(){var b=this._dataView.getFloat32(this._currentPos,!0);this._currentPos+=4;return b};b.prototype._parseFloat_64=function(){var b=this._dataView.getFloat64(this._currentPos,!0);this._currentPos+=8;return b};b.prototype.parseFloat_32=function(){return this._parseFloat_32()};
b.prototype.parseFloat_64=function(){return this._parseFloat_64()};b.prototype.parseAttributeType=function(){return this._parseInt_8()};b.prototype.parseNodeParseBits=function(){var b=new a;b.parseBits1(this);b.parseBits2(this);return b};b.prototype.parseViewParseBits=function(){return this._parseUint_32()};b.prototype.parsePmiParseBits=function(){return this._parseUint_32()};b.prototype.parseLayerParseBits=function(){return this._parseUint_32()};b.prototype.parseAttributeParseBits=function(){return this._parseUint_32()};
b.prototype.parseRelationshipParseBits=function(){return this._parseUint_32()};b.prototype.parseBoolean=function(){return 0!==this._parseUint_8()};b.prototype.parsePoint3_32=function(){return new d.Point3(this._parseFloat_32(),this._parseFloat_32(),this._parseFloat_32())};b.prototype.parsePoint3_64=function(){return new d.Point3(this._parseFloat_64(),this._parseFloat_64(),this._parseFloat_64())};b.prototype.parsePlane3_32=function(){return d.Plane.createFromCoefficients(this._parseFloat_32(),this._parseFloat_32(),
this._parseFloat_32(),this._parseFloat_32())};b.prototype.parsePmiType=function(){return this._parseUint_32()};b.prototype.parsePmiSubType=function(){return this._parseUint_32()};b.prototype.parsePmiTopoRef=function(){return this._parseInt_8()};b.prototype.parseBodyType=function(){return this._parseUint_8()};b.prototype.parseFaceType=function(){return this._parseInt_8()};b.prototype.parseEdgeType=function(){return this._parseInt_8()};b.prototype.parseUserDataIndex=function(){var b=this._parseUint_32(),
c=this._parseUint_32();return 2097151>=c?4294967296*c+b:(""+c.toString(16)+h.zeroPadHex32(b)).toUpperCase()};b.prototype.getHeader=function(){return this._header};return b}();g.AssemblyDataParser=c})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(c,b){this._inclusionsOf=new Map;this._masterModelKey=4294967295;this._prototypeInstanceCount=-1;this._attachScope=c;this._attachedInvisibly=b}a.prototype.getAttachScope=function(){return this._attachScope};a.prototype.getMasterModelKey=function(){console.assert(4294967295!==this._masterModelKey);return this._masterModelKey};a.prototype.getModelKeys=function(){var c=[];this._inclusionsOf.forEach(function(b,a){c.push(a)});return c};
a.prototype.hasInclusions=function(){return 0<this._inclusionsOf.size};a.prototype.getAllInclusions=function(){var c=[];this._inclusionsOf.forEach(function(b,a){for(var d=0;d<b.length;d++)c.push(b[d],a)});return c};a.prototype.getInclusionsOf=function(c){var b=this._inclusionsOf.get(c);if(void 0===b)return[];for(var a=[],d=0;d<b.length;d++)a.push(b[d],c);return a};a.prototype.hasModelIncluded=function(c){return this._inclusionsOf.has(c)};a.prototype.attachedInvisibly=function(){return this._attachedInvisibly};
a.prototype.prototypeInstanceCount=function(){console.assert(0<=this._prototypeInstanceCount);return this._prototypeInstanceCount};a.prototype.registerInclusion=function(c,b){var a=this._inclusionsOf.get(b);void 0===a?this._inclusionsOf.set(b,[c]):a.push(c)};a.prototype.registerMasterModelKey=function(c){console.assert(4294967295===this._masterModelKey);this._masterModelKey=c};a.prototype.registerPrototypeInstanceCount=function(c){console.assert(-1===this._prototypeInstanceCount);this._prototypeInstanceCount=
c};return a}();d.AttachInfoBuilder=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(){this._calculatedCutoff=0;this._requireBoundingInfo=!1;this._prevPriorityValue=1;this._priorityProxies=new Map}a.prototype.getPriorityCompareValue=function(c){if("number"===typeof c)return c;c=this._priorityProxies.get(c);null!==c.worldBounding&&console.assert(1>=c.priorityHeuristic);return c.priorityHeuristic};a.prototype.setRequireBoundingInfo=function(c){this._requireBoundingInfo=c};a.prototype.comparePriority=function(c,b){c=
this.getPriorityCompareValue(c);b=this.getPriorityCompareValue(b);return c<b};a.prototype._updateHeuristicInfo=function(c,b){if(null!==b.worldBounding){var a=h.toVec3(b.worldBounding.center()),d=h.toVec3(b.worldBounding.extents());c=c.calculateAttachHeuristic(d,a);b.priorityHeuristic=c}null!==b.xmlAttachInfo&&b.xmlAttachInfo.directlyRequested&&(null===b.worldBounding&&(b.priorityHeuristic=0),b.priorityHeuristic+=-1E6)};a.prototype.createPriority=function(c,b,a){if(null===a)return++this._prevPriorityValue;
var d=Object.create(null);if(null!==a.bounding){b=b.transformBox(a.bounding);var f=0}else{if(this._requireBoundingInfo)throw Error("WorldBounding must be specified when streamCutoff is enabled");b=null;f=++this._prevPriorityValue}a={xmlAttachInfo:a,worldBounding:b,priorityHeuristic:f};this._updateHeuristicInfo(c,a);this._priorityProxies.set(d,a);return d};a.prototype.destroyPriority=function(c){"object"===typeof c&&this._priorityProxies.delete(c)};a.prototype.onViewChange=function(c,b,a){var d=this;
this._calculateCutoff(a.getProjectionMatrix(b.getCamera()));this._priorityProxies.forEach(function(b){d._updateHeuristicInfo(c,b)})};a.prototype.reset=function(){this._priorityProxies.clear()};a.prototype._calculateCutoff=function(c){var b=.98;0!==c.m[11]&&(b=(1-c.m[15])/c.m[11]*c.m[10]+c.m[14]);var a=d.Matrix.inverse(c);if(!a)throw Error();c=h.toVec4(a.transform4(new d.Point4(0,0,b,1)));var e=h.toVec4(a.transform4(new d.Point4(.0125,0,b,1)));b=h.toVec4(a.transform4(new d.Point4(0,.0125,b,1)));h.scale4(1/
c[3],c);h.scale4(1/e[3],e);h.scale4(1/b[3],b);this._calculatedCutoff=Math.min(h.squaredNorm4(h.sub4(e,c)),h.squaredNorm4(h.sub4(b,c)))};a.prototype.getCalculatedCutoff=function(){return this._calculatedCutoff};return a}();g.AttachPriorityManager=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){(function(a){function d(c){return"modelName"in c}a.isNameInfo=d;a.isIncInfo=function(c){return!d(c)};a.canImplicitlyLoad=function(c){return c.config.implicitlyLoadXmlExternalModels||!d(c)}})(d.ExternalModel||(d.ExternalModel={}))})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(c,b,a,d){var f=this;this._cameraTimeoutId=null;this._isFirstAttachment=!0;this._attachScope=0;null===d&&(d=13);console.assert(0<d);this._engine=c;this._view=b;this._callbackManager=a;this._parentToXmlAttachInfos=new Map;this._viewInfo=new g.ViewInfo(this._view);this._attachPriorityManager=new g.AttachPriorityManager;this._comparePriority=function(b,c){return f._attachPriorityManager.comparePriority(b,c)};this._attachQueue=this._createAttachQueue(d);
this._prefetchScsQueue=this._createPrefetchScsQueue(d);this._registerCameraListener()}a.createWithEmptyModel=function(c,b,d,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){switch(f.label){case 0:return[4,c.loadEmpty()];case 1:return f.sent(),[2,new a(c,b,d,e)]}})})};a.prototype.setPrefetchScsCutoffScale=function(c){this._prefetchScsQueue.setCutoffScale(c);this._attachPriorityManager.setRequireBoundingInfo(this._prefetchScsQueue.cutoffEnabled())};a.prototype._createAttachQueue=
function(c){return new h.PriorityPromiseQueue(c,this._comparePriority,!1)};a.prototype._createPrefetchScsQueue=function(c){var b=this;return new h.StreamCutoffAttachQueue(0,this._attachPriorityManager,c+15,function(c,a){return b._comparePriority(c,a)},!1)};a.prototype._reprioritizeAttachments=function(){this._viewInfo=new g.ViewInfo(this._view);this._attachPriorityManager.onViewChange(this._viewInfo,this._view,this._engine);this._attachQueue.markDirty();this._prefetchScsQueue.update()};a.prototype._registerCameraListener=
function(){var c=this,b=function(){c._onCameraChange()};this._callbackManager.bind({camera:b,_shutdownBegin:function(){null!==c._cameraTimeoutId&&(clearTimeout(c._cameraTimeoutId),c._cameraTimeoutId=null);c._callbackManager.unbind({camera:b})}})};a.prototype.reprioritizeAttachmentsNow=function(){null!==this._cameraTimeoutId&&(clearTimeout(this._cameraTimeoutId),this._cameraTimeoutId=null);this._reprioritizeAttachments()};a.prototype._onCameraChange=function(){var c=this;null!==this._cameraTimeoutId&&
clearTimeout(this._cameraTimeoutId);this._cameraTimeoutId=this._engine.setTimeout(function(){c._cameraTimeoutId=null;c._reprioritizeAttachments()},500)};a.prototype._awaitAttachInfo=function(c,b,a,e,l){var f=this,k=null===e,p=new g.AttachInfoBuilder(b,a),q=!1,r=[],u=h.OpenPromise.create(),t=h.OpenPromise.create(),v=!1,w=function(){console.assert(!v);v=!0;f._cleanupAttachLowLevel();f._callbackManager.unbind(x)},y=null,x={_priorityMetaDataSent:function(c,a){c===b&&(p.registerPrototypeInstanceCount(a),
u.resolve())},_announceModel:function(c,a){c===b&&(q=!0,p.registerMasterModelKey(a))},_inclusion:function(c,a,d){c===b&&(p.registerInclusion(a,d),r.push(d))},_remapModel:function(a,d,f){a===b&&c.remapModel(d,f)},_remapInclusion:function(a,d,f,e){a===b&&c.remapInclusion(d,f,e)},_missingModel:function(c,a){c===b&&(y=a)},_attached:function(c){if(c===b){if(!q){if(null!==y&&(k||l)){console.assert(0===r.length);t.reject(new d.MissingModelError(y));return}if(1!==r.length){t.reject(new d.LoadError("Bad model: Could not find master model key."));
return}p.registerMasterModelKey(r[0])}c=[u];var a=f._isFirstAttachment;if(a){f._isFirstAttachment=!1;var e=f._callbackManager.promiseTrigger("_firstAttachment",null,k?h.AttachType.Direct:h.AttachType.Indirect);c.push(e)}return d.Util.waitForAll(c).catch(function(b){console.assert(!1);throw b;}).then(function(){return __awaiter(f,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return a&&1===this._engine.getSessionType()?[4,this._callbackManager.promiseTrigger("_firstBoundingReady",
null)]:[3,2];case 1:b.sent(),b.label=2;case 2:return w(),t.resolve(p),[2]}})})})}}};this._callbackManager.bind(x);return t.catch(function(b){w();throw b;})};a.prototype._createPriority=function(c,b){return this._attachPriorityManager.createPriority(this._viewInfo,c,b)};a.prototype._cleanupAttachLowLevel=function(){};a.prototype._cleanupAttachHighLevel=function(c,b,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return d.trys.push([0,,2,
3]),[4,c];case 1:return[2,d.sent()];case 2:return null!==a&&this._forgetXmlAttachment(a),this._attachPriorityManager.destroyPriority(b),[7];case 3:return[2]}})})};a.prototype.newAttachScope=function(){return++this._attachScope};a.prototype._attachByStream=function(c,b,a,e,g,n,h,p){var f=this,k=d.Matrix.toMatrix12(e.m);e=this._createPriority(e,h);var l=this._attachQueue.push(function(){return __awaiter(f,void 0,void 0,function(){var d,f,e,l=this;return __generator(this,function(m){switch(m.label){case 0:d=
this.newAttachScope(),f=this._awaitAttachInfo(b,d,n.get(),h,p),m.label=1;case 1:return m.trys.push([1,4,,5]),[4,c.enqueue(function(){return l._engine.attachModel(d,a,k,g,n.get())})];case 2:return m.sent(),[4,f];case 3:return[2,m.sent()];case 4:throw e=m.sent(),this._cleanupAttachLowLevel(),e;case 5:return[2]}})})},e);return this._cleanupAttachHighLevel(l,e,h)};a._getAllModelKeys=function(c){var b=c.getMasterModelKey();c=c.getAllInclusions();if(c[1]!==b)for(var a=2;a<c.length;a+=2)if(c[a+1]===b){var d=
c[a];c[a]=c[0];c[a+1]=c[1];c[0]=d;c[1]=b;break}b=[];a=0;for(d=1;d<c.length;++a,d+=2)b[a]=c[d];return b};a.prototype.attachByNamedScsBuffer=function(c,b,f,e,l,n,m,p){return __awaiter(this,void 0,void 0,function(){var k,r,u,t,v,w=this;return __generator(this,function(q){c.getAutomaticMeasurementUnitScaling()||(n=SC.UnspecifiedMeasurementUnit);k=g.towardLoadContext(p.parent);r=d.Matrix.toMatrix12(l.m);u=this._createPriority(l,p);t=function(e){return __awaiter(w,void 0,void 0,function(){var l,q,u,t,v,
w,x,y,G,I,K,J,L=this;return __generator(this,function(z){switch(z.label){case 0:return[4,function(){return __awaiter(L,void 0,void 0,function(){var c;return __generator(this,function(a){c=k.getScsModelKeysOf(b);return null===c?(k.initializeScsModelKeysOf(b),[2,e]):[2,c]})})}()];case 1:l=z.sent();q=k.getScsModelKeysOf(b);if(null===q)throw new d.InternalLogicError;u=this.newAttachScope();if(!(l instanceof Uint8Array||h.FetchApi.isSupported()&&l instanceof Response))return[3,7];v=!0;w=this._awaitAttachInfo(f,
u,m.get(),p,!1);z.label=2;case 2:return z.trys.push([2,5,,6]),[4,c.enqueue(function(){var b=L._engine.attachScsBuffer(u,l instanceof Uint8Array?l:null,r,n,m.get(),v);l instanceof Uint8Array||L.streamScsData(u,l);return b})];case 3:return z.sent(),[4,w];case 4:return t=z.sent(),[3,6];case 5:throw x=z.sent(),this._cleanupAttachLowLevel(),x;case 6:return 0===q.state&&(y=a._getAllModelKeys(t),q.resolve(y)),[3,8];case 7:if(null===l)t=null,0===q.state&&q.resolve(null);else if(l instanceof Array){console.assert(0!==
q.state);G=new g.AttachInfoBuilder(u,m.get());G.registerPrototypeInstanceCount(0);for(I=0;I<l.length;++I)K=l[I],J=this._engine.attachScsModelByKey(u,K,r,n,m.get()),G.registerInclusion(J,K),0===I&&G.registerMasterModelKey(K);t=G}else throw new d.InternalLogicError;z.label=8;case 8:return[2,t]}})})};v=function(){return __awaiter(w,void 0,void 0,function(){var c,a=this;return __generator(this,function(d){switch(d.label){case 0:return[4,this._prefetchScsQueue.push(function(){return __awaiter(a,void 0,
void 0,function(){return __generator(this,function(c){return[2,k.toScsBuffer(b,e)]})})},u)];case 1:return c=d.sent(),p.directlyRequested=!0,[2,this._attachQueue.push(function(){return t(c)},u)]}})})}();return[2,this._cleanupAttachHighLevel(v,u,p)]})})};a.prototype.streamScsData=function(c,b){var a=this;this._callbackManager.trigger("_fetchBegin",b.url,c);var d=b.body.getReader();this._engine.setTimeout(function(){return __awaiter(a,void 0,void 0,function(){var a,f,e;return __generator(this,function(k){switch(k.label){case 0:return[4,
d.read()];case 1:a=k.sent();f=a.done;e=a.value;if(f)return this._engine.feedScsBuffer(c,null),this._callbackManager.trigger("_fetchEnd",b.url,c),[2];this._engine.feedScsBuffer(c,e);return[3,0];case 2:return[2]}})})},0)};a.prototype._attachByScsBuffer=function(c,b,a,e,g,n){var f=this,k=d.Matrix.toMatrix12(e.m);e=this._createPriority(e,null);var l=this._attachQueue.push(function(){return __awaiter(f,void 0,void 0,function(){var d,f,e,l=this;return __generator(this,function(h){switch(h.label){case 0:d=
this.newAttachScope(),f=this._awaitAttachInfo(b,d,n.get(),null,!1),h.label=1;case 1:return h.trys.push([1,4,,5]),[4,c.enqueue(function(){var b=l._engine.attachScsBuffer(d,a instanceof Uint8Array?a:null,k,g,n.get(),!1);a instanceof Uint8Array||l.streamScsData(d,a);return b})];case 2:return h.sent(),[4,f];case 3:return[2,h.sent()];case 4:throw e=h.sent(),this._cleanupAttachLowLevel(),e;case 5:return[2]}})})},e);return this._cleanupAttachHighLevel(l,e,null)};a.prototype.simpleAttach=function(c,b,a,e,
g,n,h,p){c.getAutomaticMeasurementUnitScaling()||(g=SC.UnspecifiedMeasurementUnit);if("string"===typeof a)return this._attachByStream(c,b,a,e,g,n,h,p);if(null===h)return this._attachByScsBuffer(c,b,a,e,g,n);d.Util.TypeAssert(a);d.Util.TypeAssert(h);throw new d.InternalLogicError;};a.prototype.reset=function(){this._isFirstAttachment=!0;this._attachScope=0;this._parentToXmlAttachInfos.clear();this._attachPriorityManager.reset();return this.clearAttachQueues()};a.prototype.clearAttachQueues=function(){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._prefetchScsQueue.killDeferred(),this._attachQueue.killDeferred(),[4,this._prefetchScsQueue.waitForIdle()];case 1:return c.sent(),[2,this._attachQueue.waitForIdle()]}})})};a.prototype.isIdle=function(){return this._attachQueue.isIdle()};a.prototype.notifyDirectRequest=function(c){c=this._parentToXmlAttachInfos.get(c);if(void 0!==c){for(var b=!1,a=0;a<c.length;a++){var d=c[a];d.directlyRequested||(b=d.directlyRequested=
!0)}b&&this._reprioritizeAttachments()}};a.prototype.registerXmlAttachInfo=function(c){var b=c.parent,a=this._parentToXmlAttachInfos.get(b);void 0===a&&(a=[],this._parentToXmlAttachInfos.set(b,a));a.push(c)};a.prototype._forgetXmlAttachment=function(c){var b=c.parent,a=this._parentToXmlAttachInfos.get(b);1===a.length?(console.assert(a[0]===c),this._parentToXmlAttachInfos.delete(b)):(console.assert(1<a.length),c=a.indexOf(c),console.assert(0<=c),a.splice(c,1))};a.prototype.maxConcurrentAttachments=
function(){return this._attachQueue.maxActivePromises()};return a}();g.ScAttacher=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(){this._remappedModelKeys=new Map;this._remappedInclusionKeys=new Map}a.prototype.remapModel=function(c,b){this._remappedModelKeys.set(b,c);this._remappedInclusionKeys.has(c)||this._remappedInclusionKeys.set(c,new Map)};a.prototype.remapInclusion=function(c,b,a){c=this._remappedInclusionKeys.get(c);console.assert(void 0!==c);c.set(a,b)};a.prototype.getEffectiveModelKey=function(c){var b=this._remappedModelKeys.get(c);return void 0!==
b?b:c};a.prototype.getEffectiveInclusionKey=function(c,b){b=this._remappedInclusionKeys.get(b);return void 0!==b&&(b=b.get(c),void 0!==b)?b:c};return a}();d.ScKeyRemapper=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(b){return(new DOMParser).parseFromString(b,"application/xml")}function e(b){return __awaiter(this,void 0,void 0,function(){var c,d;return __generator(this,function(f){switch(f.label){case 0:return[4,h.httpRequest(b)];case 1:return c=f.sent(),d=c.responseXML,null===d&&(d=a(c.responseText)),[2,d]}})})}function c(b){if(!b.hasChildNodes)return null;b=b.firstChild;if(!(b instanceof Comment))return null;b=b.data.split(" ");if(2!==b.length||"HC"!==b[0])return null;
b=b[1].split(".");if(2>b.length)return null;for(var c=[],a=0;a<b.length;a++){var d=b[a];if(!h.isBase10Number(d))return null;c.push(parseInt(d,10))}return c}function b(b){b=b.getElementsByTagName("parsererror");if(0<b.length)throw new d.XmlParseError(b[0].textContent||"unknown error");}function f(b,c,a,d){return{getAttachScope:function(){return b},getMasterModelKey:function(){return d},getModelKeys:function(){return[d]},hasInclusions:function(){return!0},getAllInclusions:function(){return[a,d]},getInclusionsOf:function(b){return b===
d?[a,d]:[]},hasModelIncluded:function(b){return b===d},attachedInvisibly:function(){return c},prototypeInstanceCount:function(){return 0}}}var k=function(){function k(b,c,a,d,f){this._loadQueue=new h.PromiseQueue(1024,!1);this._activeLoadGeneration=this._activeLoadCount=0;this._isFirstLoad=!0;this._firstAssemblyDataHeader=null;console.assert(b.isInitialized());this._assemblyTree=b;this._scAttacher=c;this._engine=a;this._view=d;this._callbackManager=f;this._isScsSession=2===this._engine.getSessionType();
this._nodesUntilNextSleep=2E3}k.prototype._resolveMeasurementUnits=function(b){if(this._assemblyTree.getAutomaticMeasurementUnitScaling()){var c=g.towardProductOccurrence(b.getParent());if(null===c)throw new d.InternalLogicError;var a=c.getMeasurementUnit(),f=b.getMeasurementUnit();a!==f&&(c=b.getLocalTransform(),null===c&&(c=g.Transform.getIdentity()),a=f/a,c[0]*=a,c[5]*=a,c[10]*=a,b.setLocalTransformAsInitial(c))}};k.prototype._patchImplicitNodesByModelInc=function(b,c,a,d,f){var e=this,k=0;if(0!==
d.length)for(var l,n=h.Lazy.create(function(){var d=b.get(),k=g.towardAttachContext(d),n=k.getAttachScope();l=k.attachedInvisibly();k=k.split(n,l,d);d.addAttachContext(k);d=new g.InclusionContext(e._assemblyTree,k,c,a);k.addInclusionContext(d);k=g.ProductOccurrence.createDynamic(e._assemblyTree,d,"Of Inclusion ("+c+")",null,null,!l,f);d.addProductOccurrence(k);return k}),m=0;m<d.length;m++){var p=d[m],q=this._assemblyTree.lookupAnyBodyByInstanceInc(c,p);if(null===q){q=n.get();var r="Implicit Body "+
++k;q=this._assemblyTree.createMeshInstance(!0,c,p,null,r,q,!1,!1);l&&q.setVisibility(!1)}}};k.prototype._getPrototypeInstanceCountByAttachment=function(b){var c=new Set,a=0;b=b.getAllInclusions();for(var d=0;d<b.length;d+=2){var f=b[d],e=b[d+1];c.has(e)||(c.add(e),a+=this._assemblyTree.getInstanceCountByInclusion(f))}return a};k.prototype._patchImplicitNodesByAttachment=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,e,k,l,n,m,p,x,z,B,A=this;return __generator(this,function(q){switch(q.label){case 0:return console.assert(b.isLoaded()),
f=null,e=h.Lazy.create(function(){var d=new g.ScKeyRemapper,e=c.getMasterModelKey();f=new g.AttachContext(d,c.getAttachScope(),c.attachedInvisibly(),e,b);d=new g.InclusionContext(A._assemblyTree,f,0,0);f.addInclusionContext(d);e=g.ProductOccurrence.createDynamic(A._assemblyTree,d,"Implicit Bodies",null,null,!c.attachedInvisibly(),a);d.addProductOccurrence(e);return e}),k=c.prototypeInstanceCount(),0!==k?[3,2]:[4,this._engine.instanceKeyInfo(c.getAttachScope(),0,1)];case 1:k=q.sent()[0],q.label=2;
case 2:return l=this._getPrototypeInstanceCountByAttachment(c),l===k?[2]:[4,this._engine.instanceKeyInfo(c.getAttachScope(),0,0)];case 3:n=q.sent();m=c.getAllInclusions();for(p=0;p<m.length;p+=2)x=m[p],z=m[p+1],B=n.get(z),void 0!==B&&this._patchImplicitNodesByModelInc(e,x,z,B,a);l=this._getPrototypeInstanceCountByAttachment(c);if(l<k)throw new d.InternalLogicError;return null===f?[2]:[4,g.markContextsLoaded([f])];case 4:return q.sent(),b.addAttachContext(f),[2]}})})};k.prototype._updateOnDemandRequests=
function(b){return __awaiter(this,void 0,void 0,function(){var c,a,d,f,e;return __generator(this,function(k){if(!this._assemblyTree.onDemandRequestsActive())return[2];c=b.getChildren();a=[];d=0;for(f=c;d<f.length;d++)e=f[d],this._assemblyTree.isBeingRequested(e)&&a.push(e);return[2,this._assemblyTree.requestNodes(this,a,!0)]})})};k.prototype._populateAttachment=function(b,c,a,d,f,e){return __awaiter(this,void 0,void 0,function(){var k;return __generator(this,function(g){switch(g.label){case 0:return console.assert(f===
h.AttachType.Indirect===(null!==e)),[4,this._parseRootNodes(b,c,a,d,e)];case 1:return k=g.sent(),[4,this._postProcessAttachContext(c,d,f,k)];case 2:return g.sent(),[2,k]}})})};k.prototype._postProcessAttachContext=function(b,c,a,d){return __awaiter(this,void 0,void 0,function(){var f,e,k,l=this;return __generator(this,function(n){switch(n.label){case 0:return[4,g.WalkerAsync.forceLazyPromises(d)];case 1:return n.sent(),[4,this._assemblyTree.enqueue(function(){return g.synchronizePmiVisibilities(l._engine,
d)})];case 2:return n.sent(),(f=this._assemblyTree.markImplicitNodesOutOfHierarchy())&&(f=0<d.getChildren().length||a===h.AttachType.Indirect),[4,this._patchImplicitNodesByAttachment(b,c,f)];case 3:return n.sent(),[4,this._updateOnDemandRequests(d)];case 4:return n.sent(),e=d.getChildren(),k=e.map(function(b){return b.getRuntimeId()}),this._callbackManager.trigger("_attachmentPopulated",k),[2]}})})};k.prototype._parseRootNodes=function(b,c,a,d,f){return __awaiter(this,void 0,void 0,function(){var e,
k,l,n,m,p,q,r=this;return __generator(this,function(u){switch(u.label){case 0:return e=d.getMasterModelKey(),k=d.getInclusionsOf(e),4294967295===e&&(console.assert(0===k.length),k.push(4294967295,4294967295)),l=new g.AttachContext(a,d.getAttachScope(),d.attachedInvisibly(),e,c),null!==f&&l.setReservedNodeIdOffset(f),n=new h.PromiseQueue(1,!0),[4,this._assemblyTree.enqueue(function(){return l.getRootNodeMetaData(r._assemblyTree)})];case 1:m=u.sent();p=function(c){n.push(function(){return r._parseRootNode(b,
l,m,k[c],k[c+1])})};for(q=0;q<k.length;q+=2)p(q);return[4,n.waitForIdle()];case 2:return u.sent(),[2,l]}})})};k.prototype._parseRootNode=function(b,c,a,d,f){return __awaiter(this,void 0,void 0,function(){var e,k;return __generator(this,function(l){switch(l.label){case 0:return console.assert(0!==d),[4,this._populateInclusion(b,c,a,d,f)];case 1:return e=l.sent(),e.hasAuthoredId()?(console.assert(!e.isLoaded()),k=g.towardInclusionContext(e),l=k.getParent(),l=l instanceof g.AttachContext&&l.getParent()instanceof
g.LoadContext?!0:!1,l&&this._setupRootNode(e,!1)):null===e.getName()&&(c.removeProductOccurrence(e)||console.assert(!1)),[2]}})})};k.prototype._setupRootNode=function(b,c){console.assert(!b.isAbsoluteRoot());c&&b.markIsExternalModelRoot(this._assemblyTree);this._resolveMeasurementUnits(b)};k.prototype._populateInclusion=function(b,c,a,d,f){return __awaiter(this,void 0,void 0,function(){var e,k,l=this;return __generator(this,function(n){switch(n.label){case 0:return console.assert(0!==d),e=new g.InclusionContext(this._assemblyTree,
c,d,f),c.addInclusionContext(e),[4,function(){return __awaiter(l,void 0,void 0,function(){var d,f,k;return __generator(this,function(l){if(null===a||0===a.bytes.length)return d=null,null===a&&(d="Missing"),[2,g.ProductOccurrence.createDynamic(this._assemblyTree,e,d,null,null,!c.attachedInvisibly())];f=new g.AssemblyDataParser(a);k=g.ProductOccurrence.parseBinary(b,this._assemblyTree,e,f);return[2,g.ProductOccurrence.reify(b,this,this._assemblyTree,e,k,e)]})})}()];case 1:return k=n.sent(),e.addProductOccurrence(k),
[2,k]}})})};k.prototype._rectifyLateVisibilityChange=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d,f,e;return __generator(this,function(k){a=g.towardAttachContext(c.getParent());d=g.towardProductOccurrence(c.getParent());console.assert(d===g.towardProductOccurrence(a));if(b.attachInvisibly||null===d||!d.isLoaded())return[2];f=d.isVisible();if(a.attachedInvisibly()===!f)return[2];e=f?2:0;return[2,g.updateVisibilitiesByAttachment(this._assemblyTree,this._engine,a,e)]})})};k.prototype._loadCleanup=
function(b,c,a){console.assert(0<this._activeLoadCount);b.onLoadComplete();null!==c&&this._callbackManager.unbind(c);--this._activeLoadCount;this._assemblyTree.onLoadEnd(a);this._callbackManager.trigger("visibilityChanged",[],[])};k.prototype._wrap=function(b,c,a,f){var e=this,k=this._activeLoadGeneration;return this._loadQueue.push(function(){return __awaiter(e,void 0,void 0,function(){var e,g,l,n,m,p,q,r,u,C,E,F,H,G,I=this;return __generator(this,function(t){switch(t.label){case 0:e=this._assemblyTree.onLoadBegin();
g=null;if(k!==this._activeLoadGeneration)throw this._loadCleanup(c,g,e),new d.LoadCancelledError;null===this._firstAssemblyDataHeader&&(g={_modelStructureHeaderParsed:function(b){return __awaiter(I,void 0,void 0,function(){return __generator(this,function(c){null!==g&&(null===this._firstAssemblyDataHeader&&(this._firstAssemblyDataHeader=b),this._callbackManager.unbind(g),g=null);return[2]})})}},this._callbackManager.bind(g,!0));t.label=1;case 1:return t.trys.push([1,3,,5]),[4,a];case 2:return t.sent(),
[3,5];case 3:return l=t.sent(),[4,c.purgeContents()];case 4:throw t.sent(),this._loadCleanup(c,g,e),l;case 5:n=c.getParent();if(null===n)throw this._loadCleanup(c,g,e),new d.InternalLogicError;m=f===h.AttachType.Direct;if(!m)return[3,8];if(!c.hasChildren())return[3,6];n.addLoadContext(c);return[3,8];case 6:return[4,c.purgeContents()];case 7:t.sent(),t.label=8;case 8:this._loadCleanup(c,g,e);p=c.getChildren();q=[];r=0;for(u=p;r<u.length;r++)C=u[r],E=this._rectifyLateVisibilityChange(b,C),q.push(E);
return[4,d.Util.waitForAll(q)];case 9:t.sent();if(!this._isFirstLoad)return[3,13];this._isFirstLoad=!1;c.markAsFirstLoad();F=p.map(function(b){return b.getRuntimeId()});H=!1;t.label=10;case 10:return t.trys.push([10,12,,13]),[4,this._callbackManager.promiseTrigger("_firstModelLoaded","firstModelLoaded",F,H,f)];case 11:return t.sent(),[3,13];case 12:throw G=t.sent(),console.assert(!1),G;case 13:return[2,c]}})})})};k.prototype._initLoad=function(b,c,a){++this._activeLoadCount;a=this._isScsSession&&
a?new h.PromiseCache:null;return new g.LoadContext(b,c,a)};k._getNetMatrix=function(b,c){b=d.Matrix.createFromArray(g.getNetMatrix(b));null!==c&&(b=d.Matrix.multiply(c,b));return b};k.prototype._lazyAttachInvisibly=function(b,c){return h.Lazy.create(function(){return c.attachInvisibly||!b.isVisible()})};k.prototype._loadBySingleAttach=function(b,c,a,d){var f=this,e=this._initLoad(c,d,!1);d=h.LazyPromise.create(function(){return __awaiter(f,void 0,void 0,function(){var d,f,l,n,m,p,q;return __generator(this,
function(r){switch(r.label){case 0:return[4,a];case 1:return d=r.sent(),f=new g.ScKeyRemapper,l=k._getNetMatrix(c,b.additionalMatrix),n=c.getMeasurementUnit(),m=this._lazyAttachInvisibly(c,b),[4,this._scAttacher.simpleAttach(this._assemblyTree,f,d,l,n,m,null,!1)];case 2:return p=r.sent(),[4,this._populateAttachment(b,e,f,p,h.AttachType.Direct,null)];case 3:return q=r.sent(),[4,g.markContextsLoaded([e,q])];case 4:return r.sent(),q.hasChildren()&&e.addAttachContext(q),[2,{}]}})})});return this._wrap(b,
e,d,h.AttachType.Direct)};k.prototype._populateFromXml=function(b,c,a,f){return __awaiter(this,void 0,void 0,function(){var e,k,l,n,h,m,p,q,B,A,D,C;return __generator(this,function(r){switch(r.label){case 0:e=a.documentElement;k=e.firstElementChild;for(n=l=null;null!==k;){"ModelFile"===k.localName&&(console.assert(null===l),l=g.ModelFile.parseXml(b,this._assemblyTree,c,k,f));if("DefaultCamera"===k.localName&&(n=g.XmlParser.parseCamera(k),!n))throw new d.XmlParseError('"DefaultCamera" element exists but couldn\'t be parsed');
k=k.nextElementSibling}if(null===l)throw new d.XmlParseError('Expected "ModelFile" element.');h=!1;if(!this._isFirstLoad)return[3,4];m=SC.UnspecifiedMeasurementUnit;this._assemblyTree.getAutomaticMeasurementUnitScaling()&&(p=g.towardProductOccurrence(c),m=p.getMeasurementUnit());if(null==n)return[3,2];h=!0;return[4,this._view._setCameraPromise(n,0)];case 1:return r.sent(),[3,4];case 2:q=g.ModelFile.parseBounding(l,m);if(q.isDegenerate()||null!==n)return[3,4];h=!0;return[4,this._view.setViewOrientation(d.ViewOrientation.Iso,
0,q)];case 3:r.sent(),r.label=4;case 4:return[4,g.ModelFile.reify(b,this._callbackManager,this,this._assemblyTree,c,l)];case 5:B=r.sent();A=0;for(D=B;A<D.length;A++)C=D[A],this._setupRootNode(C,!1);return!this._isFirstLoad||h?[3,7]:[4,this._view.setViewOrientation(d.ViewOrientation.Iso,0)];case 6:r.sent(),r.label=7;case 7:return[2]}})})};k.prototype._loadByXml=function(a,f,e,k,l){var n=this,m=this._initLoad(f,l,!0);l=h.LazyPromise.create(function(){return __awaiter(n,void 0,void 0,function(){var l,
n,p,q,r,u,t,D,C;return __generator(this,function(v){switch(v.label){case 0:return[4,e];case 1:l=v.sent();b(l);n=c(l);if(null===n||!h.versionAtLeast(g.MaxModelFileVersion,n))throw new d.XmlParseError("Bad version.");p=function(b){return k(b,n)};this._scAttacher.reprioritizeAttachmentsNow();f.addLoadContext(m);q=g.towardInclusionContext(f);r=g.towardAttachContext(q);u=this._scAttacher.newAttachScope();t=this._lazyAttachInvisibly(f,a);D=r.split(u,t.get(),m);m.addAttachContext(D);C=q.split(this._assemblyTree,
D);D.addInclusionContext(C);return[4,this._populateFromXml(a,C,l,p)];case 2:return v.sent(),[4,g.markContextsLoaded([m,D])];case 3:return v.sent(),[2,{}]}})})});return this._wrap(a,m,l,h.AttachType.Indirect)};k.prototype._attachExternalModelByInc=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d,f,e,k,l;return __generator(this,function(n){switch(n.label){case 0:return console.assert(0!==b.inclusionKey),a=g.towardAttachContext(c).getAttachScope(),d=b.modelKey,f=this._lazyAttachInvisibly(c,
b.config),e=new g.ScKeyRemapper,k=new g.AttachContext(e,a,f.get(),d,c),[4,k.getRootNodeMetaData(this._assemblyTree)];case 1:return l=n.sent(),[4,this._populateInclusion(b.config,k,l,b.inclusionKey,b.modelKey)];case 2:return n.sent(),[2,k]}})})};k.prototype._attachExternalModelInfoByName=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,e,k,l,n,m,p,x,z,B,A=this;return __generator(this,function(q){switch(q.label){case 0:f=new g.ScKeyRemapper;e=this._lazyAttachInvisibly(c,b.config);
k=c.getMeasurementUnit();q=d.Matrix.createFromArray(g.getNetMatrix(c));if(0>=k||!A._assemblyTree.getAutomaticMeasurementUnitScaling())l=q;else{var r=a.getAttachContext().getParent();null===r?r=SC.UnspecifiedMeasurementUnit:(r=r.getParent(),r=null===r?SC.UnspecifiedMeasurementUnit:r.getMeasurementUnit());r=r===SC.UnspecifiedMeasurementUnit?1:k/r;l=1===r?q:d.Matrix.multiply(q,(new d.Matrix).setScaleComponent(r,r,r))}n={bounding:b.bounding,parent:c,directlyRequested:!1};if(!this._isScsSession)return[3,
2];this._scAttacher.registerXmlAttachInfo(n);return[4,this._scAttacher.attachByNamedScsBuffer(this._assemblyTree,b.modelName,f,b.toAttachData,l,k,e,n)];case 1:return m=q.sent()||0,[3,8];case 2:return q.trys.push([2,7,,8]),[4,b.toAttachData(b.modelName)];case 3:p=q.sent();if(null!==p&&p!==d.EmptyModelName)return[3,4];m=0;return[3,6];case 4:if("string"!==typeof p)throw d.Util.TypeAssert(p),new d.InternalLogicError;d.Util.TypeAssert(p);this._scAttacher.registerXmlAttachInfo(n);return[4,this._scAttacher.simpleAttach(this._assemblyTree,
f,p,l,k,e,n,b.config.allowMissingExternalModels)];case 5:m=q.sent(),q.label=6;case 6:return[3,8];case 7:x=q.sent();if(b.config.allowMissingExternalModels&&x instanceof d.MissingModelError)m=1;else throw x;return[3,8];case 8:if("number"===typeof m){d.Util.TypeAssert(m);z=this._scAttacher.newAttachScope();B=!e.get();a:{r=this._assemblyTree;var u=m,t=B;q=new g.AttachContext(f,z,t,0,c);switch(u){case 0:break a;case 1:u=new g.InclusionContext(r,q,0,0);q.addInclusionContext(u);r=g.ProductOccurrence.createDynamic(r,
u,"Missing",null,null,!t);u.addProductOccurrence(r);break a;default:q=d.Util.TypeAssertNever(u)}}return[2,q]}return[2,this._populateAttachment(b.config,c,f,m,h.AttachType.Indirect,b.reservedNodeIdOffset)]}})})};k.prototype.setPrefetchScsCutoffScale=function(b){this._scAttacher.setPrefetchScsCutoffScale(b)};k.prototype.isIdle=function(){return 0===this._activeLoadCount?(console.assert(this._scAttacher.isIdle()),!0):!1};k.prototype.waitOnCurrentLoads=function(){return this._loadQueue.waitForIdle()};
k.prototype.cancelPendingLoads=function(){++this._activeLoadGeneration;return this.waitOnCurrentLoads()};k.prototype.cancelActiveAttachmentProcess=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,this._scAttacher.clearAttachQueues()]})})};k.prototype.loadByStream=function(b,c,a){return a===d.EmptyModelName?(b=new g.LoadContext(c,d.EmptyModelName,null),Promise.resolve(b)):this._loadBySingleAttach(b,c,Promise.resolve(a),a)};k.prototype.loadByScsBuffer=
function(b,c,a){return this._loadBySingleAttach(b,c,Promise.resolve(a),"*SCS Buffer*")};k.prototype.loadByScsFile=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(f){if(h.FetchApi.isSupported())return[2,this._loadBySingleAttach(b,c,h.FetchApi.request(a),a)];d=h.httpRequestBuffer(a);return[2,this._loadBySingleAttach(b,c,d,a)]})})};k.prototype.loadByXmlDoc=function(b,c,d,f){d="string"===typeof d?a(d):d;return this._loadByXml(b,c,Promise.resolve(d),
f,"*XML Document*")};k.prototype.loadByXmlFile=function(b,c,a,d){var f=e(a);return this._loadByXml(b,c,f,d,a)};k.prototype.attachByExternalModelInfo=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,e,k,l,n,h,m;return __generator(this,function(p){switch(p.label){case 0:return g.ExternalModel.isNameInfo(b)?[4,this._attachExternalModelInfoByName(b,c,a)]:[3,2];case 1:return f=p.sent(),[3,4];case 2:return[4,this._attachExternalModelByInc(b,c)];case 3:f=p.sent(),p.label=4;case 4:e=[];
k=f.getChildren();l=0;for(n=k;l<n.length;l++)h=n[l],this._setupRootNode(h,!0),m=this._rectifyLateVisibilityChange(b.config,h),e.push(m);return[4,d.Util.waitForAll(e)];case 5:return p.sent(),[2,f]}})})};k.prototype.loadByAssemblyData=function(b,c,a,d){return __awaiter(this,void 0,void 0,function(){var e,k,l,n,m,p,q,z,B=this;return __generator(this,function(r){e=h.AttachType.Direct;k=a[0];l=a[1];n=this._scAttacher.newAttachScope();m=!c.isVisible();p=f(n,m,k,l);q=this._initLoad(c,"*Assembly Data*",!1);
z=h.LazyPromise.create(function(){return __awaiter(B,void 0,void 0,function(){var c,a,f;return __generator(this,function(h){switch(h.label){case 0:return c=new g.ScKeyRemapper,a=p.getMasterModelKey(),f=new g.AttachContext(c,n,p.attachedInvisibly(),a,q),[4,this._parseRootNode(b,f,d,k,l)];case 1:return h.sent(),[4,this._postProcessAttachContext(q,p,e,f)];case 2:return h.sent(),[4,g.markContextsLoaded([q,f])];case 3:return h.sent(),f.hasChildren()&&q.addAttachContext(f),[2,{}]}})})});return[2,this._wrap(b,
q,z,e)]})})};k.prototype.reset=function(){this._isFirstLoad=!0;this._firstAssemblyDataHeader=null;return this._scAttacher.reset()};k.prototype.notifyDirectRequest=function(b){this._scAttacher.notifyDirectRequest(b)};k.prototype.onLoadChildProductOccurrence=function(){if(0===this._nodesUntilNextSleep)return this._nodesUntilNextSleep=2E3,this._engine.sleep(10);--this._nodesUntilNextSleep};k.prototype.firstAssemblyDataHeader=function(){return this._firstAssemblyDataHeader};return k}();g.TreeLoader=k})(h.Tree||
(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(c){var b=c.getCamera(),a=b.getPosition(),e=b.getTarget();e=d.Point3.subtract(e,a);var g=e.length();1E-7>g&&(g=1E-7);this._eyeDistanceInverse=1/g;e.scale(this._eyeDistanceInverse);c=c.getFullCameraMatrix();this._frustum=h.ConvexVolume.createFrustumFromMatrix(c);this._viewProjectionW=h.col4(c,3);this._cameraIsOrtho=b.getProjection()===d.Projection.Orthographic;this._position=h.toVec3(a);this._eye=h.toVec3(e)}a.prototype.calculateAttachHeuristic=
function(c,b){var a=0;if(this._frustum.axisAlignedBoxNotOutside(b,c))return c=h.squaredNorm3(c),c=h.projectSquaredSize(b,c,this._viewProjectionW),0<c&&(a=h.sub3(b,this._position),b=1/(h.dot3(this._eye,a)*this._eyeDistanceInverse+1E-5),a=h.scale3(1/h.norm3(a),a),a=h.dot3(this._eye,a),b=Math.pow(b,6),this._cameraIsOrtho||(b*=5*Math.pow(a,10)),1E-5>b&&(b=1E-5),a=c*b),console.assert(0<=a),-a-1;a=1/(1+Math.exp(h.norm3(c)));console.assert(0<=a&&1>a);return a};return a}();g.ViewInfo=a})(h.Tree||(h.Tree=
{}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(){}a._parseUint_32=function(c){if(!h.isBase10Number(c))return null;c=parseInt(c,10);return 4294967295>=c?c:null};a._parseFloat=function(c){c=parseFloat(c);return isNaN(c)?null:c};a.parseFloat=function(c,b){c=c.getAttribute(b);return null===c?null:this._parseFloat(c)};a._parseScKey=function(c,b){c=c.getAttribute(b);return null===c?null:this._parseUint_32(c)};a.parseDataKey=function(c,b){return this._parseScKey(c,b)};a.parseMeshKey=
function(c,b){return this._parseScKey(c,b)};a.parseInstanceKeyFromInc=function(c,b){c=c.getAttribute(b);if(null===c)return null;c=c.split(" ");return 2!==c.length||null===this._parseUint_32(c[0])?null:this._parseUint_32(c[1])};a.parseNodeId=function(c,b){c=c.getAttribute(b);return null===c?null:this._parseUint_32(c)};a.parseLayerId=function(c,b){c=c.getAttribute(b);return null===c?null:this._parseUint_32(c)};a.parseUint=function(c,b){c=c.getAttribute(b);return null===c?null:this._parseUint_32(c)};
a.parseUints=function(c,b){var a=c.getAttribute(b);if(null===a)return null;c=[];b=0;for(a=a.match(/[0-9]+/g)||[];b<a.length;b++){var d=this._parseUint_32(a[b]);if(null===d)return null;c.push(d)}return c};a.parseFloats=function(c,b){var a=c.getAttribute(b);if(null===a)return null;c=[];b=0;for(a=a.match(/\S+/g)||[];b<a.length;b++){var d=this._parseFloat(a[b]);if(null===d)return null;c.push(d)}return c};a.parseNodeIds=function(c,b){return this.parseUints(c,b)};a._parsePoint3=function(c,b){c=c.getAttribute(b);
if(null===c)return null;c=c.split(" ");if(3!==c.length)return null;b=[];for(var a=0;a<c.length;a++){var e=Number(c[a]);if(isNaN(e))return null;b.push(e)}return new d.Point3(b[0],b[1],b[2])};a.parseBounding=function(c,b){c=c.getElementsByTagName(b);if(1!==c.length)return null;b=c[0];c=this._parsePoint3(b,"Min");if(null===c)return null;b=this._parsePoint3(b,"Max");return null===b?null:new d.Box(c,b)};a.parseCamera=function(c){var b=a.parseUint(c,"Projection");if(null===b)return null;var f=c.getAttribute("field");
if(null===f)return null;var e=f.split(" ");if(2!==e.length)return null;f=parseFloat(e[0]);e=parseFloat(e[1]);c=c.getAttribute("definition");if(null===c)return null;var g=c.split(" ");if(9!==g.length)return null;var n=function(b,c){return new d.Point3(parseFloat(b[c]),parseFloat(b[c+1]),parseFloat(b[c+2]))};c=n(g,0);var h=n(g,3);g=n(g,6);return d.Camera.create(c,h,g,b,f,e)};return a}();g.XmlParser=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(c,b){var a="number"===typeof c;return a===("number"===typeof b)?c<b?-1:c>b?1:0:a?-1:1}var e=function(){function c(){console.assert(!1)}c.parseXml=function(b,c){var a=g.XmlParser.parseNodeId(c,"Id");null===a&&(console.assert(!1),a=b.generateDynamicNodeId());b=c.getAttribute("Name");for(var d=null,f=[],e=c.firstElementChild;null!==e;){if("Transformation"===e.localName)console.assert(null===d),d=g.Transform.parseXml(e),g.Transform.isIdentity(d)&&(d=null);
else if("Attributes"===e.localName)for(var h=e.firstElementChild;null!==h;){console.assert("Attr"===h.localName);var q=g.Attribute.parseXml(h);f.push(q);h=h.nextElementSibling}e=e.nextElementSibling}e=c.getAttribute("ExchangeId");c=g.XmlParser.parseLayerId(c,"LayerId");return{nodeId:a,bits:1073741824,name:b,localTransform:d,attributes:f,header:g.AssemblyDataHeader.dynamic,exchangeId:e,layerId:c,genericTypeId:null,genericId:null,userDatas:null}};c.parseBinary=function(b,c,a){a.hasBits1(1)?b=c.parseNodeId():
(console.assert(!1),b=b.generateDynamicNodeId());var d=a.hasBits1(2)?c.parseCString():null,f=1073741824;if(a.hasBits1(4)){var e=c.parseVisibility();e.shown||(f&=-1073741825);e.removed&&(f|=536870912)}e=null;a.hasBits1(8)&&(e=g.Transform.parseBinary(c),g.Transform.isIdentity(e)&&(e=null));var k=null;a.hasBits1(256)&&(k=c.parseDataKey());var h=a.hasBits1(33554432)?c.parseCString():null,r=a.hasBits1(67108864)?c.parseLayerId():null,u=null;a.hasBits2(16)&&(u=c.parseGenericTypeId());var t=null;a.hasBits2(32)&&
(t=c.parseGenericId());var v=null;if(a.hasBits1(536870912)){v=new Map;a=c.parseCount_32();for(var w=0;w<a;++w){var y=c.parseUserDataIndex(),x=c.parseCount_32();x=c.parseBytes(x);v.set(y,x)}}return{nodeId:b,bits:f,name:d,localTransform:e,attributes:null!==k?k:[],header:c.getHeader(),exchangeId:h,layerId:r,genericTypeId:u,genericId:t,userDatas:v}};return c}();g.Node=e;e=function(){function c(b,a,e){this._bits=0;this._nodeId=e.nodeId;this._bits=e.bits;null!==e.name&&(this._name=e.name);null!==e.localTransform&&
(this._localTransform=g.Transform.copy(e.localTransform));"number"===typeof e.attributes?this._lazyAttributes=c._lazyLoadAttributes(b,a,e.attributes,e.header):0<e.attributes.length&&(this._lazyAttributes=h.LazyPromise.create(e.attributes));null!==e.exchangeId&&(this._exchangeId=e.exchangeId);null!==e.layerId&&(this._layerId=e.layerId);null!==e.genericTypeId&&(this._genericTypeId=e.genericTypeId);null!==e.genericId&&(this._genericId=e.genericId);null!==e.userDatas&&(this._userDatas=d.Util.copyMap(e.userDatas))}
c._lazyLoadAttributes=function(b,c,a,d){var f=this;return h.LazyPromise.create(function(){return __awaiter(f,void 0,void 0,function(){var f,e,k,l,n,h;return __generator(this,function(m){switch(m.label){case 0:return f=b.getAbstractScEngine(),[4,b.enqueue(function(){return f.safeGetMetaData(c,a)})];case 1:e=m.sent();k=[];if(null!==e)for(l=new g.AssemblyData(d,e),n=new g.AssemblyDataParser(l);n.hasNext();)h=g.Attribute.parseBinary(n),k.push(h);return[2,k]}})})})};c.prototype.hasAuthoredId=function(){return g.isAuthoredId(this._nodeId)};
c.prototype.getAuthoredId=function(){return g.getAuthoredId(this._nodeId)};c.prototype.getName=function(){return void 0!==this._name?this._name:null};c.prototype.getExchangeId=function(){return void 0!==this._exchangeId?this._exchangeId:null};c.prototype.getAuthoredLayerId=function(){return void 0!==this._layerId?this._layerId:null};c.prototype.getGenericTypeId=function(){return void 0!==this._genericTypeId?this._genericTypeId:null};c.prototype.getGenericId=function(){return void 0!==this._genericId?
this._genericId:null};c.prototype._hasBits=function(b){return h.hasBits(this._bits,b)};c.prototype.isLoaded=function(){return this._hasBits(-2147483648)};c.prototype.markLoaded=function(){this._bits|=-2147483648};c.prototype._setVisibility=function(b){this._bits|=524288;this._bits=b?this._bits|262144:this._bits&-262145};c.prototype.isVisible=function(){return this._hasBits(524288)?this._hasBits(262144):this.isInitiallyShown()};c.prototype.isInitiallyShown=function(){return this._hasBits(536870912)?
!1:this._hasBits(1073741824)};c.prototype.setLocalTransformAsInitial=function(b){this._localTransform=b.slice()};c.prototype.overrideLocalTransform=function(b){this._localTransformOverride=b.slice()};c.prototype.hasLocalTransformOverride=function(){return void 0!==this._localTransformOverride};c.prototype.removeLocalTransformOverride=function(){console.assert(void 0!==this._localTransformOverride);delete this._localTransformOverride};c.prototype.getLocalTransform=function(){return void 0!==this._localTransformOverride?
this._localTransformOverride:void 0!==this._localTransform?this._localTransform:null};c.prototype.getAttributes=function(){return __awaiter(this,void 0,void 0,function(){var b=this;return __generator(this,function(c){return void 0!==this._lazyAttributes?[2,this._lazyAttributes.then(function(c){if(void 0!==b._lazyAttributes){for(var a=0;a<c.length;a++)b.addAttribute(c[a]);delete b._lazyAttributes}return b.getAttributes()})]:[2,h.TerseArray.toArray(this._attributes)]})})};c.prototype.addAttribute=function(b){this._attributes=
h.TerseArray.push(this._attributes,b)};c.prototype.getUserDataIndices=function(){var b=[];void 0!==this._userDatas&&this._userDatas.forEach(function(c,a){b.push(a)});return b.sort(a)};c.prototype.getUserData=function(b){if(void 0!==this._userDatas){var c=this._userDatas.get(b);if(void 0!==c)return c}throw new d.InvalidIndexError(b);};return c}();g.NodeMixin=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(b){function c(c,a,d,f){a=b.call(this,c,a,f.nodeInfo)||this;a._bits|=f.bits;a._parent=d;a._instanceKey=f.instanceKey;d=a.getAuthoredLayerId();null!==d&&c.registerNodeInLayer(a,d);null===d||a.isOutOfHierarchy()||c.registerTreeNodeInLayer(a,d);return a}__extends(c,b);c.prototype.setRequested=function(){this._bits|=1024};c.prototype.isRequested=function(){return this._hasBits(1024)};c.prototype.isOutOfHierarchy=function(){return this._hasBits(268435456)};
c.prototype.preventFromResetting=function(){return this._hasBits(16384)};c.prototype.getParent=function(){return this._parent};return c}(g.NodeMixin);g.BodyMixin=a;var e=function(b){function c(c,a,d,f){a=b.call(this,c,a,d,f)||this;c.registerBodyInstance(a);return a}__extends(c,b);c.parseXml=function(b,c,a){b=g.Node.parseXml(b,c);c=g.XmlParser.parseInstanceKeyFromInc(c,"MeshInstanceKey");if(null===c)throw new d.XmlParseError('Expected "MeshInstanceKey" attribute.');return{nodeInfo:b,inclusionKey:a,
instanceKey:c,bits:0}};c.parseBinary=function(b,c,a){var f=g.towardAttachContext(c),e=f.getRemapper(),k=f.getMasterModelKey();f=a.parseNodeParseBits();b=g.Node.parseBinary(b,a,f);c=f.hasBits1(131072)?a.parseInclusionKey(e,k):c.getInclusionKey();if(!f.hasBits1(262144))throw new d.AssemblyDataParseError('Expected "ScInstanceKey" in binary data.');a=a.parseInstanceKey();return{nodeInfo:b,inclusionKey:c,instanceKey:a,bits:0}};c.reify=function(b,a,d,f){var e=g.towardAttachContext(d);b=new c(b,a,d,f);e.attachedInvisibly()&&
b.setVisibility(!1);return b};c.createDynamic=function(b,a,d,f,e,h,r){var k=g.towardInclusionContext(h),l=g.towardAttachContext(k).getMasterModelKey();a={nodeInfo:{nodeId:b.massageAuthoredUserId(k,f),bits:1073741824,name:e,localTransform:null,attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},inclusionKey:a,instanceKey:d,bits:r};return new c(b,l,h,a)};c.prototype.getName=function(){var c=b.prototype.getName.call(this);if(null!==
c)return c;c=this.getParent().getBodyInstances();if(1<c.length){for(var a=0;a<c.length;++a)if(this===c[a])return"body "+(a+1);console.assert(!1)}return"body"};c.prototype.getInstanceInc=function(){var b=this._instanceKey;return[g.towardInclusionContext(this).getInclusionKey(),b]};c.prototype.setVisibility=function(b){b!==this.isVisible()&&this.getParent().markBranchVisibilityDirty();this._setVisibility(b)};c.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this)};return c}(a);
g.BodyInstance=e;var c=function(b){function c(c,a,d,f){a=b.call(this,c,a,d,f)||this;c.registerPmiBody(a);return a}__extends(c,b);c.parseBinary=function(b,c,a,d){b=e.parseBinary(b,c,a);d&&(d=b.nodeInfo,d=__assign({},d,{bits:d.bits&-1073741825}),b=__assign({},b,{nodeInfo:d}));return b};c.reify=function(b,a,d,f){var e=g.towardAttachContext(d);b=new c(b,a,d,f);e.attachedInvisibly()&&b.setVisibility(!1);return b};c.prototype.getName=function(){var b=this.getName();return null!==b?b:"PMI body"};c.prototype.getInstanceInc=
function(){var b=this._instanceKey;return[g.towardInclusionContext(this).getInclusionKey(),b]};c.prototype.setVisibility=function(b){b!==this.isVisible()&&this.getParent().getParent().markBranchVisibilityDirty();this._setVisibility(b)};c.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this)};return c}(a);g.PmiBody=c;a=function(b){function c(c,a,d,f){a=b.call(this,c,a,d,f)||this;a._bits&=-1073741825;c.registerViewFrame(a);return a}__extends(c,b);c.parseXml=function(b,c,a){return e.parseXml(b,
c,a)};c.parseBinary=function(b,c,a){return e.parseBinary(b,c,a)};c.reify=function(b,a,d,f){var e=g.towardAttachContext(d);b=new c(b,a,d,f);e.attachedInvisibly()&&b.setVisibility(!1);return b};c.prototype.getName=function(){var b=this.getName();return null!==b?b:"CAD View frame"};c.prototype.getInstanceInc=function(){var b=this._instanceKey;return[g.towardInclusionContext(this).getInclusionKey(),b]};c.prototype.setVisibility=function(b){b!==this.isVisible()&&this.getParent().getParent().markBranchVisibilityDirty();
this._setVisibility(b)};c.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this)};return c}(a);g.ViewFrame=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(b,c){var a=new h.PromiseQueue(1,!0);a.push(function(){return b.clear()});for(var d=function(c){a.push(function(){return b.addPlane(c,null)})},f=0;f<c.length;f++)d(c[f]);return a.waitForIdle()}function e(b,c){c.hasLocalTransformOverride()&&(c.removeLocalTransformOverride(),b.push(c))}var c=function(b){function c(a,f,e,m,p){var k=this,l=g.towardAttachContext(f).getMasterModelKey();k=b.call(this,a,l,{nodeId:e.nodeId,bits:0,name:e.name,localTransform:null,
attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null})||this;k._parent=p;k._bits|=e.bits;k._activatedCuttingSectionIndex=null;null!==e.camera&&(k._camera={initial:e.camera.copy(),derived:e.camera.copy()});k._instanceMarkupKeysToShow=d.Util.toSet(e.instanceMarkupKeysToShow);c.isAuthoredViewInfo(e,m)?(k._nodesToShow=c._toRuntimeIds(f,e.nodesToShow),k._nodesToHide=c._toRuntimeIds(f,e.nodesToHide),0<e.transformMap.size&&(k._transformMap=
new Map,e.transformMap.forEach(function(b,c){c=f.toRuntimeId(c);k._transformMap.set(c,g.Transform.copy(b))}))):(k._nodesToShow=d.Util.toSet(e.nodesToShow),k._nodesToHide=d.Util.toSet(e.nodesToHide),0<e.transformMap.size&&(k._transformMap=d.Util.copyMap(e.transformMap)));null!==e.viewFrameInfo&&(k._viewFrame=k._loadViewFrame(a,l,e.viewFrameInfo));0<e.cuttingPlanes.length&&(k._cuttingPlanes=h.TerseArray.fromArray(e.cuttingPlanes));a.registerCadView(k);return k}__extends(c,b);c.parseXml=function(b,c,
a){var f=0,e=g.XmlParser.parseNodeId(c,"Id");if(null===e)throw new d.XmlParseError('Expected "Id" attribute.');var k=c.getAttribute("Name");if(null===k)throw new d.XmlParseError('Expected "Name" attribute');var l=function(b,c,a,f){b=b.getAttribute("Enabled");if(null===b)throw new d.XmlParseError("Expected "+a+" attribute");return c=h.setBit(c,f,"1"===b)},n=c.getAttribute("isAnnotationView");f=null===n?h.setBit(f,134217728,!1):h.setBit(f,134217728,"true"===n);var t=n=null,v=[],w=[],y=[],x=new Map,
z=[],B=function(b){var c=g.XmlParser.parseUint(b,"Projection");if(null===c)throw new d.XmlParseError('Expected "Projection" attribute');var a=b.getAttribute("field");if(null===a)throw new d.XmlParseError('Expected "field" attribute');var f=a.split(" ");if(2!==f.length)throw new d.XmlParseError("Expected 2 field values");a=parseFloat(f[0]);f=parseFloat(f[1]);b=b.getAttribute("definition");if(null===b)throw new d.XmlParseError('Expected "definition" attribute');var e=b.split(" ");if(9!==e.length)throw new d.XmlParseError("Expected 9 definition values");
var k=function(b,c){return new d.Point3(parseFloat(b[c]),parseFloat(b[c+1]),parseFloat(b[c+2]))};b=k(e,0);var l=k(e,3);e=k(e,6);return d.Camera.create(b,l,e,c,a,f)},A=function(b){var c=[];if(null===g.XmlParser.parseUint(b,"Count"))throw new d.XmlParseError('Expected "PMIToShow Count" attribute');b=g.XmlParser.parseNodeIds(b,"IDs");if(null===b)throw new d.XmlParseError('Expected "PMIToShow Ids" attribute');for(var a=0;a<b.length;a+=2)c.push(b[a+1]);return c},D=function(b){var c=[],a=g.XmlParser.parseUint(b,
"Count");if(null===a)throw new d.XmlParseError('Expected "ClipPlanes Count" attribute');b=g.XmlParser.parseFloats(b,"Plane");if(null===b)throw new d.XmlParseError('Expected "Plane" attribute');if(b.length/4!==a)throw new d.XmlParseError("Expected "+a+" Planes");for(a=0;a<b.length;a+=4)c.push(d.Plane.createFromCoefficients(b[a],b[a+1],b[a+2],b[a+3]));return c},C=function(b){var c=new Map,a=g.XmlParser.parseUint(b,"Count");if(null===a)throw new d.XmlParseError('Expected "IDLocalTransform Count" attribute');
b=g.XmlParser.parseFloats(b,"IDTransform");if(null===b)throw new d.XmlParseError('Expected "IDTransform" attribute');if(b.length/13!==a)throw new d.XmlParseError("Expected "+a+" IDTransform values");for(a=0;a<b.length;a+=13){var f=b[a],e=b,k=a,l=g.Transform.getIdentity();l[1]=e[k+1];l[2]=e[k+2];l[3]=e[k+3];l[4]=e[k+4];l[6]=e[k+5];l[7]=e[k+6];l[8]=e[k+7];l[9]=e[k+8];l[11]=e[k+9];l[12]=e[k+10];l[13]=e[k+11];l[14]=e[k+12];c.set(f,l)}return c};for(c=c.firstElementChild;null!==c;)"Camera"===c.localName?
(console.assert(null===n),n=B(c)):"Frame"===c.localName?t=g.ViewFrame.parseXml(b,c,a.getInclusionKey()):"PMIToShow"===c.localName?v=A(c):"InstanceToShow"===c.localName?w=g.XmlParser.parseNodeIds(c,"IDs"):"InstanceToHide"===c.localName?y=g.XmlParser.parseNodeIds(c,"IDs"):"ClipPlanes"===c.localName?z=D(c):"IDLocalTransform"===c.localName?x=C(c):"IsCameraSet"===c.localName?f=l(c,f,"IsCameraSet",67108864):"IsPMIFilteringSet"===c.localName?f=l(c,f,"IsPMIFilteringSet",33554432):"IsGeomFilteringSet"===c.localName?
f=l(c,f,"IsGeomFilteringSet",16777216):"IsCrosssectionSet"===c.localName?f=l(c,f,"IsCrosssectionSet",8388608):"IsExplosionSet"===c.localName?f=l(c,f,"IsExplosionSet",4194304):"IsCombineState"===c.localName&&(f=l(c,f,"IsCombineState",2097152)),c=c.nextElementSibling;return{nodeId:e,name:k,camera:n,instanceMarkupKeysToShow:v,viewFrameInfo:t,nodesToShow:null===w?[]:w,nodesToHide:null===y?[]:y,transformMap:x,cuttingPlanes:z,bits:f}};c.parseBinary=function(b,c,a){var f=a.parseViewParseBits(),e=a.parseNodeId(),
k=null;h.hasBits(f,1)&&(k=a.parseCString());var l=0,n=!1;h.hasBits(f,256)?(n=!0,k+=" # Annotation View"):null!==k&&0<=k.indexOf("# Annotation View")&&(n=!0);n&&(l|=134217728);h.hasBits(f,1024)||(l|=33554432);h.hasBits(f,2048)||(l|=16777216);h.hasBits(f,4096)||(l|=8388608);h.hasBits(f,8192)||(l|=4194304);h.hasBits(f,16384)&&(l|=2097152);var t=h.hasBits(f,32768);t&&(l|=1048576);n=null;if(h.hasBits(f,2)){t=t?d.Projection.Perspective:d.Projection.Orthographic;var v=a.parsePoint3_32(),w=a.parsePoint3_32(),
y=a.parsePoint3_32(),x=a.parseFloat_32(),z=a.parseFloat_32();!h.hasBits(f,512)&&(l|=67108864,n=d.Camera.create(v,w,y,t,x,z),0>x||0>z)&&(l|=8192)}t=[];if(h.hasBits(f,4))for(w=a.parseCount_32(),v=0;v<w;++v)y=a.parseInstanceKey(),t.push(y);w=null;h.hasBits(f,8)&&(w=g.ViewFrame.parseBinary(b,c,a));b=[];if(h.hasBits(f,16))for(c=a.parseCount_32(),v=0;v<c;++v)y=a.parseNodeId(),b.push(y);c=[];if(h.hasBits(f,32))for(y=a.parseCount_32(),v=0;v<y;++v)x=a.parseNodeId(),c.push(x);y=new Map;if(h.hasBits(f,64))for(x=
a.parseCount_32(),v=0;v<x;++v){z=a.parseNodeId();var B=g.Transform.parseBinary(a);y.set(z,B)}x=[];if(h.hasBits(f,128))for(f=a.parseCount_32(),v=0;v<f;++v)z=a.parsePlane3_32(),x.push(z);return{nodeId:e,name:k,camera:n,instanceMarkupKeysToShow:t,viewFrameInfo:w,nodesToShow:b,nodesToHide:c,transformMap:y,cuttingPlanes:x,bits:l}};c.reify=function(b,a,d,f){var e=g.towardAttachContext(a);b=new c(b,a,d,0,f);e.attachedInvisibly()&&b.setVisibility(!1);return b};c.createDynamic=function(b,a,d,f,e,h,r,u,t){for(var k=
g.towardInclusionContext(a),l=b.generateDynamicNodeId(),n=[],m=0;m<e.length;m++)for(var p=0,q=e[m].getPmiBodies();p<q.length;p++){var A=q[p],D=g.towardInclusionContext(A);console.assert(k===D);A=A.getInstanceInc()[1];n.push(A)}return new c(b,k,{nodeId:l,name:d,camera:f,instanceMarkupKeysToShow:n,viewFrameInfo:null,nodesToShow:h,nodesToHide:r,transformMap:u,cuttingPlanes:null!==t?[t]:[],bits:67108864},1,a)};c.isAuthoredViewInfo=function(b,c){return 0===c};c._toRuntimeIds=function(b,c){for(var a=new Set,
d=0;d<c.length;d++){var f=b.toRuntimeId(c[d]);a.add(f)}return a};c.prototype._loadViewFrame=function(b,c,a){return g.ViewFrame.reify(b,c,this,a)};c.prototype.getViewFrame=function(){return void 0!==this._viewFrame?this._viewFrame:null};c.prototype.getParent=function(){return this._parent};c.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this)};c.prototype.getBranchVisibility=function(){var b=this.isVisible()?2:1;void 0===this._viewFrame||this._viewFrame.isOutOfHierarchy()||(b|=
this._viewFrame.isVisible()?2:1);return b};c.prototype.setVisibility=function(b){this._setVisibility(b)};c.prototype.isPmiFilteringSet=function(){return this._hasBits(33554432)};c.prototype.deactivate=function(b){var c=Promise.resolve();null!==this._activatedCuttingSectionIndex&&(b=b.getCuttingSection(this._activatedCuttingSectionIndex),null!==b&&(c=b.clear()),this._activatedCuttingSectionIndex=null);return c};c.prototype.activate=function(b,c,a,d,f,e,g){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(k){switch(k.label){case 0:return console.assert(null===this._activatedCuttingSectionIndex),[4,this._activateView(b,c,a,d,g)];case 1:return k.sent(),[2,this._activateCamera(b,c,f,e)]}})})};c.prototype._activateView=function(b,c,f,m,p){return __awaiter(this,void 0,void 0,function(){var k,l,n,t,v,w,y,x,z,B,A,D=this;return __generator(this,function(q){switch(q.label){case 0:return k=b.getRootNode(),null!==p&&console.assert(p.isAConfigurationNode()),l=0,n=new Map,t=[],v=[],w=e,void 0!==this._transformMap&&
(w=function(b,c){var a=D._transformMap,d=c.getRuntimeId();a=a.get(d);void 0!==a?(c.overrideLocalTransform(a),b.push(c)):c.hasLocalTransformOverride()&&(c.removeLocalTransformOverride(),b.push(c))}),y={enterProductOccurrence:function(b){(p===b||0<l)&&++l;var c=l,a=b.forEachPmi(function(b){var a=b.getPmiBodies();if(0!==a.length){var d=!0;if(D.isPmiFilteringSet()){d=!1;for(var f=0;f<a.length;f++){var e=a[f];e=e.getInstanceInc()[1];if(D._instanceMarkupKeysToShow.has(e)){d=!0;break}}}null!==p&&(d=d&&0<
c);n.set(b,d);for(b=0;b<a.length;b++)e=a[b],n.set(e,d)}}).then(function(){var a=b.getRuntimeId();D._nodesToHide.has(a)||b.isADrawingSheetNode()?n.set(b,!1):D._nodesToShow.has(a)&&(null!==p?n.set(b,0<c):n.set(b,!0));w(t,b);return b.forEachCadView(function(b){if(void 0!==b._viewFrame){var a=b===D;null!==p&&(a=a&&0<c);n.set(b,a);n.set(b._viewFrame,a)}})});v.push(a)},leaveProductOccurrence:function(){0<l&&--l},enterAnyBody:function(b){if(!b.isOutOfHierarchy()){w(t,b);for(var c=b.getParent();null!==c&&
!(c instanceof g.Pmi);){var a=c.getRuntimeId();if(D._nodesToHide.has(a)){n.set(c,!1);break}else if(D._nodesToShow.has(a)){n.set(c,!0);break}c=g.towardContainerNode(c.getParent())}c=b.getRuntimeId();D._nodesToShow.has(c)?n.set(b,!0):D._nodesToHide.has(c)&&n.set(b,!1);null!==p&&0===l&&n.set(b,!1)}}},[4,g.WalkerAsync.walk(y,k,g.WalkRestriction.None)];case 1:return q.sent(),[4,Promise.all(v)];case 2:return q.sent(),x=[],z=g.updateVisibilities(b,c,f,k,n,!0,!1,null,d.TreeWalkMode.Default),x.push(z),z=g.updateScMatrices(c,
f,t,!1),x.push(z),[4,d.Util.waitForAll(x)];case 3:q.sent();B=h.TerseArray.toArray(this._cuttingPlanes);if(!(0<B.length))return[3,5];A=m.getCuttingSection(4);if(null===A)return[3,5];this._activatedCuttingSectionIndex=4;return[4,a(A,B)];case 4:return q.sent(),[2,A.activate()];case 5:return[2]}})})};c.prototype._activateCamera=function(b,c,a,f){return __awaiter(this,void 0,void 0,function(){var e,k,l,n,h,m,w,y,x,z,B,A,D,C,E,F,H,G,I,K,J,L,M,N,R,O,P,S,Q,T,U,V,W,X;return __generator(this,function(p){switch(p.label){case 0:return e=
this._camera,void 0!==e?[3,3]:b.disableAutomaticFitWorld()?[3,2]:[4,a.fitWorld(f)];case 1:p.sent(),p.label=2;case 2:return[2];case 3:k=g.towardAttachRoot(this);l=g.towardAttachContext(k);n=g.towardProductOccurrence(l);h=d.Matrix.createFromArray(g.getNetMatrix(l));null!==n&&(m=k.getMeasurementUnit(),w=n.getMeasurementUnit(),m!==w&&(y=m/w,x=new d.Matrix,x.setScaleComponent(y,y,y),h=d.Matrix.multiply(x,h)));e.derived=e.initial.transform(h);if(!this._hasBits(8192))return[3,8];z=!1;return void 0===this._viewFrame?
[3,5]:[4,g.getBoundingByNodeId(b,c,[this._viewFrame.getRuntimeId()],7,!1,z)];case 4:return A=p.sent(),[3,7];case 5:return[4,c.getModelBounding(!0,!1,z)];case 6:A=p.sent(),p.label=7;case 7:return B=A,D=d.Point3.subtract(e.derived.getTarget(),e.derived.getPosition()),C=B.extents().length(),E=D.copy().normalize().scale(C),F=B.center(),H=d.Point3.subtract(F,E),e.derived.setPosition(H),e.derived.setTarget(F),e.derived.setWidth(C),e.derived.setHeight(C),[2,a._setCameraPromise(e.derived,f)];case 8:if(e.derived.getProjection()!==
d.Projection.Orthographic)return[3,10];G=d.Point3.subtract(e.derived.getTarget(),e.derived.getPosition());return[4,c.getModelBounding(!0,!1,!1)];case 9:return B=p.sent(),I=d.Point3.subtract(B.center(),e.derived.getPosition()),K=1/G.length(),J=K*d.Point3.dot(G,I),0<J&&(G.scale(K),L=Math.max(e.derived.getWidth(),e.derived.getHeight()),M=d.Point3.add(e.derived.getPosition(),d.Point3.scale(G,J)),N=d.Point3.subtract(M,d.Point3.scale(G,2.5*L)),e.derived.setPosition(N),e.derived.setTarget(M)),[2,a._setCameraPromise(e.derived,
f)];case 10:if(e.derived.getProjection()!==d.Projection.Perspective)return[3,12];R=.01;return[4,c.getModelBounding(!0,!1,!1)];case 11:B=p.sent();O=d.Point3.subtract(B.max,B.min).length();G=d.Point3.subtract(e.derived.getTarget(),e.derived.getPosition());P=G.length();S=P/O;if(0===O||S>R)return[2,a._setCameraPromise(e.derived,f)];Q=O*R*1.001;T=e.derived.getWidth()/P;U=e.derived.getHeight()/P;V=T*Q;W=U*Q;X=G.copy().normalize().scale(Q);F=d.Point3.add(e.derived.getPosition(),X);e.derived.setTarget(F);
e.derived.setWidth(V);e.derived.setHeight(W);return[2,a._setCameraPromise(e.derived,f)];case 12:return[2,a._setCameraPromise(e.derived,f)]}})})};c.prototype.hasPmi=function(b){var c=g.towardInclusionContext(this).getInclusionKey(),a=g.towardInclusionContext(b).getInclusionKey();if(c!==a)return!1;c=0;for(b=b.getPmiBodies();c<b.length;c++)if(a=b[c].getInstanceInc()[1],this._instanceMarkupKeysToShow.has(a))return!0;return!1};c.prototype.isAnnotationView=function(){return this._hasBits(134217728)};c.prototype.setViewFrame=
function(b){console.assert(void 0===this._viewFrame);this._viewFrame=b};return c}(g.NodeMixin);g.CadView=c})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){var a=function(a){function c(b,c,e,g){var f=a.call(this,b,e,g.nodeInfo)||this;f._inclusionContextForNodeId=c;f._modelKey=e;0<g.repItemInfos.length&&(c=f._loadRepresentationItems(b,e,g.repItemInfos),f._repItems=d.TerseArray.fromArray(c));b.registerPartDefinition(f);return f}__extends(c,a);c.parseXml=function(b,c){var a=g.Node.parseXml(b,c);if(null===a.name){var d=c.getAttribute("FilePath");null!==d&&(a=__assign({},a,{name:d}))}d=[];for(c=c.firstElementChild;null!==
c;){if("Body"===c.localName){var f=g.RepresentationItem.parseXml(b,c);d.push(f)}c=c.nextElementSibling}return{nodeInfo:a,repItemInfos:d}};c.parseBinary=function(b,c){var a=c.parseNodeParseBits(),d=g.Node.parseBinary(b,c,a),f=[];if(a.hasBits1(1024)){a=c.parseCount_32();for(var e=0;e<a;++e){var h=g.RepresentationItem.parseBinary(b,c);f.push(h)}}return{nodeInfo:d,repItemInfos:f}};c.reify=function(b,a,d,e){return new c(b,a,d,e)};c.createDynamic=function(b,a,d){var f=b.getRootNode();f=g.towardInclusionContext(f);
a={nodeInfo:{nodeId:b.massageAuthoredUserId(f,a),bits:1073741824,name:d,localTransform:null,attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},repItemInfos:[]};return new c(b,f,0,a)};c.createMissing=function(b){b=this.createDynamic(b,null,null);b._bits|=4096;return b};c.prototype.isMissing=function(){return this._hasBits(4096)};c.prototype._loadRepresentationItems=function(b,c,a){for(var d=[],f=0;f<a.length;f++){var e=g.RepresentationItem.reify(b,
c,a[f],this);this._addRepresentationItem(e);d.push(e)}return d};c.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this._inclusionContextForNodeId)};c.prototype.getInclusionContextForNodeId=function(){return this._inclusionContextForNodeId};c.prototype.addReferrer=function(b){var c=g.towardLoadContext(b),a=g.towardLoadContext(this._inclusionContextForNodeId);console.assert(c===a);this._referrers=d.TerseArray.push(this._referrers,b)};c.prototype.createRepItem=function(b,c){b=g.RepresentationItem.createDynamic(b,
c,null,this._modelKey,this);this._addRepresentationItem(b);return b};c.prototype._addRepresentationItem=function(b){this._repItems=d.TerseArray.push(this._repItems,b)};c.prototype.getRepresentationItems=function(){return d.TerseArray.toArray(this._repItems)};c.prototype.getReferrers=function(){return d.TerseArray.toArray(this._referrers)};c.prototype.removeAllReferrers=function(){for(var b=0,c=this.getReferrers();b<c.length;b++){var a=c[b].removePartDefinition();console.assert(this===a)}delete this._referrers};
c.prototype.getModelKey=function(){return this._modelKey};return c}(g.NodeMixin);g.PartDefinition=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){(function(c){c[c.Unknown=0]="Unknown";c[c.Text=1]="Text";c[c.Dimension=2]="Dimension";c[c.Arrow=3]="Arrow";c[c.Balloon=4]="Balloon";c[c.CircleCenter=5]="CircleCenter";c[c.Coordinate=6]="Coordinate";c[c.Datum=7]="Datum";c[c.Fastener=8]="Fastener";c[c.Gdt=9]="Gdt";c[c.Locator=10]="Locator";c[c.MeasurementPoint=11]="MeasurementPoint";c[c.Roughness=12]="Roughness";c[c.Welding=13]="Welding";c[c.Table=14]="Table";c[c.Other=15]="Other";c[c.GeometricalTolerance=16]=
"GeometricalTolerance"})(g.PmiType||(g.PmiType={}));(function(c){c[c.Ident=1]="Ident";c[c.Target=2]="Target"})(g.PmiSubTypeDatum||(g.PmiSubTypeDatum={}));(function(c){c[c.Distance=1]="Distance";c[c.DistanceOffset=2]="DistanceOffset";c[c.DistanceCumulate=3]="DistanceCumulate";c[c.Chamfer=4]="Chamfer";c[c.Slope=5]="Slope";c[c.Ordinate=6]="Ordinate";c[c.Radius=7]="Radius";c[c.RadiusTangent=8]="RadiusTangent";c[c.RadiusCylinder=9]="RadiusCylinder";c[c.RadiusEdge=10]="RadiusEdge";c[c.Diameter=11]="Diameter";
c[c.DiameterTangent=12]="DiameterTangent";c[c.DiameterCylinder=13]="DiameterCylinder";c[c.DiameterEdge=14]="DiameterEdge";c[c.DiameterCone=15]="DiameterCone";c[c.Length=16]="Length";c[c.LengthCurvilinear=17]="LengthCurvilinear";c[c.LengthCircular=18]="LengthCircular";c[c.Angle=19]="Angle"})(g.PmiSubTypeDimension||(g.PmiSubTypeDimension={}));(function(c){c[c.Fcf=1]="Fcf"})(g.PmiSubTypeGdt||(g.PmiSubTypeGdt={}));(function(c){c[c.Line=1]="Line";c[c.Spot=2]="Spot"})(g.PmiSubTypeWelding||(g.PmiSubTypeWelding=
{}));(function(c){c[c.SymbolUser=1]="SymbolUser";c[c.SymbolUtility=2]="SymbolUtility";c[c.SymbolCustom=3]="SymbolCustom";c[c.GeometricReference=4]="GeometricReference";c[c.Region=5]="Region"})(g.PmiSubTypeOther||(g.PmiSubTypeOther={}));var a=function(){return function(c){this.faceIds=[];this.edgeIds=[];this.body=c}}();g.PmiTopologyReference=a;var e=function(c){function b(a,d,e,n){var f=g.towardAttachContext(d).getMasterModelKey();var k=0;e.initiallyShown&&(k|=1073741824);k=c.call(this,a,f,{nodeId:e.nodeId,
bits:k,name:e.name,localTransform:null,attributes:e.attributesDataKey?e.attributesDataKey:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null})||this;k._bits|=16384;k._parent=n;k._packed=b._pack(e.pmiType,e.pmiSubType);n=0;for(var l=e.pmiBodyInfos;n<l.length;n++)k._pmiBodies=h.TerseArray.push(k._pmiBodies,k._loadPmiBody(a,f,l[n]));0<e.topoRefInfos.length&&(k._topoRefs=b._loadTopoRefs(d,e.topoRefInfos));if(0<e.topoRefs.length)if(void 0===
k._topoRefs)k._topoRefs=e.topoRefs.slice();else for(d=0,e=e.topoRefs;d<e.length;d++)k._topoRefs.push(e[d]);a.registerPmi(k);return k}__extends(b,c);b.parseBinary=function(b,c,a){var d=a.parsePmiParseBits(),f=a.parseNodeId(),e=null;h.hasBits(d,1)&&(e=a.parseCString());var k=null;h.hasBits(d,4)&&(k=a.parseDataKey());var l=1;h.hasBits(d,16)&&(l=a.parseCount_32());for(var u=[],t=h.hasBits(d,8),v=0;v<l;++v){var w=g.PmiBody.parseBinary(b,c,a,t);u.push(w)}b=0<u.length?h.hasBits(u[0].nodeInfo.bits,1073741824):
!1;c=a.parsePmiType();l=a.parsePmiSubType();t=[];if(h.hasBits(d,2))for(d=a.parseCount_32(),v=0;v<d;++v)w=g.ReferenceOnTopology.parseBinary(a),t.push(w);return{nodeId:f,name:e,attributesDataKey:k,pmiBodyInfos:u,initiallyShown:b,pmiType:c,pmiSubType:l,topoRefInfos:t,topoRefs:[]}};b.reify=function(c,a,d,e){var f=g.towardAttachContext(a);c=new b(c,a,d,e);f.attachedInvisibly()&&c.setVisibility(!1);return c};b.createDynamic=function(c,a,d,e,g,h,q,r){e={nodeId:c.generateDynamicNodeId(),name:e,attributesDataKey:null,
pmiBodyInfos:q,initiallyShown:!0,pmiType:g,pmiSubType:h,topoRefInfos:[],topoRefs:r};return new b(c,a,e,d)};b._loadTopoRefs=function(b,c){for(var a=[],d=0;d<c.length;d++){var f=g.ReferenceOnTopology.reify(b,c[d]);a.push(f)}return a};b.prototype._loadPmiBody=function(b,c,a){return g.PmiBody.reify(b,c,this,a)};b.prototype.getPmiBodies=function(){return h.TerseArray.toArray(this._pmiBodies)};b._pack=function(b,c){return b+100*c};b.prototype.getPmiType=function(){return this._packed%100};b.prototype.getPmiSubType=
function(){return Math.floor(this._packed/100)%100};b.prototype.getParent=function(){return this._parent};b.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this)};b.prototype.getBranchVisibility=function(){for(var b=this.isVisible()?2:1,c=0,a=h.TerseArray.toArray(this._pmiBodies);c<a.length;c++){var d=a[c];d.isOutOfHierarchy()||(b|=d.isVisible()?2:1)}return b};b.prototype.setVisibility=function(b){this._setVisibility(b)};b.prototype.getPmiTopologyReferences=function(b){if(void 0===
this._topoRefs)return[];for(var c=new Map,f=0,e=this._topoRefs;f<e.length;f++){var g=e[f],h=g.getBodyInstanceInc();h=b.lookupAnyBodyByInstanceInc(h[0],h[1]);if(null!==h){var q=c.get(h);void 0===q&&(q=new a(h),c.set(h,q));switch(g.getTopoItemType()){case d.PmiTopoRef.Face:q.faceIds.push(g.getItemIndex());break;case d.PmiTopoRef.Edge:q.edgeIds.push(g.getItemIndex())}}}var r=[];c.forEach(function(b){r.push(b)});return r};return b}(g.NodeMixin);g.Pmi=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal=
{}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(c,b){for(var a=[],e=0;e<c.length;e++){var g=b(c[e]);g&&a.push(g)}return d.Util.waitForAll(a)}var e=function(c){function b(a,e,l,n,m,p,q){var f=this;q=b._amendInfo(n,q);var k=g.towardAttachContext(m),t=k.getMasterModelKey();k=g.towardLoadContext(k);f=c.call(this,n,t,q.nodeInfo)||this;f._parent=p;f._bits=f._bits|q.productBits|32768;var v=q.nodeInfo.header;p=[];null!==q.prototypeDataKey&&(console.assert(null!==l),f._prototypeContext=f._loadPrototypeContext(e,
l,n,m,q.prototypeDataKey,v));console.assert(null===q.quickAccessPartDefinitionDataId||null===q.partDefinition);null!==q.partDefinition?Array.isArray(q.partDefinition)?f._partDefinition=f._lazyLoadPartDefinitionById(n,m,q.partDefinition,v):f._partDefinition=f._lazyLoadPartDefinitionByInfo(n,m,q.partDefinition,t):null!==q.quickAccessPartDefinitionDataId&&(f._partDefinition=f._lazyLoadPartDefinitionById(n,m,q.quickAccessPartDefinitionDataId,v));if(0<q.childDataKeys.length){console.assert(null!==l);var w=
function(){return __awaiter(f,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,this._loadProductOccurrences(e,l,n,m,q.childDataKeys,v)];case 1:return b=c.sent(),this._children=h.TerseArray.fromArray(b),[2]}})})}();p.push(w)}0<q.bodyInstanceInfos.length&&(t=f._loadBodyInstances(n,t,q.bodyInstanceInfos),f._bodyInstances=h.TerseArray.fromArray(t));0<q.cadViewInfos.length&&(t=f._loadCadViews(n,m,q.cadViewInfos),f._cadViews=h.TerseArray.fromArray(t));0<
q.pmiInfos.length&&(t=f._loadPmis(n,m,q.pmiInfos),f._pmis=h.TerseArray.fromArray(t));null!==q.measurementUnit&&(f._measurementUnit=q.measurementUnit);null!==q.externalModelInfo&&(console.assert(null!==a),console.assert(null!==l),g.ExternalModel.canImplicitlyLoad(q.externalModelInfo)?(w=f._loadAndAttachExternalModel(l,m,q.externalModelInfo),p.push(w)):f._pendingExternalModels=h.TerseArray.push(f._pendingExternalModels,q.externalModelInfo));t=0;for(w=q.layerInfos;t<w.length;t++){var y=w[t],x=k.getRuntimeLayerId(y.id);
null===x?n.createLayer(y.id,y.name,k):null!==y.name&&n.updateLayerName(x,y.name)}t=0;for(w=q.filters;t<w.length;t++)n.addFilter(w[t],k);k=0;for(t=q.relationships;k<t.length;k++)m.addRelationship(t[k]);k=0;for(t=q.bimInfos;k<t.length;k++)m.addBimInfos(t[k]);k=f.getAuthoredLayerId();null!==k&&(n.registerNodeInLayer(f,k),f.isOutOfHierarchy()||n.registerTreeNodeInLayer(f,k));n.registerProductOccurrence(f);if(null===a){if(0<p.length)throw new d.InternalLogicError;}else a.resolve(d.Util.waitForAll(p));
return f}__extends(b,c);b.parseXml=function(b,c,a,d,e){var f=a.getInclusionKey(),k=g.Node.parseXml(c,d),l=g.XmlParser.parseFloat(d,"Unit"),h=[],n=[],m=[],w=[],y=[],x=[],z=null,B=null,A=null;for(d=d.firstElementChild;null!==d;){if("PartDefinition"===d.localName){z=g.PartDefinition.parseXml(c,d);break}else if("BodyInstance"===d.localName){var D=g.BodyInstance.parseXml(c,d,f);h.push(D)}else if("Material"===d.localName)console.assert(null===B),B=g.SimpleMaterial.parseXml(d);else if("ExternalModel"===
d.localName){if(console.assert(null===A),D=d.getAttribute("Name"),null!==D){A=g.XmlParser.parseFloat(d,"Unit");var C=g.XmlParser.parseBounding(d,"BoundingBox");A={config:b,modelName:D,bounding:C,measurementUnit:A,toAttachData:e,reservedNodeIdOffset:0}}}else if("CADView"===d.localName)D=g.CadView.parseXml(c,d,a),x.push(D);else if("Filter"===d.localName)n.push(g.Filter.parseXml(d));else if("Layer"===d.localName)D=g.Layer.parseXml(d),null!==D&&m.push(D);else if("Relationships"===d.localName){D=g.Relationship.parseXml(d);
null!==D&&w.push(D);if(null!==D.related){C=0;for(var E=D.related.relationships;C<E.length;C++){var F=E[C];!1===g.RelationshipUtils.findBimObjectInArray(y,F)&&y.push(F)}}null!==D.relating&&!1===g.RelationshipUtils.findBimObjectInArray(y,D.relating.relationElt)&&y.push(D.relating.relationElt)}d=d.nextElementSibling}return{nodeInfo:k,productBits:0,childDataKeys:[],prototypeDataKey:null,partDefinition:z,quickAccessPartDefinitionDataId:null,externalModelInfo:A,bodyInstanceInfos:h,cadViewInfos:x,pmiInfos:[],
measurementUnit:l,simpleMaterial:B,layerInfos:m,filters:n,relationships:w,bimInfos:y}};b.parseBinary=function(b,c,a,d){var f=g.towardAttachContext(a),e=f.getRemapper(),k=d.parseNodeParseBits();if(k.hasBits1(2097152)){var l=d.parseAssemblyDataVersion(2);l}k.hasBits2(8)&&f.setGenericTypeMaps(d.parseGenericTypes());l=g.Node.parseBinary(c,d,k);var h=0;k.hasBits1(4194304)&&(h=d.parseProductBits());var n=[];if(k.hasBits1(16))for(var v=d.parseCount_32(),w=0;w<v;++w){var y=d.parseDataKey();n.push(y)}y=v=
null;if(k.hasBits1(32)&&(v=d.parseDataKey(),k.hasBits1(64))){y=d.parseModelKey(e);console.assert(0!==y);var x=d.parseDataKey();y=[y,x]}x=[];if(k.hasBits1(128)){var z=d.parseCount_32();for(w=0;w<z;++w){var B=g.BodyInstance.parseBinary(c,a,d);x.push(B)}}z=null;k.hasBits1(524288)&&(w=d.parseModelKey(e),console.assert(0!==w),z=d.parseInclusionKey(e,w),z={config:b,inclusionKey:z,modelKey:w});b=null;k.hasBits1(512)&&(w=d.parseModelKey(e),0===w&&(w=f.getMasterModelKey()),b=d.parseDataKey(),b=[w,b]);f=[];
if(k.hasBits1(32768))for(e=d.parseCount_32(),w=0;w<e;++w)B=g.CadView.parseBinary(c,a,d),f.push(B);e=[];if(k.hasBits1(65536))for(B=d.parseCount_32(),w=0;w<B;++w){var A=g.Pmi.parseBinary(c,a,d);e.push(A)}B=null;k.hasBits1(16384)&&(B=d.parseFloat_64());k.hasBits1(16777216)&&(w=d.parsePoint3_64(),A=d.parsePoint3_64(),c.setViewAxes(w,A));c=[];if(k.hasBits1(134217728))for(A=d.parseCount_32(),w=0;w<A;++w){var D=g.Layer.parseBinary(d);c.push(D)}A=[];if(k.hasBits1(268435456))for(D=d.parseCount_32(),w=0;w<
D;++w){var C=g.Filter.parseBinary(d);A.push(C)}D=[];C=[];if(k.hasBits2(256))for(k=d.parseCount_32(),w=0;w<k;++w){var E=g.Relationship.parseBinary(a,d);D.push(E);if(null!==E.relating&&(!1===g.RelationshipUtils.findBimObjectInArray(C,E.relating.relationElt)&&C.push(E.relating.relationElt),null!==E.related)){var F=0;for(E=E.related.relationships;F<E.length;F++){var H=E[F];!1===g.RelationshipUtils.findBimObjectInArray(C,H)&&C.push(H)}}}return{nodeInfo:l,productBits:h,childDataKeys:n,prototypeDataKey:v,
partDefinition:b,quickAccessPartDefinitionDataId:y,externalModelInfo:z,bodyInstanceInfos:x,cadViewInfos:f,pmiInfos:e,measurementUnit:B,simpleMaterial:null,layerInfos:c,filters:A,relationships:D,bimInfos:C}};b.reifySync=function(c,a,d,e,h,p){console.assert(0===h.childDataKeys.length);console.assert(null===h.externalModelInfo);var f=g.towardAttachContext(e);c=new b(null,c,a,d,e,p,h);f.attachedInvisibly()&&c.setVisibility(!1);return c};b.reify=function(c,a,d,e,g,p){return __awaiter(this,void 0,void 0,
function(){var f,k;return __generator(this,function(l){switch(l.label){case 0:return f=h.OpenPromise.create(),k=new b(f,c,a,d,e,p,g),[4,f];case 1:return l.sent(),[2,k]}})})};b.createDynamic=function(c,a,e,h,m,p,q,r){void 0===q&&(q=!1);void 0===r&&(r=null);var f=g.towardInclusionContext(a);e={nodeInfo:{nodeId:c.massageAuthoredUserId(f,h),bits:p?1073741824:0,name:e,localTransform:m,attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},
productBits:q?268435456:0,childDataKeys:[],prototypeDataKey:null,partDefinition:null,quickAccessPartDefinitionDataId:null,bodyInstanceInfos:[],externalModelInfo:null,cadViewInfos:[],pmiInfos:[],measurementUnit:r,simpleMaterial:null,layerInfos:[],filters:[],relationships:[],bimInfos:[]};h=new d.LoadSubtreeConfig;h.attachInvisibly=!p;return new b(null,h,null,c,f,a,e)};b.createMissing=function(b,c){b=this.createDynamic(b,c,"Missing",null,null,!1);b._bits|=4096;return b};b.prototype.isMissing=function(){return this._hasBits(4096)};
b._amendInfo=function(b,c){if(null!==c.nodeInfo.name)return c;var a=null;h.hasBits(c.productBits,2)?a=b.generateProductName():h.hasBits(c.productBits,4)?a=b.generateGroupName():h.hasBits(c.productBits,32)?a=b.generateDrawingSheetName():h.hasBits(c.productBits,8)&&(a=b.generateDrawingViewName());if(null===a)return c;b=__assign({},c.nodeInfo,{name:a});return __assign({},c,{nodeInfo:b})};b.prototype._loadExternalModel=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d,f;return __generator(this,
function(e){if(g.ExternalModel.isNameInfo(a))return[2,b.attachByExternalModelInfo(a,this,c)];d=this.getAuthoredId();f=g.towardLoadContext(c);return f.handleExternalModel(d,c,a.inclusionKey)?[2,b.attachByExternalModelInfo(a,this,c)]:[2,null]})})};b.prototype._loadAndAttachExternalModel=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(f){switch(f.label){case 0:return[4,this._loadExternalModel(b,c,a)];case 1:return d=f.sent(),null!==d&&this.addAttachContext(d),
[2,d]}})})};b.prototype.loadPendingExternalModels=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,d,f,e,q,r,u,t,v;return __generator(this,function(k){switch(k.label){case 0:if(!this.hasPendingExternalModels())return[2,[]];c=g.towardInclusionContext(this);a=[];d=0;for(f=h.TerseArray.toArray(this._pendingExternalModels);d<f.length;d++)e=f[d],q=this._loadAndAttachExternalModel(b,c,e),a.push(q);delete this._pendingExternalModels;r=[];u=0;return[4,Promise.all(a)];case 1:t=k.sent(),k.label=
2;case 2:if(!(u<t.length))return[3,4];v=t[u];null!==v&&r.push(v);k.label=3;case 3:return u++,[3,2];case 4:return[2,r]}})})};b.prototype._lazyLoadPartDefinitionByInfo=function(b,c,a,d){b=g.PartDefinition.reify(b,c,d,a);return h.LazyPromise.create(b)};b.prototype._lazyLoadPartDefinitionById=function(b,c,a,d){var f=this,e=b.getAbstractScEngine(),k=g.towardLoadContext(c),l=b.lookupPartDefinitionByDataId(k,a[0],a[1]);if(null!==l)return h.LazyPromise.create(function(){return __awaiter(f,void 0,void 0,function(){var b;
return __generator(this,function(c){switch(c.label){case 0:return[4,l];case 1:return b=c.sent(),b.addReferrer(this),[2,b]}})})});l=h.LazyPromise.create(function(){return __awaiter(f,void 0,void 0,function(){var f,k,l,h,n,m,p;return __generator(this,function(q){switch(q.label){case 0:return f=a[0],k=a[1],[4,b.enqueue(function(){return e.safeGetMetaData(f,k)})];case 1:return l=q.sent(),null!==l?(h=new g.AssemblyData(d,l),n=new g.AssemblyDataParser(h),m=g.PartDefinition.parseBinary(b,n),p=g.PartDefinition.reify(b,
c,f,m),p.addReferrer(this),[2,p]):[2,g.PartDefinition.createMissing(b)]}})})});b.registerPartDefinitionByDataId(k,a[0],a[1],l);return l};b._loadProductOccurrence=function(c,a,d,e,h,p){return __awaiter(this,void 0,void 0,function(){var f,k;return __generator(this,function(l){f=new g.AssemblyDataParser(h);k=b.parseBinary(c,d,e,f);return[2,b.reify(c,a,d,e,k,p)]})})};b.prototype._loadPrototypeContext=function(c,a,d,e,m,p){var f=this,k=g.towardAttachContext(e),l=g.towardLoadContext(k),n=k.getMasterModelKey();
k=d.lookupPrototypeByDataId(l,n,m);null===k&&(k=h.LazyPromise.create(function(){return __awaiter(f,void 0,void 0,function(){var f,k,l;return __generator(this,function(h){switch(h.label){case 0:return f=d.getAbstractScEngine(),[4,d.enqueue(function(){return f.safeGetMetaData(n,m)})];case 1:return k=h.sent(),null!==k?(l=new g.AssemblyData(p,k),[2,b._loadProductOccurrence(c,a,d,e,l,v)]):[2,b.createMissing(d,v)]}})})}),k=new g.SharedPrototypeContext(k),d.registerPrototypeByDataId(l,n,m,k));var v=new g.PrototypeContext(k,
e);v.addReferrer(this);return v};b.prototype._loadProductOccurrences=function(c,a,d,e,m,p){return __awaiter(this,void 0,void 0,function(){var f,k,l,n,v,w,y,x,z,B,A;return __generator(this,function(q){switch(q.label){case 0:return f=g.towardAttachContext(e),l=k=f.getMasterModelKey(),n=d.getAbstractScEngine(),[4,d.enqueue(function(){return n.safeGetMetaDatas(l,m)})];case 1:v=q.sent(),w=[],y=0,q.label=2;case 2:if(!(y<m.length))return[3,9];x=void 0;if(null===v)return[3,6];z=v[y];v[y]=h.emptyBytes;B=new g.AssemblyData(p,
z);return[4,b._loadProductOccurrence(c,a,d,e,B,this)];case 3:return x=q.sent(),(A=a.onLoadChildProductOccurrence())?[4,A]:[3,5];case 4:q.sent(),q.label=5;case 5:return[3,7];case 6:x=b.createMissing(d,this),q.label=7;case 7:w.push(x),q.label=8;case 8:return++y,[3,2];case 9:return[2,w]}})})};b.prototype._loadBodyInstances=function(b,c,a){for(var d=[],f=0;f<a.length;f++){var e=g.BodyInstance.reify(b,c,this,a[f]);d.push(e)}return d};b.prototype._loadCadViews=function(b,c,a){for(var d=[],f=0;f<a.length;f++){var e=
g.CadView.reify(b,c,a[f],this);d.push(e);e.markLoaded()}return d};b.prototype._loadPmis=function(b,c,a){for(var d=[],f=0;f<a.length;f++){var e=g.Pmi.reify(b,c,a[f],this);d.push(e)}return d};b.prototype.getParent=function(){return this._parent};b.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this)};b.prototype.isAbsoluteRoot=function(){return-2===this._nodeId};b.prototype.getPrototype=function(){return void 0!==this._prototypeContext?this._prototypeContext:null};b.prototype.isAConfigurationNode=
function(){return this._hasBits(1)};b.prototype.isADefaultNode=function(){return this._hasBits(16)};b.prototype.isAProductNode=function(){return h.hasBits(this._bits,2)};b.prototype.isAGroupNode=function(){return h.hasBits(this._bits,4)};b.prototype.isADrawingSheetNode=function(){return h.hasBits(this._bits,32)};b.prototype.isADrawingViewNode=function(){return h.hasBits(this._bits,8)};b.prototype.addProductOccurrence=function(b){console.assert(b.getParent()===this);this._children=h.TerseArray.push(this._children,
b);this._itemWasAdded()};b.prototype.addBodyInstance=function(b){console.assert(b.getParent()===this);this._bodyInstances=h.TerseArray.push(this._bodyInstances,b);this._itemWasAdded()};b.prototype.addCadView=function(b){console.assert(b.getParent()===this);this._cadViews=h.TerseArray.push(this._cadViews,b);this._itemWasAdded()};b.prototype.addPmi=function(b){console.assert(b.getParent()===this);this._pmis=h.TerseArray.push(this._pmis,b);this._itemWasAdded()};b.prototype.addLoadContext=function(b){console.assert(b.getParent()===
this);this._childContexts=h.TerseArray.push(this._childContexts,b);this._itemWasAdded()};b.prototype.addAttachContext=function(b){console.assert(b.getParent()===this);this._childContexts=h.TerseArray.push(this._childContexts,b);this._itemWasAdded()};b.prototype._followPrototypesWhileEmpty=function(){if(void 0===this._prototypeContext||void 0!==this._children||void 0!==this._childContexts)return this;var b=this._prototypeContext.getProductOccurrence();return b.isResolved()?b.getResolved()._followPrototypesWhileEmpty():
this};b.prototype.getRawPartDefinition=function(){if(void 0!==this._partDefinition)return this._partDefinition;if(void 0!==this._prototypeContext){var b=this._prototypeContext.getProductOccurrence();if(b.isResolved())return b.getResolved().getRawPartDefinition()}return null};b.prototype.getPartDefinition=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){b=this.getRawPartDefinition();if(b instanceof h.LazyPromise)return[2,h.Boxed.create(b)];if(b instanceof
Promise)return[2,b];d.Util.TypeAssert(b);return[2,null]})})};b.prototype.getPartDefinitionSync=function(){console.assert(this.isLoaded());if(void 0!==this._partDefinition&&this._partDefinition.isResolved())return this._partDefinition.getResolved();if(void 0!==this._prototypeContext){var b=this._prototypeContext.getProductOccurrence();if(b.isResolved())return b.getResolved().getPartDefinitionSync()}return null};b.prototype._getChildren=function(){for(var b=h.TerseArray.toArray(this._children),c=0,
a=h.TerseArray.toArray(this._childContexts);c<a.length;c++){var d=a[c].getChildren();h.append(b,d)}return b};b.prototype.getChildren=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,this._followPrototypesWhileEmpty()];case 1:return b=c.sent(),[2,b._getChildren()]}})})};b.prototype.getChildrenSync=function(){console.assert(this.isLoaded());var b=this.tryGetChildrenSync();if(null===b)throw new d.InternalLogicError;return b};
b.prototype.tryGetChildrenSync=function(){var b=this._followPrototypesWhileEmpty();return b instanceof Promise?null:b._getChildren()};b.prototype.forEachChild=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:return[4,this.getChildren()];case 1:return c=d.sent(),[2,a(c,b)]}})})};b.prototype.forEachBodyInstance=function(b){var c=this.getBodyInstances();return a(c,b)};b.prototype.forEachPmi=function(b){var c=this.getPmis();return a(c,
b)};b.prototype.forEachCadView=function(b){var c=this.getCadViews();return a(c,b)};b.prototype.hasBodyInstances=function(){return void 0!==this._bodyInstances};b.prototype.getBodyInstances=function(){return h.TerseArray.toArray(this._bodyInstances)};b.prototype.getCadViews=function(){return h.TerseArray.toArray(this._cadViews)};b.prototype.getPmis=function(){return h.TerseArray.toArray(this._pmis)};b.prototype.setMeasurementUnit=function(b){this._measurementUnit=b};b.prototype.unsetMeasurementUnit=
function(){this._measurementUnit=void 0};b.prototype.hasMeasurementUnit=function(){return void 0!==this._measurementUnit};b.prototype.getMeasurementUnit=function(){for(var b=this;null!==b;){if(void 0!==b._measurementUnit)return b._measurementUnit;b=g.towardProductOccurrence(b._parent)}return 1};b.prototype.getPhysicalProperties=function(){return __awaiter(this,void 0,void 0,function(){var b,c,a,d,e;return __generator(this,function(f){switch(f.label){case 0:return[4,this.getPartDefinition()];case 1:return b=
f.sent(),null===b?[2,null]:[4,b.value];case 2:c=f.sent();a=c.getRepresentationItems();if(1!==a.length)return[2,null];d=a[0];e=d.getPhysicalProperties();return[2,e]}})})};b.prototype.setPartDefinition=function(b){console.assert(void 0===this._partDefinition);this._partDefinition=h.LazyPromise.create(b)};b.prototype.setPrototype=function(b){console.assert(void 0===this._prototypeContext);this._prototypeContext=b;this._markBranchVisibilityDirty(!1)};b.prototype.removePrototype=function(){if(void 0===
this._prototypeContext)throw new d.InternalLogicError;var b=this._prototypeContext;delete this._prototypeContext;this._markBranchVisibilityDirty(!1);return b};b.prototype.getBranchVisibility=function(){this._updateBranchVisibility();return this._getBranchVisibility()};b.prototype._getBranchVisibility=function(){var b=this.isVisible()?2:1;this._hasBits(65536)&&(b|=2);this._hasBits(131072)&&(b|=1);return b};b.prototype._setBranchVisibility=function(b){this.isVisible()?console.assert(h.hasBits(b,2)):
console.assert(h.hasBits(b,1));this._bits&=-196609;h.hasBits(b,1)&&(this._bits|=131072);h.hasBits(b,2)&&(this._bits|=65536)};b.prototype._updateBranchVisibility=function(){if(this._hasBits(32768)){var b=this.isVisible()?2:1,c=this._getSubBranchVisibilities();null!==c&&(b|=c);this._setBranchVisibility(b);this._bits&=-32769}};b.prototype._getSubBranchVisibilities=function(){for(var b=0,c=0,a=this.getChildrenSync();c<a.length;c++){var d=a[c].getBranchVisibility();b|=d;if(3===b)return 3}d=0;for(c=this.getBodyInstances();d<
c.length;d++)if(a=c[d],!a.isOutOfHierarchy()&&(b|=a.isVisible()?2:1,3===b))return 3;c=0;for(a=this.getPmis();c<a.length;c++)if(d=a[c].getBranchVisibility(),b|=d,3===b)return 3;c=0;for(a=this.getCadViews();c<a.length;c++)if(d=a[c].getBranchVisibility(),b|=d,3===b)return 3;return 0===b?null:b};b.prototype._itemWasAdded=function(){3!==this._getBranchVisibility()&&this._markBranchVisibilityDirty(!0)};b.prototype._onItemRemoved=function(){1!==this._getBranchVisibility()&&this._markBranchVisibilityDirty(!1)};
b.prototype.markBranchVisibilityDirty=function(){this._markBranchVisibilityDirty(!1)};b.prototype._markBranchVisibilityDirty=function(b){if(!(this._hasBits(32768)||b&&3===this._getBranchVisibility()))if(this._bits|=32768,this._parent instanceof g.PrototypeContext)for(var c=0,a=this._parent.getReferrers();c<a.length;c++)a[c]._markBranchVisibilityDirty(b);else if(c=g.towardProductOccurrence(this._parent),null!==c)return c._markBranchVisibilityDirty(b)};b.prototype.setVisibility=function(b){this.isVisible()!==
b&&(this._setVisibility(b),this._markBranchVisibilityDirty(!1))};b.prototype._removeDirectChild=function(b){var c=h.TerseArray.toArray(this._children),a=c.length;c=c.filter(function(c){return c!==b});if(c.length===a)return!1;0===c.length?delete this._children:this._children=h.TerseArray.fromArray(c);this._onItemRemoved();return!0};b.prototype._removeIndirectChild=function(b){for(var c=!1,a=h.TerseArray.toArray(this._childContexts),d=0,f=a;d<f.length;d++)if(f[d].removeProductOccurrence(b)){c=!0;break}if(!c)return!1;
a=a.filter(function(b){return b.hasChildren()});0===a.length?delete this._childContexts:this._childContexts=h.TerseArray.fromArray(a);this._onItemRemoved();return!0};b.prototype.removeProductOccurrence=function(b){return this._removeDirectChild(b)?!0:this._removeIndirectChild(b)};b.prototype.removeBodyInstance=function(b){var c=h.TerseArray.toArray(this._bodyInstances),a=c.length;c=c.filter(function(c){return c!==b});if(c.length===a)return!1;0===c.length?delete this._bodyInstances:this._bodyInstances=
h.TerseArray.fromArray(c);this._onItemRemoved();return!0};b.prototype.purgeContents=function(){var b=this;this._markBranchVisibilityDirty(!1);var c=[];if(void 0!==this._partDefinition&&!this._partDefinition.isUnforced()){var e=this._partDefinition.then(function(c){c.removeAllReferrers();delete b._partDefinition});c.push(e)}void 0!==this._prototypeContext&&(e=this._prototypeContext.purgeContents(),c.push(e),delete this._prototypeContext);e=h.TerseArray.toArray(this._children);e=a(e,function(b){return b.purgeContents()});
c.push(e);delete this._children;e=h.TerseArray.toArray(this._childContexts);e=a(e,function(b){return b.purgeContents()});c.push(e);delete this._childContexts;delete this._bodyInstances;delete this._cadViews;delete this._pmis;delete this._measurementUnit;return d.Util.waitForAll(c)};b.prototype.removePartDefinition=function(){if(void 0===this._partDefinition||!this._partDefinition.isResolved())throw new d.InternalLogicError;var b=this._partDefinition;delete this._partDefinition;return b.getResolved()};
b.prototype.isOutOfHierarchy=function(){return this._hasBits(268435456)};b.prototype.markIsExternalModelRoot=function(b){console.assert(!this._hasBits(2048));this._bits|=2048;b.markSeenExternalModel()};b.prototype.isExternalModelRoot=function(){return this._hasBits(2048)};b.prototype.addPendingExternalModel=function(b){this._pendingExternalModels=h.TerseArray.push(this._pendingExternalModels,b)};b.prototype.hasPendingExternalModels=function(){return!h.TerseArray.isEmpty(this._pendingExternalModels)};
return b}(g.NodeMixin);g.ProductOccurrence=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(b,c){return void 0!==b&&c<b.length?b[c]:null}function e(b,c,a){void 0===b&&(b=[]);b.length=Math.max(b.length,c+1);b[c]=a;return b}var c;(function(b){b[b.Unknown=0]="Unknown";b[b.BRep=1]="BRep";b[b.Tessellation=2]="Tessellation";b[b.Wireframe=3]="Wireframe";b[b.PointCloud=4]="PointCloud"})(c=g.BodyType||(g.BodyType={}));var b=function(b){function f(c,a,d,f){a=b.call(this,c,a,d.nodeInfo)||this;a._parent=f;a._bodyType=d.bodyType;0<d.faceMeasurementProps.length&&
(a._faceMeasurementProps=d.faceMeasurementProps.slice());0<d.edgeMeasurementProps.length&&(a._edgeMeasurementProps=d.edgeMeasurementProps.slice());null!==d.physicalProps&&(a._physicalProps=d.physicalProps);if(0<d.faceAttributes.length){a._faceAttributes=[];for(var e=0,g=d.faceAttributes;e<g.length;e++)f=g[e],a._faceAttributes.push(null===f?null:f.copy())}if(0<d.edgeAttributes.length)for(a._edgeAttributes=[],e=0,g=d.edgeAttributes;e<g.length;e++)f=g[e],a._edgeAttributes.push(null===f?null:f.copy());
if(0<d.pointAttributes.length)for(a._pointAttributes=[],e=0,d=d.pointAttributes;e<d.length;e++)f=d[e],a._pointAttributes.push(null===f?null:f.copy());c.registerRepresentationItem(a);return a}__extends(f,b);f.parseXml=function(b,a){b=g.Node.parseXml(b,a);a=g.XmlParser.parseMeshKey(a,"TCKey_Mesh");return{nodeInfo:b,meshKey:a,bodyType:c.Unknown,faceMeasurementProps:[],edgeMeasurementProps:[],physicalProps:null,faceAttributes:[],edgeAttributes:[],pointAttributes:[]}};f.parseBinary=function(b,c){var a=
c.parseNodeParseBits();b=g.Node.parseBinary(b,c,a);var f=c.parseBodyType(),e=null;a.hasBits1(8192)&&(e=c.parseMeshKey());var k=[];if(a.hasBits1(2048))for(var l=c.parseCount_32(),h=0;h<l;++h){var n=g.MeasurementProperty.Face.parseBinary(c);k.push(n)}n=[];if(a.hasBits1(4096))for(l=c.parseCount_32(),h=0;h<l;++h){var w=g.MeasurementProperty.Edge.parseBinary(c);n.push(w)}l=null;a.hasBits1(1048576)&&(l=g.PhysicalProperties.parseBinary(c));w=[];if(a.hasBits2(1)){var y=c.parseCount_32();for(h=0;h<y;h++){for(var x=
[],z=c.parseCount_32(),B=0;B<z;B++){var A=g.Attribute.parseBinary(c);A.getType()!==d.AttributeType.Ignored&&x.push(A)}w.push(0<x.length?new d.SubentityAttributes(x):null)}}y=[];if(a.hasBits2(2)){var D=c.parseCount_32();for(h=0;h<D;h++){x=[];z=c.parseCount_32();for(B=0;B<z;B++)A=g.Attribute.parseBinary(c),A.getType()!==d.AttributeType.Ignored&&x.push(A);y.push(0<x.length?new d.SubentityAttributes(x):null)}}D=[];if(a.hasBits2(128))for(a=c.parseCount_32(),h=0;h<a;h++){x=[];z=c.parseCount_32();for(B=
0;B<z;B++)A=g.Attribute.parseBinary(c),A.getType()!==d.AttributeType.Ignored&&x.push(A);D.push(0<x.length?new d.SubentityAttributes(x):null)}return{nodeInfo:b,meshKey:e,bodyType:f,faceMeasurementProps:k,edgeMeasurementProps:n,physicalProps:l,faceAttributes:w,edgeAttributes:y,pointAttributes:D}};f.reify=function(b,c,a,d){return new f(b,c,a,d)};f.createDynamic=function(b,a,d,e,k){var l=k.getInclusionContextForNodeId();a={nodeInfo:{nodeId:b.massageAuthoredUserId(l,a),bits:1073741824,name:d,localTransform:null,
attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},meshKey:null,bodyType:c.Unknown,faceMeasurementProps:[],edgeMeasurementProps:[],physicalProps:null,faceAttributes:[],edgeAttributes:[],pointAttributes:[]};return new f(b,e,a,k)};f.prototype.setPhysicalProperties=function(b){this._physicalProps=b};f.prototype.getPhysicalProperties=function(){return void 0!==this._physicalProps?this._physicalProps:null};f.prototype.getParent=
function(){return this._parent};f.prototype.getFaceCount=function(){return void 0!==this._faceMeasurementProps?this._faceMeasurementProps.length:0};f.prototype.getEdgeCount=function(){return void 0!==this._edgeMeasurementProps?this._edgeMeasurementProps.length:0};f.prototype.getFaceAttributes=function(b){return a(this._faceAttributes,b)};f.prototype.getEdgeAttributes=function(b){return a(this._edgeAttributes,b)};f.prototype.getPointAttributes=function(b){return a(this._pointAttributes,b)};f.prototype.getFaceMeasurementProperty=
function(b){return a(this._faceMeasurementProps,b)};f.prototype.getEdgeMeasurementProperty=function(b){return a(this._edgeMeasurementProps,b)};f.prototype.setFaceMeasurementProperty=function(b,c){this._faceMeasurementProps=e(this._faceMeasurementProps,b,c.copy())};f.prototype.setEdgeMeasurementProperty=function(b,c){this._edgeMeasurementProps=e(this._edgeMeasurementProps,b,c.copy())};f.prototype.getBodyType=function(){return this._bodyType};f.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,
this._parent.getInclusionContextForNodeId())};return f}(g.NodeMixin);g.RepresentationItem=b})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(c,b,a,d){this._type=c;this._valueName=a;this._title=b;this._value=d}a.parseBinary=function(c){var b=null,d=c.getHeader(),e=0;null!==d&&d.supportsAttributeBits()&&(e=c.parseAttributeParseBits());d=c.parseCString();h.hasBits(e,1)&&(b=c.parseCString());e=c.parseAttributeType();c=c.parseCString();return new a(e,d,b,c)};a.parseXml=function(c){console.assert("Attr"===c.localName);var b=d.AttributeType.Undefined,f="",e="",g=c.getAttribute("ValueName"),
h=c.getAttribute("Name");if(null!==h&&(f=h,"__PRC_RESERVED_ATTRIBUTE_A3DF_ProductInformation"===f))return new a(b,f,g,e);h=c.getAttribute("Type");if(null!==h)switch(h){case "i":b=d.AttributeType.Int;break;case "f":b=d.AttributeType.Float;break;case "t":b=d.AttributeType.Time;break;case "s":b=d.AttributeType.String}c=c.getAttribute("Value");null!==c&&(e=c);return new a(b,f,g,e)};a.prototype.getType=function(){return this._type};a.prototype.getValueName=function(){return this._valueName};a.prototype.getTitle=
function(){return this._title};a.prototype.getValue=function(){return this._value};a.prototype.copy=function(){var c=null;null!==this._valueName&&(c=this._valueName.slice());return new a(this._type,this._title.slice(),c,this._value.slice())};return a}();g.Attribute=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(c){this._colorTable=[];this._colorTable=c.slice()}a.parseXml=function(c){console.assert("ColorTable"===c.localName);var b=[];c=c.getAttribute("data");if(null!==c){c=c.split(" ");console.assert(0===c.length%3);for(var f=0;f<c.length;f+=3){var e=parseFloat(c[f]),g=parseFloat(c[f+1]),h=parseFloat(c[f+2]);e=new d.Color(e,g,h);b.push(e)}}return new a(b)};a.prototype.getColor=function(c){if(0<=c&&0===c%3&&(c/=3,c<this._colorTable.length))return this._colorTable[c];
console.assert(!1);return null};return a}();g.ColorTable=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){var a=function(){function b(){this.isInclusive=!1;this.ids=[]}b.parseBinary=function(c){var a=new b;a.isInclusive=c.parseBoolean();for(var d=c.parseCount_32(),f=0;f<d;f++)a.ids.push(c.parseNodeId());return a};b.parseXml=function(c){var a=new b;a.isInclusive="1"===c.getAttribute("Inclusive");var d=g.XmlParser.parseNodeIds(c,"Ids");null!==d?(a.ids=d,c=c.getAttribute("Count"),null!==c&&(c=parseInt(c,10),console.assert(c===a.ids.length))):console.error("'Entities' tag has missing or malformed 'Ids' attribute");
return a};return b}();g.FilterEntities=a;var e=function(){function b(){this.isInclusive=!1;this.authoredIds=[]}b.parseBinary=function(c){var a=new b;a.isInclusive=c.parseBoolean();for(var d=c.parseCount_32(),f=0;f<d;f++)a.authoredIds.push(c.parseLayerId());return a};b.parseXml=function(c){var a=new b;a.isInclusive="1"===c.getAttribute("Inclusive");var d=g.XmlParser.parseUints(c,"Ids");null!==d?(a.authoredIds=d,c=c.getAttribute("Count"),null!==c&&(c=parseInt(c,10),console.assert(c===a.authoredIds.length))):
console.error("'Layers' tag has missing or malformed 'Ids' attribute");return a};return b}();g.FilterLayers=e;var c=function(){function b(){this.isDisplayfilter=!1;this.name=null;this.isActive=!1;this.entities=this.layers=null}b.parseBinary=function(c){var f=new b,g=null,h=null,m=c.parseLayerParseBits();f.isDisplayfilter=c.parseBoolean();d.hasBits(m,1)&&(f.name=c.parseCString());f.isActive=c.parseBoolean();d.hasBits(m,2)&&(g=e.parseBinary(c));d.hasBits(m,4)&&(h=a.parseBinary(c));f.layers=g;f.entities=
h;return f};b.parseXml=function(c){var d=new b,f=c.getAttribute("Name");null!==f&&(d.name=f);d.isDisplayfilter="1"===c.getAttribute("Display");d.isActive="1"===c.getAttribute("Active");for(f=c.firstElementChild;null!==f;f=f.nextElementSibling)"Layers"===f.localName?(console.assert(null===d.layers),d.layers=e.parseXml(f)):"Entities"===f.localName?(console.assert(null===d.entities),d.entities=a.parseXml(f)):console.error("Unknown tag: "+c.localName);return d};return b}();g.Filter=c})(d.Tree||(d.Tree=
{}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){var a=function(){function a(c,b,a,d){this.id=c;this.name=b;this.nodes=a;this.treeNodes=d}a.parseBinary=function(c){var b=c.parseLayerParseBits(),a=c.parseLayerId(),e=null;d.hasBits(b,1)&&(e=c.parseCString());return{id:a,name:e}};a.parseXml=function(c){var b=c.getAttribute("Name");c=g.XmlParser.parseUint(c,"Id");return null===c?(console.error("'Layer' tag missing 'Id' attribute"),null):{id:c,name:b}};return a}();g.Layer=a})(d.Tree||(d.Tree={}))})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(c,b,a,d,e,g,h,p,q){this._ambientAlpha=c;this._diffuseAlpha=b;this._emissiveAlpha=a;this._specularAlpha=d;this._shininess=e;null!==g&&(this._ambientIndex=g);null!==h&&(this._diffuseIndex=h);null!==p&&(this._emissiveIndex=p);null!==q&&(this._specularIndex=q)}a.parseXml=function(c){console.assert("MaterialTable"===c.localName);var b=g.XmlParser.parseFloat(c,"AmbientAlpha")||0,d=g.XmlParser.parseFloat(c,"DiffuseAlpha")||0,e=g.XmlParser.parseFloat(c,
"EmissiveAlpha")||0,l=g.XmlParser.parseFloat(c,"SpecularAlpha")||0,h=g.XmlParser.parseFloat(c,"Shininess")||0,m=g.XmlParser.parseUint(c,"AmbientIndice"),p=g.XmlParser.parseUint(c,"DiffuseIndice"),q=g.XmlParser.parseUint(c,"EmissiveIndice");c=g.XmlParser.parseUint(c,"SpecularIndice");return new a(b,d,e,l,h,m,p,q,c)};a.prototype.getAmbientColorIndex=function(){return void 0!==this._ambientIndex?this._ambientIndex:null};a.prototype.getDiffuseColorIndex=function(){return void 0!==this._diffuseIndex?this._diffuseIndex:
null};a.prototype.getEmissiveColorIndex=function(){return void 0!==this._emissiveIndex?this._emissiveIndex:null};a.prototype.getSpecularColorIndex=function(){return void 0!==this._specularIndex?this._specularIndex:null};a.prototype.getAmbientAlpha=function(){return this._ambientAlpha};a.prototype.getDiffuseAlpha=function(){return this._diffuseAlpha};a.prototype.getEmissiveAlpha=function(){return this._emissiveAlpha};a.prototype.getSpecularAlpha=function(){return this._specularAlpha};a.prototype.getShininess=
function(){return this._shininess};return a}();g.Material=a;a=function(){function a(c,b){null!==c&&(this._color=c);null!==b&&(this._alpha=b)}a.parseXml=function(c){console.assert("Material"===c.localName);var b=null,f=null;c=c.getAttribute("Color");if(null!==c){var e=c.split(" ");if(4!==e.length)throw new d.XmlParseError('Expected "Color" attribute to have four channel components.');b=parseFloat(e[0]);f=parseFloat(e[1]);c=parseFloat(e[2]);e=parseFloat(e[3]);b=new d.Color(b,f,c);f=e}return new a(b,
f)};a.prototype.getColor=function(){return void 0!==this._color?this._color:null};a.prototype.getAlpha=function(){return void 0!==this._alpha?this._alpha:null};return a}();g.SimpleMaterial=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(c,b,a){this.surfaceArea=c;this.volume=b;this.centerOfGravity=a}a.parseBinary=function(c){var b=c.parseFloat_64(),d=c.parseFloat_64();c=c.parsePoint3_64();return new a(b,d,c)};return a}();d.PhysicalProperties=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(c,b,a,d){this._inclusionKey=c;this._bodyInstanceKey=b;this._topoItemType=a;this._itemIndex=d}a.parseBinary=function(c){var b=c.parseInstanceKey(),a=c.parsePmiTopoRef();c=c.parseIndex_32();return{bodyInstanceKey:b,topoItemType:a,itemIndex:c}};a.reify=function(c,b){c=c.getInclusionKey();return new a(c,b.bodyInstanceKey,b.topoItemType,b.itemIndex)};a.fromBodyInstance=function(c,b,d){c=c.getInstanceInc();return new a(c[0],c[1],b,d)};a.prototype.getBodyInstanceInc=
function(){return[this._inclusionKey,this._bodyInstanceKey]};a.prototype.getTopoItemType=function(){return this._topoItemType};a.prototype.getItemIndex=function(){return this._itemIndex};return a}();d.ReferenceOnTopology=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a;(function(b){b[b.Undefined=0]="Undefined";b[b.Unconnected=1]="Unconnected";b[b.Connected=2]="Connected"})(a=g.BimStatus||(g.BimStatus={}));var e=function(){function c(){this.relationships=[]}c.parseBinary=function(d,f){for(var e=new c,g=f.parseCount_32(),k=0;k<g;k++){var l=f.parseCString(),h=f.parseCString();if(f.parseBoolean()){var n=a.Connected;b.registerBimId(l,d)}else n=a.Unconnected;e.relationships.push({category:n,id:l,name:h})}return e};return c}();
g.RelationshipRelated=e;var c=function(){function c(){this.relationElt={id:"",name:"",category:a.Undefined}}c.parseBinary=function(d,f){var e=new c;e.relationElt.id=f.parseCString();e.relationElt.name=f.parseCString();f.parseBoolean()?(e.relationElt.category=a.Connected,b.registerBimId(e.relationElt.id,d)):e.relationElt.category=a.Unconnected;return e};c.parseXml=function(b){var a=new c;b.getAttribute("Relating");return a};return c}();g.RelationshipRelating=c;var b=function(){function b(){this.type=
d.RelationshipType.Undefined;this.relating=this.related=null}b.registerBimId=function(b,c){var a=c.toRuntimeId(parseInt(b,10));null!==a&&c.addBimIdToMap(b,a)};b.parseBinary=function(a,d){var f=new b,g=d.parseRelationshipParseBits();h.hasBits(g,1)&&(f.type=d.parseCount_32());h.hasBits(g,4)&&(f.relating=c.parseBinary(a,d));h.hasBits(g,2)&&(f.related=e.parseBinary(a,d));return f};b.parseXml=function(c){var a=new b;c=c.getAttribute("Type");null!==c&&(a.type=Number(c));return a};return b}();g.Relationship=
b;var f=function(){function b(){}b.pushRelatedItemFromParser=function(b){var c=[],a=0;for(b=b.relationships;a<b.length;a++){var d=b[a];c.push({category:d.category,id:d.id,name:d.name})}return c};b.addFromRelatingElt=function(b,c){var a=b.related,d=b.type;if(null!==d&&void 0!==d)if(c.has(d)||null===a){if(a=b.related,null!==a)for(b=0,a=a.relationships;b<a.length;b++){var f=a[b],e=c.get(d);void 0!==e&&!1===this.findBimObjectInArray(e.related,{id:f.id,category:f.category,name:f.name})&&e.related.push({id:f.id,
category:f.category,name:f.name})}}else c.set(d,{related:this.pushRelatedItemFromParser(a),relating:[]})};b.findBimObjectInArray=function(b,c){for(var a=0;a<b.length;a++){var d=b[a];if(d.category===c.category&&d.name===c.name&&d.id===c.id)return!0}return!1};b.addFromRelatedElt=function(b,c){var a=b.type;null!==a&&(c.has(a)||null===b.relating||c.set(a,{related:[],relating:[{category:b.relating.relationElt.category,id:b.relating.relationElt.id,name:b.relating.relationElt.name}]}))};b.findIndexInRelated=
function(b,c){for(var a=-1,d=0,f=0;f<c.length;f++){if(c[f].id===b){a=d;break}d++}return a};return b}();g.RelationshipUtils=f})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(c,b){console.assert(null!==c||null!==b);this._materialIndex=c;this._colorIndex=b}a.parseXml=function(c){console.assert("Style"===c.localName);var b=d.XmlParser.parseUint(c,"MaterialIndex");c=d.XmlParser.parseUint(c,"ColorIndex");return new a(b,c)};a.prototype.getMaterialIndex=function(){return this._materialIndex};a.prototype.getColorIndex=function(){return this._colorIndex};return a}();d.Style=a})(d.Tree||(d.Tree={}))})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(){}a.parseBinary=function(c){return c.parseMatrix()};a.parseXml=function(c){console.assert("Transformation"===c.localName);var b=[];c=c.getAttribute("RelativeTransfo");if(null!==c){c=c.split(" ");console.assert(16===c.length);for(var a=0;16>a;++a){var d=parseFloat(c[a]);console.assert(!isNaN(d));b.push(d)}}return b};a.getIdentity=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};a.copy=function(c){return c.slice()};a.isIdentity=
function(c){return 1===c[0]&&0===c[1]&&0===c[2]&&0===c[3]&&0===c[4]&&1===c[5]&&0===c[6]&&0===c[7]&&0===c[8]&&0===c[9]&&1===c[10]&&0===c[11]&&0===c[12]&&0===c[13]&&0===c[14]&&1===c[15]};a.multiply=function(c,b){var d=a.getIdentity();d[0]=c[0]*b[0]+c[1]*b[4]+c[2]*b[8]+c[3]*b[12];d[1]=c[0]*b[1]+c[1]*b[5]+c[2]*b[9]+c[3]*b[13];d[2]=c[0]*b[2]+c[1]*b[6]+c[2]*b[10]+c[3]*b[14];d[3]=c[0]*b[3]+c[1]*b[7]+c[2]*b[11]+c[3]*b[15];d[4]=c[4]*b[0]+c[5]*b[4]+c[6]*b[8]+c[7]*b[12];d[5]=c[4]*b[1]+c[5]*b[5]+c[6]*b[9]+c[7]*
b[13];d[6]=c[4]*b[2]+c[5]*b[6]+c[6]*b[10]+c[7]*b[14];d[7]=c[4]*b[3]+c[5]*b[7]+c[6]*b[11]+c[7]*b[15];d[8]=c[8]*b[0]+c[9]*b[4]+c[10]*b[8]+c[11]*b[12];d[9]=c[8]*b[1]+c[9]*b[5]+c[10]*b[9]+c[11]*b[13];d[10]=c[8]*b[2]+c[9]*b[6]+c[10]*b[10]+c[11]*b[14];d[11]=c[8]*b[3]+c[9]*b[7]+c[10]*b[11]+c[11]*b[15];d[12]=c[12]*b[0]+c[13]*b[4]+c[14]*b[8]+c[15]*b[12];d[13]=c[12]*b[1]+c[13]*b[5]+c[14]*b[9]+c[15]*b[13];d[14]=c[12]*b[2]+c[13]*b[6]+c[14]*b[10]+c[15]*b[14];d[15]=c[12]*b[3]+c[13]*b[7]+c[14]*b[11]+c[15]*b[15];
return d};return a}();d.Transform=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(b){b.markLoaded();var c=0;for(b=b.getRepresentationItems();c<b.length;c++)b[c].markLoaded()}function e(b){b=b.getRawPartDefinition();if(null!==b){if(b instanceof h.LazyPromise)return b.isResolved()?void 0:b.then(a);d.Util.TypeAssert(b);return b.then(function(b){if(null!==b&&(b=b.value,!b.isResolved()))return b.then(a)})}}function c(b){var c=g.forcePrototype(b);return void 0!==c?c.then(function(){return e(b)}):e(b)}g.forcePartDefinition=c;g.forcePartDefinitions=
function(b){return __awaiter(this,void 0,void 0,function(){var a,e;return __generator(this,function(f){switch(f.label){case 0:return a=[],e={enterProductOccurrence:function(b){b=c(b);void 0!==b&&a.push(b)}},[4,g.WalkerAsync.walk(e,b,g.WalkRestriction.None)];case 1:return f.sent(),[2,d.Util.waitForAll(a)]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(c){c=c.getPrototype();if(null!==c){var b=c.getProductOccurrence();return(b.isResolved()?e(b.getResolved()):b.then(e)).then(function(){console.assert(b.isResolved());b.getResolved().markLoaded()})}}function e(c){return __awaiter(this,void 0,void 0,function(){var b,f;return __generator(this,function(e){switch(e.label){case 0:return b=[],f={enterProductOccurrence:function(c){c=a(c);void 0!==c&&b.push(c)}},[4,g.WalkerAsync.walk(f,c,g.WalkRestriction.None)];
case 1:return e.sent(),[2,d.Util.waitForAll(b)]}})})}g.forcePrototype=a;g.forcePrototypes=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(c,b,a,e,l,n){var f=[];return(c=c.walk({enterAnyBody:function(b){if(!l.has(b)){l.add(b);if(b instanceof g.BodyInstance){if(!h.hasBits(a,1)||b.isOutOfHierarchy()&&!e)return}else if(b instanceof g.PmiBody){if(!h.hasBits(a,2))return}else if(d.Util.TypeAssert(b),!h.hasBits(a,4))return;b=b.getInstanceInc();f.push(b[0],b[1])}}},b,n))?c.then(function(){return f}):f}function e(c,b,d,e,l){return a(g.WalkerSync,c,b,d,e,l)}g.gatherInstanceIncs=function(c,b,d,
e){return a(g.WalkerAsync,c,b,d,e,g.WalkRestriction.None)};g.gatherInstanceIncsSync=e;g.gatherInstanceIncsByNodeIdsSync=function(c,b,a,k){for(var f=null,h=new Set,m=0;m<b.length;m++){var p=b[m],q=c.lookupAnyTreeNode(p);if(null===q)throw new d.InvalidNodeIdError(p);p=g.isOutOfHierarchy(q);p=e(q,a,p,h,k);if(null===f)f=p;else for(q=0;q<p.length;q++)f.push(p[q])}return null!==f?f:[]}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.gatherParentsOfPendingExternalModels=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b;return __generator(this,function(f){switch(f.label){case 0:return e=[],c=function(b){b.hasPendingExternalModels()&&e.push(b)},b={enterProductOccurrence:c},[4,d.WalkerAsync.walk(b,a,d.WalkRestriction.None)];case 1:return f.sent(),[2,e]}})})}})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){g.getBoundingByNodeId=function(a,e,c,b,f,k){return __awaiter(this,void 0,void 0,function(){var l;return __generator(this,function(h){l=g.gatherInstanceIncsByNodeIdsSync(a,c,b,g.WalkRestriction.None);if(0===l.length)throw new d.CommunicatorError("Cannot get the bounding of node without geometry.");return[2,e.getPartsBounding(l,f,k)]})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.getNodeColorMap=function(a,e,c){return __awaiter(this,void 0,void 0,function(){var b,f,g,l,h,m,p,q;return __generator(this,function(k){switch(k.label){case 0:return b=[],f=[],g={enterAnyBody:function(c){c instanceof d.BodyInstance&&!c.isOutOfHierarchy()&&(b.push(c),c=c.getInstanceInc(),f.push(c[0],c[1]))}},[4,d.WalkerAsync.walk(g,a,d.WalkRestriction.None)];case 1:return k.sent(),l=new Map,[4,e.getPartColor(f,c)];case 2:h=k.sent();m=h.length;console.assert(m===
b.length);for(p=0;p<m;++p)q=h[p],null!==q&&l.set(b[p].getRuntimeId(),q);return[2,l]}})})}})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){g.getVisibilityState=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,f;return __generator(this,function(k){switch(k.label){case 0:return e=new Set,c=new Set,b={enterAnyBody:function(b){if(b instanceof g.BodyInstance){var a=b.getRuntimeId();b.isVisible()?e.add(a):c.add(a)}}},[4,g.WalkerAsync.walk(b,a,g.WalkRestriction.None)];case 1:return k.sent(),f=e.size>=c.size,[2,new d.VisibilityState(f,f?c:e)]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(a,c){var b=function(b){c.push(b)};return g.WalkerAsync.walk({enterProductOccurrence:b,enterAnyBody:b,enterCadView:b,enterPmi:b,enterPartDefinition:b,enterRepresentationItem:b},a,g.WalkRestriction.None)}g.markContextsLoaded=function(e){return __awaiter(this,void 0,void 0,function(){var c,b,f,g,l,h,m,p,q;return __generator(this,function(k){switch(k.label){case 0:c=[];b=[];f=0;for(g=e;f<g.length;f++)l=g[f],h=a(l,b),c.push(h);return[4,d.Util.waitForAll(c)];
case 1:k.sent();m=0;for(p=b;m<p.length;m++)q=p[m],q.markLoaded();return[2]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.resetTransforms=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b;return __generator(this,function(f){switch(f.label){case 0:return e=!1,c=function(b){b.hasLocalTransformOverride()&&(b.removeLocalTransformOverride(),e=!0)},b={enterProductOccurrence:c,enterPmi:c,enterCadView:c,enterAnyBody:function(b){b.preventFromResetting()||c(b)}},[4,d.WalkerAsync.walk(b,a,d.WalkRestriction.None)];case 1:return f.sent(),[2,e]}})})}})(d.Tree||(d.Tree={}))})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.setMeshLevels=function(a,e,c){var b=[],f=new Set,g=function(b){if(f.has(b))return!1;f.add(b);return!0};g={followProductOccurrence:g,followPmi:g,followCadView:g,followAnyBody:g,enterAnyBody:function(c){c.isOutOfHierarchy()||(c=c.getInstanceInc(),b.push(c[0],c[1]))}};for(var l=0;l<e.length;l++)d.WalkerSync.walk(g,e[l],d.WalkRestriction.None);a.setMeshLevel(b,c)}})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){g.updateScMatrices=function(a,e,c,b){return __awaiter(this,void 0,void 0,function(){var f,k,l,n,m,p,q,r,u,t,v,w,y=this;return __generator(this,function(x){switch(x.label){case 0:f=[];k=[];l=[];n=new Set;m=function(b){if(n.has(b))return!1;n.add(b);b=b.getLocalTransform();if(null!==b){var c=h.last(f);c=g.Transform.multiply(b,c);f.push(c)}return!0};p=function(b){null!==b.getLocalTransform()&&(console.assert(1<f.length),f.pop())};q={followProductOccurrence:m,leaveProductOccurrence:p,
followPmi:m,leavePmi:p,followCadView:m,leaveCadView:p,followAnyBody:m,enterAnyBody:function(c){if(!c.isOutOfHierarchy()||b)c=c.getInstanceInc(),l.push(c[0],c[1]),c=d.Matrix.createFromArray(h.last(f)),k.push(c)},leaveAnyBody:p};r=new h.PromiseQueue(1,!0);u=function(b){var c=h.Lazy.create(function(){return __awaiter(y,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return console.assert(0===f.length),c=g.getNetMatrix(b.getParent()),f.push(c),[4,g.WalkerAsync.walk(q,
b,g.WalkRestriction.None)];case 1:return a.sent(),console.assert(1===f.length),f.pop(),[2]}})})});r.push(c)};t=0;for(v=c;t<v.length;t++)w=v[t],u(w);return[4,r.waitForIdle()];case 1:return x.sent(),console.assert(2*k.length===l.length),[4,a.setMatrices(l,k)];case 2:return x.sent(),e.trigger("_updateTransform",b),[2]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(b){for(var c=[],a=0;a<b.length;a++){var d=b[a].getInstanceInc();c.push(d[0],d[1])}return c}function e(b){for(var c=[],a=0;a<b.length;a++){var d=b[a].getRuntimeId();c.push(d)}return c}function c(b,c,k,l,n,m,p,q,r,u){return __awaiter(this,void 0,void 0,function(){var f,v,w,y,x,z,B,A,D,C,E,F,H,G,I=this;return __generator(this,function(t){switch(t.label){case 0:if(l instanceof g.AttachContext)switch(console.assert(0===n.size),console.assert(null===k),
console.assert(null===r),console.assert(null!==m),f=function(b){l.getChildren().forEach(function(c){n.set(c,b)})},m){case 0:console.assert(!0===q);f(!1);break;case 1:f(!0);break;case 2:console.assert(p),console.assert(!0===q)}else console.assert(null===m);null!==r&&console.assert(r.isAConfigurationNode());v=0;null===q&&(q=b.getInitiallyHiddenStayHidden());w=[];y=[];x=[];z=function(b){var c=B(b,!1);null!==c&&b.setVisibility(c)};B=function(b,c){var a=n.get(b);void 0!==a?x.push(a):0<x.length&&x.push(h.last(x));
if(g.isOutOfHierarchy(b))return null;if(null!==r&&0===v)return!1;if(void 0!==a)return a;a=b.isVisible();var d=b.isInitiallyShown();if(0<x.length){if(c=h.last(x),c!==a)return c&&!d&&q?b instanceof g.PmiBody&&(b=b.getParent(),!0===n.get(b))?!0:null:c}else if(p&&a!==d&&!c)return d;return null};A=function(b){0<x.length&&x.pop()};D={enterProductOccurrence:function(b){(r===b||0<v)&&++v;z(b)},leaveProductOccurrence:function(b){A(b);0<v&&--v},enterPmi:z,leavePmi:A,enterCadView:z,leaveCadView:A,enterAnyBody:function(b){var c=
b.preventFromResetting();c=B(b,c);null!==c&&(b.setVisibility(c),c?w.push(b):y.push(b))},leaveAnyBody:A};if(u!==d.TreeWalkMode.PerNode)return[3,1];n.forEach(function(b,c){return __awaiter(I,void 0,void 0,function(){return __generator(this,function(b){g.WalkerSync.walk(D,c,g.WalkRestriction.None);return[2]})})});return[3,3];case 1:return[4,g.WalkerAsync.walk(D,l,g.WalkRestriction.None)];case 2:t.sent(),t.label=3;case 3:return console.assert(0===x.length),null===m?(C=a(w),E=a(y),c.pauseRendering(),c.setPartVisibility(C,
!0,!0),c.setPartVisibility(E,!1,!0),c.resumeRendering(),null!==k&&(F=e(w),H=e(y),k.trigger("visibilityChanged",F,H))):(G=l.getAttachScope(),console.assert(0!==G),c.setVisibilityByAttachment(G,m)),[2]}})})}g.updateVisibilitiesByAttachment=function(b,a,e,g){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){return[2,c(b,a,null,e,new Map,g,2===g,1!==g,null,d.TreeWalkMode.Default)]})})};g.updateVisibilities=function(b,a,d,e,g,h,p,q,r){return __awaiter(this,void 0,void 0,
function(){return __generator(this,function(f){return[2,c(b,a,d,e,g,null,h,p,q,r)]})})};g.synchronizePmiVisibilities=function(b,c){return __awaiter(this,void 0,void 0,function(){var d,f,e,h,p;return __generator(this,function(k){switch(k.label){case 0:return d=[],f=[],e={enterAnyBody:function(b){if(b instanceof g.PmiBody||b instanceof g.ViewFrame){var c=b.isVisible();b.setVisibility(c);c?d.push(b):f.push(b)}}},[4,g.WalkerAsync.walk(e,c,g.WalkRestriction.None)];case 1:return k.sent(),h=a(d),p=a(f),
b.pauseRendering(),b.synchronizeVisibilities(h,!0),b.synchronizeVisibilities(p,!1),b.resumeRendering(),[2]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(c,b){this._visitor=new g.TotalVisitor(c,b)}a.walk=function(c,b,f){if(f===g.WalkRestriction.LoadedNodesOnly&&!b.isLoaded())return Promise.resolve();var e=new a(c,f);if(b instanceof g.NodeMixin)return e._walkAnyTreeNode(b);var l=new d.Util.ActionQueue(1,!1);c=function(b){l.push(function(){return e._walkAnyTreeNode(b)})};f=0;for(b=b.getChildren();f<b.length;f++)c(b[f]);return l.waitForIdle()};a.forceLazyPromises=function(c){return this.walk({},
c,g.WalkRestriction.None)};a.prototype._walkAnyTreeNode=function(c){c instanceof g.ProductOccurrence?c=this._walkProductOccurrence(c):c instanceof g.Pmi?c=this._walkPmi(c):c instanceof g.CadView?c=this._walkCadView(c):(d.Util.TypeAssert(c),c=this._walkAnyBody(c));return void 0===c?Promise.resolve():c};a.prototype._walkRepresentationItem=function(c){this._visitor.followRepresentationItem(c)&&(this._visitor.enterRepresentationItem(c),this._visitor.leaveRepresentationItem(c))};a.prototype._walkPartDefinition=
function(c){if(this._visitor.followPartDefinition(c)){this._visitor.enterPartDefinition(c);for(var b=0,a=c.getRepresentationItems();b<a.length;b++)this._walkRepresentationItem(a[b]);this._visitor.leavePartDefinition(c)}};a.prototype._walkAnyBody=function(c){this._visitor.followAnyBody(c)&&(this._visitor.enterAnyBody(c),this._visitor.leaveAnyBody(c))};a.prototype._walkPmi=function(c){if(this._visitor.followPmi(c)){this._visitor.enterPmi(c);for(var b=0,a=c.getPmiBodies();b<a.length;b++)this._walkAnyBody(a[b]);
this._visitor.leavePmi(c)}};a.prototype._walkCadView=function(c){if(this._visitor.followCadView(c)){this._visitor.enterCadView(c);var b=c.getViewFrame();null!==b&&this._walkAnyBody(b);this._visitor.leaveCadView(c)}};a.prototype._walkProductOccurrence=function(c){var b=this,a=new d.Util.ActionQueue(1,!1);if(this._visitor.followProductOccurrence(c)){this._visitor.enterProductOccurrence(c);var e=c.getRawPartDefinition();null!==e&&(e instanceof h.LazyPromise?a.push(function(){if(e.isResolved())return b._walkPartDefinition(e.getResolved())}):
(d.Util.TypeAssert(e),a.push(function(){return e.then(function(c){return null!==c&&(c=c.value,c.isResolved())?b._walkPartDefinition(c.getResolved()):Promise.resolve()})})));var g=c.tryGetChildrenSync();if(null!==g)for(var n=function(c){a.push(function(){return b._walkProductOccurrence(c)})},m=0;m<g.length;m++)n(g[m]);else a.push(function(){return c.getChildren().then(function(c){if(0!==c.length){for(var a=new d.Util.ActionQueue(1,!1),f=function(c){a.push(function(){return b._walkProductOccurrence(c)})},
e=0;e<c.length;e++)f(c[e]);if(!a.isIdle())return a.waitForIdle()}})});g=function(c){a.push(function(){return b._walkAnyBody(c)})};n=0;for(m=c.getBodyInstances();n<m.length;n++)g(m[n]);g=function(c){a.push(function(){return b._walkPmi(c)})};n=0;for(m=c.getPmis();n<m.length;n++)g(m[n]);g=function(c){a.push(function(){return b._walkCadView(c)})};n=0;for(m=c.getCadViews();n<m.length;n++)g(m[n]);a.push(function(){return b._visitor.leaveProductOccurrence(c)})}if(!a.isIdle())return a.waitForIdle()};return a}();
g.WalkerAsync=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(b){return b.isLoaded()}function e(){return!0}var c;(function(b){b[b.None=0]="None";b[b.LoadedNodesOnly=1]="LoadedNodesOnly"})(c=g.WalkRestriction||(g.WalkRestriction={}));var b=function(){return function(b,g){this.followProductOccurrence=e;this.leaveProductOccurrence=this.enterProductOccurrence=h.nop;this.followPartDefinition=e;this.leavePartDefinition=this.enterPartDefinition=h.nop;this.followRepresentationItem=e;this.leaveRepresentationItem=this.enterRepresentationItem=
h.nop;this.followAnyBody=e;this.leaveAnyBody=this.enterAnyBody=h.nop;this.followCadView=e;this.leaveCadView=this.enterCadView=h.nop;this.followPmi=e;this.leavePmi=this.enterPmi=h.nop;g===c.LoadedNodesOnly?(console.assert(void 0===b.followProductOccurrence),console.assert(void 0===b.followAnyBody),console.assert(void 0===b.followCadView),console.assert(void 0===b.followPmi),this.followPmi=this.followCadView=this.followAnyBody=this.followProductOccurrence=a):d.Util.TypeAssert(g);void 0!==b.followProductOccurrence&&
(this.followProductOccurrence=b.followProductOccurrence);void 0!==b.enterProductOccurrence&&(this.enterProductOccurrence=b.enterProductOccurrence);void 0!==b.leaveProductOccurrence&&(this.leaveProductOccurrence=b.leaveProductOccurrence);void 0!==b.followPartDefinition&&(this.followPartDefinition=b.followPartDefinition);void 0!==b.enterPartDefinition&&(this.enterPartDefinition=b.enterPartDefinition);void 0!==b.leavePartDefinition&&(this.leavePartDefinition=b.leavePartDefinition);void 0!==b.followRepresentationItem&&
(this.followRepresentationItem=b.followRepresentationItem);void 0!==b.enterRepresentationItem&&(this.enterRepresentationItem=b.enterRepresentationItem);void 0!==b.leaveRepresentationItem&&(this.leaveRepresentationItem=b.leaveRepresentationItem);void 0!==b.followAnyBody&&(this.followAnyBody=b.followAnyBody);void 0!==b.enterAnyBody&&(this.enterAnyBody=b.enterAnyBody);void 0!==b.leaveAnyBody&&(this.leaveAnyBody=b.leaveAnyBody);void 0!==b.followCadView&&(this.followCadView=b.followCadView);void 0!==b.enterCadView&&
(this.enterCadView=b.enterCadView);void 0!==b.leaveCadView&&(this.leaveCadView=b.leaveCadView);void 0!==b.followPmi&&(this.followPmi=b.followPmi);void 0!==b.enterPmi&&(this.enterPmi=b.enterPmi);void 0!==b.leavePmi&&(this.leavePmi=b.leavePmi)}}();g.TotalVisitor=b})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(c,b){this._visitor=new d.TotalVisitor(c,b)}a.walk=function(c,b,f){if(f!==d.WalkRestriction.LoadedNodesOnly||b.isLoaded())return c=new a(c,f),b instanceof d.ProductOccurrence?c._walkProductOccurrence(b):b instanceof d.Pmi?c._walkPmi(b):b instanceof d.CadView?c._walkCadView(b):c._walkAnyBody(b)};a.prototype._walkRepresentationItem=function(c){console.assert(c.isLoaded());this._visitor.followRepresentationItem(c)&&(this._visitor.enterRepresentationItem(c),
this._visitor.leaveRepresentationItem(c))};a.prototype._walkPartDefinition=function(c){console.assert(c.isLoaded());if(this._visitor.followPartDefinition(c)){this._visitor.enterPartDefinition(c);for(var b=0,a=c.getRepresentationItems();b<a.length;b++)this._walkRepresentationItem(a[b]);this._visitor.leavePartDefinition(c)}};a.prototype._walkAnyBody=function(c){console.assert(c.isLoaded());this._visitor.followAnyBody(c)&&(this._visitor.enterAnyBody(c),this._visitor.leaveAnyBody(c))};a.prototype._walkPmi=
function(c){console.assert(c.isLoaded());if(this._visitor.followPmi(c)){this._visitor.enterPmi(c);for(var b=0,a=c.getPmiBodies();b<a.length;b++)this._walkAnyBody(a[b]);this._visitor.leavePmi(c)}};a.prototype._walkCadView=function(c){console.assert(c.isLoaded());if(this._visitor.followCadView(c)){this._visitor.enterCadView(c);var b=c.getViewFrame();null!==b&&this._walkAnyBody(b);this._visitor.leaveCadView(c)}};a.prototype._walkProductOccurrence=function(c){console.assert(c.isLoaded());if(this._visitor.followProductOccurrence(c)){this._visitor.enterProductOccurrence(c);
var b=c.getPartDefinitionSync();null!==b&&this._walkPartDefinition(b);b=0;for(var a=c.getChildrenSync();b<a.length;b++)this._walkProductOccurrence(a[b]);b=0;for(a=c.getBodyInstances();b<a.length;b++)this._walkAnyBody(a[b]);b=0;for(a=c.getPmis();b<a.length;b++)this._walkPmi(a[b]);b=0;for(a=c.getCadViews();b<a.length;b++)this._walkCadView(a[b]);this._visitor.leaveProductOccurrence(c)}};return a}();d.WalkerSync=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(){this.plane=new d.Plane;this.instanceNodeId=this.meshId=this.referenceGeometry=null;this.color=d.Color.createFromFloat(.65,.65,.65);this.lineColor=d.Color.black();this.opacity=.35;this.matrix=new d.Matrix}a.prototype.toJson=function(){return this._toJson()};a.prototype._toJson=function(){return{plane:{normal:this.plane.normal,d:this.plane.d},referenceGeometry:this.referenceGeometry}};a.prototype.forJson=function(){return this.toJson()};a.prototype.fromJson=
function(a){a=h.deepClone(a);var c=a.plane;this.plane=new d.Plane;var b=c.normal;this.plane.normal=new d.Point3(b.x,b.y,b.z);this.plane.d=c.d;a=a.referenceGeometry;if(Array.isArray(a))for(c=0;c<a.length;++c)a[c]=d.Point3.fromJson(a[c]);this.referenceGeometry=a};a.prototype.getMatrix=function(){return this.matrix.copy()};a.prototype.setMatrix=function(a){this.matrix=a.copy()};a.prototype.setReferenceGeometry=function(a){if(a){this.referenceGeometry=[];for(var c=0;c<a.length;c++)this.referenceGeometry.push(a[c].copy())}else this.referenceGeometry=
null};a.prototype.getReferenceGeometry=function(){if(this.referenceGeometry){for(var a=[],c=0,b=this.referenceGeometry;c<b.length;c++)a.push(b[c].copy());return a}return null};a.prototype.createMeshData=function(){var a=this.referenceGeometry;if(null===a)return null;var c=new d.MeshData,b=[],f=[];b.push(a[0].x,a[0].y,a[0].z);b.push(a[1].x,a[1].y,a[1].z);b.push(a[3].x,a[3].y,a[3].z);b.push(a[1].x,a[1].y,a[1].z);b.push(a[2].x,a[2].y,a[2].z);b.push(a[3].x,a[3].y,a[3].z);for(var g=d.Plane.createFromPoints(a[0],
a[1],a[2]).normal,l=0;6>l;l++)f.push(g.x,g.y,g.z);c.addFaces(b,f);c.addPolyline([a[0].x,a[0].y,a[0].z,a[1].x,a[1].y,a[1].z]);c.addPolyline([a[1].x,a[1].y,a[1].z,a[2].x,a[2].y,a[2].z]);c.addPolyline([a[2].x,a[2].y,a[2].z,a[3].x,a[3].y,a[3].z]);c.addPolyline([a[3].x,a[3].y,a[3].z,a[0].x,a[0].y,a[0].z]);return c};return a}();h.CuttingPlane=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a,d,c,b,f){this._cuttingPlanes=[];this._isActive=!1;this._viewer=a;this._model=d;this._callbackManager=c;this._cuttingManager=b;this._engine=f}g.deprecated=function(a,d,c){var b=c.value;c.value=function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];this._callbackManager.trigger("deprecated","CuttingSection",d);return b.apply(this,c)};return c};g.prototype.addPlane=function(a,e){void 0===e&&(e=null);return __awaiter(this,void 0,void 0,function(){var c,
b;return __generator(this,function(f){switch(f.label){case 0:c=this._engine.getCuttingSectionLimits();if(this._cuttingPlanes.length>=c.maxCuttingPlanesPerSection)return[2,!1];b=new d.Internal.CuttingPlane;b.plane=a.copy();b.setReferenceGeometry(e);this._cuttingPlanes.push(b);return this._isActive?[4,this._resetCuttingPlane(b)]:[2,!0];case 1:return f.sent(),[4,this._engine.updateCuttingSection(this)];case 2:return f.sent(),[2,!0]}})})};g.prototype.setPlane=function(a,d,c){void 0===c&&(c=null);return __awaiter(this,
void 0,void 0,function(){var b;return __generator(this,function(f){switch(f.label){case 0:b=this._cuttingPlanes[a];if(void 0===b)return[3,2];b.plane=d.copy();b.setReferenceGeometry(c);return this._isActive?[4,this._resetCuttingPlane(b)]:[3,2];case 1:return f.sent(),[2,this._engine.updateCuttingSection(this)];case 2:return[2]}})})};g.prototype.updatePlane=function(a,e,c,b,f){void 0===c&&(c=new d.Matrix);void 0===b&&(b=!1);void 0===f&&(f=!1);return __awaiter(this,void 0,void 0,function(){var g,l,h;
return __generator(this,function(k){switch(k.label){case 0:g=this._cuttingPlanes[a];if(void 0===g)return[3,3];g.plane=e.copy();if(!this._isActive)return[3,3];if(null===g.instanceNodeId)return[3,2];this._engine.pauseRendering();l=g.getMatrix();f&&(l=new d.Matrix);h=d.Matrix.multiply(l,c);b&&g.setMatrix(h);return[4,Promise.all([this._model.setNodeMatrix(g.instanceNodeId,h),this._engine.updateCuttingSection(this)])];case 1:return k.sent(),this._engine.resumeRendering(),[3,3];case 2:return[2,this._engine.updateCuttingSection(this)];
case 3:return[2]}})})};g.prototype.removePlane=function(a){var e=[],c=this._cuttingPlanes[a];void 0!==c&&(null!==c.meshId&&null!==c.instanceNodeId&&e.push(this._destroyMeshes([c.meshId],[c.instanceNodeId])),this._cuttingPlanes.splice(a,1));this._isActive&&e.push(this._engine.updateCuttingSection(this));return d.Util.waitForAll(e)};g.prototype.getPlane=function(a){a=this._cuttingPlanes[a];return void 0!==a?a.plane.copy():null};g.prototype.getNodeId=function(a){a=this._cuttingPlanes[a];return void 0!==
a?a.instanceNodeId:null};g.prototype.getReferenceGeometry=function(a){a=this._cuttingPlanes[a];return void 0!==a?a.getReferenceGeometry():null};g.prototype.getPlaneIndexByNodeId=function(a){for(var d=0;d<this._cuttingPlanes.length;d++)if(this._cuttingPlanes[d].instanceNodeId===a)return d;return null};g.prototype.setPlaneOpacity=function(a,d){a=this._cuttingPlanes[a];void 0!==a&&(a.opacity=d,null!==a.instanceNodeId&&this._model.setNodesOpacity([a.instanceNodeId],d))};g.prototype.setPlaneTransparency=
function(a,d){this.setPlaneOpacity(a,d);return Promise.resolve()};g.prototype.setItemTransparency=function(a,d){this.setPlaneOpacity(a,d);return Promise.resolve()};g.prototype.setColor=function(a){for(var d=[],c=0,b=this._cuttingPlanes;c<b.length;c++){var f=b[c];f.color.assign(a);null!==f.instanceNodeId&&d.push(f.instanceNodeId)}this._model.setNodesFaceColor(d,a);return Promise.resolve()};g.prototype.setOpacity=function(a){for(var d=[],c=0,b=this._cuttingPlanes;c<b.length;c++){var f=b[c];f.opacity=
a;null!==f.instanceNodeId&&d.push(f.instanceNodeId)}this._model.setNodesOpacity(d,a)};g.prototype.setTransparency=function(a){this.setOpacity(a);return Promise.resolve()};g.prototype.getCount=function(){return this._cuttingPlanes.length};g.prototype.clear=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this.deactivate()];case 1:return a.sent(),this._cuttingPlanes.length=0,[2]}})})};g.prototype.activate=function(){return __awaiter(this,
void 0,void 0,function(){var a,e,c,b,f;return __generator(this,function(g){switch(g.label){case 0:if(this._isActive)return[2];this._isActive=!0;if(!(0<this._cuttingPlanes.length))return[3,2];this._cuttingManager.hasActiveCuttingSection()||this._engine.setDefaultDepthRange(0,.9999995231628418);a=[];e=[];c=0;for(b=this._cuttingPlanes;c<b.length;c++)f=b[c],a.push(this._createCuttingPlaneGeometry(f).then(function(b){null!==b&&e.push(b)}));return[4,d.Util.waitForAll(a)];case 1:g.sent(),this._initCuttingPlanesByNodeId(e),
g.label=2;case 2:return[2,this._engine.addCuttingSection(this)]}})})};g.prototype.deactivate=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(e){return this._isActive?(this._isActive=!1,a=[],a.push(this._destroyGeometry()),a.push(this._engine.removeCuttingSection(this)),this._cuttingManager.hasActiveCuttingSection()||this._engine.setDefaultDepthRange(0,1),[2,d.Util.waitForAll(a)]):[2]})})};g.prototype.isActive=function(){return this._isActive};g.prototype.toJson=
function(){return this._toJson()};g.prototype._toJson=function(){for(var a=[],d=0;d<this._cuttingPlanes.length;d++)a[d]=this._cuttingPlanes[d].toJson();return{planes:a}};g.prototype.forJson=function(){return this.toJson()};g.prototype.fromJson=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,f,g,l;return __generator(this,function(k){switch(k.label){case 0:return[4,this.clear()];case 1:k.sent();e=d.Internal.deepClone(a);c=e.planes;b=0;for(f=c;b<f.length;b++)g=f[b],l=new d.Internal.CuttingPlane,
l.fromJson(g),this._cuttingPlanes.push(l);return[2,this.activate()]}})})};g.prototype._initCuttingPlanesByNodeId=function(a){this._model.setInstanceModifier(d.InstanceModifier.DoNotCut,a,!0);this._model.setInstanceModifier(d.InstanceModifier.DoNotExplode,a,!0);this._cuttingManager.getStandinGeometryPickable()||this._model.setInstanceModifier(d.InstanceModifier.DoNotSelect,a,!0)};g.prototype._destroyGeometry=function(){for(var a=[],d=[],c=0,b=this._cuttingPlanes;c<b.length;c++){var f=b[c];null!==f.meshId&&
a.push(f.meshId);null!==f.instanceNodeId&&d.push(f.instanceNodeId);f.meshId=null;f.instanceNodeId=null}return this._destroyMeshes(a,d)};g.prototype._getInstanceNodeIds=function(){for(var a=[],d=0,c=this._cuttingPlanes;d<c.length;d++){var b=c[d].instanceNodeId;null!==b&&a.push(b)}return a};g.prototype._resetCuttingPlane=function(a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:if(null===a.meshId||null===a.instanceNodeId)return[3,2];
d=this._destroyMeshes([a.meshId],[a.instanceNodeId]);a.meshId=null;a.instanceNodeId=null;return[4,d];case 1:return c.sent(),[2,this._createInstanceGeometry(a)];case 2:if(null!==a.referenceGeometry)return[2,this._createInstanceGeometry(a)];c.label=3;case 3:return[2]}})})};g.prototype._createInstanceGeometry=function(a){return __awaiter(this,void 0,void 0,function(){var d,c;return __generator(this,function(b){switch(b.label){case 0:return d=[],[4,this._createCuttingPlaneGeometry(a)];case 1:return c=
b.sent(),null!==c&&d.push(c),this._initCuttingPlanesByNodeId(d),[2]}})})};g.prototype._destroyMeshes=function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b,f,g;return __generator(this,function(k){switch(k.label){case 0:return c=[],c.push(this._model.deleteMeshInstances(e)),c.push(this._model.deleteMeshes(a)),[4,d.Util.waitForAll(c)];case 1:k.sent();b=0;for(f=e;b<f.length;b++)g=f[b],this._viewer.selectionManager._incrementalBlacklistedInstanceNodes.delete(g);return[2]}})})};g.prototype._createCuttingPlaneGeometry=
function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,f,g,l,h,m;return __generator(this,function(k){switch(k.label){case 0:e=a.createMeshData();if(null===e)return[2,null];e.setBackfacesEnabled(!0);return[4,this._model.createMesh(e)];case 1:return c=k.sent(),a.meshId=c,b=d.MeshInstanceCreationFlags.OverrideSceneVisibility|d.MeshInstanceCreationFlags.ExcludeBounding|d.MeshInstanceCreationFlags.DoNotXRay,f=a.plane.copy(),g=f.normal.copy().scale(-f.d),l=(new d.Matrix).setTranslationComponent(g.x,
g.y,g.z),a.setMatrix(l.copy()),h=new d.MeshInstanceData(c,l,null,a.color,null,null,b),h.setLineColor(a.lineColor),this._engine.pauseRendering(),[4,this._model.createMeshInstance(h,void 0,!0,!0)];case 2:return m=k.sent(),a.instanceNodeId=m,this._viewer.selectionManager._incrementalBlacklistedInstanceNodes.add(m),this._model.setDepthRange([m],4.76837158203125E-7,1),this._model.setNodesOpacity([m],a.opacity),this._engine.resumeRendering(),[2,m]}})})};__decorate([g.deprecated],g.prototype,"setPlaneTransparency",
null);__decorate([g.deprecated],g.prototype,"setItemTransparency",null);__decorate([g.deprecated],g.prototype,"setTransparency",null);__decorate([g.deprecated],g.prototype,"forJson",null);return g}();d.CuttingSection=h})(Communicator||(Communicator={}));
(function(d){(function(d){function g(a,d){for(var c=0;c<d.length;c++)a.push(d[c])}d.emptyBytes=new Uint8Array(0);d.copyArray=function(a){return a.slice()};d.append=function(a,d){for(var c=0;c<d.length;c++)a.push(d[c])};d.last=function(a){console.assert(0<a.length);return a[a.length-1]};d.all=function(a){for(var d=0;d<a.length;d++)if(!a[d])return!1;return!0};d.chunkify=function(a,d){for(var c=[],b=0;b<a.length;b+=d)c.push(a.slice(b,b+d));return c};d.mapInPlace=function(a,d){for(var c=0;c<a.length;++c)a[c]=
d(a[c]);return a};d.concatInPlace=g;d.concatAll=function(a){for(var d=[],c=0;c<a.length;c++)g(d,a[c]);return d}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){d.filterInPlace=function(d,a){for(var e=0,c=0;c<d.length;++c){var b=d[c];a(b)&&(d[e++]=b)}d.length=e}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(){this._leftToRight=new Map;this._rightToLeft=new Map}a.prototype.set=function(a,c){this._leftToRight.set(a,c);this._rightToLeft.set(c,a)};a.prototype.getLeft=function(a){return this._rightToLeft.get(a)};a.prototype.getRight=function(a){return this._leftToRight.get(a)};return a}();d.Bimap=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(a){this.value=a}a.create=function(d){return new a(d)};return a}();d.Boxed=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(){this._stopTime=this._currentTime=0}a.prototype.stop=function(){this._stopTime=this._currentTime};a.prototype.isTicking=function(){this._refreshCurrentTime();return 0<this._remainingDuration()};a.prototype.tickFor=function(a){this._refreshCurrentTime();this._remainingDuration()>=a||(this._stopTime=this._currentTime+a)};a.prototype._remainingDuration=function(){return this._stopTime-this._currentTime};a.prototype._refreshCurrentTime=function(){this._currentTime=
Date.now()};return a}();d.Clock=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(a){this._planes=[];this._absPlanes=[];this._signs=[];this._distanceScale=[];for(var c=a.length,b=0;b<a.length;b++)this._planes.push(a[b].slice());for(a=0;a<c;++a)for(this._planes[a][3]=-this._planes[a][3],this._absPlanes[a]=d.cwiseAbs3(this._planes[a]),this._signs[a]=[0,0,0],b=0;3>b;++b)this._signs[a][b]=0<=this._planes[a][b]?1:-1;for(a=0;a<c;++a)b=d.squaredNorm3(this._planes[a]),this._distanceScale[a]=0===b?0:1/b}a.fromPlaneCoefficients=function(d){for(var c=
[],b=0;b<d.length;b++){var f=d[b];c.push([f.x,f.y,f.z,f.w])}return new a(c)};a.createFrustumFromMatrix=function(e){for(var c=[],b=0;3>b;++b)c[b]=d.sub4(d.col4(e,3),d.col4(e,b));for(b=0;3>b;++b)c[b+3]=d.add4(d.col4(e,3),d.col4(e,b));return new a(c)};a.prototype.testAxisAlignedBox=function(a,c){for(var b=this._planes.length,f=2,e=0;e<b;++e){var g=d.dot3(this._planes[e],a),h=d.dot3(this._absPlanes[e],c);if(g+h<=this._planes[e][3])return 0;g-h<this._planes[e][3]&&(f=1)}return f};a.prototype.axisAlignedBoxNotOutside=
function(a,c){for(var b=this._planes.length,f=0;f<b;++f)if(d.dot3(this._planes[f],d.add3(a,d.cwiseProduct3(c,this._signs[f])))<=this._planes[f][3])return!1;return!0};a.prototype.sphereNotOutside=function(a,c){for(var b=this._planes.length,f=0;f<b;++f){var e=d.dot3(this._planes[f],a)-this._planes[f][3];if(0>e&&e*e*this._distanceScale[f]>=c)return!1}return!0};a.prototype.sphereFullyInside=function(a,c){for(var b=this._planes.length,f=0;f<b;++f){var e=d.dot3(this._planes[f],a)-this._planes[f][3];if(0>
e||e*e*this._distanceScale[f]<c)return!1}return!0};a.prototype.pointInside=function(a){for(var c=this._planes.length,b=0;b<c;++b)if(0>d.dot3(this._planes[b],a)-this._planes[b][3])return!1;return!0};return a}();d.ConvexVolume=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(){}a.isSupported=function(){return a._enabled&&"function"===typeof fetch&&"function"===typeof ReadableStream};a.request=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return[4,fetch(a)];case 1:c=b.sent();if(200===c.status)return[2,c];throw new d.LoadError('Failed to fetch "'+a+'" with status '+c.status+".");}})})};a._enabled=!0;return a}();h.FetchApi=g})(d.Internal||(d.Internal=
{}))})(Communicator||(Communicator={}));(function(d){(function(d){d.nop=function(){};d.identity=function(d){return d}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function g(a,e){return new Promise(function(c,b){var f=new XMLHttpRequest;f.open("GET",a,!0);e&&(f.responseType=e);f.onload=function(e){4===f.readyState&&(200===f.status?c(f):(e=new d.LoadError('XMLHttpRequest failed to GET "'+a+'" with status '+f.status+"."),b(e)))};f.onerror=function(c){b(c)};f.send()})}h.httpRequest=g;h.httpRequestBuffer=function(a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:return[4,
g(a,"arraybuffer")];case 1:return d=c.sent(),[2,new Uint8Array(d.response)]}})})}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){d.copyMap=function(d){var a=new Map;d.forEach(function(d,c){a.set(c,d)});return a};d.copySet=function(d){var a=new Set;d.forEach(function(d){a.add(d)});return a};d.toSet=function(d){for(var a=new Set,e=0;e<d.length;e++)a.add(d[e]);return a}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(a){this._deferredValue=a}a.create=function(d){return new a(d)};a.prototype.get=function(){null!==this._deferredValue&&(this._resolvedValue=this._deferredValue(),this._deferredValue=null);return this._resolvedValue};return a}();d.Lazy=g})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(h){h.Lazy=d.Util.Lazy;var g=function(){function a(c){this._value=c}a.create=function(c){return new a(c)};a.prototype.get=function(){"function"===typeof this._value&&(this._value=this._value());return this._value};return a}();h.LazyObject=g;var a=function(){function a(c){"function"===typeof c&&(c=g.create(c));c instanceof Promise&&(c=this._rectifyResult(c));this._value=c}a.create=function(c){return new a(c)};a.prototype.isUnforced=function(){return this._value instanceof g};
a.prototype.isResolved=function(){return!(this._value instanceof g)&&!(this._value instanceof Promise)};a.prototype.getResolved=function(){console.assert(this.isResolved());return this._value};a.prototype.then=function(c,b){this._value instanceof g&&(this._value=this._rectifyResult(this._value.get()));if(this._value instanceof Promise)return this._value.then(c,b);d.Util.TypeAssert(this._value);return Promise.resolve(this._value).then(c,b)};a.prototype._rectifyResult=function(c){var b=this;return c instanceof
Promise?c.then(function(c){return b._value=c}):c};return a}();h.LazyPromise=a})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){d.fromIntegerMap=function(d){if(d instanceof Map)return d;for(var a=new Map,e=0,c=Object.keys(d);e<c.length;e++){var b=c[e],f=d[b];a.set(parseInt(b,10),f)}return a};d.toIntegerMap=function(d){if(!(d instanceof Map))return d;var a={};d.forEach(function(d,c){a[c]=d});return a};d.fromRealNumberMap=function(d){if(d instanceof Map)return d;for(var a=new Map,e=0,c=Object.keys(d);e<c.length;e++){var b=c[e];a.set(Number(b),d[b])}return a};d.fromStringMap=function(d){if(d instanceof
Map)return d;for(var a=new Map,e=0,c=Object.keys(d);e<c.length;e++){var b=c[e];a.set(b,d[b])}return a}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(h){h.Todo=function(){for(var g=0;g<arguments.length;g++);throw new d.InternalLogicError;}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){h.TypeAssert=function(d){};h.TypeAssertNever=function(g){throw new d.InternalLogicError;}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));(function(d){d=d.Internal||(d.Internal={});d=d.CompileTime||(d.CompileTime={});d.enable=!0;d.disable=!1})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(a){this._heap=[];this._comparator=a}a.prototype.clear=function(){this._heap.length=0};Object.defineProperty(a.prototype,"length",{get:function(){return this._heap.length},enumerable:!0,configurable:!0});a.prototype.peek=function(){return this._heap[0]};a.prototype.push=function(a){this._heap.push(a);this._siftUp()};a.prototype.pop=function(){var a=this.peek(),c=this.length-1;0<c&&this._swap(0,c);this._heap.pop();this._siftDown();return a};a.prototype.replace=
function(a){var c=this.peek();this._heap[0]=a;this._siftDown();return c};a.prototype._greater=function(a,c){return this._comparator(this._heap[a],this._heap[c])};a.prototype._swap=function(a,c){var b=[this._heap[c],this._heap[a]];this._heap[a]=b[0];this._heap[c]=b[1]};a.prototype._siftUp=function(){for(var a=this.length-1;0<a&&this._greater(a,(a+1>>>1)-1);)this._swap(a,(a+1>>>1)-1),a=(a+1>>>1)-1};a.prototype._siftDown=function(){for(var a=0;(a<<1)+1<this.length&&this._greater((a<<1)+1,a)||a+1<<1<
this.length&&this._greater(a+1<<1,a);){var c=a+1<<1<this.length&&this._greater(a+1<<1,(a<<1)+1)?a+1<<1:(a<<1)+1;this._swap(a,c);a=c}};return a}();d.PriorityQueue=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){d.waitForAll=function(d){return Promise.all(d)}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){return function(){this.items=[];this.next=null}}(),a=function(){function a(){this.clear()}a.prototype.clear=function(){this._tail=this._head=new g;this._size=0};Object.defineProperty(a.prototype,"length",{get:function(){return this._size},enumerable:!0,configurable:!0});a.prototype.push=function(c){++this._size;if(1024===this._tail.items.length){var b=new g;this._tail=this._tail.next=b}this._tail.items.push(c)};a.prototype.pop=function(){console.assert(0<
this._size);console.assert(0<this._head.items.length);--this._size;var c=this._head.items.shift();if(0===this._head.items.length){var b=this._head.next;null===b?console.assert(this._head===this._tail):this._head=b}return c};return a}();d.Queue=a})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){var g=function(){return function(a,d){this.value=a;this.kids=d.slice()}}();d.RoseTree=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){function g(a){var d=[];a.forEach(function(c){d.push(c)});return d}d.setToArray=g;d.setSubtraction=function(a,e){a=g(a).filter(function(c){return!e.has(c)});return d.toSet(a)}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){d.utf8ArrayToStr=function(c){if("undefined"!==typeof window&&8192>c.length&&"escape"in window){var b=void 0;try{var a=String.fromCharCode.apply(null,c),d=window.escape(a);b=decodeURIComponent(d)}catch(p){b=""}return b}b="";d=c.length;for(a=0;a<d;){var e=c[a++];switch(e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=String.fromCharCode(e);break;case 12:case 13:var g=c[a++];b+=String.fromCharCode((e&31)<<6|g&63);break;case 14:g=c[a++];var h=c[a++];b+=String.fromCharCode((e&
15)<<12|(g&63)<<6|(h&63)<<0)}}return b};var g=/^\d+$/;d.isBase10Number=function(c){return g.test(c)};var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz`~!@#$%^&*()_+-=[]{};:'\",.<>\\|/?".split("");d.compressUint=function(c){console.assert(0<=c);if(0===c)return a[0];for(var b=[];0!==c;){var d=Math.floor(c/a.length);b.push(a[c%a.length]);c=d}return b.join("")};var e="0000000 000000 00000 0000 000 00 0 ".split(" ");d.zeroPadHex32=function(c){c=c.toString(16);return e[c.length-1]+c}})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){(function(d){d.isEmpty=function(a){return null===a||void 0===a};d.toArray=function(a){return Array.isArray(a)?a.slice():null===a||void 0===a?[]:[a]};d.fromArray=function(a){return 0===a.length?null:1===a.length?a[0]:a};d.push=function(a,d){return a?Array.isArray(a)?(a.push(d),a):[a,d]:d}})(d.TerseArray||(d.TerseArray={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(){this._afterActionIdlePromise=this._beforeActionIdlePromise=this._action=this._timerId=null}a.prototype.isIdle=function(a){if(0===a)return null===this._timerId;h.TypeAssert(a);return null===this._action};a.prototype.waitForIdle=function(a){if(0===a){if(null===this._timerId)return Promise.resolve();null===this._beforeActionIdlePromise&&(this._beforeActionIdlePromise=d.Internal.OpenPromise.create());return this._beforeActionIdlePromise}h.TypeAssert(a);
if(null===this._action)return Promise.resolve();null===this._afterActionIdlePromise&&(this._afterActionIdlePromise=d.Internal.OpenPromise.create());return this._afterActionIdlePromise};a.prototype._triggerIdlePromise=function(a){0===a?null!==this._beforeActionIdlePromise&&(this._beforeActionIdlePromise.resolve(),this._beforeActionIdlePromise=null):(h.TypeAssert(a),null!==this._afterActionIdlePromise&&(this._afterActionIdlePromise.resolve(),this._afterActionIdlePromise=null))};a.prototype._clearTimeout=
function(){null!==this._timerId&&(clearTimeout(this._timerId),this._timerId=null)};a.prototype.clear=function(){this._clearTimeout();this._triggerIdlePromise(0);this._action=null;this._triggerIdlePromise(1)};a.prototype.set=function(a,c){var b=this;this._clearTimeout();this._action=c;this._timerId=setTimeout(function(){b._timerId=null;b._triggerIdlePromise(0);var c=b._afterActionIdlePromise;b._afterActionIdlePromise=null;b._action();null===b._timerId&&(b._action=null);null!==c&&c.resolve()},a)};return a}();
h.Timer=g})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));(function(d){d=d.Internal||(d.Internal={});d=d.Unicode||(d.Unicode={});d.Subscript2="\u00b2";d.Subscript3="\u00b3"})(Communicator||(Communicator={}));
(function(d){(function(d){function g(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]}function a(a){var c=a[0],b=a[1];a=a[2];return c*c+b*b+a*a}d.toVec3=function(a){return[a.x,a.y,a.z]};d.cwiseAbs3=function(a){return[Math.abs(a[0]),Math.abs(a[1]),Math.abs(a[2])]};d.cwiseProduct3=function(a,c){return[a[0]*c[0],a[1]*c[1],a[2]*c[2]]};d.add3=function(a,c){return[a[0]+c[0],a[1]+c[1],a[2]+c[2]]};d.sub3=function(a,c){return[a[0]-c[0],a[1]-c[1],a[2]-c[2]]};d.add4=function(a,c){return[a[0]+c[0],a[1]+c[1],a[2]+c[2],
a[3]+c[3]]};d.sub4=function(a,c){return[a[0]-c[0],a[1]-c[1],a[2]-c[2],a[3]-c[3]]};d.dot3=g;d.squaredNorm3=a;d.norm3=function(d){return Math.sqrt(a(d))};d.scale3=function(a,c){return[a*c[0],a*c[1],a*c[2]]};d.toVec4=function(a){return[a.x,a.y,a.z,a.w]};d.row4=function(a,c){a=a.m;c*=4;return[a[c],a[c+1],a[c+2],a[c+3]]};d.col4=function(a,c){a=a.m;return[a[c],a[c+4],a[c+8],a[c+12]]};d.squaredNorm4=function(a){var c=a[0],b=a[1],d=a[2];a=a[3];return c*c+b*b+d*d+a*a};d.scale4=function(a,c){return[a*c[0],
a*c[1],a*c[2],a*c[3]]};d.projectSquaredSize=function(a,c,b){a=g(a,b)+b[3];a*=a;1E-5>a&&(a=1E-5);return c/a}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(a,c){this._failed=!1;this._failureError=null;this._activePromiseCount=0;this._idlePromise=null;console.assert(0<a,"Don't create a non-progressible queue.");this._maxActivePromises=a;this._suppressFailures=c;this._deferredActions=new d.Internal.Queue}a.prototype.isIdle=function(){return 0===this._activePromiseCount};a.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){if(this.isIdle()){if(this._failed)throw this._failureError;
return[2]}null===this._idlePromise&&(this._idlePromise=h.OpenPromise.create());return[2,this._idlePromise]})})};a.prototype.push=function(a){"function"===typeof a&&(a=h.Lazy.create(a));this._activePromiseCount<this._maxActivePromises?(console.assert(0===this._deferredActions.length),this._immediateAction(a)):this._deferredActions.push(a)};a.prototype._immediateAction=function(a){var c=this;if(this._failed)return console.assert(0===this._deferredActions.length),!0;try{var b=a.get()}catch(f){this._suppressFailures||
(this._failed=!0,this._failureError=f,this._deferredActions.clear())}if(void 0===b)return!0;++this._activePromiseCount;b.then(function(b){c._finalizePromise();return b}).catch(function(b){c._finalizePromise();throw b;});return!1};a.prototype._finalizePromise=function(){--this._activePromiseCount;this._failed&&console.assert(0===this._deferredActions.length);if(0<this._deferredActions.length){do{var a=this._deferredActions.pop();if(!this._immediateAction(a))break}while(0<this._deferredActions.length)
}this._tryActivateIdlePromise()};a.prototype._tryActivateIdlePromise=function(){0===this._activePromiseCount&&(console.assert(0===this._deferredActions.length),null!==this._idlePromise&&(this._failed?this._idlePromise.reject(this._failureError):this._idlePromise.resolve(),this._idlePromise=null))};return a}();h.ActionQueue=g})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(a){this._idlePromise=this._pending=this._active=null;this._suppressFailures=a}a.prototype.isIdle=function(){return null===this._active};a.prototype.waitForIdle=function(){if(this.isIdle())return Promise.resolve();null===this._idlePromise&&(this._idlePromise=d.OpenPromise.create());return this._idlePromise};a.prototype.set=function(a){var c=this;"function"===typeof a&&(a=d.Lazy.create(a));if(null===this._active){var b=void 0;try{b=a.get()}catch(f){return this._advance(!this._suppressFailures,
f)}if(void 0===b)return this._advance(!1,null);this._active=b.then(function(){c._advance(!1,null)}).catch(function(b){c._advance(!c._suppressFailures,b)})}else this._pending=a};a.prototype._advance=function(a,c){this._active=null;a&&(this._pending=null);null===this._pending?null!==this._idlePromise&&(a?this._idlePromise.reject(c):this._idlePromise.resolve(),this._idlePromise=null):(a=this._pending,this._pending=null,this.set(a))};a.prototype.clear=function(){this._pending=null};return a}();d.CurrentAction=
g})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(){this._action=new d.CurrentAction(!0);this._latestPromise=null;this._timestamp=0}a.prototype.isIdle=function(){return null===this._latestPromise&&this._action.isIdle()};a.prototype.set=function(a){var c=this,b=++this._timestamp;null!==this._latestPromise&&this._latestPromise.reject(void 0);var f=d.OpenPromise.create();this._latestPromise=f;this._action.clear();this._action.waitForIdle().then(function(){b===c._timestamp&&c._action.set(function(){if(b===
c._timestamp){f===c._latestPromise&&(c._latestPromise=null);"function"===typeof a&&(a=d.Lazy.create(a));try{var e=a.get()}catch(l){return c._advance(f,!0,l)}return void 0===e?c._advance(f,!1,null):e.then(function(){return c._advance(f,!1,null)},function(b){return c._advance(f,!0,b)})}})});return f};a.prototype._advance=function(a,c,b){a===this._latestPromise&&(this._latestPromise=null);c?a.reject(b):a.resolve()};return a}();d.CurrentActionSync=g})(d.Util||(d.Util={}))})(Communicator||(Communicator=
{}));(function(d){(function(d){(function(d){d.create=function(){var a,d,c=new Promise(function(b,c){a=b;d=c});c.resolve=a;c.reject=d;return c}})(d.OpenPromise||(d.OpenPromise={}))})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));(function(d){(d.Internal||(d.Internal={})).OpenPromise=d.Util.OpenPromise})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(){this._cache=new Map}a.prototype.clear=function(){this._cache.clear()};a.prototype.load=function(a,c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(d){b=this._cache.get(a);if(void 0!==b)return[2,b];this._cache.set(a,c);return[2,c]})})};return a}();d.PromiseCache=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function c(b,c,a){this._lazyPromise=b;this._wrapperPromise=c;null!==a&&(this.compareValue=a)}c.prototype.kill=function(){this._lazyPromise=null};c.prototype.cancel=function(b){this._lazyPromise=null;this._wrapperPromise.resolve(b)};c.prototype.fetch=function(b,c){var a=this;null===this._lazyPromise?(this._wrapperPromise.reject(null),setTimeout(c,0)):b(this._lazyPromise).then(function(b){a._wrapperPromise.resolve(b)}).catch(function(b){a._wrapperPromise.reject(b)})};
return c}();d._DeferredPromise=g;var a=function(){function c(b,c,a){this._failed=!1;this._failureError=null;this._activePromiseCount=0;this._idlePromise=null;this._latestPromise=Promise.resolve();this._needsResorting=!1;console.assert(0<b,"Don't create a non-progressible queue.");this._maxActivePromises=b;this._deferredPromises=c;this._failureFailsAll=a}c.prototype.maxActivePromises=function(){return this._maxActivePromises};c.prototype.activePromiseCount=function(){return this._activePromiseCount};
c.prototype.isIdle=function(){return 0===this._activePromiseCount};c.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){if(this.isIdle()){if(this._failureFailsAll&&this._failed)throw this._failureError;return[2]}null===this._idlePromise&&(this._idlePromise=d.OpenPromise.create());return[2,this._idlePromise]})})};c.prototype.killDeferred=function(){for(var b=[];0<this._deferredPromises.length;){var c=this._dequeue();c.kill();b.push(c)}for(var a=
0;a<b.length;a++)c=b[a],this._queue(c)};c.prototype._push=function(b,c){"function"===typeof b&&(b=d.Lazy.create(b));return this._latestPromise=b=this._activePromiseCount<this._maxActivePromises?this._immediatePromise(b):this._deferPromise(b,c)};c.prototype._resort=function(){console.assert(this._needsResorting);this._needsResorting=!1;for(var b=0,c=this._drainQueue();b<c.length;b++)this._queue(c[b])};c.prototype._drainQueue=function(){for(var b=[];0<this._deferredPromises.length;){var c=this._dequeue();
b.push(c)}return b};c.prototype._deferPromise=function(b,c){var a=d.OpenPromise.create();b=new g(b,a,c);this._queue(b);return a};c.prototype._immediatePromise=function(b){return __awaiter(this,void 0,void 0,function(){var c,a;return __generator(this,function(d){switch(d.label){case 0:if(this._failureFailsAll&&this._failed)throw this._failureError;++this._activePromiseCount;d.label=1;case 1:return d.trys.push([1,3,,4]),[4,b.get()];case 2:return c=d.sent(),this._finalizePromise(),[2,c];case 3:throw a=
d.sent(),this._failureFailsAll&&!this._failed&&(this._failed=!0,this._failureError=a,null!==this._idlePromise&&this._idlePromise.reject(a)),this._finalizePromise(),a;case 4:return[2]}})})};c.prototype._fetchNext=function(){var b=this;this._dequeue().fetch(function(c){return b._immediatePromise(c)},function(){b._finalizePromise()})};c.prototype._finalizePromise=function(){--this._activePromiseCount;0<this._deferredPromises.length?(this._needsResorting&&this._resort(),this._fetchNext()):0===this._activePromiseCount&&
(null!==this._idlePromise&&(this._failureFailsAll&&this._failed?this._idlePromise.reject(this._failureError):this._idlePromise.resolve(),this._idlePromise=null),this._latestPromise=Promise.resolve())};return c}();d.PromiseQueueImpl=a;var e=function(c){function b(b,a){return c.call(this,b,new d.Queue,a)||this}__extends(b,c);b.prototype._queue=function(b){this._deferredPromises.push(b)};b.prototype._dequeue=function(){return this._deferredPromises.pop()};b.prototype.push=function(b){return this._push(b,
null)};b.prototype.waitOnLatest=function(){return this._latestPromise.then(d.nop,d.nop)};return b}(a);d.PromiseQueue=e;a=function(c){function b(b,a,e){var f=this;f=new d.PriorityQueue(function(b,c){return a(b.compareValue,c.compareValue)});return f=c.call(this,b,f,e)||this}__extends(b,c);b.prototype._queue=function(b){this._deferredPromises.push(b)};b.prototype._dequeue=function(){return this._deferredPromises.pop()};b.prototype.push=function(b,c){return this._push(b,c)};b.prototype.markDirty=function(){this._needsResorting=
!0};return b}(a);d.PriorityPromiseQueue=a;e=function(c){function b(b){return c.call(this,1,b)||this}__extends(b,c);b.prototype._queue=function(b){this._deferredPromises.clear();this._deferredPromises.push(b)};return b}(e);d.SingleMostRecentPromiseQueue=e;e=function(c){function b(b,a,d,e,g){d=c.call(this,d,e,g)||this;d._cutoffAttachments=[];d._attachPriorityManager=a;d._cutoffScale=b;return d}__extends(b,c);b.prototype.setCutoffScale=function(b){this._cutoffScale=Math.max(Math.min(b,2),0)};b.prototype.cutoffEnabled=
function(){return 0!==this._cutoffScale};b.prototype.isEmpty=function(){return 0===this._cutoffAttachments.length&&0===this._deferredPromises.length};b.prototype.killDeferred=function(){var b=this._drainQueue(),c=this._cutoffAttachments;this._cutoffAttachments=[];for(var a=0;a<b.length;a++)b[a].cancel(null);for(b=0;b<c.length;b++)c[b].cancel(null)};b.prototype._getCutoffValue=function(){return this._cutoffScale*-this._attachPriorityManager.getCalculatedCutoff()-1};b.prototype.push=function(b,c){if(!this.cutoffEnabled())return this._push(b,
c);var a=this._attachPriorityManager.getPriorityCompareValue(c),f=this._getCutoffValue();return a>f?("function"===typeof b&&(b=d.Lazy.create(b)),a=d.OpenPromise.create(),b=new g(b,a,c),this._cutoffAttachments.push(b),a):this._push(b,c)};b.prototype._resort=function(){if(this.cutoffEnabled()){this._needsResorting=!1;var b=this._drainQueue(),a=this._cutoffAttachments;this._cutoffAttachments=[];this._updateDeferredPromiseArray(b);this._updateDeferredPromiseArray(a)}else c.prototype._resort.call(this)};
b.prototype.update=function(){this.cutoffEnabled()?0<this._cutoffAttachments.length&&(this._resort(),this._refillQueue()):this.markDirty()};b.prototype._refillQueue=function(){for(var b=Math.min(this.maxActivePromises()-this.activePromiseCount(),this._deferredPromises.length),c=0;c<b;c++)this._fetchNext()};b.prototype._updateDeferredPromiseArray=function(b){for(var c=0;c<b.length;c++){var a=b[c],d=this._attachPriorityManager.getPriorityCompareValue(a.compareValue),f=this._getCutoffValue();d>f?this._cutoffAttachments.push(a):
this._queue(a)}};return b}(a);d.StreamCutoffAttachQueue=e})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){(function(d){d.create=function(){var a,d,c=new Promise(function(b,f){a=function(a){c.state=1;b(a)};d=function(b){c.state=2;f(b)}});c.state=0;c.resolve=a;c.reject=d;return c}})(d.TrackedOpenPromise||(d.TrackedOpenPromise={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.create=function(a,d){var c=new Promise(function(b,f){d.then(function(){c.isReady=!0;b(a)},f)});c.unsafeValue=a;c.readyPromise=d;c.isReady=!1;return c}})(d.UnsafePromise||(d.UnsafePromise={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function c(b,c,e,g){var f=a.call(this)||this;f._position=new d.Point2(b,c);f._modifiers=e;f._inputType=g;return f}__extends(c,a);c.prototype.getPosition=function(){return this._position.copy()};c.prototype.shiftDown=function(){return(this._modifiers&d.KeyModifiers.Shift)===d.KeyModifiers.Shift};c.prototype.altDown=function(){return(this._modifiers&d.KeyModifiers.Alt)===d.KeyModifiers.Alt};c.prototype.controlDown=function(){return(this._modifiers&d.KeyModifiers.Control)===
d.KeyModifiers.Control};c.prototype.commandDown=function(){return(this._modifiers&d.KeyModifiers.Command)===d.KeyModifiers.Command};c.prototype.getEventType=function(){return this._inputType};c.prototype.getModifiers=function(){return this._modifiers};return c}(h.InputEvent);h.MouseInputEventBase=g;var a=function(a){function c(b,c,d,e,g,h){b=a.call(this,b,c,g,h)||this;b._button=d;b._buttons=e;return b}__extends(c,a);c.prototype.getButton=function(){return this._button};c.prototype.getButtons=function(){return this._buttons};
return c}(g);h.MouseInputEvent=a;g=function(a){function c(b,c,d,e,g,h){b=a.call(this,b,c,g,h)||this;b._wheelDelta=d;b._buttons=e;return b}__extends(c,a);c.prototype.getWheelDelta=function(){return this._wheelDelta};c.prototype.getButtons=function(){return this._buttons};return c}(g);h.MouseWheelInputEvent=g})(d.Event||(d.Event={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(a){this._selection=a}a.prototype.getType=function(){return this._selection?this._selection.getSelectionType():d.SelectionType.None};a.prototype.getSelection=function(){return this._selection};a._createNull=function(){return new a(d.Selection.SelectionItem.create())};return a}();h.NodeSelectionEvent=g})(d.Event||(d.Event={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c,b,f,e,g){var k=a.call(this)||this;k._id=c;k._position=new d.Point2(b,f);k._buttons=e;k._inputType=g;return k}__extends(e,a);e.prototype.getId=function(){return this._id};e.prototype.getPosition=function(){return this._position};e.prototype.getEventType=function(){return this._inputType};e.prototype.getButtons=function(){return this._buttons};return e}(h.InputEvent);h.TouchInputEvent=g})(d.Event||(d.Event={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function a(){}a.calculate=function(a,c,b,d){var f=2/(c+2*b+d);a=a<=c?this._PA(a,f,c):a>=c&&a<=c+b?this._PA(a,f,c):this._PC(a,f,c,b,d);return a=Math.min(a,1)};a._PA=function(a,c,b){return a*a*.5*c/b};a._PB=function(a,c,b){return this._PA(b,c,b)+(a-b)*c};a._PC=function(a,c,b,d,g){return this._PB(b+d,c,b)+(a-(b+d))*c*(1-.5*(a-(b+d))/g)};return a}();d.EaseInEaseOut=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(a,c,b,f,g){this._startTime=this._completeCallback=null;this._progress=0;this._targetMoveDelta=this._positionMoveDelta=null;this._interpolationUsesRotation=!1;this._endQuaternion=this._beginQuaternion=null;this._fieldHeightDelta=this._fieldWidthDelta=this._viewVectorLengthDelta=this._viewVectorLength=0;this._beginCam=a.copy();this._endCam=c.copy();a=d.Point3.subtract(this._endCam.getTarget(),this._endCam.getPosition()).normalize();c=this._endCam.getUp().normalize();
c=d.Point3.cross(c,a);a=d.Point3.cross(a,c);this._endCam.setUp(a.normalize());this._completeCallback=f;this._duration=b;this._view=g}a.prototype.isComplete=function(){return 1<=this._progress};a.prototype.getCallback=function(){return this._completeCallback};a.prototype.stop=function(){};a.prototype.start=function(){this._startTime=Date.now();this._progress=0;this._init();this._view.getProjectionMode()!==this._endCam.getProjection()&&this._view.setProjectionMode(this._endCam.getProjection())};a.prototype.update=
function(){if(null!==this._startTime){var a=(Date.now()-this._startTime)/this._duration;a=Math.min(a,1);a=Math.max(a,0);a=h.EaseInEaseOut.calculate(a,.49,.02,.49);a=Math.min(a,1);a=Math.max(a,0);var c=d.Point3.scale(this._positionMoveDelta,a),b=d.Point3.scale(this._targetMoveDelta,a),f=this._beginCam.getUp(),g=d.Point3.add(this._beginCam.getPosition(),c);b=d.Point3.add(this._beginCam.getTarget(),b);c=this._beginCam.getWidth()+a*this._fieldWidthDelta;var l=this._beginCam.getHeight()+a*this._fieldHeightDelta;
if(this._interpolationUsesRotation){g=this._viewVectorLength+this._viewVectorLengthDelta*a;var n=d.Quaternion.interpolate(this._beginQuaternion,this._endQuaternion,a);n=d.Quaternion.toMatrix(n);g=new d.Point3(b.x-n.m[8]*g,b.y-n.m[9]*g,b.z-n.m[10]*g);f.set(n.m[4],n.m[5],n.m[6])}f=d.Camera.create(g,b,f,this._endCam.getProjection(),c,l,this._endCam.getNearLimit());this._view.setCamera(f);this._progress=a;1<=this._progress&&this._view.setCamera(this._endCam)}};a.prototype.getMatrixFromCamera=function(a){var c=
d.Point3.subtract(a.getTarget(),a.getPosition()).normalize();a=a.getUp().normalize();a=d.Point3.cross(a,c);var b=d.Point3.cross(c,a);return d.Matrix.createFromBasis(a,b,c)};a.prototype._init=function(){var a=d.Point3.subtract(this._beginCam.getTarget(),this._beginCam.getPosition()),c=d.Point3.subtract(this._endCam.getTarget(),this._endCam.getPosition()),b=a.length(),f=c.length()-b;a.normalize();c.normalize();c=d.Point3.subtract(a,c);var g=d.Point3.subtract(this._endCam.getUp(),this._beginCam.getUp());
a=!0;1E-4>c.length()&&1E-4>g.length()&&(a=!1);g=c=null;if(a){c=this.getMatrixFromCamera(this._beginCam);g=this.getMatrixFromCamera(this._endCam);c=d.Quaternion.createFromMatrix(c);g=d.Quaternion.createFromMatrix(g);var l=d.Quaternion.subtract(c,g).magnitudeSquared();d.Quaternion.add(c,g).magnitudeSquared()<l&&g.negate()}this._interpolationUsesRotation=a;this._beginQuaternion=c;this._endQuaternion=g;this._viewVectorLength=b;this._viewVectorLengthDelta=f;this._positionMoveDelta=d.Point3.subtract(this._endCam.getPosition(),
this._beginCam.getPosition());this._targetMoveDelta=d.Point3.subtract(this._endCam.getTarget(),this._beginCam.getTarget());this._fieldWidthDelta=this._endCam.getWidth()-this._beginCam.getWidth();this._fieldHeightDelta=this._endCam.getHeight()-this._beginCam.getHeight()};return a}();h.CameraInterpolation=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(){this._activeInterpolation=null;this._updateTimer=new d.Util.Timer;this._updateInterval=16}a.prototype.stop=function(){this._activeInterpolation&&this._activeInterpolation.stop();this._activeInterpolation=null;this._updateTimer.clear()};a.prototype.start=function(a,c){void 0===c&&(c=!0);if(this._activeInterpolation&&!c)return!1;this.stop();this._activeInterpolation=a;this._activeInterpolation.start();this.update();return!0};a.prototype.update=
function(){var a=this;if(this._activeInterpolation)if(this._activeInterpolation.update(),this._activeInterpolation.isComplete()){var c=this._activeInterpolation.getCallback();null!==c&&c()}else this._updateTimer.isIdle(0)&&this._updateTimer.set(this._updateInterval,function(){a.update()})};return a}();h.InterpolationManager=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(a,c,b){this._markupItems=new Map;this._selectedMarkup=this._activeView=null;this._pendingUpdateHandleTimer=new d.Util.Timer;this._pickTolerance=0;this._callbackManager=a;this._domElements=c;this._markupRenderer=b}a.prototype.shutdown=function(){this.setActiveView(null);this._markupItems.forEach(function(a){a.remove()});this._markupItems.clear()};a.prototype._updateLater=function(a){var c=this;this._pendingUpdateHandleTimer.isIdle(0)&&this._pendingUpdateHandleTimer.set(0,
function(){c.update()});null!==a&&this._pendingUpdateHandleTimer.waitForIdle(1).then(function(){a.resolve()})};a.prototype.updateLater=function(){this._updateLater(null)};a.prototype.update=function(){this._pendingUpdateHandleTimer.clear();this.renderMarkup();this.renderActiveViewMarkup()};a.prototype.registerMarkupItem=function(a){var c=d.UUID.create();this._markupItems.set(c,a);return c};a.prototype.unregisterMarkupItem=function(a){var c=this._markupItems.get(a);c&&(c.remove&&c.remove(),this._markupItems.delete(a))};
a.prototype.getActiveView=function(){return this._activeView};a.prototype.setActiveView=function(a){return __awaiter(this,void 0,void 0,function(){var c,b,d,e,g,n;return __generator(this,function(f){switch(f.label){case 0:this._selectedMarkup&&(this._selectedMarkup.onDeselect(),this._selectedMarkup=null);c=this._activeView;this._activeView=a;if(null===c||c===a)return[3,2];b=c.getMarkup();d=0;for(e=b;d<e.length;d++)g=e[d],g.remove();n=h.OpenPromise.create();this._updateLater(n);return[4,n];case 1:return f.sent(),
this._callbackManager.trigger("viewDeactivated",c),[3,4];case 2:return[4,this._pendingUpdateHandleTimer.waitForIdle(1)];case 3:f.sent(),f.label=4;case 4:return[2]}})})};a.prototype.renderMarkup=function(){this._markupRenderer._setCanvas(this._domElements.getMarkupSvgElement());this._markupRenderer._clear();this._markupItems.forEach(function(a){a.draw()});this._markupRenderer._finalize()};a.prototype.renderActiveViewMarkup=function(){this._markupRenderer._setCanvas(this._domElements.getRedlineSvgElement());
this._markupRenderer._clear();if(this._activeView){for(var a=0,c=this._activeView.getMarkup();a<c.length;a++)c[a].draw();this._markupRenderer._finalize()}};a.prototype.getPickTolerance=function(){return this._pickTolerance};a.prototype.setPickTolerance=function(a){this._pickTolerance=a};a.prototype.pick=function(a){var c=this;if(this._activeView)for(var b=0,d=this._activeView.getMarkup();b<d.length;b++){var e=d[b];if(e.hitWithTolerance(a,this._pickTolerance)||e.hit(a))return e}var g=null;this._markupItems.forEach(function(b){null===
g&&(b.hitWithTolerance(a,c._pickTolerance)||b.hit(a))&&(g=b)});return g};a.prototype.select=function(a){if(this._selectedMarkup&&a!==this._selectedMarkup)this._selectedMarkup.onDeselect();if(this._selectedMarkup=a)this._selectedMarkup.onSelect();this.update()};a.prototype.getSelected=function(){return this._selectedMarkup};return a}();h.MarkupItemManager=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(c){function b(){var b=null!==c&&c.apply(this,arguments)||this;b._center=d.Point2.zero();b._radius=1;return b}__extends(b,c);b.prototype.set=function(b,c){this._center.assign(b);this.setRadius(c)};b.prototype.getCenter=function(){return this._center.copy()};b.prototype.setCenter=function(b){this._center.assign(b)};b.prototype.getRadius=function(){return this._radius};b.prototype.setRadius=function(b){this._radius=b};return b}(g.FilledShape);g.Circle=
a;var e=function(){return function(c,b){this.center=c.copy();this.radius=b}}();g._MarkupCircleData=e;a=function(c){function b(){var b=null!==c&&c.apply(this,arguments)||this;b._circles=[];return b}__extends(b,c);b.prototype.clear=function(){this._circles=[]};b.prototype.addCircle=function(b,c){this._circles.push(new e(b,c))};b.prototype.setCircle=function(b,c,a){b=this._circles[b];b.center.assign(c);b.radius=a};b.prototype.getCircles=function(){return this._circles};return b}(g.FilledShape);g.CircleCollection=
a})(h.Shape||(h.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(c){function b(b,a){var f=c.call(this)||this;f._p1=b?b.copy():d.Point2.zero();f._p2=a?a.copy():d.Point2.zero();return f}__extends(b,c);b.prototype.set=function(b,c){this._p1.assign(b);this._p2.assign(c)};b.prototype.getP1=function(){return this._p1.copy()};b.prototype.setP1=function(b){this._p1.assign(b)};b.prototype.getP2=function(){return this._p2};b.prototype.setP2=function(b){this._p2.assign(b)};return b}(g.EndcapShape);g.Line=a;var e=function(){return function(c,
b){this.p1=c.copy();this.p2=b.copy()}}();g._MarkupLineData=e;a=function(c){function b(){var b=null!==c&&c.apply(this,arguments)||this;b._lines=[];return b}__extends(b,c);b.prototype.addLine=function(b,c){this._lines.push(new e(b,c))};b.prototype.getLines=function(){return this._lines};b.prototype.clear=function(){this._lines=[]};return b}(g.EndcapShape);g.LineCollection=a})(h.Shape||(h.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function c(){this._padding=5;this._text=new g.TextMarkupBase;this._box=new g.RectangleBase;this._box.setFillOpacity(0);this._box.setFillColor(d.Color.white())}c.prototype._assign=function(b){this._text._assign(b._text);this._box._assign(b._box);this._padding=b._padding};c.prototype.getTextPortion=function(){return this._text};c.prototype.getBoxPortion=function(){return this._box};c.prototype.getPadding=function(){return this._padding};c.prototype.setPadding=
function(b){this._padding=b};return c}();g.TextBoxBase=a;var e=function(c){function b(b,a){var f=c.call(this)||this;f._position=d.Point2.zero();f._textStr="";b&&f._position.assign(b);a&&(f._textStr=a);return f}__extends(b,c);b.prototype._assign=function(b){c.prototype._assign.call(this,b);this._position.assign(b._position)};b.prototype.getPosition=function(){return this._position.copy()};b.prototype.setPosition=function(b){this._position.assign(b)};b.prototype.getTextString=function(){return this._textStr};
b.prototype.setTextString=function(b){this._textStr=b};return b}(a);g.TextBox=e;a=function(c){function b(){var b=null!==c&&c.apply(this,arguments)||this;b._textStrings=[];return b}__extends(b,c);b.prototype.clear=function(){this._textStrings=[]};b.prototype.addString=function(b,c){this._textStrings.push(new g._MarkupTextData(b,c))};b.prototype.getStrings=function(){return this._textStrings};return b}(a);g.TextBoxCollection=a})(h.Shape||(h.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator=
{}));
(function(d){(function(h){var g=function(){return function(a,c){this.markupView=a;this.itemResults=c}}();h._MarkupViewConstruction=g;var a=function(){function a(c,b,a,d,e,g){void 0===g&&(g=null);this._faceVisibility=this._lineVisibility=!0;this._markupItems=new Set;this._sheetId=null;this._colorMap=new Map;this._snapshotImage=null;this._defaultVisibility=!0;this._visibilityExceptions=new Set;this._uniqueId=c;this._camera=a;this._name=b;this._explodeMagnitude=d;this._cuttingPlaneData=e;this._sheetId=g}
a.prototype.getCamera=function(){return this._camera};a.prototype.getSheetId=function(){return this._sheetId};a.prototype.getUniqueId=function(){return this._uniqueId};a.prototype.getName=function(){return this._name};a.prototype.setName=function(c){this._name=c};a.prototype.getLineVisibility=function(){return this._lineVisibility};a.prototype.setLineVisibility=function(c){this._lineVisibility=c};a.prototype.getFaceVisibility=function(){return this._faceVisibility};a.prototype.setFaceVisibility=function(c){this._faceVisibility=
c};a.prototype.addMarkupItem=function(c){this._markupItems.add(c)};a.prototype.getMarkup=function(){return d.Util.setToArray(this._markupItems)};a.prototype.removeMarkup=function(c){c.remove();return this._markupItems.delete(c)};a.prototype.getCuttingPlaneData=function(){return this._cuttingPlaneData};a.prototype.setCuttingPlaneData=function(c){this._cuttingPlaneData=c};a.prototype.getExplodeMagnitude=function(){return this._explodeMagnitude};a.prototype.setExplodeMagnitude=function(c){this._explodeMagnitude=
c};a.prototype.getColorMap=function(){return this._colorMap};a.prototype.setColorMap=function(c){this._colorMap=c};a.prototype.getDefaultVisibility=function(){return this._defaultVisibility};a.prototype.setDefaultVisibility=function(c){this._defaultVisibility=c};a.prototype.getVisibilityExceptions=function(){return this._visibilityExceptions};a.prototype.setVisibilityExceptions=function(c){this._visibilityExceptions=c};a.prototype.getSnapshotImage=function(){return this._snapshotImage};a.prototype.setSnapshotImage=
function(c){this._snapshotImage=c};a.prototype._handleLoadMarkupItem=function(c){return c instanceof h.MarkupItem?(this.addMarkupItem(c),!0):!1};a._fromJson=function(c,b){return __awaiter(this,void 0,void 0,function(){var f,e,l,h,m,p,q,r,u,t,v,w,y,x,z,B,A,D,C,E,F,H;return __generator(this,function(k){switch(k.label){case 0:f=c;e=d.Camera.fromJson(f.camera);f.hasOwnProperty("sheetId")&&f.sheetId&&(h=parseInt(c.sheetId,10),isNaN(h)||(l=h));m=new a(f.uniqueId,f.name,e,f.explodeMagnitude,f.cuttingData,
l);m.setLineVisibility(f.lineVisibility);m.setFaceVisibility(f.faceVisibility);void 0!==f.defaultVisibility&&void 0!==f.visibilityExceptions&&(m.setDefaultVisibility(f.defaultVisibility),p=new Set,f.visibilityExceptions.forEach(function(b){p.add(b)}),m.setVisibilityExceptions(p));q=new Map;r=f.colors;if(Array.isArray(r))for(u=0,t=r;u<t.length;u++)v=t[u],w=v[0],y=d.Color.fromJson(v[1]),q.set(w,y);m.setColorMap(q);x=[];console.assert(Array.isArray(f.markup));z=0;for(B=f.markup;z<B.length;z++)if(A=B[z],
D=d.Internal.classFromString(A.className))C=D.fromJson(A,b),C instanceof Promise?x.push(C.then(function(b){return m._handleLoadMarkupItem(b)})):x.push(Promise.resolve(m._handleLoadMarkupItem(C)));E=f.imageSrc;void 0!==E&&0<E.length&&(F=new Image,F.src=E,m.setSnapshotImage(F));return[4,Promise.all(x)];case 1:return H=k.sent(),[2,new g(m,H)]}})})};a.prototype.toJson=function(){return this._toJson()};a.prototype._toJson=function(){var c={uniqueId:this._uniqueId,name:this._name,camera:this._camera.toJson(),
cuttingData:this._cuttingPlaneData,explodeMagnitude:this._explodeMagnitude,lineVisibility:this._lineVisibility,faceVisibility:this._faceVisibility,markup:[],sheetId:this._sheetId,defaultVisibility:this._defaultVisibility,visibilityExceptions:[],colors:[],imageSrc:""};this._markupItems.forEach(function(b){var a=b.toJson();a.className=b.getClassName();c.markup.push(a)});this._visibilityExceptions.forEach(function(b){c.visibilityExceptions.push(b)});this._colorMap.forEach(function(b,a){c.colors.push([a,
b.toJson()])});null!==this._snapshotImage&&(c.imageSrc=this._snapshotImage.src);return c};a.prototype.forJson=function(){return this.toJson()};return a}();h.MarkupView=a})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c,b,d,e,g,h){var f=a.call(this)||this;f._markupViews=new Map;f._defaultViewCounter=1;f._markupItemManager=b;f._callbackManager=d;f._explodeManager=e;f._cuttingManager=g;f._viewer=c;f._sheetManager=h;f._initEvents();return f}__extends(e,a);e.prototype._initEvents=function(){var c=this;this._callbackManager.bind({modelSwitchStart:function(){c._markupItemManager.shutdown()}})};e.prototype.getView=function(c){c=this._markupViews.get(c);return void 0!==
c?c:null};e.prototype.getViewKeys=function(){var c=[];this._markupViews.forEach(function(b,a){c.push(a)});return c};e.prototype.loadData=function(c){return __awaiter(this,void 0,void 0,function(){var b,a,e,g,n,m=this;return __generator(this,function(f){b=[];a=0;for(e=c;a<e.length;a++)g=e[a],n=d.Markup.MarkupView._fromJson(g,this._viewer).then(function(b){if(!h.all(b.itemResults))return!1;b=b.markupView;var c=b.getUniqueId();return m._markupViews.has(c)?!1:(m._markupViews.set(c,b),m._callbackManager.trigger("viewLoaded",
b),!0)}),b.push(n);return[2,Promise.all(b)]})})};e.prototype.exportMarkup=function(){var c=[];this._markupViews.forEach(function(b){c.push(b.toJson())});return c};e.prototype.createView=function(c,b,a,e,g,h){void 0===c&&(c=this._createDefaultViewName());void 0===b&&(b=!0);void 0===a&&(a=null);void 0===e&&(e=null);void 0===g&&(g=null);void 0===h&&(h=null);var f=this._viewer.view,k=d.UUID.create();c=new d.Markup.MarkupView(k,c,f.getCamera(),this._explodeManager.getMagnitude(),this._cuttingManager.toJson(),
a);this._markupViews.set(k,c);c.setLineVisibility(f.getLineVisibility());c.setFaceVisibility(f.getFaceVisibility());null!==e&&(c.setDefaultVisibility(e.defaultVisibility),c.setVisibilityExceptions(e.visibilityExceptions));null!==g&&c.setColorMap(g);null!==h&&c.setSnapshotImage(h);this._markupItemManager.setActiveView(c);b&&this._callbackManager.trigger("viewCreated",c);return c};e.prototype._activateSheet=function(c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return null!==
c?[2,this._sheetManager.setActiveSheetId(c,!0,!1)]:[2]})})};e.prototype._activateViewImpl=function(c,b){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(d){switch(d.label){case 0:return[4,this._activateSheet(c.getSheetId())];case 1:return d.sent(),a=this._viewer.view,a.setFaceVisibility(c.getFaceVisibility()),a.setLineVisibility(c.getLineVisibility()),0<b?[4,this._markupItemManager.setActiveView(null)]:[3,4];case 2:return d.sent(),[4,a._setCameraPromise(c.getCamera(),
b)];case 3:return d.sent(),[3,5];case 4:a.setCamera(c.getCamera()),d.label=5;case 5:return[4,this._setActiveView(c)];case 6:return d.sent(),[2]}})})};e.prototype._activateView=function(a,b){a=this._markupViews.get(a);return void 0!==a?(b=this._activateViewImpl(a,b),h.UnsafePromise.create(!0,b)):h.UnsafePromise.create(!1,Promise.resolve())};e.prototype.activateView=function(a,b){void 0===b&&(b=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){return[2,
this._activateView(a,b)]})})};e.prototype.deprecatedActivateView=function(a,b){void 0===b&&(b=d.DefaultTransitionDuration);return this._activateView(a,b).unsafeValue};e.prototype._setActiveView=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,d,e;return __generator(this,function(f){switch(f.label){case 0:return this._viewer.model.isDrawing()?null!==a.getSheetId()?[3,2]:[4,this._viewer.sheetManager.deactivateSheets()]:[3,5];case 1:return f.sent(),[3,4];case 2:b=a.getVisibilityExceptions();
c=a.getDefaultVisibility();if(!(0<b.size&&c))return[3,4];d=[];b.forEach(function(b){d.push(b)});return[4,this._viewer.model.setNodesVisibility(d,!1)];case 3:f.sent(),f.label=4;case 4:return[3,8];case 5:return c=a.getDefaultVisibility(),[4,this._viewer.model.setNodesVisibility([this._viewer.model.getAbsoluteRootNode()],c)];case 6:f.sent();b=a.getVisibilityExceptions();if(!(0<b.size))return[3,8];e=[];b.forEach(function(b){e.push(b)});return[4,this._viewer.model.setNodesVisibility(e,!c)];case 7:f.sent(),
f.label=8;case 8:return[4,this._markupItemManager.setActiveView(a)];case 9:return f.sent(),[4,this._cuttingManager.fromJson(a.getCuttingPlaneData())];case 10:return f.sent(),[4,this._viewer.model.setNodesColors(a.getColorMap())];case 11:return f.sent(),[4,this._explodeManager.setMagnitude(a.getExplodeMagnitude())];case 12:return f.sent(),[2]}})})};e.prototype.deleteView=function(a){var b=this._markupViews.get(a);return void 0!==b?(this._callbackManager.trigger("viewDeleted",b),b===this._markupItemManager.getActiveView()&&
this._markupItemManager.setActiveView(null),this._markupViews.delete(a),!0):!1};e.prototype._createDefaultViewName=function(){return"View "+this._defaultViewCounter++};e.prototype.toJson=function(){return this.exportMarkup()};e.prototype.forJson=function(){return this.toJson()};return e}(d.MarkupTypeManager);h.MarkupViewManager=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b,c,e,g,h){void 0===c&&(c=null);void 0===e&&(e=null);void 0===g&&(g=null);void 0===h&&(h=null);var f=a.call(this)||this;f._uniqueId=d.UUID.create();f._lineMeshId=null;f._lineMeshInstanceId=null;f._lineColor=d.Color.red();f._lineOpacity=1;f._linePattern=null;f._linePatternLength=null;f._linePatternLengthUnit=null;f._viewer=b;f._firstPoint=c;f._secondPoint=e;f._firstNodeId=g;f._secondNodeId=h;return f}__extends(c,a);c.prototype.setLineColor=
function(b){this._lineColor=b};c.prototype.getLineColor=function(){return this._lineColor};c.prototype.setLineOpacity=function(b){this._lineOpacity=b};c.prototype.getLineOpacity=function(){return this._lineOpacity};c.prototype.setLinePattern=function(b,a,c){this._linePattern=b;this._linePatternLength=a;this._linePatternLengthUnit=c};c.prototype.getLinePattern=function(){return void 0!==this._linePattern?this._linePattern:null};c.prototype.getLinePatternLength=function(){return void 0!==this._linePatternLength?
this._linePatternLength:null};c.prototype.getLinePatternLengthUnit=function(){return void 0!==this._linePatternLengthUnit?this._linePatternLengthUnit:null};c.prototype.setFirstPoint=function(b){this._firstPoint=b};c.prototype.getFirstPoint=function(){return this._firstPoint};c.prototype.setSecondPoint=function(b){this._secondPoint=b};c.prototype.getSecondPoint=function(){return this._secondPoint};c.prototype.setFirstNodeId=function(b){this._firstNodeId=b};c.prototype.getFirstNodeId=function(){return this._firstNodeId};
c.prototype.setSecondNodeId=function(b){this._secondNodeId=b};c.prototype.getSecondNodeId=function(){return this._secondNodeId};c.prototype.getNodeId=function(){return this._lineMeshInstanceId};c.prototype.removeLine=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(a){switch(a.label){case 0:return b=this._viewer.model,null===this._lineMeshInstanceId?[3,3]:[4,b.deleteMeshInstances([this._lineMeshInstanceId])];case 1:return a.sent(),this._lineMeshInstanceId=
null,null===this._lineMeshId?[3,3]:[4,b.deleteMeshes([this._lineMeshId])];case 2:a.sent(),this._lineMeshId=null,a.label=3;case 3:return[2]}})})};c.prototype.updateLine=function(){return __awaiter(this,void 0,void 0,function(){var b,a,c,e,g;return __generator(this,function(f){switch(f.label){case 0:return[4,this.removeLine()];case 1:f.sent();if(null===this._firstPoint||null===this._secondPoint)return[3,4];b=new d.MeshData;b.addPolyline([this._firstPoint.x,this._firstPoint.y,this._firstPoint.z,this._secondPoint.x,
this._secondPoint.y,this._secondPoint.z]);a=this._viewer.model;return[4,a.createMesh(b)];case 2:return this._lineMeshId=c=f.sent(),e=new d.MeshInstanceData(c),e.setLineColor(this._lineColor),e.setLineOpacity(this._lineOpacity),e.setCreationFlags(d.MeshInstanceCreationFlags.ExcludeBounding),[4,a.createMeshInstance(e)];case 3:g=f.sent(),null!==this._linePattern&&a.setNodesLinePattern([g],this._linePattern,this._linePatternLength,this._linePatternLengthUnit),this._lineMeshInstanceId=g,f.label=4;case 4:return[2]}})})};
c.prototype.getId=function(){return this._uniqueId};c.prototype.setId=function(b){this._uniqueId=b};c.prototype.getClassName=function(){return c.className};c.prototype._toJson=function(){return{className:this.getClassName(),uniqueId:this._uniqueId,firstPoint:this.getFirstPoint(),secondPoint:this.getSecondPoint(),firstNodeId:this.getFirstNodeId(),secondNodeId:this.getSecondNodeId(),lineColor:this.getLineColor(),lineOpacity:this.getLineOpacity(),linePattern:this.getLinePattern(),linePatternLength:this.getLinePatternLength(),
linePatternLengthUnit:this.getLinePatternLengthUnit()}};c.prototype.toJson=function(){return this._toJson()};c.fromJson=function(b,a){return __awaiter(this,void 0,void 0,function(){var f,e;return __generator(this,function(g){f=b;e=new c(a,d.Point3.fromJson(f.firstPoint),d.Point3.fromJson(f.secondPoint),f.firstNodeId,f.secondNodeId);e.setId(f.uniqueId);e.setLineColor(d.Color.fromJson(f.lineColor));e.setLineOpacity(f.lineOpacity);null!=f.linePattern&&null!=f.linePatternLength&&null!=f.linePatternLengthUnit&&
e.setLinePattern(f.linePattern,f.linePatternLength,f.linePatternLengthUnit);return[2,e]})})};c.className="Communicator.Markup.Line.LineMarkup";return c}(h.MarkupItem);g.LineMarkup=a})(h.Line||(h.Line={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){var a=function(a){function c(b){var c=a.call(this)||this;c._viewer=b;return c}__extends(c,a);c.prototype.onDragStart=function(b){b;return!1};c.prototype.onDragMove=function(b){b;return!1};c.prototype.onDragEnd=function(b){b;return!1};c.prototype.remove=function(){this._viewer.trigger("redlineDeleted",this);this._viewer.markupManager.refreshMarkup()};return c}(d.MarkupItem);g.RedlineItem=a})(d.Redline||(d.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||
(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(){this._svgDefsElement=this._svgCanvas=null;this._svgElements=[];this._svgTextElements=[]}a.prototype._setCanvas=function(a){this._svgCanvas=a;this._svgDefsElement=document.createElementNS(g.Util.svgNamespace,"defs");this._svgCanvas.appendChild(this._svgDefsElement)};a.prototype._clear=function(){if(null===this._svgCanvas||null===this._svgDefsElement)throw new d.CommunicatorError("canvas not set");for(;this._svgCanvas.firstChild;)this._svgCanvas.removeChild(this._svgCanvas.firstChild);this._svgElements=
[];for(this._svgTextElements=[];this._svgDefsElement.firstChild;)this._svgDefsElement.removeChild(this._svgDefsElement.firstChild);this._svgCanvas.appendChild(this._svgDefsElement)};a.prototype._finalize=function(){if(null===this._svgCanvas)throw new d.CommunicatorError("canvas not set");for(var a=0,b=this._svgElements;a<b.length;a++){var f=b[a];this._svgCanvas.appendChild(f)}a=0;for(b=this._svgTextElements;a<b.length;a++)f=b[a],this._svgCanvas.appendChild(f)};a.prototype.drawCircle=function(a){return this._addCircleNode(a.getCenter(),
a.getRadius(),a)};a.prototype.drawCircles=function(a){for(var b=[],c=0,d=a.getCircles();c<d.length;c++){var e=d[c];e=this._addCircleNode(e.center,e.radius,a);b.push(e)}return b};a.prototype.drawLine=function(a){return this._addLineElement(a.getP1(),a.getP2(),a)};a.prototype.drawLines=function(a){for(var b=[],c=0,d=a.getLines();c<d.length;c++){var e=d[c];e=this._addLineElement(e.p1,e.p2,a);b.push(e)}return b};a.prototype.drawText=function(a){return this._addTextElement(a.getText(),a.getPosition(),
a)};a.prototype.drawTexts=function(a){for(var b=[],c=0,d=a.getStrings();c<d.length;c++){var e=d[c];e=this._addTextElement(e.text,e.position,a);b.push(e)}return b};a.prototype.measureText=function(a,b){if(null===this._svgCanvas)throw new d.CommunicatorError("canvas not set");a=this._createTextElement(a,d.Point2.zero(),b);this._svgCanvas.appendChild(a);b=a.getBoundingClientRect();b=new d.Point2(b.width,b.height);this._svgCanvas.removeChild(a);return b};a.prototype.measureTextBox=function(a){var b=this.measureText(a.getTextString(),
a.getTextPortion());b.x+=2*a.getBoxPortion().getStrokeWidth();b.y+=2*a.getBoxPortion().getStrokeWidth();b.x+=2*a.getPadding();b.y+=2*a.getPadding();return b};a.prototype.drawPolyline=function(a){return this._addPolylineElement(a.getPoints(),a)};a.prototype.drawPolylines=function(a){for(var b=[],c=0,d=a.getPolylines();c<d.length;c++){var e=this._addPolylineElement(d[c],a);b.push(e)}return b};a.prototype.drawPolygon=function(a){return this._addPolygonElement(a.getPoints(),a)};a.prototype.drawPolygons=
function(a){for(var b=[],c=0,d=a.getPolygons();c<d.length;c++){var e=this._addPolygonElement(d[c],a);b.push(e)}return b};a.prototype.drawRectangle=function(a){return this._addRectangleElement(a.getPosition(),a.getSize(),a)};a.prototype.drawRectangles=function(a){for(var b=[],c=0,d=a.getRectangles();c<d.length;c++){var e=d[c];e=this._addRectangleElement(e.position,e.size,a);b.push(e)}return b};a.prototype.drawTextBox=function(a){return this._addTextBoxElement(a.getTextString(),a.getPosition(),a)};
a.prototype.drawTextBoxes=function(a){for(var b=[],c=0,d=a.getStrings();c<d.length;c++){var e=d[c];e=this._addTextBoxElement(e.text,e.position,a);b.push(e)}return b};a.prototype._addTextBoxElement=function(a,b,d){var c=this.measureText(a,d.getTextPortion());c.x+=2*d.getPadding();c.y+=2*d.getPadding();var f=[];c=this._addRectangleElement(b,c,d.getBoxPortion(),!0);f.push(c);b=b.copy();b.x+=d.getPadding();b.y+=d.getPadding()/2+d.getBoxPortion().getStrokeWidth();a=this._addTextElement(a,b,d.getTextPortion());
f.push(a);return f};a.prototype._renderEndcaps=function(a,b,f,e){if(null===this._svgDefsElement)throw new d.CommunicatorError("canvas not set");f.getStartEndcapType()===d.Markup.Shape.EndcapType.Arrowhead?(f.getEndcapsInverted()?(a=g.Util.createEndArrowMarker(f.getStartEndcapSize(),f.getStartEndcapColor()),a.refX.baseVal.value=f.getStartEndcapSize()):a=g.Util.createStartArrowMarker(f.getStartEndcapSize(),f.getStartEndcapColor()),e.style.markerStart="url(#"+a.id+")",this._svgDefsElement.appendChild(a)):
f.getStartEndcapType()===d.Markup.Shape.EndcapType.Circle&&(a=g.Util.createCircleMarker(a,f.getStrokeWidth(),f.getStartEndcapSize(),f.getStartEndcapColor()),this._addSVGElement(a));f.getEndEndcapType()===d.Markup.Shape.EndcapType.Arrowhead?(a=f.getEndcapsInverted()?g.Util.createStartArrowMarker(f.getEndEndcapSize(),f.getEndEndcapColor()):g.Util.createEndArrowMarker(f.getEndEndcapSize(),f.getEndEndcapColor()),e.style.markerEnd="url(#"+a.id+")",this._svgDefsElement.appendChild(a)):f.getEndEndcapType()===
d.Markup.Shape.EndcapType.Circle&&(a=g.Util.createCircleMarker(b,f.getStrokeWidth(),f.getEndEndcapSize(),f.getEndEndcapColor()),this._addSVGElement(a))};a.prototype._createTextElement=function(a,b,d){var c=document.createElementNS(g.Util.svgNamespace,"text"),f=0;for(a=a.split("\n");f<a.length;f++){var e=a[f],h=document.createElementNS(g.Util.svgNamespace,"tspan");h.textContent=e;h.setAttributeNS(null,"x",""+b.x);h.setAttributeNS(null,"dy","1.2em");c.appendChild(h)}(f=d.getFontFamily())&&c.setAttributeNS(null,
"font-family",f);c.setAttributeNS(null,"font-size",d.getFontSize().toString());c.setAttributeNS(null,"x",""+b.x);c.setAttributeNS(null,"y",""+b.y);this._setGenericFillAttributes(c,d);this._setGenericStrokeAttributes(c,d);return c};a.prototype._addTextElement=function(a,b,d){a=this._createTextElement(a,b,d);this._addSVGTextItemElement(a);return a};a.prototype._addRectangleElement=function(a,b,d,e){void 0===e&&(e=!1);var c=document.createElementNS(g.Util.svgNamespace,"rect");c.setAttributeNS(null,"x",
a.x.toString());c.setAttributeNS(null,"y",a.y.toString());c.setAttributeNS(null,"width",b.x.toString());c.setAttributeNS(null,"height",b.y.toString());a=d.getBorderRadius();0<a&&(c.setAttributeNS(null,"rx",a.toString()),c.setAttributeNS(null,"ry",a.toString()));this._setGenericFillAttributes(c,d);this._setGenericStrokeAttributes(c,d);e?this._addSVGTextItemElement(c):this._addSVGElement(c);return c};a.prototype._addLineElement=function(a,b,d){var c=document.createElementNS(g.Util.svgNamespace,"line");
c.setAttributeNS(null,"x1",a.x.toString());c.setAttributeNS(null,"y1",a.y.toString());c.setAttributeNS(null,"x2",b.x.toString());c.setAttributeNS(null,"y2",b.y.toString());this._setGenericStrokeAttributes(c,d);this._addSVGElement(c);this._renderEndcaps(a,b,d,c);return c};a.prototype._addPolygonElement=function(a,b){a=g.Util.svgPointString(a);var c=document.createElementNS(g.Util.svgNamespace,"polygon");c.setAttributeNS(null,"points",a);this._setGenericStrokeAttributes(c,b);this._setGenericFillAttributes(c,
b);this._addSVGElement(c);return c};a.prototype._addPolylineElement=function(a,b){var c=g.Util.svgPointString(a),d=document.createElementNS(g.Util.svgNamespace,"polyline");d.setAttributeNS(null,"points",c);d.setAttributeNS(null,"fill","none");this._renderEndcaps(a[0],a[a.length-1],b,d);this._setGenericStrokeAttributes(d,b);this._addSVGElement(d);return d};a.prototype._addCircleNode=function(a,b,d){var c=document.createElementNS(g.Util.svgNamespace,"circle");c.setAttributeNS(null,"cx",a.x.toString());
c.setAttributeNS(null,"cy",a.y.toString());c.setAttributeNS(null,"r",b.toString());this._setGenericFillAttributes(c,d);this._setGenericStrokeAttributes(c,d);this._addSVGElement(c);return c};a.prototype._setGenericFillAttributes=function(a,b){a.setAttributeNS(null,"fill",g.Util.svgColorRgbString(b.getFillColor()));a.setAttributeNS(null,"fill-opacity",b.getFillOpacity().toString())};a.prototype._setGenericStrokeAttributes=function(a,b){a.setAttributeNS(null,"stroke",g.Util.svgColorRgbString(b.getStrokeColor()));
a.setAttributeNS(null,"stroke-width",b.getStrokeWidth().toString())};a.prototype._addSVGTextItemElement=function(a){this._svgTextElements.push(a)};a.prototype._addSVGElement=function(a){this._svgElements.push(a)};return a}();g.SVGMarkupRenderer=a})(h.SVG||(h.SVG={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){(function(a){function e(a){return"rgb("+a.r+", "+a.g+", "+a.b+")"}a.svgNamespace="http://www.w3.org/2000/svg";a.svgColorRgbString=e;a.svgPointString=function(a){for(var b="",c=0;c<a.length;c++)c&&(b+=" "),b+=a[c].x+","+a[c].y;return b};a.createStartArrowMarker=function(c,b){var f=1.1*c,g=new d.Point2(f,0),l=new d.Point2(f,c),h=new d.Point2(0,c/2),m=document.createElementNS(a.svgNamespace,"marker");m.id=d.UUID.create();m.markerWidth.baseVal.value=f;m.markerHeight.baseVal.value=
c;m.setOrientToAuto();m.refY.baseVal.value=c/2;c="M"+g.x+","+g.y+" L"+l.x+","+l.y+" L"+h.x+","+h.y+" Z";f=document.createElementNS(a.svgNamespace,"path");f.setAttribute("d",c);f.setAttributeNS(null,"fill",e(b));m.appendChild(f);return m};a.createEndArrowMarker=function(c,b){var f=1.1*c,g=d.Point2.zero(),l=new d.Point2(0,c),h=new d.Point2(f,c/2),m=document.createElementNS(a.svgNamespace,"marker");m.id=d.UUID.create();m.markerWidth.baseVal.value=f;m.markerHeight.baseVal.value=c;m.setOrientToAuto();
m.refY.baseVal.value=c/2;m.refX.baseVal.value=c;c="M"+g.x+","+g.y+" L"+l.x+","+l.y+" L"+h.x+","+h.y+" Z";f=document.createElementNS(a.svgNamespace,"path");f.setAttribute("d",c);f.setAttributeNS(null,"fill",e(b));m.appendChild(f);return m};a.createCircleMarker=function(c,b,d,g){d/=2;g=e(g);var f=document.createElementNS(a.svgNamespace,"circle");f.setAttributeNS(null,"cx",c.x.toString());f.setAttributeNS(null,"cy",c.y.toString());f.setAttributeNS(null,"r",d.toString());f.setAttributeNS(null,"fill",
g);0<b&&(f.setAttributeNS(null,"stroke-width",b.toString()),f.setAttributeNS(null,"stroke",g));return f}})(g.Util||(g.Util={}))})(h.SVG||(h.SVG={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._points=[];return b}__extends(c,a);c.prototype.clearPoints=function(){this._points=[]};c.prototype.getPoints=function(){return this._points};c.prototype.pushPoint=function(b){this._points.push(b.copy())};return c}(d.FilledShape);d.Polygon=a;a=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._polygons=[];return b}__extends(c,a);c.prototype.clear=function(){this._polygons=
[]};c.prototype.createPolygon=function(){var b=[];this._polygons.push(b);return b};c.prototype.getPolygons=function(){return this._polygons};return c}(d.FilledShape);d.PolygonCollection=a})(d.Shape||(d.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._points=[];return b}__extends(c,a);c.prototype.clearPoints=function(){this._points=[]};c.prototype.getPoints=function(){return this._points};c.prototype.pushPoint=function(b){this._points.push(b.copy())};return c}(d.EndcapShape);d.Polyline=a;a=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._polylines=[];return b}__extends(c,a);c.prototype.clear=function(){this._polylines=
[]};c.prototype.createPolyline=function(){var b=[];this._polylines.push(b);return b};c.prototype.getPolylines=function(){return this._polylines};return c}(d.EndcapShape);d.PolylineCollection=a})(d.Shape||(d.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function g(b,a){var c=Math.abs(b.x);var f=Math.abs(b.y),e=Math.abs(b.z);c=c<=f&&c<=e?new d.Point3(1,0,0):f<=c&&f<=e?new d.Point3(0,1,0):new d.Point3(0,0,1);b=d.Point3.cross(c,b);return a?(a.assign(b),a):b}function a(b,a,c,d){var f=c.normal.x*(a.x-b.x)+c.normal.y*(a.y-b.y)+c.normal.z*(a.z-b.z);if(1E-5>Math.abs(f))return!1;c=-(c.d+c.normal.x*b.x+c.normal.y*b.y+c.normal.z*b.z)/f;d.x=b.x+c*(a.x-b.x);d.y=b.y+c*(a.y-b.y);d.z=b.z+c*(a.z-b.z);return 0>c||1<c?!1:!0}function e(b){if(.01>
Math.abs(b-25.4/72))return"points";if(.01>Math.abs(b-25.4))return"inch";if(.01>Math.abs(b-1))return"mm";if(.01>Math.abs(b-10))return"cm";if(.01>Math.abs(b-25.4/6))return"picas";if(.01>Math.abs(b-12*25.4))return"ft";if(.01>Math.abs(b-914.4))return"yd";if(.01>Math.abs(b-1E3))return"m";if(.01>Math.abs(b-1E6))return"km";if(.01>Math.abs(b-1609344))return"mi";console.log("warning: unit multiplier doesn't map to known type: unit="+b);return""}function c(b){return Math.PI/180*b}function b(b){return 180/Math.PI*
b}function f(b,a,f){b=b.copy().normalize();var e=c(a);a=Math.cos(e);e=Math.sin(e);var g=1-a,k=g*b.x*b.y,l=g*b.x*b.z,h=g*b.y*b.z;void 0===f&&(f=new d.Matrix);f.m[0]=g*b.x*b.x+a;f.m[1]=e*b.z+k;f.m[2]=l-e*b.y;f.m[3]=0;f.m[4]=k-e*b.z;f.m[5]=g*b.y*b.y+a;f.m[6]=e*b.x+h;f.m[7]=0;f.m[8]=e*b.y+l;f.m[9]=h-e*b.x;f.m[10]=g*b.z*b.z+a;f.m[11]=0;f.m[12]=0;f.m[13]=0;f.m[14]=0;f.m[15]=1;return f}function k(b,a,c){a=d.Point3.subtract(a,b);b=d.Point3.subtract(c,b);b=d.Point3.dot(b,a)/a.squaredLength();return Math.max(0,
Math.min(1,b))}h.oneVectorCross=g;h.intersectionPlaneLine2=a;h.computePointToLineDistance=function(b,a,c,f){var e=d.Point3.subtract(c,a),g=e.squaredLength(),k=0;0<g&&(k=((b.x-a.x)*(c.x-a.x)+(b.y-a.y)*(c.y-a.y)+(b.z-a.z)*(c.z-a.z))/g);e.set(e.x*k,e.y*k,e.z*k);f.set(a.x+e.x,a.y+e.y,a.z+e.z);new d.Point3(0,0,0);return d.Point3.subtract(b,f).length()};h.formatWithUnit=function(b,a){a=e(a);for(var c,d=2;9>d&&(c=b.toFixed(d),0===parseFloat(c));d++);0===parseFloat(c)&&(c="0");return c+a};h.degreesToRadians=
c;h.radiansToDegrees=b;h.computeOffaxisRotation=f;h.intersect3d2Planes=function(b,a,c,f,e,g){var k=d.Point3.cross(b.normal,c.normal),l=Math.abs(k.x),h=Math.abs(k.y),n=Math.abs(k.z);if(1E-7>l+h+n)return c=d.Point3.subtract(f,a),0===d.Point3.dot(b.normal,c)?1:0;l=l>h?l>n?1:3:h>n?2:3;h=d.Point3.zero();a=-d.Point3.dot(b.normal,a);f=-d.Point3.dot(c.normal,f);switch(l){case 1:h.x=0;h.y=(f*b.normal.z-a*c.normal.z)/k.x;h.z=(a*c.normal.y-f*b.normal.y)/k.x;break;case 2:h.x=(a*c.normal.z-f*b.normal.z)/k.y;h.y=
0;h.z=(f*b.normal.x-a*c.normal.x)/k.y;break;case 3:h.x=(f*b.normal.y-a*c.normal.y)/k.z,h.y=(a*c.normal.x-f*b.normal.x)/k.z,h.z=0}e.assign(h);g.set(h.x+k.x,h.y+k.y,h.z+k.z);return 2};h.intersectionPlaneLine=function(b,c,f,e,g,k){var l=new d.Plane;l.normal.x=(e.y-f.y)*(g.z-f.z)-(e.z-f.z)*(g.y-f.y);l.normal.y=(e.z-f.z)*(g.x-f.x)-(e.x-f.x)*(g.z-f.z);l.normal.z=(e.x-f.x)*(g.y-f.y)-(e.y-f.y)*(g.x-f.x);l.normal.normalize();l.d=-l.normal.x*f.x-l.normal.y*f.y-l.normal.z*f.z;return a(b,c,l,k)};h.computeAngleBetweenVector=
function(a,c){a=a.copy().normalize();var f=c.copy().normalize();c=d.Point3.cross(a,f).length();a=d.Point3.dot(a,f);return b(Math.atan2(c,a))};h.generatePointsOnCircle=function(b,a,c,f,e){for(var k=2*Math.PI/f,l=0;l<f;l++)b[l]=new d.Point3(0,c*Math.cos(k*l),c*Math.sin(k*l));b[f]=b[0].copy();c=g(e);c.normalize();k=d.Point3.cross(c,e);k.normalize();l=new d.Matrix;var h=l.m;h[0]=e.x;h[1]=e.y;h[2]=e.z;h[3]=0;h[4]=c.x;h[5]=c.y;h[6]=c.z;h[7]=0;h[8]=k.x;h[9]=k.y;h[10]=k.z;h[11]=0;h[12]=0;h[13]=0;h[14]=0;
h[15]=1;l.transformArray(b,b);for(l=0;l<=f;l++)b[l].set(b[l].x+a.x,b[l].y+a.y,b[l].z+a.z)};h.distanceLineLine=function(b,a,c,f,e,g){var k=0,l=0,h=d.Point3.subtract(a,b),n=d.Point3.subtract(f,c),m=d.Point3.dot(h,b),p=d.Point3.dot(h,n),q=d.Point3.dot(h,h),r=d.Point3.dot(h,c),A=d.Point3.dot(n,n),D=d.Point3.dot(n,c),C=d.Point3.dot(n,b);f=d.Point3.dot(h,f);var E=d.Point3.dot(n,a),F=q*A-p*p;0===F?(0!==q?(r=(r-m)/q,0>r?r=0:1<r&&(r=1),m=(f-m)/q,0>m?m=0:1<m&&(m=1)):m=r=0,0!==A?(C=(C-D)/A,0>C?C=0:1<C&&(C=1),
A=(E-D)/A,0>A?A=0:1<A&&(A=1)):A=C=0,k=(r+m)/2,l=(C+A)/2):(a=(p*C-p*D-A*m+A*r)/F,p=(q*C-q*D+p*r-p*m)/F,r=(r-m)/q,C=(C-D)/A,m=(f-m)/q,A=(E-D)/A,0<=a&&1>=a&&0<=p&&1>=p?(k=a,l=p):0>a&&0<=p&&1>=p?(k=a,l=C):1<a&&0<=p&&1>=p?(k=a,l=A):0<=a&&1>=a&&0>p?(k=r,l=p):0<=a&&1>=a&&1<p?(k=m,l=p):0>a&&0>p?(k=r,l=C):0>a&&1<p?(k=m,l=C):1<a&&0>p?(k=r,l=A):1<a&&1<p&&(k=m,l=A),0>k?k=0:1<k&&(k=1),0>l?l=0:1<l&&(l=1));e.x=k*h.x+b.x;e.y=k*h.y+b.y;e.z=k*h.z+b.z;g.x=l*n.x+c.x;g.y=l*n.y+c.y;g.z=l*n.z+c.z;return d.Point3.subtract(g,
e).length()};h.lineLineIntersect=function(b,a,c,f){var e=d.Point3.zero(),g=d.Point3.zero(),k=d.Point3.zero(),l=d.Point3.zero(),h=d.Point3.zero();k.x=b.x-c.x;k.y=b.y-c.y;k.z=b.z-c.z;l.x=f.x-c.x;l.y=f.y-c.y;l.z=f.z-c.z;if(1E-12>Math.abs(l.x)&&1E-12>Math.abs(l.y)&&1E-12>Math.abs(l.z))return null;h.x=a.x-b.x;h.y=a.y-b.y;h.z=a.z-b.z;if(1E-12>Math.abs(h.x)&&1E-12>Math.abs(h.y)&&1E-12>Math.abs(h.z))return null;a=k.x*l.x+k.y*l.y+k.z*l.z;f=l.x*h.x+l.y*h.y+l.z*h.z;var n=k.x*h.x+k.y*h.y+k.z*h.z;k=l.x*l.x+l.y*
l.y+l.z*l.z;var m=(h.x*h.x+h.y*h.y+h.z*h.z)*k-f*f;if(1E-12>Math.abs(m))return null;n=(a*f-n*k)/m;a=(a+f*n)/k;e.x=b.x+n*h.x;e.y=b.y+n*h.y;e.z=b.z+n*h.z;g.x=c.x+a*l.x;g.y=c.y+a*l.y;g.z=c.z+a*l.z;return e};h.closestPointScalarFromPointToSegment=k;h.closestPointFromPointToSegment=function(b,a,c){c=k(b,a,c);a=d.Point3.subtract(a,b).scale(c);return d.Point3.add(b,a)};h.isPointOnLineSegment=function(b,a,c,f){var e=k(b,a,c);if(0>e||1<e)return!1;a=d.Point3.subtract(a,b).scale(e);b=d.Point3.add(b,a);return d.Point3.subtract(b,
c).squaredLength()<=f*f};h.isPointOnLineSegment2d=function(b,a,c,f){var e=d.Point2.subtract(c,a);var g=e.length();e.scale(((b.x-a.x)*(c.x-a.x)+(b.y-a.y)*(c.y-a.y))/(g*g));e=d.Point2.add(a,e);return d.Point2.distance(b,e)<=f?e.x<Math.min(a.x,c.x)||e.x>Math.max(a.x,c.x)||e.y<Math.min(a.y,c.y)||e.y>Math.max(a.y,c.y)?!1:!0:!1};h.isPointInRect2d=function(b,a,c,d){void 0===d&&(d=0);return b.x+d<a.x||b.x>a.x+c.x+d||b.y+d<a.y||b.y>a.y+c.y+d?!1:!0};h.generateArcPoints=function(b,a,c,e,g){var k=[],l=d.Point3.zero(),
h=new d.Matrix;a/=g;for(var n=0,m=0;n<=g;++n,m+=a)f(b,m,h),h.transform(e,l),k.push(d.Point3.add(c,l));return k}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(a,e){this.origin=d.Point3.zero();this.direction=new d.Point3(0,0,1);a&&this.origin.assign(a);e&&this.direction.assign(e)}g.prototype.copy=function(){return new g(this.origin,this.direction)};g.prototype.assign=function(a){this.origin.assign(a.origin);this.direction.assign(a.direction);return this};g.prototype.negate=function(){this.direction.negate();return this};return g}();d.Ray=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(){this.normal=d.Point3.zero();this.d=0}g.prototype.setFromPointAndNormal=function(a,e){this.normal.assign(e);this.d=-d.Point3.dot(e,a);return this};g.prototype.setFromPoints=function(a,e,c){this.normal=d.Point3.cross(d.Point3.subtract(e,a),d.Point3.subtract(c,a)).normalize();this.d=-d.Point3.dot(a,this.normal)};g.prototype.setFromCoefficients=function(a,d,c,b){this.normal.set(a,d,c);this.d=b};g.prototype.getCoefficients=function(){var a=this.normal;return[a.x,
a.y,a.z,this.d]};g.prototype.distanceToPoint=function(a){return d.Point3.dot(this.normal,a)+this.d};g.prototype.rayIntersection=function(a){var e=d.Point3.zero();return this.intersectsRay(a,e)?e:null};g.prototype.intersectsRay=function(a,e){var c=d.Point3.dot(this.normal,a.direction),b=this.distanceToPoint(a.origin),f=-b/c;return 0<=f&&0<Math.abs(c)?(e&&(c=a.direction.copy().scale(f),e.set(a.origin.x+c.x,a.origin.y+c.y,a.origin.z+c.z)),!0):0<=f&&0>=Math.abs(b)?(e&&e.assign(a.origin),!0):!1};g.prototype.determineSide=
function(a){return 0<this.normal.x*a.x+this.normal.y*a.y+this.normal.z*a.z+this.d?!0:!1};g.prototype.copy=function(){var a=new g;a.normal.assign(this.normal);a.d=this.d;return a};g.prototype.assign=function(a){this.normal.assign(a.normal);this.d=a.d};g.prototype.equals=function(a){return this.normal.equals(a.normal)&&this.d===a.d};g.createFromPointAndNormal=function(a,d){return(new g).setFromPointAndNormal(a,d)};g.createFromPoints=function(a,d,c){var b=new g;b.setFromPoints(a,d,c);return b};g.createFromCoefficients=
function(a,d,c,b){var f=new g;f.setFromCoefficients(a,d,c,b);return f};return g}();d.Plane=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(a,d,c,b){this.x=a;this.y=d;this.z=c;this.w=b}d.prototype.scale=function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this};d.prototype.set=function(a,d,c,b){this.x=a;this.y=d;this.z=c;this.w=b};d.prototype.assign=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w};d.zero=function(){return new d(0,0,0,0)};return d}();d.Point4=h})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(a,b){this._button=a;this._modifier=b}a.prototype.getButton=function(){return this._button};a.prototype.getModifier=function(){return this._modifier};return a}();h.ButtonModifier=g;var a=function(){function a(a){this._ptFirst=d.Point2.zero();this._ptPrevious=d.Point2.zero();this._ptCurrent=d.Point2.zero();this._dragging=!1;this._dragCount=0;this._primaryTouchId=null;this._mapping=[];this._buttonModifierActive=!1;this._doubleClickInterval=200;this._firstMouseDownTime=
null;this._isDoubleClick=!1;this._viewer=a}a.prototype.onDoubleClick=function(a){};a.prototype.onMouseDown=function(a){this._firstMouseDownTime?Date.now()-this._firstMouseDownTime<this._doubleClickInterval?(this._isDoubleClick=!0,this._firstMouseDownTime=null):this._firstMouseDownTime=Date.now():(this._firstMouseDownTime=Date.now(),this._isDoubleClick=!1);if(this._isDoubleClick)this.onDoubleClick(a);else{if(this._buttonModifierActive=this.checkMapping(a))a=a.getPosition(),this._ptFirst.assign(a),
this._ptPrevious.assign(a),this._ptCurrent.assign(a);this._dragging=!0}};a.prototype.onMouseMove=function(a){this.isActive()&&(this._ptPrevious.assign(this._ptCurrent),this._ptCurrent.assign(a.getPosition()),this._dragging&&!this._ptCurrent.equals(this._ptPrevious)&&(++this._dragCount,1===this._dragCount&&this._viewer.trigger("beginInteraction")))};a.prototype.onMouseUp=function(a){this._buttonModifierActive&&this.stopInteraction();this._dragging=!1;this._dragCount=0};a.prototype.stopInteraction=
function(){this._viewer.trigger("endInteraction");this._dragging=!1;this._dragCount=0;this._buttonModifierActive=!1};a.prototype.isDragging=function(){return this._dragging};a.prototype.isActive=function(){return(this._buttonModifierActive||null!==this._primaryTouchId)&&!this._isDoubleClick&&!this._viewer.getContextMenuStatus()};a.prototype.onTouchStart=function(a){if(null===this._primaryTouchId){this._primaryTouchId=a.getId();var b=a.getPosition();b=new d.Event.MouseInputEvent(b.x,b.y,d.Button.None,
a.getButtons(),d.KeyModifiers.None,d.MouseInputType.Down);this.onMouseDown(b)}a.setHandled(this.setHandled())};a.prototype.onTouchMove=function(a){if(this._primaryTouchId===a.getId()){var b=a.getPosition();b=new d.Event.MouseInputEvent(b.x,b.y,d.Button.None,a.getButtons(),d.KeyModifiers.None,d.MouseInputType.Move);this.onMouseMove(b)}a.setHandled(this.setHandled())};a.prototype.onTouchEnd=function(a){if(this._primaryTouchId===a.getId()){var b=a.getPosition();b=new d.Event.MouseInputEvent(b.x,b.y,
d.Button.None,a.getButtons(),d.KeyModifiers.None,d.MouseInputType.Up);this.onMouseUp(b);this._primaryTouchId=null}a.setHandled(this.setHandled())};a.prototype.addMapping=function(a,b){void 0===b&&(b=d.KeyModifiers.None);this._mapping.push(new g(a,b))};a.prototype.clearMapping=function(){this._mapping=[]};a.prototype.setMapping=function(a,b){void 0===b&&(b=d.KeyModifiers.None);this._mapping=[];this._mapping.push(new g(a,b))};a.prototype.checkMapping=function(a){if(0===this._mapping.length)return!0;
for(var b=0,c=this._mapping;b<c.length;b++){var d=c[b];if(d.getButton()===a.getButton()&&d.getModifier()===a.getModifiers())return!0}return!1};a.prototype.setHandled=function(){return!1};a.prototype.onDeactivate=function(){var a=this.stopInteraction();this._primaryTouchId=null;return a};return a}();h.OperatorBase=a})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){var c=a.call(this)||this;c._stage=0;c._finalized=!1;c._uniqueId="";c._positions=[];c._name="";c._measurementValue=0;c._unitMultiplier=1;c._textShape=new h.Shape.TextBox;c._visibility=!0;c._positions=[];c._lineShapes=[];c._viewer=b;return c}__extends(c,a);c.prototype.getName=function(){return this._name};c.prototype.setName=function(b){this._name=b};c.prototype._getStage=function(){return this._stage};c.prototype._nextStage=function(){this._stage++};
c.prototype._setId=function(b){this._uniqueId=b};c.prototype._getId=function(){return this._uniqueId};c.prototype.adjust=function(b){b};c.prototype._isFinalized=function(){return this._finalized};c.prototype.update=function(){};c.prototype.draw=function(){this.update()};c.prototype.setVisibility=function(b){this._visibility=b;this.draw();b?this._viewer.trigger("measurementShown",this):this._viewer.trigger("measurementHidden",this)};c.prototype.getVisibility=function(){return this._visibility};c.prototype.toJson=
function(){return{}};c.prototype.forJson=function(){return this.toJson()};c.prototype.getMeasurementValue=function(){return this._measurementValue};c.prototype.getUnitMultiplier=function(){return this._unitMultiplier};c.prototype.setMeasurementText=function(b){this._textShape.setTextString(b)};c.prototype.getMeasurementText=function(){return this._textShape.getTextString()};c.prototype._setMeasurementValue=function(b){this._measurementValue=b/this._unitMultiplier;this.setMeasurementText(d.Util.formatWithUnit(this._measurementValue,
this._unitMultiplier));this._viewer.trigger("measurementValueSet",this)};c._serializePointArray=function(b){for(var a=[],c=0;c<b.length;c++)a.push(b[c].toJson());return a};c._constructPointArray=function(b){for(var a=[],c=0;c<b.length;c++){var e=d.Point3.fromJson(b[c]);a.push(e)}return a};return c}(h.MarkupItem);g.MeasureMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function c(b){b=a.call(this,b)||this;b._rectangle=new d.Markup.Shape.Rectangle;b._markupHandle=null;b._dim=new d.Point2(0,0);b.initialPosition=new d.Point2(0,0);b.currentPosition=new d.Point2(0,0);b.min=new d.Point2(0,0);b.max=new d.Point2(0,0);b._name="_RectangleMarkup";b._rectangle.setFillOpacity(0);return b}__extends(c,a);c.prototype.draw=function(){this._viewer.markupManager.getRenderer().drawRectangle(this._rectangle)};c.prototype.updateCurrentPosition=
function(b){this.currentPosition.assign(b);this._rectangle.setStrokeColor(this.initialPosition.x<this.currentPosition.x?d.Color.red():d.Color.blue());this.min.assign(this.initialPosition);this.max.assign(this.currentPosition);this.max.x<this.min.x&&(b=this.max.x,this.max.x=this.min.x,this.min.x=b);this.max.y<this.min.y&&(b=this.max.y,this.max.y=this.min.y,this.min.y=b);this._dim.assign(this.max);this._dim.subtract(this.min);this._updateRectangleVertices()};c.prototype._updateRectangleVertices=function(){this._rectangle.setPosition(this.min);
this._rectangle.setSize(this._dim)};c.prototype.activate=function(b){this.initialPosition.assign(b);this.currentPosition.assign(b);this.min.assign(b);this.max.assign(b);this._dim.set(0,0);this._rectangle.setStrokeWidth(1);this._updateRectangleVertices();this._markupHandle=this._viewer.markupManager.registerMarkup(this)};c.prototype.deactivate=function(){this.initialPosition.set(0,0);this.currentPosition.set(0,0);this.min.set(0,0);this.max.set(0,0);this._dim.set(0,0);this._rectangle.setStrokeWidth(0);
this._updateRectangleVertices();var b=this._viewer.markupManager;null!==this._markupHandle&&(b.unregisterMarkup(this._markupHandle),this._markupHandle=null);b.refreshMarkup()};c.prototype.isActive=function(){return null!==this._markupHandle};return c}(d.Markup.Measure.MeasureMarkup),a=function(a){function c(b){var c=a.call(this,b)||this;c._forceEffectiveSceneVisibilityMask=d.SelectionMask.None;c._rectangleMarkup=new g(b);c._incrementalSelection=d.Util.IncrementalSelection.create("SelectionManager",
b);b.setCallbacks({_resetAssemblyTreeBegin:function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.clearSelection()];case 1:return b.sent(),[2,this.waitForIdle()]}})})},selectionArray:function(b){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return 0!==b.length?[3,2]:[4,this._incrementalSelection.stopSelection()];case 1:a.sent(),a.label=2;case 2:return[2]}})})}});return c}
__extends(c,a);c.prototype.getForceEffectiveSceneVisibilityMask=function(){return this._forceEffectiveSceneVisibilityMask};c.prototype.setForceEffectiveSceneVisibilityMask=function(b){this._forceEffectiveSceneVisibilityMask=b};c.prototype.hasActiveSelection=function(){return!this._incrementalSelection.isIdle()};c.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,this._incrementalSelection.waitForIdle()]})})};c.prototype.clearSelection=
function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,this._incrementalSelection.clearSelection()]})})};c.prototype._allowSelection=function(b,a){return b.x===a.x||b.y===a.y?!1:!0};c.prototype._createBeginConfig=function(b,a,c){var f=new d.IncrementalPickConfig;f.forceEffectiveSceneVisibilityMask=this._forceEffectiveSceneVisibilityMask;f.ignoreCuttingSections=!1;f.ignoreUnrequestedInstances=!0;c&&(f.mustBeFullyContained=!0);return{pickConfig:f,areaCssMin:b,
areaCssMax:a}};c.prototype._performSelection=function(b){return __awaiter(this,void 0,void 0,function(){var a,c,e,g,h;return __generator(this,function(f){switch(f.label){case 0:return a=this._rectangleMarkup.min.copy(),c=this._rectangleMarkup.max.copy(),e=this._rectangleMarkup.initialPosition.x<this._rectangleMarkup.currentPosition.x,b?[4,this.clearSelection()]:[3,2];case 1:f.sent(),f.label=2;case 2:if(!this._allowSelection(a,c))return[2];g=this._createBeginConfig(a,c,e);f.label=3;case 3:return f.trys.push([3,
5,,6]),[4,this._incrementalSelection.performSelection(g)];case 4:return[2,f.sent()];case 5:h=f.sent();if(!(h instanceof d.SelectionInvalidatedError))throw h;return[3,6];case 6:return[2]}})})};c.prototype.setHandled=function(){return!0};c.prototype.onKeyUp=function(b){b.getKeyCode()===d.KeyCode.Escape&&this.clearSelection()};c.prototype.onMouseDown=function(b){a.prototype.onMouseDown.call(this,b);this.isActive()&&(b.setHandled(!0),this._rectangleMarkup.isActive()&&this._rectangleMarkup.deactivate(),
this._rectangleMarkup.activate(b.getPosition()))};c.prototype.onMouseMove=function(b){a.prototype.onMouseMove.call(this,b);this.isActive()&&this._rectangleMarkup.isActive()&&(b.setHandled(!0),this._rectangleMarkup.updateCurrentPosition(b.getPosition()),this._viewer.markupManager.refreshMarkup())};c.prototype.onMouseUp=function(b){if(this.isActive()&&this._rectangleMarkup.isActive()){b.setHandled(!0);this._rectangleMarkup.updateCurrentPosition(b.getPosition());var c=!b.controlDown();this._performSelection(c)}this._rectangleMarkup.isActive()&&
this._rectangleMarkup.deactivate();a.prototype.onMouseUp.call(this,b)};return c}(h.OperatorBase);h.AreaSelectionOperator=a})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){var b=a.call(this,c)||this;b._axisTriad=c.view.getAxisTriad();b._pickConfig=new d.PickConfig(d.SelectionMask.Face);b._pickConfig.restrictToOverlays=!0;return b}__extends(e,a);e.prototype.onMouseUp=function(c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(f){switch(f.label){case 0:if(!(this._axisTriad.getEnabled()&&25>d.Point2.subtract(this._ptFirst,this._ptCurrent).squaredLength()&&this._axisTriad.insideOverlay(c.getPosition())))return[3,
3];c.setHandled(!0);return[4,this._viewer.view.pickFromPoint(this._ptFirst,this._pickConfig)];case 1:return b=f.sent(),[4,this._axisTriad.onClickSelection(b)];case 2:f.sent(),f.label=3;case 3:return a.prototype.onMouseUp.call(this,c),[2]}})})};return e}(h.OperatorBase);h.AxisTriadOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){return function(a,c,b,d,g){this.section=a;this.node=c;this.planeIndex=b;this.plane=d;this.selectionPosition=g;this.origPlaneD=d.d}}(),a=function(a){function c(b,c){b=a.call(this,b)||this;b._context=null;b._cuttingManager=c;return b}__extends(c,a);c.prototype.onMouseDown=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return a.prototype.onMouseDown.call(this,b),null===this._context&&this.isActive()&&
this._cuttingManager.hasActiveCuttingSection()?[4,this._startSelection(b)]:[3,2];case 1:c.sent(),b.setHandled(null!==this._context),c.label=2;case 2:return[2]}})})};c.prototype.onMouseMove=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:a.prototype.onMouseMove.call(this,b);c=this._context;if(!this.isActive()||null===c)return[3,2];b.setHandled(!0);return[4,this._updatePlane(b.getPosition(),c,!1)];case 1:d.sent(),this._viewer.trigger("cuttingPlaneDrag",
c.section,c.planeIndex),d.label=2;case 2:return[2]}})})};c.prototype._updatePlane=function(b,a,c){return __awaiter(this,void 0,void 0,function(){var f,e,g,k,h,r,u,t,v;return __generator(this,function(l){switch(l.label){case 0:f=a.selectionPosition;e=a.plane.normal.copy().add(a.selectionPosition);g=this._viewer.view.unprojectPoint(b,0);k=this._viewer.view.unprojectPoint(b,.5);if(null===g||null===k)return[3,3];h=d.Util.lineLineIntersect(f,e,g,k);if(null===h)return[3,2];r=d.Point3.subtract(h,a.selectionPosition);
u=0>d.Point3.dot(r,a.plane.normal)?r.length():-r.length();a.plane.d=a.origPlaneD+u;t=a.plane.normal.copy().scale(-u);v=(new d.Matrix).setTranslationComponent(t.x,t.y,t.z);return[4,a.section.updatePlane(a.planeIndex,a.plane,v,c,!1)];case 1:l.sent(),l.label=2;case 2:this._cuttingManager.delayCapping(),l.label=3;case 3:return[2]}})})};c.prototype.onMouseUp=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:c=this._context;if(!this.isActive()||
null===c)return[3,2];b.setHandled(!0);return[4,this._updatePlane(b.getPosition(),c,!0)];case 1:d.sent(),this._viewer.trigger("cuttingPlaneDragEnd",c.section,c.planeIndex),d.label=2;case 2:return this._context=null,a.prototype.onMouseUp.call(this,b),[2]}})})};c.prototype.setHandled=function(){return this.isActive()&&null!==this._context};c.prototype._startSelection=function(b){return __awaiter(this,void 0,void 0,function(){var a,c,e,h,m,p,q,r;return __generator(this,function(f){switch(f.label){case 0:return this._context=
null,a=b.getPosition(),c=d.SelectionMask.Face|d.SelectionMask.Line,e=new d.PickConfig(c),e.ignoreCappingGeometry=!0,e.forceEffectiveSceneVisibilityMask=d.SelectionMask.Face,[4,this._viewer.view.compositePickFromPoint(a,e)];case 1:h=f.sent();m=h.fetchMostRelevant(c);if(null===m)return[2];p=m.getNodeId();q=this._cuttingManager.getCuttingSectionFromNodeId(p);null!==q&&(r=q.getPlaneIndexByNodeId(p),this._context=new g(q,p,r,q.getPlane(r),m.getPosition()),this._cuttingManager.delayCapping(),this._viewer.trigger("cuttingPlaneDragStart",
q,r));return[2]}})})};return c}(h.OperatorBase);h.CuttingPlaneOperator=a})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){var b=a.call(this,c)||this;b._draggingAvatar=!1;b._restrictToAvatar=!0;b._floorLocked=!1;b._manager=c.floorplanManager;return b}__extends(e,a);e.prototype.onMouseDown=function(c){return __awaiter(this,void 0,void 0,function(){var b,f,e,g;return __generator(this,function(k){switch(k.label){case 0:a.prototype.onMouseDown.call(this,c);if(!this._manager.isActive())return[2];b=c.getPosition();if(this._restrictToAvatar)return[3,1];f=this._manager.insideOverlay(b);
return[3,3];case 1:return e=new d.PickConfig,e.restrictToOverlays=!0,[4,this._viewer.view.pickFromPoint(b,e)];case 2:g=k.sent(),f=g.getNodeId()===this._manager.getAvatarNodeId(),k.label=3;case 3:if(!f)return[3,5];this._draggingAvatar=!0;this._floorLocked=this._manager.getFloorLock();return[4,this._manager.setFloorLock(!0)];case 4:k.sent(),this._manager.snapAvatarToPoint(b),c.setHandled(!0),k.label=5;case 5:return[2]}})})};e.prototype.onMouseUp=function(c){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(b){switch(b.label){case 0:return a.prototype.onMouseUp.call(this,c),this._draggingAvatar?[4,this._manager.setFloorLock(this._floorLocked)]:[3,2];case 1:b.sent(),b.label=2;case 2:return this._draggingAvatar=!1,[2]}})})};e.prototype.onMouseMove=function(c){a.prototype.onMouseMove.call(this,c);this._manager.isActive()&&this._draggingAvatar&&(c.setHandled(!0),c=c.getPosition(),this._manager.insideOverlay(c)&&this._manager.snapAvatarToPoint(c))};e.prototype.restrictToAvatar=function(a){this._restrictToAvatar=
a};return e}(h.OperatorBase);h.FloorplanOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){var b=a.call(this,c)||this;b._draggingHandle=!1;b._newRotationMatrix=new d.Matrix;b._translation=d.Point3.zero();b._newTranslation=d.Point3.zero();b._nodeIdGroupMap=new Map;b._groupIdCount=0;b._activeChildrenGroupIds=new Map;b._initialLocalNodeMatrices=[];b._newLocalNodeMatrices=[];b._trackedPoints=[];b._trackedPointsPositions=[];b._trackedPointCount=0;b._previousContextClick=!1;b._overlayIndex=null;b._activeHandleNodeId=null;b._handleEventType=
d.HandleEventType.Translate;b._highlightedHandleId=null;b._handleSize=1;b._explodeActive=!1;b._measureActive=!1;b._settingMatrixInProgress=!1;b._handleMarkup=new d.Markup.HandleMarkup(c);b._pickConfig=new d.PickConfig(d.SelectionMask.Face);b._pickConfig.restrictToOverlays=!0;c.setCallbacks({explode:function(a){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return(this._explodeActive=0<a)?[4,this.removeHandles()]:[3,2];case 1:b.sent(),b.label=
2;case 2:return[2]}})})},measurementBegin:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._measureActive=!0,[4,this.removeHandles()];case 1:return b.sent(),[2]}})})},measurementCreated:function(){b._measureActive=!1}});return b}__extends(e,a);e.prototype.setAxisMeshData=function(a){return this._handleMarkup.setAxisMeshData(a)};e.prototype.setPlaneMeshData=function(a){return this._handleMarkup.setPlaneMeshData(a)};e.prototype.setViewPlaneMeshData=
function(a){return this._handleMarkup.setViewPlaneMeshData(a)};e.prototype.setRotateMeshData=function(a){return this._handleMarkup.setRotateMeshData(a)};e.prototype.addTrackedPoint=function(a){var b=this._trackedPointCount;this._trackedPoints[b]=a.copy();this._trackedPointsPositions[b]=a.copy();++this._trackedPointCount;return b};e.prototype.getTrackedPoints=function(){return this._trackedPointsPositions};e.prototype.clearTrackedPoints=function(){this._trackedPoints.length=0;this._trackedPointCount=
this._trackedPointsPositions.length=0};e.prototype.isEnabled=function(){return!this._explodeActive&&!this._measureActive&&!this._viewer.sheetManager.isDrawingSheetActive()};e.prototype._guardEnabled=function(){if(!this.isEnabled()){var a=this._explodeActive?"Handles are not enabled when the model is exploded":this._measureActive?"Handles are not enabled while a measurement is in progress.":this._viewer.sheetManager.isDrawingSheetActive()?"Handles are not enabled for 2d drawings.":"Handles are not enabled.";
throw new d.CommunicatorError(a);}};e.prototype.setHandleSize=function(a){this._handleSize=a};e.prototype.addHandles=function(a,b,d){void 0===b&&(b=null);void 0===d&&(d=null);return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(f){switch(f.label){case 0:return this._previousContextClick=!1,this._guardEnabled(),b?[3,2]:[4,this._viewer.model.getNodesBounding(a)];case 1:return c=f.sent(),[2,this.addHandles(a,c.center())];case 2:return null===d&&(d=this.generateGroupId()),
this._nodeIdGroupMap.set(d,a),[2,this._handleMarkup.addHandles(b,this._handleSize,d)]}})})};e.prototype.generateGroupId=function(){return this._groupIdCount++};e.prototype._massageGroupId=function(a){return null===a?d.Markup.HandleMarkup.defaultGroupId:a};e.prototype.addAxisTranslationHandle=function(a,b,d,e,g){void 0===e&&(e=null);void 0===g&&(g=null);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._previousContextClick=!1;this._guardEnabled();return[2,this._handleMarkup.addAxisTranslationHandle(a,
b,d,e,this._massageGroupId(g))]})})};e.prototype.addAxisRotationHandle=function(a,b,d,e,g){void 0===e&&(e=null);void 0===g&&(g=null);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._previousContextClick=!1;this._guardEnabled();return[2,this._handleMarkup.addRotateHandle(a,b,d,e,this._massageGroupId(g))]})})};e.prototype.addPlaneTranslationHandle=function(a,b,d,e,g,h){void 0===g&&(g=null);void 0===h&&(h=null);return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(c){this._previousContextClick=!1;this._guardEnabled();return[2,this._handleMarkup.addPlaneTranslationHandle(a,b,d,e,g,this._massageGroupId(h))]})})};e.prototype.addViewPlaneTranslationHandle=function(a,b,d){void 0===d&&(d=null);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._previousContextClick=!1;this._guardEnabled();return[2,this._handleMarkup.addViewPlaneHandle(a,b,this._massageGroupId(d))]})})};e.prototype.setNodeIds=function(a,b){void 0===b&&
(b=null);this._nodeIdGroupMap.set(this._massageGroupId(b),a)};e.prototype.getNodeIds=function(a){void 0===a&&(a=null);a=this._nodeIdGroupMap.get(this._massageGroupId(a));return void 0===a?[]:a.slice()};e.prototype.showHandles=function(){this._handleMarkup.showOverlay()};e.prototype.updatePosition=function(a,b,d,e){void 0===e&&(e=null);return this._handleMarkup.updatePosition(a,b,d,this._massageGroupId(e),this._activeChildrenGroupIds)};e.prototype.getPosition=function(){var a=this._handleMarkup.getHandleNodeIds();
return 0<a.length&&(a=this._handleMarkup.getPosition(a[0]),null!==a)?a.copy():null};e.prototype.removeHandles=function(){this._newRotationMatrix=new d.Matrix;this._translation=d.Point3.zero();this._highlightedHandleId=null;this._nodeIdGroupMap.clear();this._groupIdCount=0;return this._handleMarkup.removeHandles()};e.prototype.getTranslation=function(){return this._translation};e.prototype._initLocalNodeMatrices=function(a){var b=this._viewer.model;this._initialLocalNodeMatrices=[];for(var c=0;c<a.length;c++)this._initialLocalNodeMatrices.push(b.getNodeMatrix(a[c]))};
e.prototype._getHandleEventType=function(a){return this._handleMarkup.getHandleType(a)===d.HandleType.Rotate?d.HandleEventType.Rotate:d.HandleEventType.Translate};e.prototype._rotate=function(a,b,f,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(g){switch(g.label){case 0:if(!this._draggingHandle||this._settingMatrixInProgress)return[2];c=this.getNodeIds(e);return[4,this._genericTransform(a,b,d.Point3.zero(),f,c,e)];case 1:return g.sent(),this._viewer.trigger("handleEvent",
d.HandleEventType.Rotate,c,this._initialLocalNodeMatrices,this._newLocalNodeMatrices),[2]}})})};e.prototype._translate=function(a,b,f){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(e){switch(e.label){case 0:if(!this._draggingHandle||this._settingMatrixInProgress)return[2];c=this.getNodeIds(f);return[4,this._genericTransform(d.Point3.zero(),0,a,b,c,f)];case 1:return e.sent(),this._viewer.trigger("handleEvent",d.HandleEventType.Translate,c,this._initialLocalNodeMatrices,
this._newLocalNodeMatrices),[2]}})})};e.prototype._genericTransform=function(a,b,f,e,g,h){return __awaiter(this,void 0,void 0,function(){var c,k,l,n,u,t,v,w,y,x,z,B,A,D,C,E;return __generator(this,function(m){switch(m.label){case 0:this._settingMatrixInProgress=!0;c=this._viewer.model;k=new d.Matrix;this._newTranslation=f;0<a.squaredLength()&&(k=this._getRotationMatrix(a,d.Point3.zero(),b),this._newRotationMatrix=k.copy());l=[];l.push(this.updatePosition(this._newTranslation,this._newRotationMatrix,
!1,h));this._newLocalNodeMatrices=[];for(n=0;n<g.length;n++)u=this._newTranslation.copy(),t=g[n],v=this._initialLocalNodeMatrices[n].copy(),w=a.copy(),y=e.copy(),x=void 0,z=c.getNodeParent(t),null!==z?(x=c.getNodeNetMatrix(z),B=d.Matrix.inverse(x),null!==B&&(B.transform(y,y),B.setTranslationComponent(0,0,0),B.transform(w,w),B.transform(u,u))):x=null,0<a.squaredLength()&&(k=this._getRotationMatrix(w,y,x&&0>x.upperLeft3x3Determinant()?-b:b),v=d.Matrix.multiply(v,k)),v.setTranslationComponent(v.m[12]+
u.x,v.m[13]+u.y,v.m[14]+u.z),l.push(c.setNodeMatrix(t,v)),this._newLocalNodeMatrices.push(v);A=this._newRotationMatrix.copy();A.setTranslationComponent(f.x,f.y,f.z);for(n=0;n<this._trackedPoints.length;++n)D=this._trackedPoints[n].copy(),C=d.Point3.subtract(D,e),A.transform(C,C),E=d.Point3.add(C,e),this._trackedPointsPositions[n]=E;return[4,d.Util.waitForAll(l)];case 1:return m.sent(),this._settingMatrixInProgress=!1,[2]}})})};e.prototype._testRotate=function(a,b,f){void 0===f&&(f=null);return __awaiter(this,
void 0,void 0,function(){var c,e;return __generator(this,function(g){switch(g.label){case 0:f=this._massageGroupId(f);c=this._getActiveNodeIdByGroupId(f);if(null===c)return[3,3];e=this._handleMarkup.getPosition(c);if(null===e)return[2];this._startDragging(c,d.HandleEventType.Rotate);return[4,this._rotate(a,b,e,f)];case 1:return g.sent(),[4,this._stopDragging()];case 2:g.sent(),g.label=3;case 3:return[2]}})})};e.prototype._testTranslate=function(a,b){void 0===b&&(b=null);return __awaiter(this,void 0,
void 0,function(){var c;return __generator(this,function(f){switch(f.label){case 0:b=this._massageGroupId(b);c=this._getActiveNodeIdByGroupId(b);if(null===c)return[3,3];this._startDragging(c,d.HandleEventType.Translate);return[4,this._translate(a,d.Point3.zero(),b)];case 1:return f.sent(),[4,this._stopDragging()];case 2:f.sent(),f.label=3;case 3:return[2]}})})};e.prototype._getActiveNodeIdByGroupId=function(a){for(var b=this._handleMarkup.getHandleNodeIds(),c=0;c<b.length;++c){var d=b[c];if(this._handleMarkup.getHandleGroupId(d)===
a)return d}return null};e.prototype._startDragging=function(a,b){var c=this;this._activeHandleNodeId=a;this._handleEventType=b;var d=this._handleMarkup.getHandleGroupId(a),e=this.getNodeIds(d),g=new Map;this._nodeIdGroupMap.forEach(function(b,a){a!==d&&b.forEach(function(b){for(var d=c._viewer.model.getNodeParent(b);null!==d;){if(-1!==e.indexOf(d)){g.set(a,b);break}d=c._viewer.model.getNodeParent(d)}})});this._activeChildrenGroupIds=g;0<e.length&&(this._initLocalNodeMatrices(e),this._viewer.trigger("handleEventStart",
this._handleEventType,e,this._initialLocalNodeMatrices),this._draggingHandle=!0)};e.prototype._stopDragging=function(){return __awaiter(this,void 0,void 0,function(){var a,b;return __generator(this,function(c){switch(c.label){case 0:this._draggingHandle=!1;if(null===this._activeHandleNodeId)return[3,2];a=this._handleMarkup.getHandleGroupId(this._activeHandleNodeId);return[4,this.updatePosition(this._newTranslation,this._newRotationMatrix,!0,a)];case 1:c.sent(),b=this.getNodeIds(a),this._activeHandleNodeId=
null,this._activeChildrenGroupIds.clear(),this._viewer.trigger("handleEventEnd",this._handleEventType,b,this._initialLocalNodeMatrices,this._newLocalNodeMatrices),this._newRotationMatrix=new d.Matrix,this._handleMarkup.resetTranslation(),this._translation.add(this._newTranslation),this._newTranslation=d.Point3.zero(),this._trackedPoints=this._trackedPointsPositions.slice(),c.label=2;case 2:return[2]}})})};e.prototype.onMouseDown=function(c){return __awaiter(this,void 0,void 0,function(){var b,d,e,
g;return __generator(this,function(f){switch(f.label){case 0:return a.prototype.onMouseDown.call(this,c),this._overlayIndex=null,[4,this._viewer.view.pickFromPoint(c.getPosition(),this._pickConfig)];case 1:return b=f.sent(),b.isNodeEntitySelection()&&(d=b.getNodeId(),e=this._viewer.model.getNodeName(d),null!==e&&"handle-"===e.slice(0,7)&&(c.setHandled(!0),g=this._getHandleEventType(d),this._startDragging(d,g))),[2]}})})};e.prototype._onHandleDrag=function(){if(null!==this._activeHandleNodeId){var a=
this._viewer.view.getCamera();d.Point3.zero();d.Point3.zero();var b=this._handleMarkup.getHandleType(this._activeHandleNodeId),f=this._handleMarkup.getVector(this._activeHandleNodeId),e=this._handleMarkup.getPosition(this._activeHandleNodeId);if(null!==b&&null!==e){var g=this._handleMarkup.getHandleGroupId(this._activeHandleNodeId);switch(b){case d.HandleType.Axis:null!==f&&(a=this._getTranslationComponent(e,f,0,g),this._translate(a,e,g));break;case d.HandleType.Plane:null!==f&&(a=this._getTranslationComponent(e,
f,1,g),this._translate(a,e,g));break;case d.HandleType.ViewPlane:f=a.getTarget();a=a.getPosition();a=d.Point3.subtract(a,f).normalize();a=this._getTranslationComponent(e,a,2,g);this._translate(a,e,g);break;case d.HandleType.Rotate:null!==f&&(this._handleMarkup.getGroupIdRotationMatrix(g).copy().setTranslationComponent(0,0,0).transform(f,f),a=this._getRotationAngle(e,f),this._rotate(f,a,e,g));break;default:d.Util.TypeAssertNever(b)}}}};e.prototype.onMouseMove=function(c){return __awaiter(this,void 0,
void 0,function(){var b;return __generator(this,function(d){switch(d.label){case 0:a.prototype.onMouseMove.call(this,c);if(!this._draggingHandle||null===this._activeHandleNodeId)return[3,1];this._onHandleDrag();return[3,4];case 1:return[4,this._viewer.view.pickFromPoint(c.getPosition(),this._pickConfig)];case 2:return b=d.sent(),[4,this._highlightHandle(b)];case 3:d.sent(),d.label=4;case 4:return[2]}})})};e.prototype.onMouseUp=function(c){this._draggingHandle||!(3>this._dragCount)||c.getButton()===
d.Button.Right||this._previousContextClick||this._viewer.getContextMenuStatus()||0!==this._overlayIndex&&null!==this._overlayIndex||this.removeHandles();this._previousContextClick=c.getButton()===d.Button.Right||this._viewer.getContextMenuStatus();this._draggingHandle&&this._stopDragging();a.prototype.onMouseUp.call(this,c)};e.prototype.setHandled=function(){return this._draggingHandle};e.prototype._getClosestPoint=function(a,b,f){var c=a.copy();a=a.copy().add(b);b=this._viewer.view.unprojectPoint(f,
0);f=this._viewer.view.unprojectPoint(f,.5);return null!==b&&null!==f?d.Util.lineLineIntersect(c,a,b,f):null};e.prototype._getTranslationComponent=function(a,b,f,e){2!==f&&this._handleMarkup.getGroupIdRotationMatrix(e).copy().setTranslationComponent(0,0,0).transform(b,b);var c=e=null;1===f||2===f?(e=this._getPlaneIntersectionPoint(a,b,this._ptFirst),null!==e&&(c=this._getPlaneIntersectionPoint(e,b,this._ptCurrent))):0===f&&(e=this._getClosestPoint(a,b,this._ptFirst),null!==e&&(c=this._getClosestPoint(e,
b,this._ptCurrent)));return null!==c&&null!==e?d.Point3.subtract(c,e):d.Point3.zero()};e.prototype._clearHighlightedHandle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return null===this._highlightedHandleId?[3,2]:[4,this._viewer.model.unsetNodesFaceColor([this._highlightedHandleId])];case 1:a.sent(),this._highlightedHandleId=null,a.label=2;case 2:return[2]}})})};e.prototype._highlightHandle=function(a){return __awaiter(this,
void 0,void 0,function(){var b,c,e;return __generator(this,function(f){switch(f.label){case 0:if(!a.isNodeEntitySelection()||a.overlayIndex()!==d.BuiltinOverlayIndex.Handles)return[3,2];b=this._viewer.model;c=b.getNodeName(a.getNodeId());if(null===c||"handle-"!==c.slice(0,7))return[3,2];e=a.getNodeId();return this._highlightedHandleId===e?[2]:[4,this._clearHighlightedHandle()];case 1:return f.sent(),this._highlightedHandleId=e,b.setNodesFaceColor([this._highlightedHandleId],d.Color.green()),[2];case 2:return[2,
this._clearHighlightedHandle()]}})})};e.prototype._getPlaneIntersectionPoint=function(a,b,f){var c=this._viewer.view.unprojectPoint(f,0);f=this._viewer.view.unprojectPoint(f,.5);if(null===c||null===f)return null;c=new d.Ray(c,f.copy().subtract(c));a=d.Plane.createFromPointAndNormal(a,b);b=d.Point3.zero();return a.intersectsRay(c,b)?b:null};e.prototype._getRotationAngle=function(a,b){console.assert(null!==a);var c=this._getPlaneIntersectionPoint(a,b,this._ptFirst),e=this._getPlaneIntersectionPoint(a,
b,this._ptCurrent);if(null===c||null===e)return 0;c=d.Point3.subtract(c,a).normalize();a=d.Point3.subtract(e,a).normalize();e=d.Point3.dot(c,a);e=180*Math.acos(e)/Math.PI;0>d.Point3.dot(d.Point3.cross(c,a),b)&&(e=-e);return e};e.prototype._getRotationMatrix=function(a,b,f){var c=(new d.Matrix).setTranslationComponent(-b.x,-b.y,-b.z);a=d.Matrix.createFromOffAxisRotation(a,f);b=(new d.Matrix).setTranslationComponent(b.x,b.y,b.z);return d.Matrix.multiply(d.Matrix.multiply(c,a),b)};return e}(h.OperatorBase);
h.HandleOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){var b=a.call(this,c)||this;b._navCube=c.view.getNavCube();b._pickConfig=new d.PickConfig(d.SelectionMask.Face);b._pickConfig.restrictToOverlays=!0;return b}__extends(e,a);e.prototype.onMouseMove=function(c){return __awaiter(this,void 0,void 0,function(){var b,d,e;return __generator(this,function(f){switch(f.label){case 0:return a.prototype.onMouseMove.call(this,c),b=c.getPosition(),d=this._dragging&&1<this._dragCount,this._navCube.getEnabled()&&
!d&&this._navCube.insideOverlay(b)?[4,this._viewer.view.pickFromPoint(b,this._pickConfig)]:[3,2];case 1:e=f.sent(),this._navCube.onMoveSelection(e),f.label=2;case 2:return[2]}})})};e.prototype.onMouseUp=function(c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(f){switch(f.label){case 0:return this._navCube.getEnabled()&&25>d.Point2.subtract(this._ptFirst,this._ptCurrent).squaredLength()?[4,this._viewer.view.pickFromPoint(this._ptFirst,this._pickConfig)]:[3,
3];case 1:return b=f.sent(),[4,this._navCube.onClickSelection(b)];case 2:f.sent(),f.label=3;case 3:return a.prototype.onMouseUp.call(this,c),[2]}})})};return e}(h.OperatorBase);h.NavCubeOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c,b){c=a.call(this,c)||this;c._insertNoteButton=d.Button.Left;c._callbackFlag=!1;c._noteTextManager=b;return c}__extends(e,a);e.prototype.onMouseDown=function(c){var b=this;a.prototype.onMouseDown.call(this,c);this.isActive()&&(this._callbackFlag||(this._viewer.setCallbacks({explode:function(a){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this._noteTextManager.explode(a)];case 1:return b.sent(),
[2]}})})}}),this._callbackFlag=!0),this._dragging=!1)};e.prototype.onMouseUp=function(c){var b=this;if(this.isActive()){var f=new d.PickConfig(d.SelectionMask.Face);if(this._ptFirst.equals(this._ptCurrent)&&c.getButton()===this._insertNoteButton||null!==this._primaryTouchId)f=this._viewer.view.pickFromPoint(c.getPosition(),f).then(function(a){b._noteTextManager.selectPin(a)||b._noteTextManager.getExplodeActive()||b._noteTextManager.getIsolateActive()||0!==a.overlayIndex()||(a.isFaceSelection()&&new d.Markup.Note.NoteText(b._viewer,
b._noteTextManager,a.getPosition(),a.getFaceEntity().getNormal(),a.getNodeId()),c.setHandled(!0))}),f}a.prototype.onMouseUp.call(this,c)};e.prototype.getNoteTextElement=function(){return this._noteTextManager.getNoteTextElement()};e.prototype.setNoteTextElement=function(a){this._noteTextManager.setNoteTextElement(a)};e.prototype.checkPinInstance=function(a){return null!==this._noteTextManager.checkPinInstance(a)};return e}(h.OperatorBase);h.NoteOperator=g})(d.Operator||(d.Operator={}))})(Communicator||
(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){var b=a.call(this,c)||this;b._selectionButton=d.Button.Left;b._ignoreTransparency=!1;b._forceEffectiveSceneVisibilityMask=d.SelectionMask.None;b._incrementalSelection=d.Util.IncrementalSelection.create("SelectionManager",c);c.setCallbacks({_resetAssemblyTreeBegin:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.clearSelection()];case 1:return b.sent(),[2,this.waitForIdle()]}})})},
selectionArray:function(a){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return 0!==a.length?[3,2]:[4,this._incrementalSelection.stopSelection()];case 1:b.sent(),b.label=2;case 2:return[2]}})})}});return b}__extends(e,a);e.prototype.getForceEffectiveSceneVisibilityMask=function(){return this._forceEffectiveSceneVisibilityMask};e.prototype.setForceEffectiveSceneVisibilityMask=function(a){this._forceEffectiveSceneVisibilityMask=a};e.prototype.setIgnoreTransparency=
function(a){this._ignoreTransparency=a};e.prototype.getIgnoreTransparency=function(){return this._ignoreTransparency};e.prototype.hasActiveSelection=function(){return!this._incrementalSelection.isIdle()};e.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,this._incrementalSelection.waitForIdle()]})})};e.prototype.clearSelection=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,
this._incrementalSelection.clearSelection()]})})};e.prototype._createBeginConfig=function(a){var b=new d.IncrementalPickConfig;b.forceEffectiveSceneVisibilityMask=this._forceEffectiveSceneVisibilityMask;b.ignoreUnrequestedInstances=!0;return{pickConfig:b,rayCssOrigin:a,rayCssBoxRadius:10}};e.prototype._selectionPredicate=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,d;return __generator(this,function(f){switch(f.label){case 0:return b=this._viewer.model,c=a.getNodeId(),null===
c?[2,!1]:[4,b.getNodesHaveTransparency([c])];case 1:return d=f.sent()[0],[2,!d]}})})};e.prototype._performSelection=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,d=this;return __generator(this,function(f){b=this._createBeginConfig(a);c=this._ignoreTransparency?function(b){return d._selectionPredicate(b)}:null;return[2,this._incrementalSelection.performSelection(b,c)]})})};e.prototype.setHandled=function(){return!0};e.prototype.onKeyUp=function(a){a.getKeyCode()===d.KeyCode.Escape&&
this.clearSelection()};e.prototype.onMouseUp=function(c){var b=this;this.isActive()&&function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return(c.getButton()===this._selectionButton||null!==this._primaryTouchId)&&25>d.Point2.subtract(this._ptFirst,this._ptCurrent).squaredLength()?c.controlDown()?[3,2]:[4,this.clearSelection()]:[3,4];case 1:b.sent(),b.label=2;case 2:return[4,this._performSelection(c.getPosition())];case 3:b.sent(),b.label=
4;case 4:return[2]}})})}();a.prototype.onMouseUp.call(this,c)};return e}(h.OperatorBase);h.RayDrillSelectionOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c,b){c=a.call(this,c)||this;c._selectionButton=d.Button.Left;c._pickConfig=new d.PickConfig(d.SelectionMask.Face|d.SelectionMask.Line);c._forceEffectiveSceneVisibilityMask=null;c._doubleClickFitWorld=!0;c._noteTextManager=b;return c}__extends(e,a);e.prototype.setPickConfig=function(a){this._pickConfig=a.copy()};e.prototype.getPickConfig=function(){return this._pickConfig.copy()};e.prototype.getForceEffectiveSceneVisibilityMask=function(){return null!==
this._forceEffectiveSceneVisibilityMask?this._forceEffectiveSceneVisibilityMask:this._pickConfig.forceEffectiveSceneVisibilityMask};e.prototype.setForceEffectiveSceneVisibilityMask=function(a){this._forceEffectiveSceneVisibilityMask=a};e.prototype.getSelectionButton=function(){return this._selectionButton};e.prototype.setSelectionButton=function(a){this._selectionButton=a};e.prototype.onKeyUp=function(a){a.getKeyCode()===d.KeyCode.Escape&&this._viewer.selectionManager.clear()};e.prototype.onMouseUp=
function(c){var b=this;if(this.isActive()&&5>d.Point2.subtract(this._ptFirst,this._ptCurrent).length()&&(c.getButton()===this._selectionButton||null!==this._primaryTouchId)){var f=this._viewer.view,e=this._pickConfig;null!==this._forceEffectiveSceneVisibilityMask&&(e=e.copy(),e.forceEffectiveSceneVisibilityMask=this._forceEffectiveSceneVisibilityMask);f=f.pickFromPoint(this._ptCurrent,e).then(function(a){var f=null!==b._viewer.cuttingManager.getCuttingSectionFromNodeId(a.getNodeId()),e=b._noteTextManager.selectPin(a),
g=b._viewer.markupManager.pickMarkupItem(b._ptCurrent);if(g instanceof d.Markup.Redline.RedlineText)g.onSelect();e||f||null!==g||(a.isNodeSelection()?b._processSelectionClick(c,a):b._isDoubleClick||b._viewer.selectionManager.clear())});f}a.prototype.onMouseUp.call(this,c)};e.prototype.onDoubleClick=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return this._doubleClickFitWorld?[2,this._viewer.view.fitWorld()]:[2]})})};e.prototype.setDoubleClickFitWorldEnabled=
function(a){this._doubleClickFitWorld=a};e.prototype._getSelectionOrParentIfSelected=function(a){var b=this._viewer.model,c=a.getNodeId();if(!b.isNodeLoaded(c)||b.getNodeType(c)===d.NodeType.PmiBody)return a;var e=this._viewer.selectionManager,g=null;e.getSelectParentIfSelected()&&(g=e.containsParent(a));return null!==g?(b=d.Selection.SelectionItem.create(b.getNodeParent(g.getNodeId())),b.isNodeSelection()?b:a):e.contains(a)?(b=d.Selection.SelectionItem.create(b.getNodeParent(c)),b.isNodeSelection()?
b:a):a};e.prototype._processSelectionClick=function(a,b){var c=b.overlayIndex();if(0===c||null===c)c=this._viewer.selectionManager,a.controlDown()||a.commandDown()?c.toggle(b):(a=this._getSelectionOrParentIfSelected(b),c.set(a))};return e}(h.OperatorBase);h.SelectionOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function g(b,a){var c=new d.PickConfig(d.SelectionMask.Face);c.bimMask=b;c.ignoreOverlays=!0;null!==a&&(c.maxWorldDistance=a);return c}function a(b,a,c,e){return __awaiter(this,void 0,void 0,function(){var f,k,h;return __generator(this,function(l){switch(l.label){case 0:return f=new d.Ray(a,c),k=g(d.BimMask.Floor,e),[4,b.pickFromRay(f,k)];case 1:return h=l.sent(),h.isFaceSelection()?[2,h.getPosition()]:[2,null]}})})}function e(b,a,c,e){return __awaiter(this,void 0,void 0,
function(){var f,k,h;return __generator(this,function(l){switch(l.label){case 0:return f=new d.Ray(a,c.copy().normalize()),k=g(d.BimMask.Wall,e),[4,b.pickFromRay(f,k)];case 1:return h=l.sent(),h.isFaceSelection()?[2,h]:[2,null]}})})}var c=function(){function b(b){this._nearbyDoors=new Set;this._viewer=b}b.prototype._performSphereSelection=function(b,a,c){var f=d.Util.IncrementalSelection.create("View",this._viewer),e=new d.IncrementalPickConfig(d.SelectionMask.Face);e.bimMask=c;e.onlyStreamedInstances=
!0;e.ignoreUnrequestedInstances=!0;return f.performSelection({pickConfig:e,sphereCenter:b,sphereRadius:a})};b.prototype.updateNearbyDoors=function(b,a,c){return __awaiter(this,void 0,void 0,function(){var f,e,g,k,h,l,n,w,y,x,z;return __generator(this,function(m){switch(m.label){case 0:return[4,this._performSphereSelection(b,a,d.BimMask.Door)];case 1:f=m.sent();e=new Set;g=0;for(k=f;g<k.length;g++)h=k[g],l=h.getNodeId(),e.add(l);n=d.Util.setSubtraction(e,this._nearbyDoors);w=d.Util.setSubtraction(this._nearbyDoors,
e);y=d.Util.setToArray(n);x=d.Util.setToArray(w);z=this._viewer.model;z.setNodesOpacity(y,c);z.resetNodesOpacity(x);this._nearbyDoors=e;return[2]}})})};b.prototype.forgetNearbyDoors=function(){var b=d.Util.setToArray(this._nearbyDoors);this._nearbyDoors.clear();this._viewer.model.resetNodesOpacity(b)};return b}(),b=function(b){function f(a){var f=b.call(this,a)||this;f._elevationSpeed=0;f._rotationSpeed=0;f._viewAngle=90;f._zoomDistance=0;f._walkDistance=0;f._tilt=0;f._majorAxis=d.Axis.X;f._maxExtents=
0;f._walkActive=!1;f._activeWalk=new d.Util.CurrentAction(!0);f._bimModeEnabled=!1;f._synchronizedToggleBimMode=new d.Util.CurrentActionSync;f._initialInteractiveDrawLimitIncreaseStatus=!0;f._logical={floor:__assign({},h.CameraKeyboardWalkOperator.Bim.Default.FloorConfig),wall:__assign({},h.CameraKeyboardWalkOperator.Bim.Default.WallConfig),door:__assign({},h.CameraKeyboardWalkOperator.Bim.Default.DoorConfig)};f._effective={floor:__assign({},h.CameraKeyboardWalkOperator.Bim.Default.FloorConfig),wall:__assign({},
h.CameraKeyboardWalkOperator.Bim.Default.WallConfig),door:__assign({},h.CameraKeyboardWalkOperator.Bim.Default.DoorConfig)};f._doorCache=new c(a);f._downAxis=new d.Point3(0,-1,0);a.setCallbacks({subtreeLoaded:function(b,a){a===d.NodeSource.LoadModel&&f._updateSceneFloor()}});return f}__extends(f,b);f.prototype._updateSceneFloor=function(){var b=this._viewer.model.getViewAxes().upVector;console.assert(b.isAxis());this._downAxis=d.Point3.scale(b,-1)};f.prototype.isBimModeEnabled=function(){return this._bimModeEnabled};
f.prototype._enableBimMode=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._bimModeEnabled=!0,this._effective.floor=this._scaleAgainstModelUnit(this._logical.floor),this._effective.wall=this._scaleAgainstModelUnit(this._logical.wall),this._effective.door=this._scaleAgainstModelUnit(this._logical.door),this._updateSceneFloor(),[4,this._applyGravity()];case 1:return b.sent(),[4,this._updateNearbyDoors()];case 2:return b.sent(),
[2]}})})};f.prototype._disableBimMode=function(){this._bimModeEnabled=!1;this._doorCache.forgetNearbyDoors()};f.prototype.enableBimMode=function(){var b=this;return this._synchronizedToggleBimMode.set(function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this._enableBimMode()];case 1:return b.sent(),[2]}})})})};f.prototype.disableBimMode=function(){var b=this;return this._synchronizedToggleBimMode.set(function(){b._disableBimMode()})};
f.prototype.toggleBimMode=function(){var b=this;return this._synchronizedToggleBimMode.set(function(){return b._bimModeEnabled?b._disableBimMode():b._enableBimMode()})};f.prototype.onActivate=function(){return __awaiter(this,void 0,void 0,function(){var b,a,c,f,e;return __generator(this,function(g){switch(g.label){case 0:return this._viewer.view.setProjectionMode(d.Projection.Perspective),b=this._viewer.view,a=this,[4,b.getInteractiveDrawLimitIncreaseEnabled()];case 1:return a._initialInteractiveDrawLimitIncreaseStatus=
g.sent(),b.setInteractiveDrawLimitIncreaseEnabled(!1),this._calculateInitialPosition(),0!==this._maxExtents?[3,3]:[4,this.resetDefaultWalkSpeeds()];case 2:g.sent(),g.label=3;case 3:return this._bimModeEnabled?[4,this._updateNearbyDoors()]:[3,5];case 4:g.sent(),g.label=5;case 5:return c=this._viewer.floorplanManager.getConfiguration().autoActivate===d.FloorplanAutoActivation.BimWalk,c?(e=(f=this._viewer.model.getNodesByGenericType("IFCBUILDINGSTOREY"))&&0<f.size)?[4,this._viewer.floorplanManager.activate()]:
[3,7]:[3,7];case 6:g.sent(),g.label=7;case 7:return[2]}})})};f.prototype.onDeactivate=function(){return __awaiter(this,void 0,void 0,function(){var a,c,f;return __generator(this,function(e){switch(e.label){case 0:return this._viewer.view.setInteractiveDrawLimitIncreaseEnabled(this._initialInteractiveDrawLimitIncreaseStatus),this._doorCache.forgetNearbyDoors(),a=this._viewer.floorplanManager.getConfiguration().autoActivate===d.FloorplanAutoActivation.BimWalk,a?(f=(c=this._viewer.model.getNodesByGenericType("IFCBUILDINGSTOREY"))&&
0<c.size)?[4,this._viewer.floorplanManager.deactivate()]:[3,2]:[3,2];case 1:e.sent(),e.label=2;case 2:return b.prototype.onDeactivate.call(this),[2]}})})};f.prototype.resetDefaultWalkSpeeds=function(){return __awaiter(this,void 0,void 0,function(){var b,a;return __generator(this,function(c){switch(c.label){case 0:return this._rotationSpeed=40,this._viewAngle=90,[4,this._viewer.model.getLooseBounding()];case 1:return b=c.sent(),a=b.extents(),this._maxExtents=Math.max(a.x,a.y,a.z),this._walkDistance=
this._maxExtents/15,this._elevationSpeed=this._maxExtents/10,this._zoomDistance=this._maxExtents/30,[2]}})})};f.prototype.getBimFloorConfig=function(){return __assign({},this._logical.floor)};f.prototype.setBimFloorConfig=function(b){this._logical.floor=__assign({},b);this._effective.floor=this._scaleAgainstModelUnit(this._logical.floor)};f.prototype.getBimWallConfig=function(){return __assign({},this._logical.wall)};f.prototype.setBimWallConfig=function(b){this._logical.wall=__assign({},b);this._effective.wall=
this._scaleAgainstModelUnit(this._logical.wall)};f.prototype.getBimDoorConfig=function(){return __assign({},this._logical.door)};f.prototype.setBimDoorConfig=function(b){this._logical.door=__assign({},b);this._effective.door=this._scaleAgainstModelUnit(this._logical.door)};f.prototype._scaleAgainstModelUnit=function(b){var a=this._viewer.model;a=1/a.getNodeUnitMultiplier(a.getAbsoluteRootNode());b=__assign({},b);for(var c=0,d=Object.keys(b);c<d.length;c++){var f=d[c];"number"===typeof b[f]&&(b[f]*=
a)}return b};f.prototype.onMouseDown=function(a){b.prototype.onMouseDown.call(this,a)};f.prototype.onMouseMove=function(a){b.prototype.onMouseMove.call(this,a)};f.prototype.onMouseUp=function(a){b.prototype.onMouseUp.call(this,a)};f.prototype._applyGravity=function(){return __awaiter(this,void 0,void 0,function(){var b,c,f,e,g,k,h,t,v,w;return __generator(this,function(l){switch(l.label){case 0:return b=this._viewer.view,c=b.getCamera(),f=c.getPosition(),[4,a(b,f,this._downAxis,this._effective.floor.maxFallDistance)];
case 1:e=l.sent();if(null!==e)return[3,3];f=d.Point3.subtract(f,d.Point3.scale(this._downAxis,this._effective.floor.avatarOffset));return[4,a(b,f,this._downAxis,this._effective.floor.maxFallDistance)];case 2:e=l.sent();if(null===e)return[2];l.label=3;case 3:g=new d.Point3(0,0,this._effective.floor.avatarOffset);k=d.Point3.add(e,g);h=d.Point3.subtract(k,f);t=h.length();if(t>this._effective.floor.negligibleClimbHeight&&(v=d.Util.computeAngleBetweenVector(h,this._downAxis),(w=90<v)&&t>this._effective.floor.maxClimbHeight))return[2];
this._applyWalkDelta(c,h);return[2]}})})};f.prototype._updateNearbyDoors=function(){var b=this._viewer.view.getCamera().getPosition();return this._doorCache.updateNearbyDoors(b,this._effective.door.transparencyRange,.5)};f.prototype._updateCamera=function(b){this._resetPosition(b);this._updateCameraTilt(b);this._updateCameraViewAngle(b);this._viewer.view.setCamera(b)};f.prototype._applyWalkDelta=function(b,a){b.dolly(d.Point3.scale(a,-1));this._updateCamera(b)};f.prototype._applyWalkDeltaWithCollisionCheck=
function(b,a,c){return __awaiter(this,void 0,void 0,function(){var f,e,g,k,h,l,n,m,x,z,B,A,D,C,E,F,H,G;return __generator(this,function(p){switch(p.label){case 0:return f=b.getPosition(),e=d.Matrix.createFromOffAxisRotation(c,90),g=e.transform(a),k=d.Matrix.createFromOffAxisRotation(c,-90),h=k.transform(a),l=this._testWallCollision(f,g,this._effective.wall.avatarOffset),n=this._testWallCollision(f,h,this._effective.wall.avatarOffset),m=this._testWallCollision(f,a,a.length()+this._effective.wall.avatarOffset),
[4,Promise.all([l,n])];case 1:x=p.sent();z=x[0];B=x[1];if(null!==z||null!==B)if(A=function(b){return null!==b?(b=b.getFaceEntity().getNormal(),90<d.Util.computeAngleBetweenVector(b,a)):!1},A(z)||A(B))return[2];return[4,m];case 2:return D=p.sent(),null!==D&&(C=a.length(),E=d.Point3.scale(a,1/C),F=d.Point3.subtract(D.getPosition(),f).length(),H=F-this._effective.wall.avatarOffset,G=Math.min(C,H),a=d.Point3.scale(E,G)),this._applyWalkDelta(b,a),[2]}})})};f.prototype._testWallCollision=function(b,a,c){return e(this._viewer.view,
b,a,c)};f.prototype._walkBackward=function(b,a){var c=this._viewer.view.getCamera();this._resetPosition(c);var f=c.getTarget(),e=c.getPosition(),g=c.getUp();b=d.Point3.subtract(e,f).normalize().copy().scale(b);return a?this._applyWalkDeltaWithCollisionCheck(c,b,g):this._applyWalkDelta(c,b)};f.prototype._walkForward=function(b,a){return this._walkBackward(-b,a)};f.prototype._walkLeft=function(b,a){var c=this._viewer.view.getCamera();this._resetPosition(c);var f=c.getTarget(),e=c.getPosition(),g=c.getUp();
f=d.Point3.subtract(f,e).normalize();b=d.Point3.cross(g,f).normalize().copy().scale(b);return a?this._applyWalkDeltaWithCollisionCheck(c,b,g):this._applyWalkDelta(c,b)};f.prototype._walkRight=function(b,a){return this._walkLeft(-b,a)};f.prototype.walkBackward=function(b){return this._walkBackward(b,!1)};f.prototype.walkForward=function(b){return this._walkForward(b,!1)};f.prototype.walkLeft=function(b){return this._walkLeft(b,!1)};f.prototype.walkRight=function(b){return this._walkRight(b,!1)};f.prototype.walkBackwardWithCollision=
function(b){return this._walkBackward(b,!0)};f.prototype.walkForwardWithCollision=function(b){return this._walkForward(b,!0)};f.prototype.walkLeftWithCollision=function(b){return this._walkLeft(b,!0)};f.prototype.walkRightWithCollision=function(b){return this._walkRight(b,!0)};f.prototype.walkDown=function(b){var a=this._viewer.view.getCamera();this._resetPosition(a);b=a.getUp().normalize().scale(b);this._applyWalkDelta(a,b)};f.prototype.walkUp=function(b){this.walkDown(-b)};f.prototype.rotateRight=
function(b){var a=this._viewer.view.getCamera();this._resetPosition(a);var c=a.getTarget(),f=a.getPosition(),e=d.Point3.subtract(f,c).length(),g=d.Point3.subtract(c,f).normalize();b=d.Util.degreesToRadians(b);b=Math.tan(b);b*=d.Point3.subtract(a.getTarget(),a.getPosition()).length();g=d.Point3.cross(g,a.getUp()).scale(b);c=c.copy().add(g);e=d.Point3.subtract(c,f).normalize().scale(e);c=d.Point3.add(f,e);a.setTarget(c);this._updateCamera(a)};f.prototype.rotateLeft=function(b){this.rotateRight(-b)};
f.prototype.tiltDown=function(b){this.setTilt(this._tilt+b);b=this._viewer.view.getCamera();this._resetPosition(b);this._updateCamera(b)};f.prototype.tiltUp=function(b){this.tiltDown(-b)};f.prototype._calculateInitialPosition=function(){var b=this._viewer.view.getCamera();this._calculateMajorAxis(b);this.setTilt(this._calculateInitialTilt(b));this._resetPosition(b);this._updateCamera(b)};f.prototype._updateCameraViewAngle=function(b){var a=d.Util.degreesToRadians(this._viewAngle);a=Math.tan(a/2);
a*=d.Point3.subtract(b.getTarget(),b.getPosition()).length();b.setWidth(a);b.setHeight(a)};f.prototype._updateCameraTilt=function(b){var a=b.getPosition(),c=b.getTarget(),f=b.getUp().normalize(),e=d.Point3.subtract(c,a).normalize();f=d.Point3.cross(f,e).normalize();c=d.Point3.distance(c,a);d.Matrix.createFromOffAxisRotation(f,this._tilt).transform(e,e);b.setTarget(d.Point3.add(a,e.scale(c)))};f.prototype._calculateInitialTilt=function(b){var a=b.getTarget();b=b.getPosition();b=d.Point3.subtract(a,
b);a=b.length();this._majorAxis===d.Axis.X?b.x=0:this._majorAxis===d.Axis.Y?b.y=0:this._majorAxis===d.Axis.Z&&(b.z=0);b=b.length();return 180/Math.PI*Math.acos(b/a)};f.prototype._resetPosition=function(b){this._calculateMajorAxis(b);var a=b.getPosition(),c=b.getTarget();c=d.Point3.subtract(c,a);var f=c.length();0<this.getWalkSpeed()&&(f=this.getWalkSpeed());switch(this._majorAxis){case d.Axis.X:c.set(0,c.y,c.z);b.setUp(new d.Point3(1,0,0));break;case d.Axis.Y:c.set(c.x,0,c.z);b.setUp(new d.Point3(0,
1,0));break;case d.Axis.Z:c.set(c.x,c.y,0),b.setUp(new d.Point3(0,0,1))}c.normalize().scale(f);b.setTarget(d.Point3.add(a,c))};f.prototype._calculateMajorAxis=function(b){var a=b.getUp();b=Math.abs(a.x);var c=Math.abs(a.y);a=Math.abs(a.z);this._majorAxis=a>=b&&a>=c?d.Axis.Z:c>=b&&c>=a?d.Axis.Y:d.Axis.X};f.prototype.setZoomSpeed=function(b){this._zoomDistance=b};f.prototype.getZoomSpeed=function(){return this._zoomDistance};f.prototype.setTilt=function(b){this._tilt=Math.max(Math.min(b,45),-45);b=
this._viewer.view.getCamera();this._updateCamera(b)};f.prototype.getTilt=function(){return this._tilt};f.prototype.setViewAngle=function(b){b=Math.max(Math.min(b,150),30);this._viewAngle!==b&&(this._viewAngle=b,this._updateCamera(this._viewer.view.getCamera()))};f.prototype.getViewAngle=function(){return this._viewAngle};f.prototype.setWalkSpeed=function(b){this._walkDistance=b};f.prototype.getWalkSpeed=function(){return this._walkDistance};f.prototype.setElevationSpeed=function(b){this._elevationSpeed=
b};f.prototype.getElevationSpeed=function(){return this._elevationSpeed};f.prototype.setRotationSpeed=function(b){this._rotationSpeed=b};f.prototype.getRotationSpeed=function(){return this._rotationSpeed};f.prototype.setWalkActive=function(b){this._walkActive=b};f.prototype.getWalkActive=function(){return this._walkActive};f.prototype.getBimModeEnabled=function(){return this._bimModeEnabled};f.prototype.getMajorAxis=function(){return this._majorAxis};f.prototype.getActiveWalk=function(){return this._activeWalk};
return f}(h.OperatorBase);h.CameraWalkBaseOperator=b;(function(b){(function(b){(function(b){(function(b){b[b.avatarOffset=1500]="avatarOffset";b[b.maxClimbHeight=600]="maxClimbHeight";b[b.negligibleClimbHeight=20]="negligibleClimbHeight";b[b.maxFallDistance=5E3]="maxFallDistance"})(b.FloorConfig||(b.FloorConfig={}));(function(b){b[b.avatarOffset=150]="avatarOffset"})(b.WallConfig||(b.WallConfig={}));(function(b){b[b.transparencyRange=4E3]="transparencyRange"})(b.DoorConfig||(b.DoorConfig={}))})(b.Default||
(b.Default={}))})(b.Bim||(b.Bim={}))})(b=h.CameraWalkBaseOperator||(h.CameraWalkBaseOperator={}))})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function g(c){a(c,d.WalkDirection.Forward,d.WalkDirection.Backward);a(c,d.WalkDirection.Left,d.WalkDirection.Right);a(c,d.WalkDirection.Up,d.WalkDirection.Down);a(c,d.WalkDirection.RotateLeft,d.WalkDirection.RotateRight);a(c,d.WalkDirection.TiltUp,d.WalkDirection.TiltDown)}function a(a,b,d){a.has(b)&&a.has(d)&&(a.delete(b),a.delete(d))}var e=function(a){function b(b){var c=a.call(this,b)||this;c._keyWalkMapping=new Map;c._keyUpMap=new Map;c._keyDownMap=new Map;c._mouseLookSpeed=
0;c._mouseLookEnabled=!0;c._previousWalkTime=0;c._tickTimerId=null;b.setCallbacks({camera:function(b){b.getProjection()!==d.Projection.Perspective&&c._keyDownMap.clear()}});c.addKeyMapping(d.KeyCode.a,d.WalkDirection.Left);c.addKeyMapping(d.KeyCode.d,d.WalkDirection.Right);c.addKeyMapping(d.KeyCode.w,d.WalkDirection.Forward);c.addKeyMapping(d.KeyCode.s,d.WalkDirection.Backward);c.addKeyMapping(d.KeyCode.q,d.WalkDirection.RotateLeft);c.addKeyMapping(d.KeyCode.e,d.WalkDirection.RotateRight);c.addKeyMapping(d.KeyCode.r,
d.WalkDirection.TiltUp);c.addKeyMapping(d.KeyCode.f,d.WalkDirection.TiltDown);c.addKeyMapping(d.KeyCode.x,d.WalkDirection.Up);c.addKeyMapping(d.KeyCode.c,d.WalkDirection.Down);c.addKeyMapping(d.KeyCode.LeftArrow,d.WalkDirection.Left);c.addKeyMapping(d.KeyCode.RightArrow,d.WalkDirection.Right);c.addKeyMapping(d.KeyCode.UpArrow,d.WalkDirection.Forward);c.addKeyMapping(d.KeyCode.DownArrow,d.WalkDirection.Backward);return c}__extends(b,a);b.prototype.addKeyMapping=function(b,a){this._keyWalkMapping.set(b,
a)};b.prototype.getKeyMapping=function(){return d.Util.copyMap(this._keyWalkMapping)};b.prototype.clearKeyMappings=function(){this._keyWalkMapping.clear()};b.prototype.onMouseDown=function(b){a.prototype.onMouseDown.call(this,b);this._viewer.focusInput(!0)};b.prototype.onMouseMove=function(b){a.prototype.onMouseMove.call(this,b);if(this._dragging&&this._mouseLookEnabled){this._viewer.view.setProjectionMode(d.Projection.Perspective);var c=window.screen.width,f=window.screen.height;b.setHandled(!0);
b=d.Point2.subtract(this._ptPrevious,this._ptCurrent);this.rotateLeft(b.x/c*this._mouseLookSpeed);this.tiltUp(b.y/f*this._mouseLookSpeed)}};b.prototype.onMouseUp=function(b){5<this._dragCount&&b.setHandled(!0);a.prototype.onMouseUp.call(this,b)};b.prototype.onMousewheel=function(b){var a=this;this._viewer.view.setProjectionMode(d.Projection.Perspective);var c=this._viewer.view,f=c.getCamera(),e=b.getPosition(),g=b.getWheelDelta();b=c.pickFromPoint(e,new d.PickConfig(d.SelectionMask.Face)).then(function(b){var c=
b.getPosition();null!==b&&null!==c?(b=d.Point3.subtract(f.getPosition(),c).normalize().scale(a.getZoomSpeed()*g),a._applyWalkDelta(f,b)):a.walkBackward(g*a.getWalkSpeed())});b};b.prototype.onKeyDown=function(b){this._viewer.view.setProjectionMode(d.Projection.Perspective);var a=b.getKeyCode();a===d.KeyCode.v&&this.toggleBimMode();this._keyCodeActive(a)||(this._keyDownMap.set(a,b.getDate().getTime()),this._onKeyChange(a))};b.prototype.onKeyUp=function(b){var a=b.getKeyCode();this._keyUpMap.set(a,b.getDate().getTime());
this._onKeyChange(a)};b.prototype._keyCodeActive=function(b){var a=this._keyDownMap.get(b);return void 0!==a&&(b=this._keyUpMap.get(b),void 0===b||a>b)?!0:!1};b.prototype._onKeyChange=function(b){this._keyCodeActive(b)&&this._keyWalkMapping.has(b)&&(this.getWalkActive()||(this._previousWalkTime=Date.now()),this._onTick())};b.prototype.setMouseLookSpeed=function(b){this._mouseLookSpeed=b};b.prototype.getMouseLookSpeed=function(){return this._mouseLookSpeed};b.prototype.setMouseLookEnabled=function(b){this._mouseLookEnabled=
b};b.prototype.getMouseLookEnabled=function(){return this._mouseLookEnabled};b.prototype.resetDefaultWalkSpeeds=function(){return __awaiter(this,void 0,void 0,function(){var b=this;return __generator(this,function(c){return[2,a.prototype.resetDefaultWalkSpeeds.call(this).then(function(){b._mouseLookSpeed=300})]})})};b.prototype._execWalkDirection=function(b,a,c){var f=this.getWalkSpeed()*a;switch(b){case d.WalkDirection.Forward:return c?this.walkForwardWithCollision(f):this.walkForward(f);case d.WalkDirection.Backward:return c?
this.walkBackwardWithCollision(f):this.walkBackward(f);case d.WalkDirection.Left:return c?this.walkLeftWithCollision(f):this.walkLeft(f);case d.WalkDirection.Right:return c?this.walkRightWithCollision(f):this.walkRight(f);case d.WalkDirection.Up:return this.walkUp(this.getElevationSpeed()*a);case d.WalkDirection.Down:return this.walkDown(this.getElevationSpeed()*a);case d.WalkDirection.RotateLeft:return this.rotateLeft(this.getRotationSpeed()*a);case d.WalkDirection.RotateRight:return this.rotateRight(this.getRotationSpeed()*
a);case d.WalkDirection.TiltUp:return this.tiltUp(this.getRotationSpeed()*a);case d.WalkDirection.TiltDown:return this.tiltDown(this.getRotationSpeed()*a);default:d.Util.TypeAssertNever(b)}};b.prototype._queueWalkDirections=function(b){var a=this,c=new Set;this._keyWalkMapping.forEach(function(b,d){a._keyCodeActive(d)&&c.add(b)});g(c);var f=d.Util.setToArray(c);f.sort();if(0<f.length){this.setWalkActive(!0);var e=this.getBimModeEnabled();this.getActiveWalk().set(function(){return __awaiter(a,void 0,
void 0,function(){var a,g,k,h,l,n=this;return __generator(this,function(m){a=new d.Util.ActionQueue(1,!0);if(0<b)for(g=function(c){a.push(function(){return n._execWalkDirection(c,b,e)})},k=0,h=f;k<h.length;k++)l=h[k],g(l);e&&(c.has(d.WalkDirection.Up)||c.has(d.WalkDirection.Down)||a.push(function(){return __awaiter(n,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this._applyGravity()];case 1:return b.sent(),[2]}})})}),a.push(function(){return __awaiter(n,
void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this._updateNearbyDoors()];case 1:return b.sent(),[2]}})})}));return a.isIdle()?[2]:[2,a.waitForIdle()]})})})}};b.prototype._onTick=function(){var b=this,a=Date.now(),c=(a-this._previousWalkTime)/1E3;this._previousWalkTime=a;a=!this.getActiveWalk().isIdle();this.setWalkActive(a);this._queueWalkDirections(c);null!==this._tickTimerId&&(cancelAnimationFrame(this._tickTimerId),this._tickTimerId=null);this.getWalkActive()&&
(this._tickTimerId=requestAnimationFrame(function(){b._onTick()}))};return b}(h.CameraWalkBaseOperator);h.CameraKeyboardWalkOperator=e})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(e){function c(b,c){b=e.call(this,b)||this;b._cameraRotationMomentumEnabled=!1;b._isDown=!1;b._mouseDragged=!1;b._averagedMousePoints=new a;b._averageTimeIntervalMilliseconds=150;b._previousMouseMovePoint=d.Point2.zero();b._mouseMovePoint=d.Point2.zero();b._mouseMoveOffset=d.Point2.zero();b._previousMouseMoveTime=null;b._mouseMoveTime=null;b._mouseMoveElapsedTimeSeconds=0;b._rotationDegreesPerSecond=[0,0];b._animationLastTickTime=0;b._animationElapsedTimeSeconds=
0;b._animationIntervalResult=null;b._preferredAnimationIntervalMilliseconds=16;b._momentum=0;b._momentumLossPerSecond=0;b._degreesPerPixel=.5;b._maxRotationMagnitudeScale=8;b._initialSelectionPosition=null;b._cameraRotateFunction=c;return b}__extends(c,e);c.prototype.getCameraRotationMomentumEnabled=function(){return this._cameraRotationMomentumEnabled};c.prototype.setCameraRotationMomentumEnabled=function(b){b!==this._cameraRotationMomentumEnabled&&((this._cameraRotationMomentumEnabled=b)||this.stopAnimation())};
c.prototype.isCurrentlyAnimating=function(){return this._cameraRotationMomentumEnabled&&0<this.getMomentum()};c.prototype.onDeactivate=function(){return e.prototype.onDeactivate.call(this)};c.prototype.onViewOrientationChange=function(){this.stopAnimation()};c.prototype.supportsAnimation=function(){return!0};c.prototype.onMouseDown=function(b){e.prototype.onMouseDown.call(this,b);this.isActive()&&(this._initialSelectionPosition=b.getPosition(),this._isDown=!0,this.stopAnimation(),this._mouseDragged=
!1,this._mouseMoveTime=this._previousMouseMoveTime=Date.now(),this._mouseMovePoint.assign(this._initialSelectionPosition),this._previousMouseMovePoint.assign(this._mouseMovePoint),this._averagedMousePoints.clear(),this._averagedMousePoints.add(this._mouseMovePoint,this._mouseMoveTime))};c.prototype.onMouseMove=function(b){e.prototype.onMouseMove.call(this,b);this.isActive()&&this._isDown&&(this._mouseDragged=!0,this._previousMouseMovePoint.assign(this._mouseMovePoint),this._mouseMovePoint.assign(b.getPosition()),
this._mouseMoveOffset=d.Point2.subtract(this._mouseMovePoint,this._previousMouseMovePoint),this._previousMouseMoveTime=this._mouseMoveTime,this._mouseMoveTime=Date.now(),this._mouseMoveElapsedTimeSeconds=null===this._previousMouseMoveTime?0:(this._mouseMoveTime-this._previousMouseMoveTime)/1E3,this._averagedMousePoints.add(this._mouseMovePoint,this._mouseMoveTime),b=this._getMouseMoveOffsetForRotation(),this._rotateCamera(b))};c.prototype.onMouseUp=function(b){if(this.isActive()&&(this._isDown=!1,
this._mouseDragged&&this.getCameraRotationMomentumEnabled())){this._mouseMoveOffset=this._averagedMousePoints.getAverageOffsetWithinMilliseconds(this._averageTimeIntervalMilliseconds);var a=this._getMouseMoveOffsetForRotation();if(0!==a[0]||0!==a[1]){for(var c=0;2>c;c++){var d=Math.abs(a[c])*this._maxRotationMagnitudeScale;this._rotationDegreesPerSecond[c]=a[c]/this._mouseMoveElapsedTimeSeconds;this._rotationDegreesPerSecond[c]<-d?this._rotationDegreesPerSecond[c]=-d:this._rotationDegreesPerSecond[c]>
d&&(this._rotationDegreesPerSecond[c]=d)}this._momentum=1;this._startAnimation()}else this._momentum=0}e.prototype.onMouseUp.call(this,b)};c.prototype._rotateCamera=function(b){this._cameraRotateFunction(b)};c.prototype.stopAnimation=function(){null!==this._animationIntervalResult&&(clearInterval(this._animationIntervalResult),this._animationIntervalResult=null)};c.prototype.getMomentum=function(){return this._momentum};c.prototype.setMomentumLossPerSecond=function(b){0<=b&&(this._momentumLossPerSecond=
b)};c.prototype.getMomentumLossPerSecond=function(){return this._momentumLossPerSecond};c.prototype.isAnimating=function(){return null!==this._animationIntervalResult};c.prototype._startAnimation=function(){var b=this;null===this._animationIntervalResult&&(this._animationLastTickTime=Date.now(),this._animationIntervalResult=window.setInterval(function(){b._onTick()},this._preferredAnimationIntervalMilliseconds))};c.prototype._getMouseMoveOffsetForRotation=function(){return[-this._mouseMoveOffset.x*
this._degreesPerPixel,this._mouseMoveOffset.y*this._degreesPerPixel]};c.prototype._onTick=function(){var b=Date.now();this._animationElapsedTimeSeconds=(b-this._animationLastTickTime)/1E3;this._animationLastTickTime=b;this._rotateCamera([this._animationElapsedTimeSeconds*this._rotationDegreesPerSecond[0],this._animationElapsedTimeSeconds*this._rotationDegreesPerSecond[1]]);if(0<this._momentumLossPerSecond)if(this._momentum=Math.max(0,this._momentum-this._animationElapsedTimeSeconds*this._momentumLossPerSecond),
0<this._momentum)for(b=0;b<this._rotationDegreesPerSecond.length;b++)this._rotationDegreesPerSecond[b]*=this._momentum;else{for(b=0;b<this._rotationDegreesPerSecond.length;b++)this._rotationDegreesPerSecond[b]=0;this._rotateCamera(this._rotationDegreesPerSecond);this.stopAnimation()}};return c}(h.OperatorBase);h.CameraOrbitBaseOperator=g;var a=function(){function a(a){void 0===a&&(a=10);this._count=0;this._points=Array(a);this._times=Array(a)}a.prototype.clear=function(){this._count=0};a.prototype.add=
function(a,b){void 0===b&&(b=Date.now());var c=this._count%this._points.length;void 0===this._points[c]?this._points[c]=a.copy():this._points[c].assign(a);this._times[c]=b;this._count++};a.prototype.getAverageOffsetWithinMilliseconds=function(a,b){void 0===b&&(b=Date.now());var c=-1,e=d.Point2.zero(),g=Math.min(this._points.length,this._count);if(0<g){for(var h=0,m=0;m<g;m++){var p=(this._count-1-m)%this._points.length;if(b-this._times[p]>a)break;c=p;e.add(this._points[p]);h++}1<h?(e.subtract(this._points[c]),
h--,e.scale(1/h)):(c=-1,e.set(0,0))}return 0<=c?d.Point2.subtract(e,this._points[c]):e};return a}()})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function c(b,c,e){var f=a.call(this)||this;f._circle=new d.Markup.Shape.Circle;f._viewer=b;f._position=c;f._circle.setRadius(e);return f}__extends(c,a);c.prototype.draw=function(){if(this._circle){var b=this._viewer.view.projectPoint(this._position);this._circle.setCenter(d.Point2.fromPoint3(b));this._viewer.markupManager.getRenderer().drawCircle(this._circle)}};return c}(d.Markup.MarkupItem);h.OrbitMarkup=g;var a=function(a){function c(b){var c=a.call(this,
b,function(b){if(!c._viewer.sheetManager.isDrawingSheetActive())if(null!==c._pickPosition){if(null===c._circleMarkupHandler){var a=new g(c._viewer,c._pickPosition,c._circleRadius);c._circleMarkupHandler=c._viewer.markupManager.registerMarkup(a)}c._orbitByTurnTiltWithTarget(b,c._pickPosition)}else switch(a=c._viewer.view.getCamera(),c._orbitFallbackMode){default:case d.OrbitFallbackMode.CameraTarget:c._orbitByTurnTiltWithTarget(b,a.getTarget());break;case d.OrbitFallbackMode.ModelCenter:c._modelCenter&&
c._orbitByTurnTiltWithTarget(b,c._modelCenter);break;case d.OrbitFallbackMode.OrbitTarget:c._orbitByTurnTiltWithTarget(b,c._orbitTarget)}})||this;c._orbitTarget=d.Point3.zero();c._orbitFallbackMode=d.OrbitFallbackMode.ModelCenter;c._modelCenter=null;c._circleMarkupHandler=null;c._circleRadius=3;c._updateCameraCenterAction=new d.Util.CurrentAction(!1);c._updateCameraCenterTimer=new d.Util.Timer;c._primaryButton=d.Button.Middle;c._pickPosition=null;c._bimOrbitEnabled=!1;c._viewer.setCallbacks({sceneReady:function(){c._updateModelCenter()},
modelSwitched:function(){c._updateModelCenter()},visibilityChanged:function(){c._updateModelCenter()},_updateTransform:function(b){b||c._updateModelCenter()},_geometryCreated:function(){c._updateModelCenter()},hwfParseComplete:function(){c._updateModelCenter()}});return c}__extends(c,a);c.prototype._updateModelCenter=function(b){var a=this;void 0===b&&(b=50);this._updateCameraCenterTimer.clear();this._updateCameraCenterAction.set(function(){return __awaiter(a,void 0,void 0,function(){var a,c=this;
return __generator(this,function(d){switch(d.label){case 0:return[4,this._viewer.model.getModelBounding(!0,!1)];case 1:a=d.sent();if(a.isDegenerate()&&0<b)return this._updateCameraCenterTimer.set(500,function(){c._updateModelCenter(b-1)}),[2];this._modelCenter=a.center();return[2]}})})})};c.prototype.onMouseDown=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(f){switch(f.label){case 0:return a.prototype.onMouseDown.call(this,b),this.isActive()&&b.getButton()===
this._primaryButton?[4,this._viewer.view.pickFromPoint(b.getPosition(),new d.PickConfig(d.SelectionMask.Face))]:[3,2];case 1:c=f.sent(),null!==c&&0===c.overlayIndex()?(this._pickPosition=c.getPosition(),b.setHandled(!0)):this._pickPosition=null,f.label=2;case 2:return[2]}})})};c.prototype.onMouseUp=function(b){a.prototype.onMouseUp.call(this,b);b.getButton()===this._primaryButton&&(this._pickPosition=null);this._removeMarkup()};c.prototype.setBimOrbitEnabled=function(b){this._bimOrbitEnabled=b};c.prototype.getBimOrbitEnabled=
function(){return this._bimOrbitEnabled};c.prototype._removeMarkup=function(){null!==this._circleMarkupHandler&&(this._viewer.markupManager.unregisterMarkup(this._circleMarkupHandler),this._circleMarkupHandler=null)};c.prototype._getClampedRotationMatrix=function(b,a,c,e){b=d.Matrix.createFromOffAxisRotation(b,a);a=d.Point3.zero();b.transform(c,a);return 0>=d.Util.radiansToDegrees(Math.asin(d.Point3.dot(e,a)))?new d.Matrix:b};c.prototype._orbitByTurnTiltWithTarget=function(b,a){var c=this._viewer.view,
f=c.getCamera(),e=f.getPosition().subtract(a),g=f.getTarget().subtract(a),h=f.getUp().normalize(),q=d.Point3.subtract(g,e).normalize(),r=d.Point3.cross(h,q).normalize();q=b[0];var u=b[1];new d.Matrix;new d.Matrix;this._bimOrbitEnabled?(b=this._viewer.model.getViewAxes().upVector.copy(),r=this._getClampedRotationMatrix(r,u,h,b),b=d.Matrix.createFromOffAxisRotation(b,q/4),q=b.transform(r.transform(e)),g=b.transform(r.transform(g)),h=b.transform(r.transform(d.Point3.add(e,h)))):(r=d.Matrix.createFromOffAxisRotation(r,
u),b=d.Matrix.createFromOffAxisRotation(h,q),r=d.Matrix.multiply(b,r),q=r.transform(e),g=r.transform(g),h=r.transform(d.Point3.add(e,h)));h.subtract(q);e=q;e.add(a);g.add(a);f.setPosition(e);f.setTarget(g);f.setUp(h);c.setCamera(f)};c.prototype.setOrbitFallbackMode=function(b){this._orbitFallbackMode=b};c.prototype.getOrbitFallbackMode=function(){return this._orbitFallbackMode};c.prototype.setOrbitTarget=function(b){this._orbitTarget=b};c.prototype.getOrbitTarget=function(){return this._orbitTarget};
c.prototype.setPrimaryButton=function(b){this._primaryButton=b};c.prototype.getPrimaryButton=function(){return this._primaryButton};return c}(h.CameraOrbitBaseOperator);h.CameraOrbitOperator=a})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){c=a.call(this,c)||this;c._cameraPtPrevious=d.Point3.zero();return c}__extends(e,a);e.prototype.onMouseDown=function(c){a.prototype.onMouseDown.call(this,c);if(this.isActive()||this._viewer.sheetManager.isDrawingSheetActive()){var b=this._viewer.view;(c=b.getCamera().getCameraPlaneIntersectionPoint(c.getPosition(),b))&&this._cameraPtPrevious.assign(c)}};e.prototype.onMouseMove=function(c){a.prototype.onMouseMove.call(this,c);if(this.isActive()||
this._viewer.sheetManager.isDrawingSheetActive()){var b=this._viewer.view,f=b.getCamera();if(c=f.getCameraPlaneIntersectionPoint(c.getPosition(),b))c=d.Point3.subtract(c,this._cameraPtPrevious),f.dolly(c),b.setCamera(f)}};return e}(h.OperatorBase);h.CameraPanOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){c=a.call(this,c)||this;c._mouseMoveZoomDelta=3;c._mouseWheelZoomDelta=.25;c._pinchZoomModifier=2.5;c._zoomToMousePosition=!0;c._dollyZoomEnabled=!1;c._adjustCameraTarget=!1;c._preserveViewAngle=!0;c._mouseMoveZoomFactor=1;c._mouseWheelZoomFactor=-1;c._secondaryTouchId=null;c._lastTouch1=d.Point2.zero();c._lastTouch2=d.Point2.zero();c._prevLen=0;return c}__extends(e,a);e.prototype.setMouseWheelZoomInverted=function(a){this._mouseWheelZoomFactor=
a?-1:1};e.prototype.getMouseWheelZoomInverted=function(){return-1===this._mouseWheelZoomFactor};e.prototype.setMouseMoveZoomInverted=function(a){this._mouseMoveZoomFactor=a?-1:1};e.prototype.getMouseMoveZoomInverted=function(){return-1===this._mouseMoveZoomFactor};e.prototype.setMouseMoveZoomDelta=function(a){this._mouseMoveZoomDelta=a};e.prototype.getMouseMoveZoomDelta=function(){return this._mouseMoveZoomDelta};e.prototype.setMouseWheelZoomDelta=function(a){this._mouseWheelZoomDelta=a};e.prototype.getMouseWheelZoomDelta=
function(){return this._mouseWheelZoomDelta};e.prototype.setZoomToMousePosition=function(a){this._zoomToMousePosition=a};e.prototype.getZoomToMousePosition=function(){return this._zoomToMousePosition};e.prototype.setDollyZoomEnabled=function(a){this._dollyZoomEnabled=a};e.prototype.getDollyZoomEnabled=function(){return this._dollyZoomEnabled};e.prototype.setMouseWheelAdjustCameraTarget=function(a){this._adjustCameraTarget=a};e.prototype.getMouseWheelAdjustCameraTarget=function(){return this._adjustCameraTarget};
e.prototype.setPreserveViewAngle=function(a){this._preserveViewAngle=a};e.prototype.getPreserveViewAngle=function(){return this._preserveViewAngle};e.prototype.onMouseMove=function(c){return __awaiter(this,void 0,void 0,function(){var b,d,e,g,h,m;return __generator(this,function(f){switch(f.label){case 0:a.prototype.onMouseMove.call(this,c);if(!this.isDragging()||!this.isActive())return[3,4];b=this._viewer.view;d=b.pointToWindowPosition(this._ptCurrent);e=b.pointToWindowPosition(this._ptPrevious);
g=d.y-e.y;h=d.x-e.x;m=this._mouseMoveZoomDelta*this._mouseMoveZoomFactor*(g-h);return this._dollyZoomEnabled?[4,this._dollyZoom(m,void 0,void 0,!0)]:[3,2];case 1:return f.sent(),[3,4];case 2:return[4,this._doZoom(m)];case 3:f.sent(),f.label=4;case 4:return[2]}})})};e.prototype.onMousewheel=function(a){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return b=this._mouseWheelZoomDelta*this._mouseWheelZoomFactor*a.getWheelDelta(),this._dollyZoomEnabled?
[4,this._dollyZoom(-b,void 0,a.getPosition())]:[3,2];case 1:return c.sent(),[3,4];case 2:return[4,this._doZoom(b,void 0,a.getPosition())];case 3:c.sent(),c.label=4;case 4:return[2]}})})};e.prototype.onTouchStart=function(a){var b=this._viewer.view;null===this._primaryTouchId?(this._primaryTouchId=a.getId(),this._lastTouch1.assign(b.pointToWindowPosition(a.getPosition()))):null===this._secondaryTouchId&&(this._secondaryTouchId=a.getId(),this._lastTouch2.assign(b.pointToWindowPosition(a.getPosition())));
null!==this._primaryTouchId&&null!==this._secondaryTouchId&&(this._prevLen=d.Point2.subtract(this._lastTouch2,this._lastTouch1).length(),this._dragging=!0)};e.prototype.onTouchMove=function(a){var b=this._viewer.view,c=a.getId();a=a.getPosition();c===this._primaryTouchId?this._lastTouch1.assign(b.pointToWindowPosition(a)):c===this._secondaryTouchId&&this._lastTouch2.assign(b.pointToWindowPosition(a));!this._dragging||c!==this._primaryTouchId&&c!==this._secondaryTouchId||(b=d.Point2.subtract(this._lastTouch2,
this._lastTouch1).length(),this._zoomHelper(1/(1-(this._prevLen-b)*this._pinchZoomModifier),this._viewer.view.getCamera()),this._prevLen=b)};e.prototype.onTouchEnd=function(a){a=a.getId();this._primaryTouchId===a?this._primaryTouchId=null:this._secondaryTouchId===a&&(this._secondaryTouchId=null);this._dragging=!1};e.prototype.onDeactivate=function(){this._secondaryTouchId=this._primaryTouchId=null};e.prototype._updateCameraViewAngle=function(a){var b=d.Util.degreesToRadians(90);b=Math.tan(b/2);b*=
d.Point3.subtract(a.getTarget(),a.getPosition()).length();a.setWidth(b);a.setHeight(b);return a};e.prototype._dollyZoom=function(a,b,f,e){void 0===b&&(b=this._viewer.view.getCamera());void 0===e&&(e=!1);return __awaiter(this,void 0,void 0,function(){var c,g,k,h,q,r,u,t,v,w,y,x,z=this;return __generator(this,function(l){switch(l.label){case 0:return c=this._viewer.view,b.setProjection(d.Projection.Perspective),g=b.getPosition(),k=b.getTarget(),f?[4,this._viewer.model.getModelBounding(!1,!1,!1)]:[3,
3];case 1:return h=l.sent(),q=h.extents().length(),r=q/100,[4,this._viewer.view.pickFromPoint(f,new d.PickConfig)];case 2:return u=l.sent(),t=u.getPosition(),null!==t&&(v=d.Point3.subtract(k,g),w=d.Point3.subtract(t,g),y=d.Point3.add(g,v.scale(d.Point3.dot(v,w)/d.Point3.dot(v,v))),b.setTarget(y)),x=d.Point3.subtract(b.getTarget(),g),0<a&&x.length()<r&&b.setTarget(d.Point3.add(k,x.copy().normalize().scale(2*r))),x=d.Point3.subtract(b.getTarget(),g),b.setPosition(d.Point3.add(g,x.copy().scale(.05*(0<
a?1:-1)))),[3,4];case 3:x=d.Point3.subtract(k,g).scale(a/10),b.setPosition(d.Point3.add(g,x)),e&&b.setTarget(d.Point3.add(k,x)),l.label=4;case 4:return b=this._updateCameraViewAngle(b),this._viewer.pauseRendering(function(){if(f){var a=b.getCameraPlaneIntersectionPoint(f,z._viewer.view);c.setCamera(b);var e=b.getCameraPlaneIntersectionPoint(f,z._viewer.view);null!==a&&null!==e&&b.dolly(d.Point3.subtract(e,a))}c.setCamera(b)}),[2]}})})};e.prototype._doZoom=function(a,b,f){void 0===b&&(b=this._viewer.view.getCamera());
return __awaiter(this,void 0,void 0,function(){var c,e,g,h,p,q,r,u=this;return __generator(this,function(k){switch(k.label){case 0:return c=this._viewer.view,e=1/(1-a),f&&this._zoomToMousePosition?this._adjustCameraTarget?[4,this._viewer.view.pickFromPoint(f,new d.PickConfig)]:[3,2]:[3,3];case 1:g=k.sent(),void 0!==g&&g.isEntitySelection()&&(h=b.getPosition().subtract(b.getTarget()),p=d.Point3.subtract(b.getTarget(),b.getPosition()),q=d.Point3.subtract(g.getPosition(),b.getPosition()),r=b.getPosition().add(p.scale(d.Point3.dot(p,
q)/d.Point3.dot(p,p))),b.setTarget(r),b.setPosition(d.Point3.add(r,h))),k.label=2;case 2:return this._viewer.pauseRendering(function(){var a=b.getCameraPlaneIntersectionPoint(f,u._viewer.view);u._zoomHelper(e,b);var g=b.getCameraPlaneIntersectionPoint(f,u._viewer.view);null!==a&&null!==g&&b.dolly(d.Point3.subtract(g,a));c.setCamera(b)}),[3,4];case 3:this._zoomHelper(e,b),k.label=4;case 4:return[2]}})})};e.prototype._zoomHelper=function(a,b){var c=this._viewer.view;b.setWidth(b.getWidth()*a);b.setHeight(b.getHeight()*
a);if(this._preserveViewAngle&&!this._viewer.sheetManager.isDrawingSheetActive()){var e=b.getPosition(),g=b.getTarget();a=d.Point3.subtract(g,e).scale(a);b.setPosition(d.Point3.subtract(g,a))}c.setCamera(b)};return e}(h.OperatorBase);h.CameraZoomOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c,b,d,e){c=a.call(this,c)||this;c._activeOperator=null;c._activeTouchCount=0;c._touchMoveCount=0;c._returnToOrbit=!1;c._bimNavigationEnabled=!1;c._orbitOperator=b;c._panOperator=d;c._zoomOperator=e;return c}__extends(e,a);e.prototype.setBimNavigationEnabled=function(a){this._bimNavigationEnabled=a;var b=this._orbitOperator,c=this._zoomOperator,e=this._panOperator;b.clearMapping();c.clearMapping();e.clearMapping();b.setMapping(d.Button.Left);b.setBimOrbitEnabled(a);
c.setDollyZoomEnabled(a);a?(b.setPrimaryButton(d.Button.Left),c.setMapping(d.Button.Right),e.setMapping(d.Button.Middle),this._setBimCamera()):(b.addMapping(d.Button.Middle),b.setPrimaryButton(d.Button.Middle),c.addMapping(d.Button.Left,d.KeyModifiers.Shift),e.addMapping(d.Button.Right),e.addMapping(d.Button.Left,d.KeyModifiers.Control))};e.prototype._setBimCamera=function(){var a=this._viewer.view.getCamera(),b=d.Point3.subtract(a.getPosition(),a.getTarget()).normalize(),f=this._viewer.model.getViewAxes().upVector.copy();
f=d.Point3.cross(b,f);b=d.Point3.cross(f,b);a.setUp(b);a.setProjection(d.Projection.Perspective);this._viewer.view.setCamera(a)};e.prototype.getBimNavigationEnabled=function(){return this._bimNavigationEnabled};e.prototype.onViewOrientationChange=function(){this._activeTouchCount=0;this._returnToOrbit=!1};e.prototype.onMouseDown=function(c){a.prototype.onMouseDown.call(this,c);this._setActiveOperatorForMouseInput(c);this._activeOperator&&(this._bimNavigationEnabled&&this._setBimCamera(),this._activeOperator.onMouseDown(c))};
e.prototype.onMouseMove=function(c){a.prototype.onMouseMove.call(this,c);if(this._activeOperator&&this._dragging&&3<this._dragCount)this._activeOperator.onMouseMove(c)};e.prototype.onMouseUp=function(c){if(this._activeOperator)this._activeOperator.onMouseUp(c);this._activeOperator instanceof h.CameraOrbitOperator||this._orbitOperator._removeMarkup();a.prototype.onMouseUp.call(this,c)};e.prototype.onMousewheel=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,
this._zoomOperator.onMousewheel(a)];case 1:return b.sent(),[2]}})})};e.prototype.onTouchStart=function(a){++this._activeTouchCount;this._orbitOperator.onTouchStart(a);this._zoomOperator.onTouchStart(a);this._viewer.sheetManager.isDrawingSheetActive()&&(this._panOperator.onTouchStart(a),this._orbitOperator.onDeactivate());1===this._activeTouchCount&&(this._primaryTouchId=a.getId());2===this._activeTouchCount&&(this._orbitOperator.onDeactivate(),this._panOperator.onTouchStart(a),this._zoomOperator.onTouchStart(a))};
e.prototype.onTouchMove=function(a){++this._touchMoveCount;5<this._touchMoveCount&&(this._returnToOrbit?(this._orbitOperator.onTouchStart(a),this._returnToOrbit=!1):1===this._activeTouchCount?(this._orbitOperator.onTouchMove(a),this._zoomOperator.onTouchMove(a),this._panOperator.onTouchMove(a)):2===this._activeTouchCount&&(this._zoomOperator.onTouchMove(a),this._panOperator.onTouchMove(a)))};e.prototype.onTouchEnd=function(a){2===this._activeTouchCount&&(this._returnToOrbit=!0);this._zoomOperator.onTouchEnd(a);
this._panOperator.onTouchEnd(a);this._orbitOperator.onTouchEnd(a);0<this._activeTouchCount&&--this._activeTouchCount;0===this._activeTouchCount&&(this._touchMoveCount=0)};e.prototype.stopInteraction=function(){var c=[];var b=a.prototype.stopInteraction.call(this);void 0!==b&&c.push(b);this._touchMoveCount=this._activeTouchCount=0;b=this._zoomOperator.onDeactivate();void 0!==b&&c.push(b);b=this._panOperator.onDeactivate();void 0!==b&&c.push(b);b=this._orbitOperator.onDeactivate();void 0!==b&&c.push(b);
return d.Util.waitForAll(c)};e.prototype._setActiveOperatorForMouseInput=function(a){var b=this._orbitOperator,c=this._panOperator,d=this._zoomOperator;this._activeOperator=null;this._viewer.sheetManager.isDrawingSheetActive()?this._activeOperator=c:b.checkMapping(a)?this._activeOperator=b:d.checkMapping(a)?this._activeOperator=d:c.checkMapping(a)&&(this._activeOperator=c)};e.prototype.onDeactivate=function(){a.prototype.onDeactivate.call(this);this._orbitOperator.onDeactivate();this._panOperator.onDeactivate();
this._zoomOperator.onDeactivate()};return e}(h.OperatorBase);h.CameraNavigationOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){var b=a.call(this,c,function(a){b._rotateAroundAxis(b._rotationAxis,a[0])})||this;b._rotationAxis=new d.Point3(0,0,1);b._tiltAmount=12;return b}__extends(e,a);e.prototype._rotateAroundAxis=function(a,b){var c=this._viewer.view,e=c.getCamera(),g=e.getPosition(),h=e.getUp().normalize(),m=e.getTarget();a=d.Matrix.createFromOffAxisRotation(a,b);b=(new d.Matrix).setTranslationComponent(-m.x,-m.y,-m.z);b=d.Matrix.multiply(b,a);m=(new d.Matrix).setTranslationComponent(m.x,
m.y,m.z);d.Matrix.multiply(b,m).transform(g,g);a.transform(h,h);h.normalize();e.setPosition(g);e.setUp(h);c.setCamera(e)};e.prototype.onMousewheel=function(a){a=a.getWheelDelta();var b=this._viewer.view.getCamera(),c=b.getUp().normalize();b=d.Point3.subtract(b.getTarget(),b.getPosition()).normalize();c=d.Point3.cross(c,b).normalize();0<a?this._rotateAroundAxis(c,this._tiltAmount):this._rotateAroundAxis(c,-this._tiltAmount)};e.prototype.setRotationAxis=function(a){var b=!0;switch(a){case d.Axis.X:this._rotationAxis.set(1,
0,0);break;case d.Axis.Y:this._rotationAxis.set(0,1,0);break;case d.Axis.Z:this._rotationAxis.set(0,0,1);break;default:b=!1}return b};return e}(h.CameraOrbitBaseOperator);h.CameraTurntableOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(a,c,b){this._keyboardWalkOperator=b;this._activeOperator=this._walkOperator=c;this._walkMode=d.WalkMode.Mouse;this._active=!1}a.prototype.setWalkMode=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:if(this._walkMode===a)return[3,7];this._walkMode=a;if(a!==d.WalkMode.Keyboard)return[3,4];this._activeOperator=this._keyboardWalkOperator;return this._active?[4,this._walkOperator.onDeactivate()]:
[3,3];case 1:return c.sent(),[4,this._keyboardWalkOperator.onActivate()];case 2:c.sent(),c.label=3;case 3:return[3,7];case 4:return this._activeOperator=this._walkOperator,this._active?[4,this._keyboardWalkOperator.onDeactivate()]:[3,7];case 5:return c.sent(),[4,this._walkOperator.onActivate()];case 6:c.sent(),c.label=7;case 7:return[2]}})})};a.prototype.getWalkMode=function(){return this._activeOperator instanceof h.CameraKeyboardWalkOperator?d.WalkMode.Keyboard:d.WalkMode.Mouse};a.prototype.onMouseDown=
function(a){this._activeOperator.onMouseDown(a)};a.prototype.onMouseMove=function(a){this._activeOperator.onMouseMove(a)};a.prototype.onMouseUp=function(a){this._activeOperator.onMouseUp(a)};a.prototype.onMousewheel=function(a){this._activeOperator.onMousewheel(a)};a.prototype.onTouchStart=function(a){this._activeOperator.onTouchStart(a)};a.prototype.onTouchMove=function(a){this._activeOperator.onTouchMove(a)};a.prototype.onTouchEnd=function(a){this._activeOperator.onTouchEnd(a)};a.prototype.onKeyDown=
function(a){this._activeOperator.onKeyDown(a)};a.prototype.onKeyUp=function(a){if(this._activeOperator instanceof h.CameraKeyboardWalkOperator)this._activeOperator.onKeyUp(a)};a.prototype.onDeactivate=function(){return this._activeOperator.onDeactivate()};a.prototype.onActivate=function(){this._active=!0;return this._activeOperator.onActivate()};a.prototype.onViewOrientationChange=function(){this._active=!1};a.prototype.stopInteraction=function(){return this._activeOperator.stopInteraction()};a.prototype.setBimModeEnabled=
function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){c=[];a?(c.push(this._keyboardWalkOperator.enableBimMode()),c.push(this._walkOperator.enableBimMode())):(c.push(this._keyboardWalkOperator.disableBimMode()),c.push(this._walkOperator.disableBimMode()));return[2,Promise.all(c).then(function(){})]})})};a.prototype.resetDefaultWalkSpeeds=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,Promise.all([this._walkOperator.resetDefaultWalkSpeeds(),
this._keyboardWalkOperator.resetDefaultWalkSpeeds()]).then(function(){})]})})};a.prototype.setBimFloorConfig=function(a){this._walkOperator.setBimFloorConfig(a);this._keyboardWalkOperator.setBimFloorConfig(a)};a.prototype.setBimWallConfig=function(a){this._walkOperator.setBimWallConfig(a);this._keyboardWalkOperator.setBimWallConfig(a)};a.prototype.setBimDoorConfig=function(a){this._walkOperator.setBimDoorConfig(a);this._keyboardWalkOperator.setBimDoorConfig(a)};a.prototype.setZoomSpeed=function(a){this._walkOperator.setZoomSpeed(a);
this._keyboardWalkOperator.setZoomSpeed(a)};a.prototype.setWalkSpeed=function(a){this._walkOperator.setWalkSpeed(a);this._keyboardWalkOperator.setWalkSpeed(a)};a.prototype.setElevationSpeed=function(a){this._walkOperator.setElevationSpeed(a);this._keyboardWalkOperator.setElevationSpeed(a)};a.prototype.setRotationSpeed=function(a){this._walkOperator.setRotationSpeed(a);this._keyboardWalkOperator.setRotationSpeed(a)};a.prototype.setViewAngle=function(a){this._walkOperator.setViewAngle(a);this._keyboardWalkOperator.setViewAngle(a)};
return a}();h.CameraWalkModeOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){c=a.call(this,c)||this;c._timerId=null;c._walkButton=d.Button.None;c._previousTimestamp=0;c._activeTouchCount=0;c._maxDistance=200;return c}__extends(e,a);e.prototype.onActivate=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,a.prototype.onActivate.call(this)];case 1:return c.sent(),this._viewer.trigger("walkOperatorActivated"),[2]}})})};e.prototype.onKeyDown=function(a){a=
a.getKeyCode();var b=this.getWalkSpeed();a===d.KeyCode.PgUp&&this.setWalkSpeed(1.2*b);a===d.KeyCode.PgDown&&this.setWalkSpeed(.8*b);a===d.KeyCode.v&&this.toggleBimMode()};e.prototype.onDeactivate=function(){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return c=this._resetCameraTarget(),this.stopWalking(),[4,a.prototype.onDeactivate.call(this)];case 1:return b.sent(),this._viewer.trigger("walkOperatorDeactivated"),[2,c]}})})};e.prototype._checkProjection=
function(){var a=this._viewer.view;a.getProjectionMode()!==d.Projection.Perspective&&(a.setProjectionMode(d.Projection.Perspective),this._calculateInitialPosition())};e.prototype.onMouseDown=function(c){a.prototype.onMouseDown.call(this,c);this._checkProjection();this.isActive()&&(this.stopWalking(),this.setWalkActive(!0),this._walkButton=c.getButton())};e.prototype.onMouseMove=function(c){a.prototype.onMouseMove.call(this,c);this.getWalkActive()&&null===this._timerId&&this.isActive()&&(this._previousTimestamp=
Date.now(),this._onTick())};e.prototype.onMouseUp=function(c){this.isActive()&&this.stopWalking();a.prototype.onMouseUp.call(this,c)};e.prototype.onTouchStart=function(c){a.prototype.onTouchStart.call(this,c);++this._activeTouchCount;1===this._activeTouchCount?this._walkButton=d.Button.Left:2===this._activeTouchCount?this._walkButton=d.Button.Right:3===this._activeTouchCount&&(this._walkButton=d.Button.None)};e.prototype.onTouchMove=function(c){3===this._activeTouchCount&&this._primaryTouchId===c.getId()?
(this._ptCurrent.assign(c.getPosition()),c=d.Point2.subtract(this._ptCurrent,this._ptPrevious),this._adjustTilt(c.y/100*1.5)):3>this._activeTouchCount&&a.prototype.onTouchMove.call(this,c)};e.prototype.onTouchEnd=function(c){a.prototype.onTouchEnd.call(this,c);0<this._activeTouchCount&&--this._activeTouchCount};e.prototype.onMousewheel=function(a){this._checkProjection();0<a.getWheelDelta()?this._adjustTilt(3):this._adjustTilt(-3)};e.prototype.stopWalking=function(){null!==this._timerId&&(cancelAnimationFrame(this._timerId),
this._timerId=null);this.setWalkActive(!1)};e.prototype._testWalk=function(a,b,f){return __awaiter(this,void 0,void 0,function(){var c,e,g;return __generator(this,function(k){switch(k.label){case 0:return c=new d.Event.MouseInputEvent(0,0,f,d.Buttons.None,d.KeyModifiers.None,d.MouseInputType.Down),e=new d.Event.MouseInputEvent(0,a,f,d.Buttons.None,d.KeyModifiers.None,d.MouseInputType.Move),g=new d.Event.MouseInputEvent(0,a,f,d.Buttons.None,d.KeyModifiers.None,d.MouseInputType.Up),this.onMouseDown(c),
this.onMouseMove(e),[4,d.Util.sleep(b)];case 1:return k.sent(),this.onMouseUp(g),[2]}})})};e.prototype._onTick=function(){var a=this,b=Date.now(),f=(b-this._previousTimestamp)/1E3;this._previousTimestamp=b;var e=this._viewer.view;b=d.Point2.subtract(this._ptCurrent,this._ptFirst);var g=new d.Point2(Math.abs(b.x)/this._maxDistance,Math.abs(b.y)/this._maxDistance),h=this.getRotationSpeed()*f*g.x,m=this.getWalkSpeed()*f*g.y,p=this.getElevationSpeed()*f*g.x;f=this.getElevationSpeed()*f*g.y;if(this._walkButton===
d.Button.Left){if(0!==b.x&&(0<b.x?this.rotateRight(h):0>b.x&&this.rotateLeft(h)),0!==b.y){var q=e.getCamera();this._resetPosition(q);f=q.getTarget();e=q.getPosition();f=d.Point3.subtract(f,e).normalize();var r=q.getUp(),u=d.Point3.scale(f,m);0<b.y&&(u=u.negate());this.setWalkActive(!0);var t=this.getBimModeEnabled();this.getActiveWalk().set(function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return t?[4,this._applyWalkDeltaWithCollisionCheck(q,
u,r)]:[3,4];case 1:return b.sent(),[4,this._applyGravity()];case 2:return b.sent(),[4,this._updateNearbyDoors()];case 3:return b.sent(),[3,5];case 4:return[2,this._applyWalkDelta(q,u)];case 5:return[2]}})})})}}else if(this._walkButton===d.Button.Right||this._walkButton===d.Button.Middle)0<Math.abs(b.y)&&(0<b.y?this.walkUp(f):this.walkDown(f)),0<Math.abs(b.x)&&(0<b.x?this.walkRight(p):this.walkLeft(p));this._timerId=requestAnimationFrame(function(){a._onTick()})};e.prototype._adjustTilt=function(a){var b=
this._viewer.view;this.setTilt(this.getTilt()+a);a=b.getCamera();this._resetPosition(a);var c=a.getTarget(),e=a.getPosition(),g=d.Point3.distance(c,e),h=a.getUp().normalize();c=d.Point3.subtract(c,e).normalize();h=d.Point3.cross(h,c).normalize();d.Matrix.createFromOffAxisRotation(h,this.getTilt()).transform(c,c);c.normalize().scale(g);a.setTarget(d.Point3.add(e,c));b.setCamera(a)};e.prototype._resetCameraTarget=function(){return __awaiter(this,void 0,void 0,function(){var a,b,f,e,g,h;return __generator(this,
function(c){switch(c.label){case 0:return a=this._viewer.view,b=a.getCanvasSize(),f=new d.Point2(Math.round(b.x/2),Math.round(b.y/2)),e=new d.PickConfig,[4,a.pickFromPoint(f,e)];case 1:return g=c.sent(),g.isEntitySelection()&&(h=a.getCamera(),h.setTarget(g.getPosition()),a.updateCamera(h)),[2]}})})};return e}(h.CameraWalkBaseOperator);h.CameraWalkOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(){this._positionOffset=d.Point2.zero();this._position=d.Point2.zero();this._activeNoteText=null;this._createTextBox()}a.prototype._createTextBox=function(){var a=this;this._container=document.createElement("div");this._container.className="noteTextElement";this._textArea=document.createElement("textarea");this._textArea.oninput=function(){null!==a._activeNoteText&&a._activeNoteText.saveTextValue()};this._container.appendChild(this._textArea);
var b=7;["blue","red","green","white","black"].forEach(function(c){var f=document.createElement("button");f.className="noteButton color "+c;f.style.top=b+"px";b+=25;f.id=c+"_button";switch(c){case "blue":var e=d.Color.blue();break;case "red":e=d.Color.red();break;case "green":e=d.Color.green();break;case "white":e=d.Color.white();break;case "black":e=d.Color.black();break;default:e=d.Color.white()}f.onmousedown=function(){null!==a._activeNoteText&&a._activeNoteText.setColor(e)};a._container.appendChild(f)});
var f=document.createElement("button");f.className="noteButton trash";f.style.top=b+"px";f.onmousedown=function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return null===this._activeNoteText?[3,2]:[4,this._activeNoteText.remove()];case 1:b.sent(),b.label=2;case 2:return[2]}})})};this._container.appendChild(f)};a.prototype.setPositionOffset=function(a){this._positionOffset=a};a.prototype.getPositionOffset=function(){return this._positionOffset.copy()};
a.prototype.setPosition=function(a){this._position=d.Point2.add(a,this._positionOffset);this._container.style.left=this._position.x+"px";this._container.style.top=this._position.y+"px"};a.prototype.getPosition=function(){return this._position.copy()};a.prototype.setText=function(a){var b=this._container.querySelector("textarea");null!==b&&(b.value=a)};a.prototype.getText=function(){var a=this._container.querySelector("textarea");return null!==a?a.value:""};a.prototype.setSize=function(a){this._container.style.width=
a.x+"px";this._container.style.height=a.y+"px"};a.prototype.getSize=function(){var a=this._container.getBoundingClientRect();return new d.Point2(a.width,a.height)};a.prototype.focus=function(){this._textArea.focus();this._textArea.style.pointerEvents="auto"};a.prototype.blur=function(){this._container.blur()};a.prototype.hide=function(){this._container.style.visibility="hidden";this._activeNoteText=null};a.prototype.show=function(a){this._container.style.visibility="visible";this._activeNoteText=
a};a.prototype.getHtmlContainer=function(){return this._container};a.prototype.setHtmlContainer=function(a){this._container=a};return a}();g.NoteTextElement=a})(h.Note||(h.Note={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){return function(){this.rotate=this.viewPlane=this.plane=this.axis=null}}(),a=function(){return function(a,b,f,e,g,h){this.vector=b;this.matrix=f;this.nodeId=e;this.position=a;this.handleType=g;this.translation=d.Point3.zero();this.groupId=h}}(),e=function(c){function b(b){var a=c.call(this)||this;a._meshIds=new g;a._scaleModifier=1;a._id=0;a._handleData=new Map;a._translationFromInitialHandlePosition=d.Point3.zero();a._groupIdRotationMatrix=new Map;a._viewer=
b;a._callbacks={camera:function(){a._updateCamera()},_assemblyTreeReady:function(){return __awaiter(a,void 0,void 0,function(){var b,a,c,d,f=this;return __generator(this,function(e){this._updateViewport();this._hideOverlay();b=this._createMeshId(this._getAxisMeshData()).then(function(b){f._meshIds.axis=b});a=this._createMeshId(this._getPlaneMeshData()).then(function(b){f._meshIds.plane=b});c=this._createMeshId(this._getViewPlaneMeshData()).then(function(b){f._meshIds.viewPlane=b});d=this._createMeshId(this._getRotateMeshData()).then(function(b){f._meshIds.rotate=
b});b;a;c;d;return[2]})})},modelSwitchStart:function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.removeHandles()];case 1:return b.sent(),[2]}})})}};a._viewer.setCallbacks(a._callbacks);return a}__extends(b,c);b.prototype.remove=function(){null!==this._callbacks&&(this._viewer.unsetCallbacks(this._callbacks),this._callbacks=null);c.prototype.remove.call(this)};b.prototype._getAxisMeshData=function(){return d.Util.generateConeCylinderMeshData(b._cylinderRadius,
b._segmentCount,b._cylinderHeight,b._coneBaseRadius,b._capHeight,b._taperHeight)};b.prototype._getPlaneMeshData=function(){var a=new d.Point3(b._planeOffset,0,b._planeOffset),c=new d.Point3(b._planeOffset+b._planeLength,0,b._planeOffset),e=new d.Point3(b._planeOffset+b._planeLength,0,b._planeOffset+b._planeLength),g=new d.Point3(b._planeOffset,0,b._planeOffset+b._planeLength),h=[a.x,a.y,a.z,c.x,c.y,c.z,e.x,e.y,e.z,a.x,a.y,a.z,e.x,e.y,e.z,g.x,g.y,g.z],p=new d.Point3(0,-1,0);p=[p.x,p.y,p.z,p.x,p.y,
p.z,p.x,p.y,p.z,p.x,p.y,p.z,p.x,p.y,p.z,p.x,p.y,p.z];var q=new d.MeshData;q.addFaces(h,p);q.setBackfacesEnabled(!0);q.addPolyline([a.x,a.y,a.z,c.x,c.y,c.z]);q.addPolyline([c.x,c.y,c.z,e.x,e.y,e.z]);q.addPolyline([e.x,e.y,e.z,g.x,g.y,g.z]);q.addPolyline([g.x,g.y,g.z,a.x,a.y,a.z]);return q};b.prototype._getViewPlaneMeshData=function(){return d.Util.generateSphereMeshData()};b.prototype._getRotateMeshData=function(b,a,c){void 0===b&&(b=35);void 0===a&&(a=12);void 0===c&&(c=.5);var f=b*Math.PI/180*.5;
b=[];for(var e=-f;e<=f;e+=.1){var g=Math.sin(e)*a;b.push(Math.cos(e)*a);b.push(0);b.push(g)}a=new d.Point3(0,0,1);c=d.Util.createCylinderMeshDataFromArc(b,a,10,c);c.setBackfacesEnabled(!0);return c};b.prototype.setAxisMeshData=function(b){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return null!==this._meshIds.axis?[3,2]:[4,this._createMeshId(b)];case 1:return a=c.sent(),this._meshIds.axis=a,[3,3];case 2:return[2,this._viewer.model.replaceMesh(this._meshIds.axis,
b)];case 3:return[2]}})})};b.prototype.setPlaneMeshData=function(b){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return null!==this._meshIds.plane?[3,2]:[4,this._createMeshId(b)];case 1:return a=c.sent(),this._meshIds.plane=a,[3,3];case 2:return[2,this._viewer.model.replaceMesh(this._meshIds.plane,b)];case 3:return[2]}})})};b.prototype.setViewPlaneMeshData=function(b){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,
function(c){switch(c.label){case 0:return null!==this._meshIds.viewPlane?[3,2]:[4,this._createMeshId(b)];case 1:return a=c.sent(),this._meshIds.viewPlane=a,[3,3];case 2:return[2,this._viewer.model.replaceMesh(this._meshIds.viewPlane,b)];case 3:return[2]}})})};b.prototype.setRotateMeshData=function(b){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return null!==this._meshIds.rotate?[3,2]:[4,this._createMeshId(b)];case 1:return a=c.sent(),
this._meshIds.rotate=a,[3,3];case 2:return[2,this._viewer.model.replaceMesh(this._meshIds.rotate,b)];case 3:return[2]}})})};b.prototype.getOverlayId=function(){return d.BuiltinOverlayIndex.Handles};b.prototype._hideOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.Handles,!1)};b.prototype.hideOverlay=function(){this._hideOverlay();return Promise.resolve()};b.prototype._showOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.Handles,!0);
this._updateCamera()};b.prototype.showOverlay=function(){this._showOverlay();return Promise.resolve()};b.prototype._updateViewport=function(){this._viewer.overlayManager.setViewport(d.BuiltinOverlayIndex.Handles,d.OverlayAnchor.UpperLeftCorner,0,d.OverlayUnit.ProportionOfCanvas,0,d.OverlayUnit.ProportionOfCanvas,1,d.OverlayUnit.ProportionOfCanvas,1,d.OverlayUnit.ProportionOfCanvas)};b.prototype.updateViewport=function(){this._updateViewport();return Promise.resolve()};b.prototype.addHandles=function(b,
a,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){switch(f.label){case 0:return this._scaleModifier=a,this._translationFromInitialHandlePosition.assign(d.Point3.zero()),[4,this.createDefaultHandles(b,c)];case 1:return f.sent(),this._showOverlay(),[2]}})})};b.prototype._updateCamera=function(){this._viewer.overlayManager.setCamera(d.BuiltinOverlayIndex.Handles,this._viewer.view.getCamera())};b.prototype.getVector=function(b){b=this._handleData.get(b);return void 0!==
b&&(b=b.vector,null!==b)?b.copy():null};b.prototype.getHandleType=function(b){b=this._handleData.get(b);return void 0===b?null:b.handleType};b.prototype.getHandleGroupId=function(a){a=this._handleData.get(a);return void 0===a?b.defaultGroupId:a.groupId};b.prototype.getPosition=function(b){if(b=this._handleData.get(b)){var a=b.translation.copy();return b.position.copy().add(this._translationFromInitialHandlePosition).add(a)}return null};b.prototype.getHandleNodeIds=function(){var b=[];this._handleData.forEach(function(a,
c){b.push(c)});return b};b.prototype.removeHandles=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(a){switch(a.label){case 0:return b=this.getHandleNodeIds(),this._handleData.clear(),this._groupIdRotationMatrix.clear(),this._id=0,this._hideOverlay(),[4,this._viewer.model.deleteMeshInstances(b)];case 1:return a.sent(),[2]}})})};b.prototype.isEmpty=function(){return 0===this._handleData.size};b.prototype.createDefaultHandles=function(a,c){return __awaiter(this,
void 0,void 0,function(){var f;return __generator(this,function(e){switch(e.label){case 0:return f=[],f.push(this.addViewPlaneHandle(a,b._viewPlaneColor,c)),f.push(this.addAxisTranslationHandle(a,new d.Point3(1,0,0),b._xColor,null,c)),f.push(this.addAxisTranslationHandle(a,new d.Point3(0,1,0),b._yColor,null,c)),f.push(this.addAxisTranslationHandle(a,new d.Point3(0,0,1),b._zColor,null,c)),f.push(this.addPlaneTranslationHandle(a,new d.Point3(1,0,0),b._zColor,d.Color.black(),new d.Point3(0,-1,0),c)),
f.push(this.addPlaneTranslationHandle(a,new d.Point3(0,1,0),b._xColor,d.Color.black(),new d.Point3(0,0,-1),c)),f.push(this.addPlaneTranslationHandle(a,new d.Point3(0,0,1),b._yColor,d.Color.black(),new d.Point3(-1,0,0),c)),f.push(this.addRotateHandle(a,new d.Point3(1,0,0),b._zColor,new d.Point3(0,-1,0),c)),f.push(this.addRotateHandle(a,new d.Point3(0,1,0),b._xColor,new d.Point3(0,0,-1),c)),f.push(this.addRotateHandle(a,new d.Point3(0,0,1),b._yColor,new d.Point3(-1,0,0),c)),[4,Promise.all(f)];case 1:return e.sent(),
[2]}})})};b.prototype._createMeshId=function(b){return __awaiter(this,void 0,void 0,function(){var a,c;return __generator(this,function(d){switch(d.label){case 0:return a=this._viewer.model,[4,a.createMesh(b,{doNotDelete:!0})];case 1:return c=d.sent(),[2,c]}})})};b.prototype.addAxisTranslationHandle=function(b,c,e,g,h){return __awaiter(this,void 0,void 0,function(){var f,k,l,n;return __generator(this,function(m){switch(m.label){case 0:if(null!==this._meshIds.axis)return[3,2];f=this._meshIds;return[4,
this._createMeshId(this._getAxisMeshData())];case 1:f.axis=m.sent(),m.label=2;case 2:return k="handle-axis-translation-"+this._id++,l=this._getRotationMatrixFromVector(c,g),[4,this._createMeshInstance(this._meshIds.axis,k,e,null,b.copy(),l.copy())];case 3:return n=m.sent(),this._handleData.set(n,new a(b.copy(),c.copy(),l.copy(),n,d.HandleType.Axis,h)),[2,n]}})})};b.prototype.addViewPlaneHandle=function(b,c,e){return __awaiter(this,void 0,void 0,function(){var f,g;return __generator(this,function(k){switch(k.label){case 0:if(null!==
this._meshIds.viewPlane)return[3,2];f=this._meshIds;return[4,this._createMeshId(this._getViewPlaneMeshData())];case 1:f.viewPlane=k.sent(),k.label=2;case 2:return[4,this._createMeshInstance(this._meshIds.viewPlane,"handle-sphere-instance",c,null,b,new d.Matrix)];case 3:return g=k.sent(),this._handleData.set(g,new a(b.copy(),null,new d.Matrix,g,d.HandleType.ViewPlane,e)),[2,g]}})})};b.prototype.addPlaneTranslationHandle=function(b,c,e,g,h,p){return __awaiter(this,void 0,void 0,function(){var f,k,l,
n;return __generator(this,function(m){switch(m.label){case 0:if(null!==this._meshIds.plane)return[3,2];f=this._meshIds;return[4,this._createMeshId(this._getPlaneMeshData())];case 1:f.plane=m.sent(),m.label=2;case 2:return k="handle-plane-translation-"+this._id++,l=this._getRotationMatrixFromVector(c,h),[4,this._createMeshInstance(this._meshIds.plane,k,e,g,b,l)];case 3:return n=m.sent(),this._handleData.set(n,new a(b.copy(),c.copy(),l.copy(),n,d.HandleType.Plane,p)),[2,n]}})})};b.prototype.addRotateHandle=
function(b,c,e,g,h){return __awaiter(this,void 0,void 0,function(){var f,k,l,n;return __generator(this,function(m){switch(m.label){case 0:if(null!==this._meshIds.rotate)return[3,2];f=this._meshIds;return[4,this._createMeshId(this._getRotateMeshData())];case 1:f.rotate=m.sent(),m.label=2;case 2:return k="handle-rotate-"+this._id++,l=this._getRotationMatrixFromVector(c,g),[4,this._createMeshInstance(this._meshIds.rotate,k,e,null,b,l)];case 3:return n=m.sent(),this._handleData.set(n,new a(b.copy(),c.copy(),
l.copy(),n,d.HandleType.Rotate,h)),[2,n]}})})};b.prototype._getRotationMatrixFromVector=function(b,a){a||(a=new d.Point3(1,0,0),.001>d.Point3.cross(a,b).squaredLength()&&(a=new d.Point3(0,1,0)));a=d.Point3.cross(a,b).normalize();var c=d.Point3.cross(a,b).normalize();b.normalize();var f=new d.Matrix;f.m[0]=a.x;f.m[1]=a.y;f.m[2]=a.z;f.m[3]=0;f.m[4]=b.x;f.m[5]=b.y;f.m[6]=b.z;f.m[7]=0;f.m[8]=c.x;f.m[9]=c.y;f.m[10]=c.z;f.m[11]=0;f.m[12]=0;f.m[13]=0;f.m[14]=0;f.m[15]=1;return f};b.prototype._createMeshInstance=
function(b,a,c,e,g,h){return __awaiter(this,void 0,void 0,function(){var f,k,l;return __generator(this,function(n){f=this._createTransformationMatrix(g,new d.Matrix);f=d.Matrix.multiply(h,f);k=new d.MeshInstanceData(b,f,a,c||void 0,e||void 0);k.setOpacity(1);k.setCreationFlags(d.MeshInstanceCreationFlags.SuppressCameraScale|d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.ExcludeBounding|d.MeshInstanceCreationFlags.DoNotXRay|d.MeshInstanceCreationFlags.OverrideSceneVisibility|
d.MeshInstanceCreationFlags.AlwaysDraw);k.setOverlayIndex(d.BuiltinOverlayIndex.Handles);l=this._viewer.model;return[2,l.createMeshInstance(k,void 0,!0,!0)]})})};b.prototype._createTransformationMatrix=function(a,c){var f=b._defaultScale*this._scaleModifier;f=(new d.Matrix).setScaleComponent(f,f,f);f=d.Matrix.multiply(f,c);f.setTranslationComponent(a.x,a.y,a.z);return f};b.prototype._getHandlePosition=function(b){var a=null;this._handleData.forEach(function(c){c.groupId===b&&(a=c.position.copy())});
return a};b.prototype.getGroupIdRotationMatrix=function(b){b=this._groupIdRotationMatrix.get(b);return void 0===b?new d.Matrix:b.copy()};b.prototype.updatePosition=function(b,a,c,e,g){return __awaiter(this,void 0,void 0,function(){var f,k,h,l,n=this;return __generator(this,function(m){switch(m.label){case 0:f=this._viewer.model;k=[];h=new Map;l=this._getHandlePosition(e);if(null===l)return[2];this._handleData.forEach(function(m,p){var q=m.groupId,r=void 0!==g.get(q);if(q===e||r){var t=m.position.copy();
t.add(b.copy());var u=m.translation.copy();t.add(u);u=d.Matrix.multiply(n.getGroupIdRotationMatrix(q),a);u=d.Matrix.multiply(m.matrix,u);r&&(r=d.Point3.subtract(t,l),a.transform(r,t),t.add(l));r=n._createTransformationMatrix(t,u);c&&(m.position.assign(t),h.set(q,d.Matrix.multiply(n.getGroupIdRotationMatrix(q),a)));k.push(f.setNodeMatrix(p,r))}});h.forEach(function(b,a){n._groupIdRotationMatrix.set(a,b.copy())});return[4,Promise.all(k)];case 1:return m.sent(),[2]}})})};b.prototype.resetTranslation=
function(){var b=this;this._translationFromInitialHandlePosition&&(this._handleData.forEach(function(a){a.translation.add(b._translationFromInitialHandlePosition)}),this._translationFromInitialHandlePosition.assign(d.Point3.zero()))};b.prototype.getTranslation=function(){return this._translationFromInitialHandlePosition};b.className="Communicator.Markup.HandleMarkup";b.defaultGroupId=-1;b._defaultScale=.02;b._cylinderRadius=.5;b._coneBaseRadius=.9;b._cylinderHeight=7;b._capHeight=1.2;b._taperHeight=
.2;b._segmentCount=20;b._planeOffset=1;b._planeLength=2.5;b._xColor=new d.Color(168,56,59);b._yColor=new d.Color(96,166,50);b._zColor=new d.Color(41,81,185);b._viewPlaneColor=d.Color.white();return b}(h.MarkupItem);h.HandleMarkup=e})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){var c=a.call(this,b)||this;c._firstNode=null;c._firstPointShape=new h.Shape.Circle;c._secondPointShape=new h.Shape.Circle;c._arrowsInvert=!1;c._measurePoint1=null;c._measurePoint2=null;c._leaderPoint1=null;c._leaderPoint2=null;c._textPoint=null;c._name="MeasureBodyBodyDistance";c._lineShapes=[];for(var e=0;6>e;e++)c._lineShapes.push(new h.Shape.Line),c._lineShapes[e].setStrokeColor(c._viewer.measureManager.getMeasurementColor()),
c._lineShapes[e].setEndEndcapColor(c._viewer.measureManager.getMeasurementColor()),c._lineShapes[e].setStartEndcapColor(c._viewer.measureManager.getMeasurementColor());c._viewer=b;c.initCircle(c._firstPointShape);c.initCircle(c._secondPointShape);c._textShape=new h.Shape.TextBox;c._textShape.getBoxPortion().setFillOpacity(1);c._textShape.getBoxPortion().setFillColor(new d.Color(255,255,255));return c}__extends(c,a);c.prototype.initCircle=function(b){b.setRadius(2.5);b.setFillColor(this._viewer.measureManager.getMeasurementColor())};
c.prototype.setUnitMultiplier=function(b){this._unitMultiplier=b};c.prototype.setFirstNode=function(b){this._stage=1;this._firstNode=b};c.prototype.getFirstNode=function(){return this._firstNode};c.prototype.setSecondNode=function(b){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:if(null===this._firstNode)return[2];this._stage=2;return[4,this._viewer.model.computeMinimumBodyBodyDistance(this._firstNode,b)];case 1:return a=c.sent(),this._measurePoint1=
a.pos1.copy(),this._measurePoint2=a.pos2.copy(),this._textPoint=a.pos2.copy(),this._setMeasurementValue(a.distance),[2]}})})};c.prototype._getStage=function(){return this._stage};c.prototype.finalize=function(){this._stage++};c.prototype.adjust=function(b){a.prototype.adjust.call(this,b);if(!(2>this._stage)){var c=this._viewer.view.raycastFromPoint(b);if(null!==c&&null!==this._measurePoint1&&null!==this._measurePoint2&&null!=this._textPoint){var e=new d.Point3(1,0,0);this._measurePoint2.equals(this._measurePoint1)||
(e=d.Point3.subtract(this._measurePoint2,this._measurePoint1));var g=this._viewer.view.getCamera().getUp();b=d.Point3.cross(c.direction,g).normalize();var h=new d.Point3((this._measurePoint1.x+this._measurePoint2.x)/2,(this._measurePoint1.y+this._measurePoint2.y)/2,(this._measurePoint1.z+this._measurePoint2.z)/2);g=new d.Point3(h.x+g.x,h.y+g.y,h.z+g.z);var m=new d.Point3(h.x+b.x,h.y+b.y,h.z+b.z),p=new d.Point3(c.origin.x+1E6*c.direction.x,c.origin.y+1E6*c.direction.y,c.origin.z+1E6*c.direction.z);
b=new d.Point3(0,0,0);d.Util.intersectionPlaneLine(c.origin,p,h,g,m,b);this._textPoint.assign(b);new d.Point3(0,0,0);c=Math.abs(e.x)<=Math.abs(e.y)&&Math.abs(e.x)<=Math.abs(e.z)?new d.Point3(1,0,0):Math.abs(e.y)<=Math.abs(e.x)&&Math.abs(e.y)<=Math.abs(e.z)?new d.Point3(0,1,0):new d.Point3(0,0,1);c=d.Point3.cross(c,e);h=d.Point3.cross(c,e);c.set(this._measurePoint1.x+c.x,this._measurePoint1.y+c.y,this._measurePoint1.z+c.z);h.set(this._measurePoint1.x+h.x,this._measurePoint1.y+h.y,this._measurePoint1.z+
h.z);g=new d.Point3(b.x+1E4*e.x,b.y+1E4*e.y,b.z+1E4*e.z);e=new d.Point3(b.x-1E4*e.x,b.y-1E4*e.y,b.z-1E4*e.z);e=d.Util.intersectionPlaneLine(g,e,this._measurePoint1,c,h,b);c=!isNaN(b.x)&&!isNaN(b.y)&&!isNaN(b.z);e&&c||(b=this._measurePoint2.copy());b=d.Point3.subtract(b,this._measurePoint1);this._leaderPoint1=new d.Point3(this._measurePoint1.x+b.x,this._measurePoint1.y+b.y,this._measurePoint1.z+b.z);this._leaderPoint2=new d.Point3(this._measurePoint2.x+b.x,this._measurePoint2.y+b.y,this._measurePoint2.z+
b.z);this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}}};c.prototype._updateArrowsInverted=function(){if(null!==this._leaderPoint1&&null!==this._leaderPoint2&&null!==this._textPoint){var b=new d.Point3((this._leaderPoint1.x+this._leaderPoint2.x)/2,(this._leaderPoint1.y+this._leaderPoint2.y)/2,(this._leaderPoint1.z+this._leaderPoint2.z)/2),a=d.Point3.subtract(this._leaderPoint2,this._leaderPoint1);2*d.Point3.subtract(this._textPoint,b).length()>a.length()?this._arrowsInvert=
!0:this._arrowsInvert=!1}};c.prototype.update=function(){var b=this;a.prototype.update.call(this);if(!(1>=this._stage)){var c=this._viewer.view;this._behindView=!1;var e=function(a){if(null===a)return d.Point2.zero();a=c.projectPoint(a);0>=a.z&&(b._behindView=!0);return d.Point2.fromPoint3(a)},g=e(this._measurePoint1),n=e(this._measurePoint2),m=e(this._textPoint),p=e(this._leaderPoint1);e=e(this._leaderPoint2);this._firstPointShape.setCenter(g);this._textShape&&this._textShape.setPosition(m);this._secondPointShape.setCenter(n);
this._lineShapes[0].set(g,n);this._lineShapes[1].set(p,e);this._lineShapes[2].set(g,p);this._lineShapes[3].set(n,e);this._lineShapes[4].set(p,m);this._lineShapes[5].set(p,e);this._lineShapes[5].setEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[5].setStartEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[5].setEndcapsInverted(this._arrowsInvert)}};c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()&&(this.update(),!this._behindView)){var b=
this._viewer.markupManager.getRenderer();if(2===this._stage||3===this._stage){b.drawCircle(this._firstPointShape);b.drawCircle(this._secondPointShape);for(var a=0,c=this._lineShapes;a<c.length;a++)b.drawLine(c[a]);b.drawTextBox(this._textShape)}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{name:this._name,measurePoint1:this._measurePoint1,measurePoint2:this._measurePoint2,leaderPoint1:this._leaderPoint1,leaderPoint2:this._leaderPoint2,textPoint:this._textPoint,
text:this._textShape.getTextString(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,className:this.getClassName()}};c.fromJson=function(b,a){a=new c(a);a._name=b.name;a._measurePoint1=d.Point3.fromJson(b.measurePoint1);a._measurePoint2=d.Point3.fromJson(b.measurePoint2);a._textPoint=d.Point3.fromJson(b.textPoint);a._textShape.setTextString(b.text);a._leaderPoint1=d.Point3.fromJson(b.leaderPoint1);a._leaderPoint2=d.Point3.fromJson(b.leaderPoint2);a._measurementValue=b.measurementValue;
a._unitMultiplier=b.unitMultiplier||1;a._updateArrowsInverted();a._stage=2;return a};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureBodyBodyDistanceMarkup"};return c}(g.MeasureMarkup);g.MeasureBodyBodyDistanceMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){var a=function(a){function c(b){var c=a.call(this,b)||this;c._lineEdgeShape=new d.Shape.Polyline;c._linePositions=[];c._name="MeasureLength";c._positions=[];c._lineShapes=[];c._lineEdgeShape.setStrokeWidth(4);c._lineEdgeShape.setStrokeColor(b.measureManager.getMeasurementEdgeColor());return c}__extends(c,a);c.prototype.setLineGeometry=function(b){this._lineEdgeShape.setStrokeColor(this._viewer.measureManager.getMeasurementEdgeColor());this._linePositions=b;this._stage=
1};c.prototype.reset=function(){this._stage=0};c.prototype.adjust=function(b){a.prototype.adjust.call(this,b)};c.prototype.update=function(){a.prototype.update.call(this);var b=this._viewer.measureManager,c=b.getMeasurementColor();b=b.getMeasurementEdgeColor();this._lineShapes.forEach(function(b){b.setStrokeColor(c)});this._lineEdgeShape.setStrokeColor(b)};c.prototype.draw=function(){};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureLengthMarkup"};return c}(g.MeasureMarkup);
g.MeasureLengthMarkup=a})(d.Measure||(d.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b,c,e,g){var f=a.call(this,b)||this;f._circlePoints=[];f._radius=0;f._surfaceCenter=d.Point3.zero();f._circlePlane=new d.Plane;f._arrowsInvert=!1;f._name="MeasureCircleEdgeLength";f._lineProperties=c;f._matrix=e.copy();f._unitMultiplier=g;f._textShape.getBoxPortion().setFillOpacity(1);f._textShape.getBoxPortion().setFillColor(new d.Color(255,255,255));for(c=0;5>c;c++)f._lineShapes.push(new h.Shape.Line),f._lineShapes[c].setStrokeColor(b.measureManager.getMeasurementColor());
return f}__extends(c,a);c.prototype.createCircleData=function(){d.Util.generatePointsOnCircle(this._circlePoints,this._lineProperties.origin,this._lineProperties.radius,32,this._lineProperties.normal);this._matrix.transformArray(this._circlePoints,this._circlePoints);this._positions[0]=this._circlePoints[0].copy();this._positions[1]=this._circlePoints[16].copy();var b=new d.Point3(this._lineProperties.radius,0,0),a=new d.Point3(0,0,0);this._matrix.transform(b,b);this._matrix.transform(a,a);this._radius=
d.Point3.subtract(a,b).length();d.Point3.subtract(this._positions[1],this._positions[0]);this._positions[4]=this._positions[1].copy();this._surfaceCenter=this._matrix.transform(this._lineProperties.origin);b=new d.Point3(this._circlePoints[0].x,this._circlePoints[0].y,this._circlePoints[0].z);a=new d.Point3(this._circlePoints[1].x,this._circlePoints[1].y,this._circlePoints[1].z);this._circlePlane=d.Plane.createFromPoints(b,a,this._surfaceCenter)};c.prototype.setLineGeometry=function(b){a.prototype.setLineGeometry.call(this,
b);this._positions[0]=this._linePositions[0];this._positions[0].equals(this._positions[this._positions.length-1])?this._positions[1]=this._positions[Math.floor(this._positions.length/2)]:this._positions[1]=this._linePositions[this._linePositions.length-1];this._positions[1]=this._linePositions[this._linePositions.length-1];this._positions[2]=this._linePositions[1].copy();this.createCircleData();this._setMeasurementValue(this._radius)};c.prototype.adjust=function(b){a.prototype.adjust.call(this,b);
var c=this._viewer.view.raycastFromPoint(b);if(null!==c){b=this._surfaceCenter;var e=this._circlePlane,g=e.rayIntersection(c);null===g&&(g=d.Point3.add(b,c.direction.copy().scale(-2*this._radius)),g=d.Plane.createFromPointAndNormal(g,c.direction).rayIntersection(c),console.assert(null!==g),c=new d.Ray(g,e.normal),g=e.rayIntersection(c),null===g&&(g=e.rayIntersection(c.negate())));null===g&&(console.assert(!1),g=b.copy());c=d.Point3.subtract(g,b).normalize().scale(this._radius);e=d.Point3.add(b,c);
b=d.Point3.subtract(b,c);this._positions[0]=e;this._positions[1]=b;this._positions[2]=e.copy();this._positions[3]=b.copy();this._positions[4]=g.copy();this._positions[5]=this._surfaceCenter.copy();this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}};c.prototype._updateArrowsInverted=function(){var b=new d.Point3((this._positions[4].x+this._positions[5].x)/2,(this._positions[4].y+this._positions[5].y)/2,(this._positions[4].z+this._positions[5].z)/2),a=d.Point3.subtract(this._positions[5],
this._positions[4]);this._arrowsInvert=2*d.Point3.subtract(this._positions[2],b).length()>a.length()};c.prototype.update=function(){a.prototype.update.call(this);var b=this._viewer.view;if(0<this._stage){this._lineEdgeShape.clearPoints();for(var c=0,e=this._linePositions;c<e.length;c++){var g=d.Point2.fromPoint3(b.projectPoint(e[c]));this._lineEdgeShape.pushPoint(g)}}if(1<this._stage){c=Array(6);for(e=0;e<this._positions.length;e++)c[e]=d.Point2.fromPoint3(b.projectPoint(this._positions[e]));this._textShape&&
this._textShape.setPosition(c[4]);this._lineShapes[0].set(c[5],c[2]);this._lineShapes[1].set(c[5],c[4]);b=this._viewer.measureManager.getMeasurementColor();this._lineShapes[0].setEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[0].setStartEndcapType(h.Shape.EndcapType.None);this._lineShapes[0].setEndcapsInverted(this._arrowsInvert);this._lineShapes[0].setEndEndcapColor(b);this._lineShapes[0].setStartEndcapColor(b)}};c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()){this.update();
var b=this._viewer.markupManager.getRenderer();switch(this._stage){case 1:b.drawPolyline(this._lineEdgeShape);break;case 2:case 3:for(var a=0;2>a;a++)b.drawLine(this._lineShapes[a]);b.drawTextBox(this._textShape);b.drawPolyline(this._lineEdgeShape)}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){var b=g.MeasureMarkup._serializePointArray(this._linePositions),a=g.MeasureMarkup._serializePointArray(this._positions);return{matrix:this._matrix.toJson(),lineOrigin:this._lineProperties.origin,
lineRadius:this._lineProperties.radius,lineNormal:this._lineProperties.normal,linePositions:b,positions:a,text:this._textShape.getTextString(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){var f=d.Matrix.fromJson(b.matrix),e=b.lineRadius,h=d.Point3.fromJson(b.lineOrigin),m=d.Point3.fromJson(b.lineNormal);e=new d.SubentityProperties.CircleElement(e,h,m);a=new c(a,
e,f,b.unitMultiplier||1);f=g.MeasureMarkup._constructPointArray(b.linePositions);e=g.MeasureMarkup._constructPointArray(b.positions);a.setLineGeometry(f);a._positions=e;a._textShape.setTextString(b.text);a._stage=3;a._measurementValue=b.measurementValue;return a};c.construct=function(b,a){return c.fromJson(b,a)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureCircleEdgeLengthMarkup"};return c}(g.MeasureLengthMarkup);g.MeasureCircleEdgeLengthMarkup=a})(h.Measure||(h.Measure=
{}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){b=a.call(this,b)||this;b._faceSelection=[];b._arcArray=[];b._lineGeometryShape=new h.Shape.Polyline;b.planeIntersectionLine=[];b._pointOnLine=d.Point3.zero();b._clickpointOriginal2=d.Point3.zero();b._clickpointOriginal1=d.Point3.zero();b._plane1=new d.Plane;b._plane2=new d.Plane;b._secondPoint=d.Point3.zero();b._firstPoint=d.Point3.zero();b._textPos=d.Point3.zero();b._intermediatePoint=d.Point3.zero();b._textAnchorPoint=d.Point3.zero();
b._angle=0;b._useAuthoredNormals=!0;b._name="MeasureFaceFaceAngle";b._lineGeometryShape.setStrokeWidth(2);b._lineGeometryShape.setStrokeColor(b._viewer.measureManager.getMeasurementColor());b._textShape=new h.Shape.TextBox;b._textShape.getBoxPortion().setFillOpacity(1);b._textShape.getBoxPortion().setFillColor(new d.Color(255,255,255));for(var c=0;5>c;c++)b._lineShapes.push(new h.Shape.Line),b._lineShapes[c].setStrokeColor(b._viewer.measureManager.getMeasurementColor());return b}__extends(c,a);c.prototype._getNormalAndPositionFromSelection=
function(b,a,c){return __awaiter(this,void 0,void 0,function(){var f,e,g,k,h;return __generator(this,function(l){switch(l.label){case 0:return f=b.getNodeId(),e=b.getFaceEntity().getCadFaceIndex(),c.assign(b.getPosition().copy()),a.assign(b.getFaceEntity().getNormal()),[4,this._viewer.model.getFaceProperty(f,e)];case 1:return g=l.sent(),this._useAuthoredNormals&&null!==g&&g instanceof d.SubentityProperties.PlaneElement&&(k=this._viewer.model.getNodeNetMatrix(f),h=k.normalMatrix(),null!==h&&h.transform(g.normal,
a)),[2]}})})};c.prototype.getFirstSelection=function(){return this._faceSelection[0]};c.prototype.setFirstFace=function(b){return __awaiter(this,void 0,void 0,function(){var a,c,e,g;return __generator(this,function(f){switch(f.label){case 0:return a=b.getNodeId(),c=b.getFaceEntity().getCadFaceIndex(),this._viewer.model.setNodeFaceColor(a,c,new d.Color(255,0,0)),this._faceSelection.push(b),e=d.Point3.zero(),g=d.Point3.zero(),[4,this._getNormalAndPositionFromSelection(b,e,g)];case 1:return f.sent(),
this._firstPoint=g.copy(),this._plane1.setFromPointAndNormal(this._firstPoint,e),this._clickpointOriginal1=b.getPosition().copy(),this._stage++,[2]}})})};c.prototype.setSecondFace=function(b){return __awaiter(this,void 0,void 0,function(){var a,c,e,g,h,p,q,r,u,t,v,w,y,x,z,B,A;return __generator(this,function(f){switch(f.label){case 0:return a=b.getNodeId(),c=b.getFaceEntity().getCadFaceIndex(),this._faceSelection[1]=b,this._viewer.model.setNodeFaceColor(a,c,new d.Color(255,0,0)),e=d.Point3.zero(),
g=d.Point3.zero(),[4,this._getNormalAndPositionFromSelection(b,g,e)];case 1:f.sent();this._secondPoint=e.copy();this._plane2.setFromPointAndNormal(this._secondPoint,g);this.planeIntersectionLine[0]=new d.Point3(0,0,0);this.planeIntersectionLine[1]=new d.Point3(0,0,0);h=d.Util.intersect3d2Planes(this._plane1,this._firstPoint,this._plane2,this._secondPoint,this.planeIntersectionLine[0],this.planeIntersectionLine[1]);if(2!==h)return[2,!1];p=d.Point3.subtract(this.planeIntersectionLine[1],this.planeIntersectionLine[0]);
p.normalize();this.planeIntersectionLine[0].set(this.planeIntersectionLine[0].x-100*p.x,this.planeIntersectionLine[0].y-100*p.y,this.planeIntersectionLine[0].z-100*p.z);this.planeIntersectionLine[1].set(this.planeIntersectionLine[1].x+100*p.x,this.planeIntersectionLine[1].y+100*p.y,this.planeIntersectionLine[1].z+100*p.z);d.Util.computePointToLineDistance(this._secondPoint,this.planeIntersectionLine[0],this.planeIntersectionLine[1],this._pointOnLine);q=new d.Point3(0,0,0);r=new d.Point3(0,0,0);q.set(this._firstPoint.x+
p.x,this._firstPoint.y+p.y,this._firstPoint.z+p.z);d.Util.computePointToLineDistance(this._pointOnLine,this._firstPoint,q,r);this._firstPoint=r.copy();this._clickpointOriginal2=b.getPosition().copy();u=new d.Matrix;t=d.Point3.subtract(this._secondPoint,this._pointOnLine);v=t.length();w=d.Point3.subtract(this._firstPoint,this._pointOnLine);w.normalize();this._intermediatePoint.set(this._pointOnLine.x+w.x*v,this._pointOnLine.y+w.y*v,this._pointOnLine.z+w.z*v);this._angle=d.Util.computeAngleBetweenVector(t,
w);if(0===this._angle)return[2,!1];this._measurementValue=this._angle;this._textShape.setTextString(this._measurementValue.toFixed(2)+"\u00b0");this._viewer.trigger("measurementValueSet",this);this._textPos=this._pointOnLine.copy();y=!1;x=new d.Point3(0,0,0);z=new d.Point3(0,0,0);d.Util.computeOffaxisRotation(p,1,u);u.transform(t,z);x.set(z.x+this._pointOnLine.x,z.y+this._pointOnLine.y,z.z+this._pointOnLine.z);x=d.Point3.subtract(x,this._firstPoint);B=x.length();d.Util.computeOffaxisRotation(p,-1,
u);u.transform(t,z);x.set(z.x+this._pointOnLine.x,z.y+this._pointOnLine.y,z.z+this._pointOnLine.z);d.Point3.subtract(x,this._firstPoint);A=x.length();A<B&&(y=!0);this._arcArray=d.Util.generateArcPoints(p,y?-this._angle:this._angle,this._pointOnLine,t,30);this._stage++;return[2,!0]}})})};c.prototype.adjust=function(b){a.prototype.adjust.call(this,b);if(!(1>=this._stage)&&(b=this._viewer.view.raycastFromPoint(b),null!==b)){var c=new d.Point3(b.origin.x+1E6*b.direction.x,b.origin.y+1E6*b.direction.y,
b.origin.z+1E6*b.direction.z),e=new d.Point3(0,0,0);d.Util.intersectionPlaneLine(b.origin,c,this._pointOnLine,this._firstPoint,this._secondPoint,e);this._textPos=e.copy();new d.Point3(0,0,0);b=d.Point3.subtract(e,this._pointOnLine);c=b.length();b=d.Point3.subtract(this._secondPoint,this._pointOnLine);b.normalize();this._secondPoint.set(this._pointOnLine.x+b.x*c,this._pointOnLine.y+b.y*c,this._pointOnLine.z+b.z*c);b=d.Point3.subtract(this.planeIntersectionLine[1],this.planeIntersectionLine[0]);b.normalize();
c=new d.Matrix;e=d.Point3.subtract(this._secondPoint,this._pointOnLine);var g=e.length(),h=d.Point3.subtract(this._firstPoint,this._pointOnLine);h.normalize();this._intermediatePoint.set(this._pointOnLine.x+h.x*g,this._pointOnLine.y+h.y*g,this._pointOnLine.z+h.z*g);g=!1;h=new d.Point3(0,0,0);var m=new d.Point3(0,0,0);d.Util.computeOffaxisRotation(b,1,c);c.transform(e,m);h.set(m.x+this._pointOnLine.x,m.y+this._pointOnLine.y,m.z+this._pointOnLine.z);h=d.Point3.subtract(h,this._firstPoint);var p=h.length();
d.Util.computeOffaxisRotation(b,-1,c);c.transform(e,m);h.set(m.x+this._pointOnLine.x,m.y+this._pointOnLine.y,m.z+this._pointOnLine.z);h=d.Point3.subtract(h,this._firstPoint);h.length()<p&&(g=!0);this._arcArray=d.Util.generateArcPoints(b,g?-this._angle:this._angle,this._pointOnLine,e,30);b=this._viewer.view.projectPoint(this._textPos);c=0;for(e=this._arcArray;c<e.length;c++)if(g=this._viewer.view.projectPoint(e[c]),g=(new d.Point3(b.x-g.x,b.y-g.y,b.z-g.z)).length(),void 0===q||q>g)var q=g;void 0===
q||20>=q?this._textAnchorPoint=this._textPos:(c=this._viewer.view.projectPoint(this._intermediatePoint),q=this._viewer.view.projectPoint(this._secondPoint),c=new d.Point3(c.x-b.x,c.y-b.y,c.z-b.z),q=new d.Point3(q.x-b.x,q.y-b.y,q.z-b.z),b=c.length(),q=q.length(),this._textAnchorPoint=b<q?this._intermediatePoint:this._secondPoint)}};c.prototype._nextStage=function(){this._stage++;2<this._stage&&(this._finalized=!0,this.cleanup())};c.prototype.cleanup=function(){var b=this,a=function(a){a=b._faceSelection[a];
b._viewer.model.unsetNodeFaceColor(a.getNodeId(),a.getFaceEntity().getCadFaceIndex())};2<=this._stage&&a(1);1<=this._stage&&a(0)};c.prototype.update=function(){a.prototype.update.call(this);var b=this._viewer.view;if(1<this._stage){this._lineGeometryShape.clearPoints();for(var c=0,e=this._arcArray;c<e.length;c++)this._lineGeometryShape.pushPoint(d.Point2.fromPoint3(b.projectPoint(e[c])));this._lineGeometryShape.setEndcapType(h.Shape.EndcapType.Arrowhead);this._lineGeometryShape.setStartEndcapType(h.Shape.EndcapType.Arrowhead);
this._lineGeometryShape.setEndEndcapSize(5);this._lineGeometryShape.setStartEndcapSize(5);this._lineGeometryShape.setEndEndcapColor(this._viewer.measureManager.getMeasurementColor());this._lineGeometryShape.setStartEndcapColor(this._viewer.measureManager.getMeasurementColor());c=Array(10);c[0]=b.projectPoint(this._textPos);c[1]=b.projectPoint(this._firstPoint);c[2]=b.projectPoint(this._clickpointOriginal1);c[3]=b.projectPoint(this._secondPoint);c[4]=b.projectPoint(this._clickpointOriginal2);c[5]=
b.projectPoint(this._intermediatePoint);c[6]=b.projectPoint(this._textAnchorPoint);this._behindView=!1;b=Array(10);for(e=0;6>=e;e++)0>=c[e].z&&(this._behindView=!0),b[e]=d.Point2.fromPoint3(c[e]);this._textShape&&this._textShape.setPosition(b[0]);this._lineShapes[0].set(b[1],b[2]);this._lineShapes[1].set(b[1],b[5]);this._lineShapes[2].set(b[3],b[4]);this._lineShapes[3].set(b[6],b[0])}};c.prototype.draw=function(){var b=0!==this._viewer.explodeManager.getMagnitude();if(this._visibility&&!b&&(this.update(),
!this._behindView&&2<=this._stage&&4>=this._stage)){b=this._viewer.markupManager.getRenderer();for(var a=0;4>a;a++)b.drawLine(this._lineShapes[a]);b.drawTextBox(this._textShape);b.drawPolyline(this._lineGeometryShape)}};c.prototype.setUseAuthoredNormals=function(b){this._useAuthoredNormals=b};c.prototype.getUseAuthoredNormals=function(){return this._useAuthoredNormals};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){for(var b=[],a=0,c=this._arcArray;a<c.length;a++){var d=
c[a].toJson();b.push(d)}return{text:this._textShape.getTextString(),textPos:this._textPos.toJson(),arcArray:b,firstPoint:this._firstPoint.toJson(),clickpointOriginal1:this._clickpointOriginal1.toJson(),secondPoint:this._secondPoint.toJson(),clickpointOriginal2:this._clickpointOriginal2.toJson(),intermediatePoint:this._intermediatePoint.toJson(),textAnchorPoint:this._textAnchorPoint.toJson(),measurementValue:this._measurementValue,className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};
c.fromJson=function(b,a){a=new c(a);for(var f=0,e=b.arcArray;f<e.length;f++){var g=d.Point3.fromJson(e[f]);a._arcArray.push(g)}a._textShape.setTextString(b.text);a._textPos.assign(d.Point3.fromJson(b.textPos));a._firstPoint.assign(d.Point3.fromJson(b.firstPoint));a._clickpointOriginal1=d.Point3.fromJson(b.clickpointOriginal1);a._secondPoint.assign(d.Point3.fromJson(b.secondPoint));a._clickpointOriginal2=d.Point3.fromJson(b.clickpointOriginal2);a._intermediatePoint.assign(d.Point3.fromJson(b.intermediatePoint));
a._textAnchorPoint.assign(d.Point3.fromJson(b.textAnchorPoint));a._measurementValue=b.measurementValue;a._stage=3;return a};c.construct=function(b,a){return c.fromJson(b,a)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureFaceFaceAngleMarkup"};return c}(g.MeasureMarkup);g.MeasureFaceFaceAngleMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){b=a.call(this,b)||this;b._faceSelection=[];b._line1PreviewShape1=new h.Shape.Line;b._line1PreviewShape2=new h.Shape.Line;b._line2PreviewShape1=new h.Shape.Line;b._line2PreviewShape2=new h.Shape.Line;b._matrix1=new d.Matrix;b._matrix2=new d.Matrix;b._lineGeometryShape=new h.Shape.Polyline;b._parallelFaces=!1;b._triangulatedDistance=!0;b._pointsOnSameRay=!1;b._arrowsInvert=!1;b._faceData=[];b._distance=0;b._surfaceCenter=[d.Point3.zero(),
d.Point3.zero()];b._surfaceAxis1=[d.Point3.zero(),d.Point3.zero()];b._surfaceAxis2=[d.Point3.zero(),d.Point3.zero()];b._cylinderAxisInfinite1=[d.Point3.zero(),d.Point3.zero()];b._cylinderAxisInfinite2=[d.Point3.zero(),d.Point3.zero()];b._firstPointHelper=d.Point3.zero();b._secondPointHelper=d.Point3.zero();b._secondPoint=d.Point3.zero();b._firstPoint=d.Point3.zero();b._textPos=d.Point3.zero();b._name="MeasureFaceFaceDistance";b._lineGeometryShape.setStrokeWidth(2);b._lineGeometryShape.setStrokeColor(b._viewer.measureManager.getMeasurementColor());
b._textShape=new h.Shape.TextBox;b._textShape.getBoxPortion().setFillOpacity(1);b._textShape.getBoxPortion().setFillColor(new d.Color(255,255,255));for(var c=0;5>c;c++)b._lineShapes.push(new h.Shape.Line),b._lineShapes[c].setStrokeColor(b._viewer.measureManager.getMeasurementColor());return b}__extends(c,a);c.prototype.setUnitMultiplier=function(b){this._unitMultiplier=b};c.prototype.setFirstFace=function(b,a,c,e){var f=b.getNodeId(),g=b.getFaceEntity(),k=b.getPosition();this._matrix1=c.copy();this._viewer.model.setNodeFaceColor(f,
g.getCadFaceIndex(),new d.Color(255,0,0));this._faceSelection[0]=b;this._firstPoint=k.copy();this._faceData[0]=a;this._faceData[0]instanceof d.SubentityProperties.PlaneElement?(b=this._faceData[0],a=new d.Point3(b.origin.x+b.normal.x,b.origin.y+b.normal.y,b.origin.z+b.normal.z),this._matrix1.transform(a,this._surfaceAxis1[0]),this._matrix1.transform(b.origin,this._surfaceCenter[0])):this._faceData[0]instanceof d.SubentityProperties.CylinderElement&&this.createCylinderData(this._faceData[0],c,e);this._stage++};
c.prototype.getFirstSelection=function(){return this._faceSelection[0]||null};c.prototype.getFirstFaceData=function(){return this._faceData[0]||null};c.prototype.cleanup=function(){var b=this._viewer.model;2<=this._stage&&b.unsetNodeFaceColor(this._faceSelection[1].getNodeId(),this._faceSelection[1].getFaceEntity().getCadFaceIndex());1<=this._stage&&b.unsetNodeFaceColor(this._faceSelection[0].getNodeId(),this._faceSelection[0].getFaceEntity().getCadFaceIndex())};c.prototype.createCylinderData=function(b,
a,c){c=d.Point3.subtract(c.max,c.min).length()/4;var f=new d.Point3(b.origin.x+1E4*b.normal.x,b.origin.y+1E4*b.normal.y,b.origin.z+1E4*b.normal.z),e=new d.Point3(b.origin.x-1E4*b.normal.x,b.origin.y-1E4*b.normal.y,b.origin.z-1E4*b.normal.z),g=new d.Point3(0,0,0);d.Util.computePointToLineDistance(b.origin,f,e,g);this._surfaceCenter[this._stage]=new d.Point3(0,0,0);a.transform(g,this._surfaceCenter[this._stage]);f=new d.Point3(g.x+b.normal.x,g.y+b.normal.y,g.z+b.normal.z);this._surfaceAxis1[this._stage]=
new d.Point3(0,0,0);a.transform(f,this._surfaceAxis1[this._stage]);f.set(g.x-b.normal.x,g.y-b.normal.y,g.z-b.normal.z);this._surfaceAxis2[this._stage]=new d.Point3(0,0,0);a.transform(f,this._surfaceAxis2[this._stage]);new d.Point3(0,0,0);b=this._surfaceAxis1[this._stage].copy();b=d.Point3.subtract(b,this._surfaceCenter[this._stage]);b.normalize();this._surfaceAxis1[this._stage].set(this._surfaceCenter[this._stage].x+b.x*c,this._surfaceCenter[this._stage].y+b.y*c,this._surfaceCenter[this._stage].z+
b.z*c);this._surfaceAxis2[this._stage].set(this._surfaceCenter[this._stage].x-b.x*c,this._surfaceCenter[this._stage].y-b.y*c,this._surfaceCenter[this._stage].z-b.z*c);this._cylinderAxisInfinite1[this._stage]=new d.Point3(this._surfaceCenter[this._stage].x+b.x*c*1E3,this._surfaceCenter[this._stage].y+b.y*c*1E3,this._surfaceCenter[this._stage].z+b.z*c*1E3);this._cylinderAxisInfinite2[this._stage]=new d.Point3(this._surfaceCenter[this._stage].x-b.x*c*1E3,this._surfaceCenter[this._stage].y-b.y*c*1E3,
this._surfaceCenter[this._stage].z-b.z*c*1E3)};c.prototype.setSecondFace=function(b,a,c,e,g){return __awaiter(this,void 0,void 0,function(){var f,k,h,l,n,t,v,w,y,x,z,B,A,D,C,E,F,H,G,I,K,J;return __generator(this,function(m){switch(m.label){case 0:f=this._faceSelection[0];k=this._faceData[0];if(void 0===f||void 0===k)throw new d.CommunicatorError("setSecondFace() called before setFirstFace()");if(c instanceof d.SubentityProperties.PlaneElement)h=k,l=new d.Point3(h.origin.x+h.normal.x,h.origin.y+h.normal.y,
h.origin.z+h.normal.z),this._matrix1.transform(l,this._surfaceAxis1[0]),this._matrix1.transform(h.origin,this._surfaceCenter[0]);else if(c instanceof d.SubentityProperties.CylinderElement)this.createCylinderData(c,e,g);else return[2];return[4,this._viewer.model.computeMinimumFaceFaceDistance(f.getNodeId(),f.getFaceEntity().getCadFaceIndex(),a.getNodeId(),a.getFaceEntity().getCadFaceIndex())];case 1:n=m.sent();if(0===n.distance)return[2];this._matrix2=e.copy();this._secondPoint=a.getPosition().copy();
if(!(k instanceof d.SubentityProperties.PlaneElement&&c instanceof d.SubentityProperties.PlaneElement))return[3,2];t=c;l=new d.Point3(t.origin.x+t.normal.x,t.origin.y+t.normal.y,t.origin.z+t.normal.z);this._matrix2.transform(l,this._surfaceAxis1[1]);this._matrix2.transform(t.origin,this._surfaceCenter[1]);v=new d.Point3(this._surfaceAxis1[0].x-this._surfaceCenter[0].x,this._surfaceAxis1[0].y-this._surfaceCenter[0].y,this._surfaceAxis1[0].z-this._surfaceCenter[0].z);w=new d.Point3(this._surfaceAxis1[1].x-
this._surfaceCenter[1].x,this._surfaceAxis1[1].y-this._surfaceCenter[1].y,this._surfaceAxis1[1].z-this._surfaceCenter[1].z);v.normalize();w.normalize();y=new d.Point3(-v.x,-v.y,-v.z);v.equalsWithTolerance(w,1E-5)||y.equalsWithTolerance(w,1E-5)?(this._secondPointHelper=new d.Point3(this._secondPoint.x,this._secondPoint.y,this._secondPoint.z),this._firstPointHelper=new d.Point3(this._firstPoint.x,this._firstPoint.y,this._firstPoint.z),x=new d.Plane,x.setFromPointAndNormal(this._surfaceCenter[0],v),
z=new d.Plane,z.setFromPointAndNormal(this._surfaceCenter[1],w),B=new d.Point3(this._firstPoint.x+v.x,this._firstPoint.y+v.y,this._firstPoint.z+v.z),d.Util.intersectionPlaneLine2(f.getPosition(),B,z,this._secondPoint),y.equalsWithTolerance(w,1E-5)&&(A=new d.Point3(-v.x,-v.y,-v.z),x.setFromPointAndNormal(this._surfaceCenter[0],A)),this._distance=D=Math.abs(z.d-x.d)/x.normal.length(),this._setMeasurementValue(this._distance),this._parallelFaces=!0,this._triangulatedDistance=!1,C=new d.Point3(0,1,0),
E=d.Point3.subtract(this._secondPoint,this._firstPoint),F=new d.Point3(0,0,0),F=d.Point3.subtract(this._secondPointHelper,this._firstPoint),H=d.Util.computeAngleBetweenVector(C,E),G=d.Util.computeAngleBetweenVector(C,F),this._textPos.assign(this._secondPoint),.1>H-G&&-.1<H-G&&(this._pointsOnSameRay=!0)):(this._firstPoint.assign(n.pos1),this._secondPoint.assign(n.pos2),this._textPos.assign(n.pos2),this._distance=n.distance,this._setMeasurementValue(this._distance));return[3,8];case 2:if(!(k instanceof
d.SubentityProperties.CylinderElement&&c instanceof d.SubentityProperties.CylinderElement))return[3,3];v=new d.Point3(this._surfaceAxis1[0].x-this._surfaceCenter[0].x,this._surfaceAxis1[0].y-this._surfaceCenter[0].y,this._surfaceAxis1[0].z-this._surfaceCenter[0].z);w=new d.Point3(this._surfaceAxis1[1].x-this._surfaceCenter[1].x,this._surfaceAxis1[1].y-this._surfaceCenter[1].y,this._surfaceAxis1[1].z-this._surfaceCenter[1].z);v.normalize();w.normalize();y=new d.Point3(-v.x,-v.y,-v.z);if(v.equalsWithTolerance(w,
1E-5)||y.equalsWithTolerance(w,1E-5)){I=new d.Point3(0,0,0);d.Util.computePointToLineDistance(this._firstPoint,this._cylinderAxisInfinite1[0],this._cylinderAxisInfinite2[0],I);this._firstPoint=I.copy();K=new d.Point3(this._firstPoint.x,this._firstPoint.y,this._firstPoint.z);K=d.Point3.subtract(K,this._surfaceCenter[0]);K.set(0,0,0);d.Util.computePointToLineDistance(this._firstPoint,this._cylinderAxisInfinite1[1],this._cylinderAxisInfinite2[1],I);this._secondPoint=I.copy();D=d.Point3.subtract(this._secondPoint,
this._firstPoint).length();if(1E-7>D)return[2];this._triangulatedDistance=!1;this._textPos.assign(this._secondPoint);this._setMeasurementValue(D)}else{this._distance=d.Util.distanceLineLine(this._cylinderAxisInfinite1[0],this._cylinderAxisInfinite2[0],this._cylinderAxisInfinite1[1],this._cylinderAxisInfinite2[1],this._firstPoint,this._secondPoint);if(1E-7>this._distance)return[2];this._textPos.assign(this._firstPoint);this._setMeasurementValue(this._distance)}return[3,8];case 3:if(!(k instanceof d.SubentityProperties.CylinderElement&&
c instanceof d.SubentityProperties.PlaneElement))return[3,5];v=new d.Point3(this._surfaceAxis1[0].x-this._surfaceCenter[0].x,this._surfaceAxis1[0].y-this._surfaceCenter[0].y,this._surfaceAxis1[0].z-this._surfaceCenter[0].z);return[4,this._viewer.model.computeMinimumFaceLineDistance(a.getNodeId(),a.getFaceEntity().getCadFaceIndex(),new d.Ray(this._surfaceCenter[0],v))];case 4:J=m.sent();this._distance=J.distance;if(1E-7>this._distance)return[2];this._firstPoint.assign(J.pos1);this._secondPoint.assign(J.pos2);
this._textPos.assign(J.pos2);this._viewer.model.setNodeFaceColor(a.getNodeId(),a.getFaceEntity().getCadFaceIndex(),new d.Color(255,0,0));this._faceData[1]=c;this._faceSelection[1]=a;this._stage++;this.adjust(b);this._setMeasurementValue(this._distance);return[3,8];case 5:if(!(k instanceof d.SubentityProperties.PlaneElement&&c instanceof d.SubentityProperties.CylinderElement))return[3,7];v=new d.Point3(this._surfaceAxis1[1].x-this._surfaceCenter[1].x,this._surfaceAxis1[1].y-this._surfaceCenter[1].y,
this._surfaceAxis1[1].z-this._surfaceCenter[1].z);return[4,this._viewer.model.computeMinimumFaceLineDistance(f.getNodeId(),f.getFaceEntity().getCadFaceIndex(),new d.Ray(this._surfaceCenter[1],v))];case 6:J=m.sent();this._distance=J.distance;if(1E-7>this._distance)return[2];this._firstPoint.assign(J.pos1);this._secondPoint.assign(J.pos2);this._textPos.assign(J.pos2);this._viewer.model.setNodeFaceColor(a.getNodeId(),a.getFaceEntity().getCadFaceIndex(),new d.Color(255,0,0));this._faceData[1]=c;this._faceSelection[1]=
a;this._stage++;this.adjust(b);this._setMeasurementValue(this._distance);return[3,8];case 7:this._firstPoint.assign(n.pos1);this._secondPoint.assign(n.pos2);this._textPos.assign(n.pos2);this._distance=n.distance;if(1E-7>this._distance)return[2];this._setMeasurementValue(this._distance);m.label=8;case 8:return this._viewer.model.setNodeFaceColor(a.getNodeId(),a.getFaceEntity().getCadFaceIndex(),new d.Color(255,0,0)),this._faceData[1]=c,this._faceSelection[1]=a,this._stage++,this.adjust(b),[2]}})})};
c.prototype.adjust=function(b){a.prototype.adjust.call(this,b);if(!(1>=this._stage)){var c=this._viewer.view.raycastFromPoint(b);if(null!==c){var e=new d.Point3(c.origin.x+1E6*c.direction.x,c.origin.y+1E6*c.direction.y,c.origin.z+1E6*c.direction.z),g=d.Util.oneVectorCross(c.direction);new d.Point3(0,0,0);var h=d.Point3.cross(c.direction,g);h.normalize();new d.Point3((this._firstPoint.x+this._secondPoint.x)/2,(this._firstPoint.y+this._secondPoint.y)/2,(this._firstPoint.z+this._secondPoint.z)/2);var m=
this._textPos.copy();g.set(m.x+g.x,m.y+g.y,m.z+g.z);h.set(m.x+h.x,m.y+h.y,m.z+h.z);b=new d.Point3(0,0,0);d.Util.intersectionPlaneLine(c.origin,e,m,g,h,b);2===this._stage?d.Util.computePointToLineDistance(b,this._firstPoint,this._secondPoint,this._textPos):this._parallelFaces||this._triangulatedDistance?(c=new d.Point3(0,0,0),this._pointsOnSameRay||(d.Util.computePointToLineDistance(b,this._secondPoint,this._secondPointHelper,c),new d.Point3(0,0,0),b=d.Point3.subtract(c,this._secondPoint),this._secondPoint=
c.copy(),this._firstPoint.set(this._firstPoint.x+b.x,this._firstPoint.y+b.y,this._firstPoint.z+b.z),this._textPos.set(this._textPos.x+b.x,this._textPos.y+b.y,this._textPos.z+b.z))):(c=new d.Point3(0,0,0),d.Util.computePointToLineDistance(b,this._cylinderAxisInfinite1[1],this._cylinderAxisInfinite2[1],c),b=d.Point3.subtract(c,this._secondPoint),this._secondPoint=c.copy(),this._firstPoint.set(this._firstPoint.x+b.x,this._firstPoint.y+b.y,this._firstPoint.z+b.z),this._textPos.set(this._textPos.x+b.x,
this._textPos.y+b.y,this._textPos.z+b.z));this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}}};c.prototype._updateArrowsInverted=function(){var b=new d.Point3((this._firstPoint.x+this._secondPoint.x)/2,(this._firstPoint.y+this._secondPoint.y)/2,(this._firstPoint.z+this._secondPoint.z)/2),a=d.Point3.subtract(this._secondPoint,this._firstPoint);2*d.Point3.subtract(this._textPos,b).length()>a.length()?this._arrowsInvert=!0:this._arrowsInvert=!1};c.prototype._nextStage=function(){this._stage++;
if(3<this._stage||2<this._stage&&this._triangulatedDistance)this._finalized=!0,this.cleanup()};c.prototype.update=function(){a.prototype.update.call(this);var b=this._viewer.view;this._behindView=!1;if(0!==this._stage){for(var c=Array(10),e=[],g=0;10>g;g++)e.push(new d.Point3(0,0,0));this._faceData[0]instanceof d.SubentityProperties.CylinderElement&&(e[0]=b.projectPoint(this._surfaceCenter[0]),e[1]=b.projectPoint(this._surfaceAxis1[0]),e[2]=b.projectPoint(this._surfaceAxis2[0]),c[0]=d.Point2.fromPoint3(e[0]),
c[1]=d.Point2.fromPoint3(e[1]),c[2]=d.Point2.fromPoint3(e[2]),this._line1PreviewShape1.set(c[0],c[1]),this._line1PreviewShape2.set(c[0],c[2]));1<this._stage&&this._faceData[1]instanceof d.SubentityProperties.CylinderElement&&(e[0]=b.projectPoint(this._surfaceCenter[1]),e[1]=b.projectPoint(this._surfaceAxis1[1]),e[2]=b.projectPoint(this._surfaceAxis2[1]),c[0]=d.Point2.fromPoint3(e[0]),c[1]=d.Point2.fromPoint3(e[1]),c[2]=d.Point2.fromPoint3(e[2]),this._line2PreviewShape1.set(c[0],c[1]),this._line2PreviewShape2.set(c[0],
c[2]));1<this._stage&&(e[0]=b.projectPoint(this._textPos),e[1]=b.projectPoint(this._firstPoint),e[2]=b.projectPoint(this._secondPoint),c[0]=d.Point2.fromPoint3(e[0]),c[1]=d.Point2.fromPoint3(e[1]),c[2]=d.Point2.fromPoint3(e[2]),this._textShape&&this._textShape.setPosition(c[0]),this._lineShapes[0].setEndcapType(h.Shape.EndcapType.Arrowhead),this._lineShapes[0].setStartEndcapType(h.Shape.EndcapType.Arrowhead),this._lineShapes[0].setEndcapsInverted(this._arrowsInvert),this._lineShapes[0].setEndEndcapColor(this._viewer.measureManager.getMeasurementColor()),
this._lineShapes[0].setStartEndcapColor(this._viewer.measureManager.getMeasurementColor()),this._lineShapes[0].set(c[1],c[2]),this._faceData[1]instanceof d.SubentityProperties.CylinderElement&&this._faceData[0]instanceof d.SubentityProperties.CylinderElement?(e[3]=b.projectPoint(this._surfaceCenter[0]),e[4]=b.projectPoint(this._surfaceCenter[1]),c[3]=d.Point2.fromPoint3(e[3]),c[4]=d.Point2.fromPoint3(e[4]),this._lineShapes[1].set(c[1],c[3]),this._lineShapes[2].set(c[2],c[4]),this._lineShapes[3].set(c[0],
c[1])):(e[3]=b.projectPoint(this._firstPointHelper),e[4]=b.projectPoint(this._secondPointHelper),c[3]=d.Point2.fromPoint3(e[3]),c[4]=d.Point2.fromPoint3(e[4]),this._lineShapes[1].set(c[2],c[4]),this._lineShapes[2].set(c[1],c[3]),this._lineShapes[3].set(c[1],c[0])));for(g=0;6>g;g++)0>e[g].z&&(this._behindView=!0)}};c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()&&(this.update(),!this._behindView)){var b=this._viewer.markupManager.getRenderer();switch(this._stage){case 1:this._faceData[0]instanceof
d.SubentityProperties.CylinderElement&&(b.drawLine(this._line1PreviewShape1),b.drawLine(this._line1PreviewShape2));break;case 2:case 3:case 4:this._faceData[0]instanceof d.SubentityProperties.CylinderElement&&this._faceData[1]instanceof d.SubentityProperties.CylinderElement?(3>this._stage&&(b.drawLine(this._line1PreviewShape1),b.drawLine(this._line1PreviewShape2),b.drawLine(this._line2PreviewShape1),b.drawLine(this._line2PreviewShape2)),b.drawLine(this._lineShapes[0]),b.drawLine(this._lineShapes[1]),
b.drawLine(this._lineShapes[2])):(this._viewer.markupManager.getRenderer().drawLine(this._lineShapes[0]),this._parallelFaces&&(b.drawLine(this._lineShapes[1]),b.drawLine(this._lineShapes[2]))),b.drawLine(this._lineShapes[3]),b.drawTextBox(this._textShape)}}};c._serializeFaceProp=function(b){return b instanceof d.SubentityProperties.CylinderElement?{type:"CylinderElement",origin:b.origin.toJson(),normal:b.normal.toJson(),radius:b.radius}:b instanceof d.SubentityProperties.PlaneElement?{type:"PlaneElement",
origin:b.origin.toJson(),normal:b.normal.toJson()}:null};c._constructFaceProp=function(b){if("CylinderElement"===b.type){var a=d.Point3.fromJson(b.origin),c=d.Point3.fromJson(b.normal);return new d.SubentityProperties.CylinderElement(b.radius,a,c)}return"PlaneElement"===b.type?(a=d.Point3.fromJson(b.origin),c=d.Point3.fromJson(b.normal),new d.SubentityProperties.PlaneElement(a,c)):null};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){for(var b=[],a=0,d=this._faceData;a<
d.length;a++)b.push(c._serializeFaceProp(d[a]));a=[];d=0;for(var e=this._surfaceCenter;d<e.length;d++)a.push(e[d].toJson());d=[];for(var g=0,h=this._surfaceAxis1;g<h.length;g++)e=h[g],d.push(e.toJson());g=[];h=0;for(var p=this._surfaceAxis2;h<p.length;h++)e=p[h],g.push(e.toJson());return{text:this._textShape.getTextString(),textPos:this._textPos.toJson(),firstPoint:this._firstPoint.toJson(),secondPoint:this._secondPoint.toJson(),firstPointHelper:this._firstPointHelper.toJson(),secondPointHelper:this._secondPointHelper.toJson(),
measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,parallelFaces:this._parallelFaces,faceData:b,surfaceCenter:a,surfaceAxis1:d,surfaceAxis2:g,name:this.getName(),className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){a=new c(a);a.setName(b.name);a._textShape.setTextString(b.text);a._textPos.assign(d.Point3.fromJson(b.textPos));a._firstPoint.assign(d.Point3.fromJson(b.firstPoint));a._firstPointHelper.assign(d.Point3.fromJson(b.firstPointHelper));
a._secondPoint.assign(d.Point3.fromJson(b.secondPoint));a._secondPointHelper.assign(d.Point3.fromJson(b.secondPointHelper));console.assert(Array.isArray(b.faceData));for(var f=0,e=b.faceData;f<e.length;f++){var g=c._constructFaceProp(e[f]);console.assert(null!==g);a._faceData.push(g)}a._surfaceCenter[0].assign(b.surfaceCenter[0]);a._surfaceCenter[1].assign(b.surfaceCenter[1]);a._surfaceAxis1[0].assign(b.surfaceAxis1[0]);a._surfaceAxis1[1].assign(b.surfaceAxis1[1]);a._surfaceAxis2[0].assign(b.surfaceAxis2[0]);
a._surfaceAxis2[1].assign(b.surfaceAxis2[1]);a._stage=4;a._parallelFaces=b.parallelFaces;a._measurementValue=b.measurementValue;a._unitMultiplier=b.unitMultiplier||1;return a};c.construct=function(b,a){return c.fromJson(b,a)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureFaceFaceDistanceMarkup"};return c}(g.MeasureMarkup);g.MeasureFaceFaceDistanceMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){var c=a.call(this,b)||this;c._anchorLinePoint=null;c._firstLinePoint=null;c._secondLinePoint=null;c._selectionPosition=null;c._lineGeometryShape=new h.Shape.Polyline;c._viewer=b;c._name="MeasureLineLineAngle";c._lineGeometryShape.setStrokeWidth(2);c._lineGeometryShape.setStrokeColor(c._viewer.measureManager.getMeasurementColor());c._lineGeometryShape.setEndcapType(h.Shape.EndcapType.Arrowhead);c._lineGeometryShape.setStartEndcapType(h.Shape.EndcapType.Arrowhead);
c._lineGeometryShape.setEndEndcapSize(5);c._lineGeometryShape.setStartEndcapSize(5);c._lineGeometryShape.setEndEndcapColor(c._viewer.measureManager.getMeasurementColor());c._lineGeometryShape.setStartEndcapColor(c._viewer.measureManager.getMeasurementColor());c._textShape.getBoxPortion().setFillOpacity(1);c._textShape.getBoxPortion().setFillColor(d.Color.white());return c}__extends(c,a);c.prototype.addPoint=function(b){if(!this._finalized){if(null===this._anchorLinePoint)this._anchorLinePoint=b.copy(),
this._stage=1;else if(null===this._firstLinePoint)this._firstLinePoint=b.copy(),this._stage=2;else{var a=d.Point3.subtract(this._firstLinePoint,this._anchorLinePoint),c=d.Point3.subtract(b,this._anchorLinePoint);a=d.Util.computeAngleBetweenVector(a,c);if(0===a||180===a)return;this._secondLinePoint=b.copy();this.setMeasurementText(a.toFixed(2)+"\u00b0");this._measurementValue=a;this._finalized=!0;this._stage=3}this.draw()}};c.prototype.setSelectionPosition=function(b){this._selectionPosition=b};c.prototype._drawPreviewLine=
function(b,a){var c=this._viewer.markupManager.getRenderer(),f=this._viewer.view;b=d.Point2.fromPoint3(f.projectPoint(b));a=d.Point2.fromPoint3(f.projectPoint(a));a=new h.Shape.Line(b,a);c.drawLine(a)};c.prototype._drawAngleMarkup=function(b,a,c){var f=this._viewer.markupManager.getRenderer(),e=this._viewer.view,g=d.Point3.subtract(a,b),k=d.Point3.subtract(c,b),q=d.Point3.cross(g,k).normalize();a=d.Util.computeAngleBetweenVector(g,k);if(0!==a&&180!==a){q=d.Util.generateArcPoints(q,-a,b,k,30);this._lineGeometryShape.clearPoints();
for(var r=0;r<q.length;r++)this._lineGeometryShape.pushPoint(d.Point2.fromPoint3(e.projectPoint(q[r])));f.drawPolyline(this._lineGeometryShape)}k=k.length();g=d.Point3.add(b,g.copy().normalize().scale(k));b=d.Point2.fromPoint3(e.projectPoint(b));g=d.Point2.fromPoint3(e.projectPoint(g));c=d.Point2.fromPoint3(e.projectPoint(c));e=new h.Shape.Line(b,g);f.drawLine(e);c=new h.Shape.Line(b,c);f.drawLine(c);this._textShape.setPosition(g);this._finalized?this._textShape.setTextString(this.getMeasurementText()):
this._textShape.setTextString(a.toFixed(2)+"\u00b0");f.drawTextBox(this._textShape)};c.prototype.draw=function(){this._visibility&&null!==this._anchorLinePoint&&(0>=this._viewer.view.projectPoint(this._anchorLinePoint).z||(1===this._stage?null!==this._selectionPosition&&this._drawPreviewLine(this._anchorLinePoint,this._selectionPosition):2===this._stage?null!==this._firstLinePoint&&null!==this._selectionPosition&&this._drawAngleMarkup(this._anchorLinePoint,this._firstLinePoint,this._selectionPosition):
3===this._stage&&null!=this._firstLinePoint&&null!=this._secondLinePoint&&this._drawAngleMarkup(this._anchorLinePoint,this._firstLinePoint,this._secondLinePoint)))};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{name:this._name,anchorPoint:this._anchorLinePoint.copy(),firstPoint:this._firstLinePoint.copy(),secondPoint:this._secondLinePoint.copy(),measurementValue:this._measurementValue,measurementText:this.getMeasurementText(),className:this.getClassName()}};
c.fromJson=function(b,a){a=new c(a);a._name=b.name;a._anchorLinePoint=d.Point3.fromJson(b.anchorPoint);a._firstLinePoint=d.Point3.fromJson(b.firstPoint);a._secondLinePoint=d.Point3.fromJson(b.secondPoint);a._measurementValue=b.measurementValue;a.setMeasurementText(b.measurementText);a._finalized=!0;a._stage=3;return a};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureLineLineAngleMarkup"};return c}(g.MeasureMarkup);g.MeasureLineLineAngleMarkup=a})(h.Measure||(h.Measure=
{}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){var c=a.call(this,b)||this;c._firstPointShape=new h.Shape.Circle;c._secondPointShape=new h.Shape.Circle;c._arrowsInvert=!1;c._name="MeasurePointPointDistance";c._lineShapes=[];for(var e=0;6>e;e++)c._lineShapes.push(new h.Shape.Line),c._lineShapes[e].setStrokeColor(c._viewer.measureManager.getMeasurementColor()),c._lineShapes[e].setEndEndcapColor(c._viewer.measureManager.getMeasurementColor()),c._lineShapes[e].setStartEndcapColor(c._viewer.measureManager.getMeasurementColor());
c._viewer=b;c.initCircle(c._firstPointShape);c.initCircle(c._secondPointShape);c._textShape=new h.Shape.TextBox;c._textShape.getBoxPortion().setFillOpacity(1);c._textShape.getBoxPortion().setFillColor(new d.Color(255,255,255));return c}__extends(c,a);c.prototype.initCircle=function(b){b.setRadius(2.5);b.setFillColor(this._viewer.measureManager.getMeasurementColor())};c.prototype.setUnitMultiplier=function(b){this._unitMultiplier=b};c.prototype.setFirstPointPosition=function(b){this._stage=1;this._positions[0]=
b.copy()};c.prototype.setSecondPointPosition=function(b){this._stage=2;this._positions[1]=b.copy();this._positions[2]=b.copy();this._setMeasurementValue(d.Point3.subtract(this._positions[1],this._positions[0]).length())};c.prototype._getStage=function(){return this._stage};c.prototype.finalize=function(){this._stage++};c.prototype.getFirstPointPosition=function(){return this._positions[0]};c.prototype.getSecondPointPosition=function(){return this._positions[1]};c.prototype.adjust=function(b){a.prototype.adjust.call(this,
b);var c=this._viewer.view.raycastFromPoint(b);if(null!==c){b=this._positions[0];var e=this._positions[1],g=new d.Point3(1,0,0);e.equals(b)||(g=d.Point3.subtract(e,b));var h=this._viewer.view.getCamera().getUp(),m=d.Point3.cross(c.direction,h).normalize(),p=new d.Point3((b.x+e.x)/2,(b.y+e.y)/2,(b.z+e.z)/2);h=new d.Point3(p.x+h.x,p.y+h.y,p.z+h.z);var q=new d.Point3(p.x+m.x,p.y+m.y,p.z+m.z),r=new d.Point3(c.origin.x+1E6*c.direction.x,c.origin.y+1E6*c.direction.y,c.origin.z+1E6*c.direction.z);m=new d.Point3(0,
0,0);d.Util.intersectionPlaneLine(c.origin,r,p,h,q,m);this._positions[2].assign(m);new d.Point3(0,0,0);c=Math.abs(g.x)<=Math.abs(g.y)&&Math.abs(g.x)<=Math.abs(g.z)?new d.Point3(1,0,0):Math.abs(g.y)<=Math.abs(g.x)&&Math.abs(g.y)<=Math.abs(g.z)?new d.Point3(0,1,0):new d.Point3(0,0,1);c=d.Point3.cross(c,g);p=d.Point3.cross(c,g);c.set(b.x+c.x,b.y+c.y,b.z+c.z);p.set(b.x+p.x,b.y+p.y,b.z+p.z);h=new d.Point3(m.x+1E4*g.x,m.y+1E4*g.y,m.z+1E4*g.z);g=new d.Point3(m.x-1E4*g.x,m.y-1E4*g.y,m.z-1E4*g.z);g=d.Util.intersectionPlaneLine(h,
g,b,c,p,m);c=!isNaN(m.x)&&!isNaN(m.y)&&!isNaN(m.z);g&&c||(m=e.copy());m=d.Point3.subtract(m,b);this._positions[3]=new d.Point3(b.x+m.x,b.y+m.y,b.z+m.z);this._positions[4]=new d.Point3(e.x+m.x,e.y+m.y,e.z+m.z);this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}};c.prototype._updateArrowsInverted=function(){var b=new d.Point3((this._positions[3].x+this._positions[4].x)/2,(this._positions[3].y+this._positions[4].y)/2,(this._positions[3].z+this._positions[4].z)/2),a=d.Point3.subtract(this._positions[4],
this._positions[3]);2*d.Point3.subtract(this._positions[2],b).length()>a.length()?this._arrowsInvert=!0:this._arrowsInvert=!1};c.prototype.update=function(){a.prototype.update.call(this);var b=this._viewer.view,c=Array(6);if(0<this._stage){this._behindView=!1;for(var e=0;e<this._positions.length;e++)0>=b.projectPoint(this._positions[e]).z&&(this._behindView=!0),c[e]=d.Point2.fromPoint3(b.projectPoint(this._positions[e]));this._firstPointShape.setCenter(c[0])}1<this._stage&&(this._textShape&&this._textShape.setPosition(c[2]),
this._secondPointShape.setCenter(c[1]),this._lineShapes[0].set(c[0],c[1]),this._lineShapes[1].set(c[3],c[4]),this._lineShapes[2].set(c[0],c[3]),this._lineShapes[3].set(c[1],c[4]),this._lineShapes[4].set(c[3],c[2]),this._lineShapes[5].set(c[3],c[4]),this._lineShapes[5].setEndcapType(h.Shape.EndcapType.Arrowhead),this._lineShapes[5].setStartEndcapType(h.Shape.EndcapType.Arrowhead),this._lineShapes[5].setEndcapsInverted(this._arrowsInvert))};c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()&&
(this.update(),!this._behindView)){var b=this._viewer.markupManager.getRenderer();switch(this._stage){case 1:b.drawCircle(this._firstPointShape);break;case 2:case 3:b.drawCircle(this._firstPointShape);b.drawCircle(this._secondPointShape);for(var a=0,c=this._lineShapes;a<c.length;a++)b.drawLine(c[a]);b.drawTextBox(this._textShape)}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{name:this._name,measurePoint1:this._positions[0].copy(),measurePoint2:this._positions[1].copy(),
leaderPoint1:this._positions[3].copy(),leaderPoint2:this._positions[4].copy(),textPoint:this._positions[2].copy(),text:this._textShape.getTextString(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){a=new c(a);a._name=b.name;a._positions[0]=d.Point3.fromJson(b.measurePoint1);a._positions[1]=d.Point3.fromJson(b.measurePoint2);a._positions[2]=d.Point3.fromJson(b.textPoint);
a._textShape.setTextString(b.text);a._positions[3]=d.Point3.fromJson(b.leaderPoint1);a._positions[4]=d.Point3.fromJson(b.leaderPoint2);a._measurementValue=b.measurementValue;a._unitMultiplier=b.unitMultiplier||1;a._updateArrowsInverted();a._stage=2;return a};c.construct=function(b,a){return c.fromJson(b,a)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasurePointPointDistanceMarkup"};return c}(g.MeasureMarkup);g.MeasurePointPointDistanceMarkup=a})(h.Measure||(h.Measure=
{}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){var c=a.call(this,b)||this;c._initialPoint=new h.Shape.Circle;c._leaderLine=new h.Shape.Line;c._endpoints=new h.Shape.CircleCollection;c._textboxCorners=[d.Point2.zero(),d.Point2.zero(),d.Point2.zero(),d.Point2.zero()];c._polygon=new h.Shape.Polygon;c._plane=null;c.textPosition=d.Point3.zero();c.leaderPosition=d.Point3.zero();c.pointRadius=2.5;c._viewer=b;b=c._viewer.measureManager.getMeasurementColor();c._initialPoint.setFillColor(b);
c._initialPoint.setStrokeColor(b);c._leaderLine.setStrokeColor(b);c._endpoints.setFillColor(b);c._endpoints.setStrokeColor(b);c._endpoints.setFillOpacity(1);c._textShape.getBoxPortion().setFillOpacity(1);c._textShape.getBoxPortion().setFillColor(d.Color.white());c._polygon.setFillColor(b);c._polygon.setFillOpacity(.4);return c}__extends(c,a);c.prototype._calculateArea=function(){var b=this._positions.length;if(3>b)return 0;for(var a=new Float32Array(3*b),c=0;c<b;c++){var e=this._positions[c];a[3*
c]=e.x;a[3*c+1]=e.y;a[3*c+2]=e.z}b=d.Point3.subtract(this._positions[1],this._positions[0]);c=d.Point3.subtract(this._positions[2],this._positions[0]);b=d.Point3.cross(b,c);a=this._viewer.model.triangulatePolygon(a,b);b=0;c=a.length/3/3;for(e=0;e<c;e++){for(var g=9*e,h=[],p=0;3>p;p++)h[p]=new d.Point3(a[g+3*p],a[g+3*p+1],a[g+3*p+2]);g=d.Point3.subtract(h[1],h[0]).length();p=d.Point3.subtract(h[2],h[0]).length();h=d.Point3.subtract(h[2],h[1]).length();b+=.25*Math.sqrt((g+p+h)*(-g+p+h)*(g-p+h)*(g+p-
h))}return b};c.prototype.addPoint=function(b){if(3<=this._positions.length&&(null===this._plane&&(this._plane=d.Plane.createFromPoints(this._positions[0],this._positions[1],this._positions[2])),1E-4<Math.abs(this._plane.distanceToPoint(b))))return!1;2===this._positions.length&&(this._plane=d.Plane.createFromPoints(this._positions[0],this._positions[1],b));this._positions.push(b.copy());b=this._calculateArea();var a=this.getUnitMultiplier();a=d.Util.formatWithUnit(b,a)+"\u00b2";this._setMeasurementValue(b);
this.setMeasurementText(a);return!0};c.prototype.getPoints=function(){return this._positions};c.prototype.getLast=function(){return 0===this._positions.length?null:this._positions[this._positions.length-1].copy()};c.prototype.finalize=function(){if(2<this._positions.length){var b=this._calculateArea(),a=this.getUnitMultiplier();a=d.Util.formatWithUnit(b,a)+"\u00b2";this._setMeasurementValue(b);this.setMeasurementText(a)}this._finalized=!0};c.prototype.setUnitMultiplier=function(b){this._unitMultiplier=
b};c.prototype.isValid=function(){return 2<this._positions.length};c.prototype.getMeasurementText=function(){return this._textShape.getTextString()};c.prototype._updateProjectedPoints=function(){var b=[];this._behindView=!1;for(var a=0,c=this._positions;a<c.length;a++){var e=this._viewer.view.projectPoint(c[a]);0>=e.z&&(this._behindView=!0);b.push(d.Point2.fromPoint3(e))}return b};c.prototype._updateTextBoxCorners=function(){var b=this._viewer.markupManager.getRenderer().measureTextBox(this._textShape),
a=this._textShape.getPosition();this._textboxCorners[0].assign(a);this._textboxCorners[1].set(a.x+b.x,a.y);this._textboxCorners[2].set(a.x+b.x,a.y+b.y);this._textboxCorners[3].set(a.x,a.y+b.y)};c.prototype._calculateLeaderEndpoint=function(b){this._updateTextBoxCorners();for(var a=d.Point2.zero(),c=Number.MAX_VALUE,e=0,g=this._textboxCorners;e<g.length;e++){var h=g[e],p=d.Point2.distance(b,h);p<c&&(a.assign(h),c=p)}return a};c.prototype.draw=function(){if(this._visibility){var b=this._updateProjectedPoints();
if(!this._behindView&&0!==b.length){var a=this._viewer.markupManager.getRenderer();if(1===b.length)this._initialPoint.set(b[0],this.pointRadius),a.drawCircle(this._initialPoint);else{this._polygon.clearPoints();for(var c=0;c<b.length;c++)this._polygon.pushPoint(b[c]);this._finalized&&this._polygon.pushPoint(b[0]);c=d.Point2.fromPoint3(this._viewer.view.projectPoint(this.textPosition));this._textShape.setPosition(c);a.drawPolygon(this._polygon);c=d.Point2.fromPoint3(this._viewer.view.projectPoint(this.leaderPosition));
var e=this._calculateLeaderEndpoint(c);this._leaderLine.setP1(c);this._leaderLine.setP2(e);a.drawLine(this._leaderLine);a.drawTextBox(this._textShape);this._endpoints.clear();this._endpoints.addCircle(b[0],this.pointRadius);this._endpoints.addCircle(b[b.length-1],this.pointRadius);a.drawCircles(this._endpoints)}}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){for(var b=[],a=0,c=this._positions;a<c.length;a++)b.push(c[a].toJson());return{name:this._name,points:b,
textPoint:this.textPosition.toJson(),leaderPoint:this.leaderPosition.toJson(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,text:this._textShape.getTextString(),className:this.getClassName()}};c.fromJson=function(b,a){a=new c(a);a._name=b.name;a._positions=g.MeasureMarkup._constructPointArray(b.points);a.textPosition=d.Point3.fromJson(b.textPoint);a.leaderPosition=d.Point3.fromJson(b.leaderPoint);a._measurementValue=b.measurementValue;a._unitMultiplier=b.unitMultiplier||
1;a._textShape.setTextString(b.text);a._finalized=!0;return a};c.prototype.hit=function(b){var a=this._viewer.markupManager.getRenderer().measureTextBox(this._textShape),c=this._textShape.getPosition();return b.x<c.x||b.x>c.x+a.x||b.y<c.y||b.y>c.y+a.y?!1:!0};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasurePolygonAreaMarkup"};return c}(g.MeasureMarkup);g.MeasurePolygonAreaMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){var c=a.call(this,b)||this;c._polyline=new h.Shape.Polyline;c._initialPoint=new h.Shape.Circle;c._leaderLine=new h.Shape.Line;c._endpoints=new h.Shape.CircleCollection;c._textboxCorners=[d.Point2.zero(),d.Point2.zero(),d.Point2.zero(),d.Point2.zero()];c.textPosition=d.Point3.zero();c.leaderPosition=d.Point3.zero();c.isLoop=!1;c.pointRadius=2.5;c._viewer=b;b=c._viewer.measureManager.getMeasurementColor();c._initialPoint.setFillColor(b);
c._initialPoint.setStrokeColor(b);c._polyline.setStrokeColor(b);c._polyline.setStrokeWidth(2);c._leaderLine.setStrokeColor(b);c._endpoints.setFillColor(b);c._endpoints.setStrokeColor(b);c._endpoints.setFillOpacity(1);c._textShape.getBoxPortion().setFillOpacity(1);c._textShape.getBoxPortion().setFillColor(d.Color.white());return c}__extends(c,a);c.prototype.addPoint=function(b){this._positions.push(b.copy());1<this._positions.length&&(b=d.Point3.subtract(this._positions[this._positions.length-1],this._positions[this._positions.length-
2]).length(),this._setMeasurementValue(this._measurementValue+b))};c.prototype.getPoints=function(){return this._positions};c.prototype.getlast=function(){return 0===this._positions.length?null:this._positions[this._positions.length-1].copy()};c.prototype.finalize=function(){if(this.isLoop&&2<this._positions.length){var b=d.Point3.subtract(this._positions[this._positions.length-1],this._positions[0]).length();this._setMeasurementValue(this._measurementValue+b)}this._finalized=!0};c.prototype.setUnitMultiplier=
function(b){this._unitMultiplier=b};c.prototype.isValid=function(){return 1<this._positions.length};c.prototype.getMeasurementText=function(){return this._textShape.getTextString()};c.prototype._updateProjectedPoints=function(){var b=[];this._behindView=this._behindView=!1;for(var a=0,c=this._positions;a<c.length;a++){var e=this._viewer.view.projectPoint(c[a]);0>=e.z&&(this._behindView=!0);b.push(d.Point2.fromPoint3(e))}return b};c.prototype._updateTextBoxCorners=function(){var b=this._viewer.markupManager.getRenderer().measureTextBox(this._textShape),
a=this._textShape.getPosition();this._textboxCorners[0].assign(a);this._textboxCorners[1].set(a.x+b.x,a.y);this._textboxCorners[2].set(a.x+b.x,a.y+b.y);this._textboxCorners[3].set(a.x,a.y+b.y)};c.prototype._calculateLeaderEndpoint=function(b){this._updateTextBoxCorners();for(var a=d.Point2.zero(),c=Number.MAX_VALUE,e=0,g=this._textboxCorners;e<g.length;e++){var h=g[e],p=d.Point2.distance(b,h);p<c&&(a.assign(h),c=p)}return a};c.prototype.draw=function(){if(this._visibility){var b=this._updateProjectedPoints();
if(!this._behindView&&0!==b.length){var a=this._viewer.markupManager.getRenderer();if(1===b.length)this._initialPoint.set(b[0],this.pointRadius),a.drawCircle(this._initialPoint);else{this._polyline.clearPoints();for(var c=0;c<b.length;c++)this._polyline.pushPoint(b[c]);this._finalized&&this.isLoop&&this._polyline.pushPoint(b[0]);c=d.Point2.fromPoint3(this._viewer.view.projectPoint(this.textPosition));this._textShape.setPosition(c);a.drawPolyline(this._polyline);c=d.Point2.fromPoint3(this._viewer.view.projectPoint(this.leaderPosition));
var e=this._calculateLeaderEndpoint(c);this._leaderLine.setP1(c);this._leaderLine.setP2(e);a.drawLine(this._leaderLine);a.drawTextBox(this._textShape);this._endpoints.clear();this.isLoop||(this._endpoints.addCircle(b[0],this.pointRadius),this._endpoints.addCircle(b[b.length-1],this.pointRadius),a.drawCircles(this._endpoints))}}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){for(var b=[],a=0,c=this._positions;a<c.length;a++)b.push(c[a].toJson());return{name:this._name,
points:b,textPoint:this.textPosition.toJson(),leaderPoint:this.leaderPosition.toJson(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,isLoop:this.isLoop,text:this._textShape.getTextString(),className:this.getClassName()}};c.fromJson=function(b,a){a=new c(a);a._name=b.name;a._positions=g.MeasureMarkup._constructPointArray(b.points);a.textPosition=d.Point3.fromJson(b.textPoint);a.leaderPosition=d.Point3.fromJson(b.leaderPoint);a.isLoop=b.isLoop;a._measurementValue=b.measurementValue;
a._unitMultiplier=b.unitMultiplier||1;a._textShape.setTextString(b.text);a._finalized=!0;return a};c.prototype.hit=function(b){var a=this._viewer.markupManager.getRenderer().measureTextBox(this._textShape),c=this._textShape.getPosition();return b.x<c.x||b.x>c.x+a.x||b.y<c.y||b.y>c.y+a.y?!1:!0};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasurePolylineDistanceMarkup"};return c}(g.MeasureMarkup);g.MeasurePolylineDistanceMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup=
{}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b,c,e,g){b=a.call(this,b)||this;b._lineProperties=null;b._worldSpaceLength=0;b._arrowsInvert=!1;b._name="MeasureStraightEdgeLength";b._lineProperties=c;b._matrix=e.copy();b._matrix.setTranslationComponent(0,0,0);b._unitMultiplier=g;c=b._viewer.measureManager.getMeasurementColor();for(e=0;5>e;e++)g=new h.Shape.Line,g.setStrokeColor(c),g.setEndEndcapColor(c),g.setStartEndcapColor(c),b._lineShapes.push(g);c=b._textShape.getBoxPortion();
c.setFillOpacity(1);c.setFillColor(new d.Color(255,255,255));return b}__extends(c,a);c.prototype.setLineGeometry=function(b){a.prototype.setLineGeometry.call(this,b);this._positions[0]=this._linePositions[0];this._positions[2]=this._linePositions[0].copy();this._positions[1]=this._linePositions[this._linePositions.length-1];null!==this._lineProperties&&-1!==this._lineProperties.length?(b=new d.Point3(this._lineProperties.length,0,0),this._matrix.transform(b,b),b=this._worldSpaceLength=b.length()):
b=d.Point3.subtract(this._positions[1],this._positions[0]).length();this._setMeasurementValue(b)};c.prototype.adjust=function(b){a.prototype.adjust.call(this,b);var c=this._viewer.view,e=c.raycastFromPoint(b);if(null!==e){b=this._positions[0];var g=this._positions[1],h=new d.Point3(1,0,0);g.equals(b)||(h=d.Point3.subtract(g,b));var m=c.getCamera().getUp();c=d.Point3.cross(e.direction,m).normalize();var p=d.Point3.add(b,g).scale(.5);m=d.Point3.add(p,m);var q=d.Point3.add(p,c),r=d.Point3.add(d.Point3.scale(e.direction,
1E6),e.origin);c=new d.Point3(0,0,0);d.Util.intersectionPlaneLine(e.origin,r,p,m,q,c);this._positions[2].assign(c);new d.Point3(0,0,0);e=Math.abs(h.x)<=Math.abs(h.y)&&Math.abs(h.x)<=Math.abs(h.z)?new d.Point3(1,0,0):Math.abs(h.y)<=Math.abs(h.x)&&Math.abs(h.y)<=Math.abs(h.z)?new d.Point3(0,1,0):new d.Point3(0,0,1);e=d.Point3.cross(e,h);p=d.Point3.cross(e,h);e.add(b);p.add(b);m=d.Point3.add(d.Point3.scale(h,1E4),c);h=d.Point3.add(d.Point3.scale(h,-1E4),c);d.Util.intersectionPlaneLine(m,h,b,e,p,c);h=
d.Point3.subtract(c,b);this._positions[3]=d.Point3.add(b,h);this._positions[4]=d.Point3.add(g,h);this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}};c.prototype._updateArrowsInverted=function(){var b=d.Point3.add(this._positions[3],this._positions[4]).scale(.5),a=d.Point3.subtract(this._positions[4],this._positions[3]);this._arrowsInvert=2*d.Point3.subtract(this._positions[2],b).squaredLength()>a.squaredLength()};c.prototype.update=function(){a.prototype.update.call(this);var b=
this._viewer.view;this._behindView=!1;if(0<this._stage){this._lineEdgeShape.clearPoints();for(var c=Array(this._linePositions.length),e=0;e<this._linePositions.length;e++)c[e]=b.projectPoint(this._linePositions[e]),0>=c[e].z&&(this._behindView=!0),this._lineEdgeShape.pushPoint(d.Point2.fromPoint3(c[e]))}if(1<this._stage){var g=Array(6);c=Array(6);for(e=0;e<this._positions.length;e++)c[e]=b.projectPoint(this._positions[e]),0>=c[e].z&&(this._behindView=!0),g[e]=d.Point2.fromPoint3(c[e]);this._textShape&&
this._textShape.setPosition(g[2]);b=this._viewer.measureManager.getMeasurementColor();this._lineShapes[0].set(g[3],g[4]);this._lineShapes[1].set(g[0],g[3]);this._lineShapes[2].set(g[1],g[4]);this._lineShapes[3].set(g[3],g[2]);this._lineShapes[4].set(g[3],g[4]);this._lineShapes[4].setEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[4].setStartEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[4].setEndcapsInverted(this._arrowsInvert);this._lineShapes[4].setEndEndcapColor(b);this._lineShapes[4].setStartEndcapColor(b)}};
c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()&&(this.update(),!this._behindView)){var b=this._viewer.markupManager.getRenderer();switch(this._stage){case 1:b.drawPolyline(this._lineEdgeShape);break;case 2:case 3:for(var a=0,c=this._lineShapes;a<c.length;a++)b.drawLine(c[a]);b.drawTextBox(this._textShape);b.drawPolyline(this._lineEdgeShape)}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{name:this._name,
measurePoint1:this._positions[0].copy(),measurePoint2:this._positions[1].copy(),leaderPoint1:this._positions[3].copy(),leaderPoint2:this._positions[4].copy(),textPoint:this._positions[2].copy(),text:this._textShape.getTextString(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,className:this.getClassName(),matrix:this._matrix.toJson()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){var e=d.Matrix.fromJson(b.matrix);a=new c(a,null,e,b.unitMultiplier||
1);a._name=b.name;a._positions[0]=d.Point3.fromJson(b.measurePoint1);a._positions[1]=d.Point3.fromJson(b.measurePoint2);a._positions[2]=d.Point3.fromJson(b.textPoint);a._textShape.setTextString(b.text);a._positions[3]=d.Point3.fromJson(b.leaderPoint1);a._positions[4]=d.Point3.fromJson(b.leaderPoint2);a._measurementValue=b.measurementValue;a._updateArrowsInverted();a._stage=2;return a};c.construct=function(b,a){return c.fromJson(b,a)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureStraightEdgeLengthMarkup"};
return c}(g.MeasureLengthMarkup);g.MeasureStraightEdgeLengthMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b,c,e,g,h){var f=a.call(this)||this;f._uniqueId=d.UUID.create();f._noteElementId=null;f._position=d.Point3.zero();f._text="";f._color=d.Color.white();f._sphereRadius=.03;f._deleted=!1;f._active=!1;f._callbacks=null;f._viewer=b;f._noteTextManager=c;f._selectionPosition=e;f._selectionNormal=g;f._partId=h;f._noteTextManager.addNote(f);f._init();return f}__extends(c,a);c.prototype._init=function(){return __awaiter(this,void 0,void 0,
function(){var b,a,c,d,e=this;return __generator(this,function(f){switch(f.label){case 0:return b=this._createPinTransformationMatrix(this._selectionPosition,this._selectionNormal),[4,Promise.all([this._createPinStemInstance(b),this._createPinSphereInstance(b)])];case 1:return a=f.sent(),c=a[0],d=a[1],this._stemInstanceId=c,this._sphereInstanceId=d,[4,this._restore(!1)];case 2:return f.sent(),this._callbacks={visibilityChanged:function(){e._matchPartVisibility()}},this._viewer.setCallbacks(this._callbacks),
this._viewer.trigger("noteTextCreated",this),[2]}})})};c.prototype._matchPartVisibility=function(){if(void 0!==this._sphereInstanceId&&void 0!==this._stemInstanceId){var b=this._viewer.model,a=b.getNodeVisibility(this._partId),c=b.getNodeVisibility(this._sphereInstanceId);a===c||this._noteTextManager.getExplodeActive()||b.setNodesVisibility([this._stemInstanceId,this._sphereInstanceId],a);b=this._noteTextManager.getActiveItem();null===b||b.getStemInstanceId()!==this._stemInstanceId||a||this.hide()}};
c.prototype.updatePosition=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(a){switch(a.label){case 0:return void 0===this._sphereInstanceId?[2]:[4,this._viewer.model.getNodeRealBounding(this._sphereInstanceId)];case 1:return this._pinBoundingBox=b=a.sent(),this._position=this._pinBoundingBox.center(),this.setText(this._text),[2]}})})};c.prototype._restore=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return this._noteTextManager.setActiveItemHandle(this._viewer.markupManager.registerMarkup(this)),
this._noteTextManager.setActiveItem(this),this._show(b),this._updateColor(),[4,this.draw()];case 1:return a.sent(),[2]}})})};c.prototype.restore=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,this._restore(!0)]})})};c.prototype.setText=function(b){this._text=b;this._noteTextManager.getNoteTextElement().setText(b)};c.prototype.saveTextValue=function(){this._text=this._noteTextManager.getNoteTextElement().getText()};c.prototype.draw=function(){return __awaiter(this,
void 0,void 0,function(){var b,a,c;return __generator(this,function(e){switch(e.label){case 0:if(this._deleted||!this._active)return[2];this._behindView=!1;return[4,this.updatePosition()];case 1:return e.sent(),b=this._viewer.view.projectPoint(this._position),0>=b.z&&(this._behindView=!0),this._behindView?null!==this._noteElementId&&null!==document.getElementById(this._noteElementId)&&(this._viewer.markupManager.removeMarkupElement(this._noteElementId),this._noteElementId=null):(a=new d.Point2(b.x,
b.y),c=this._noteTextManager.getNoteTextElement(),c.setPosition(a),null===this._noteElementId&&(this._noteElementId=this._viewer.markupManager.addMarkupElement(c.getHtmlContainer()))),[2]}})})};c.prototype.hit=function(b){return this.hitWithTolerance(b,0)};c.prototype.hitWithTolerance=function(b,a){if(!this._active)return!1;var c=this._noteTextManager.getNoteTextElement(),e=c.getPosition();c=c.getSize();return d.Util.isPointInRect2d(b,e,c,a)};c.prototype.getClassName=function(){return c.className};
c.prototype.getUniqueId=function(){return this._uniqueId};c.prototype.getSphereInstanceId=function(){return this._sphereInstanceId};c.prototype.getStemInstanceId=function(){return this._stemInstanceId};c.prototype.onSelect=function(){this._noteTextManager.getNoteTextElement().focus()};c.prototype.onDeselect=function(){this._noteTextManager.getNoteTextElement().blur()};c.prototype.hide=function(){var b=this._noteTextManager.getNoteTextElement();b.hide();this.setText(b.getText());this._noteTextManager.setActiveItem(null);
this._active=!1;this._viewer.trigger("noteTextHidden",this)};c.prototype._show=function(b){this._noteTextManager.getNoteTextElement().show(this);this._active=!0;b&&this._viewer.trigger("noteTextShown",this)};c.prototype.show=function(){this._show(!0)};c.prototype.remove=function(){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(e){switch(e.label){case 0:if(!0===this.getRemoved())return[2];null!==this._callbacks&&(this._viewer.unsetCallbacks(this._callbacks),
this._callbacks=null);b=this._viewer.model;c=[];void 0!==this._stemInstanceId&&c.push(b.deleteMeshInstances([this._stemInstanceId]));void 0!==this._sphereInstanceId&&c.push(b.deleteMeshInstances([this._sphereInstanceId]));this.hide();this._noteTextManager.removeNote(this);this._deleted=!0;return[4,d.Util.waitForAll(c)];case 1:return e.sent(),a.prototype.remove.call(this),[2]}})})};c.prototype.getRemoved=function(){return this._deleted};c.prototype.setColor=function(b){this._color=b;this._updateColor();
return Promise.resolve()};c.prototype.getColor=function(){return this._color};c.prototype.getPartId=function(){return this._partId};c.prototype._updateColor=function(){void 0!==this._sphereInstanceId&&this._viewer.model.setNodesFaceColor([this._sphereInstanceId],this._color)};c.prototype._createPinTransformationMatrix=function(b,a){var c=0,e=a.x;Math.abs(a.y)<Math.abs(e)&&(e=a.y,c=1);Math.abs(a.z)<Math.abs(e)&&(c=2);e=[0,0,0];e[c]=1;c=d.Point3.createFromArray(e);c=d.Point3.cross(a,c).normalize();
e=d.Point3.cross(a,c);var f=new d.Matrix;f.m=[a.x,a.y,a.z,0,c.x,c.y,c.z,0,e.x,e.y,e.z,0,0,0,0,1];f=d.Matrix.multiply(f,(new d.Matrix).setScaleComponent(this._sphereRadius,this._sphereRadius,this._sphereRadius));f.setTranslationComponent(b.x,b.y,b.z);return f};c.prototype._createPinStemInstance=function(b){return __awaiter(this,void 0,void 0,function(){var a,c,e,g;return __generator(this,function(f){a=this._noteTextManager.getPinStemMeshId();if(null===a)throw new d.CommunicatorError("stem mesh hasn't been created yet");
c=new d.MeshInstanceData(a,b,"pin-stem-instance",void 0,d.Color.black());c.setOpacity(1);e=d.MeshInstanceCreationFlags.SuppressCameraScale|d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.DoNotXRay|d.MeshInstanceCreationFlags.ExcludeBounding|d.MeshInstanceCreationFlags.OverrideSceneVisibility|d.MeshInstanceCreationFlags.AlwaysDraw;c.setCreationFlags(e);g=this._viewer.model;return[2,g.createMeshInstance(c,void 0,!0,!0)]})})};c.prototype._createPinSphereInstance=
function(b){return __awaiter(this,void 0,void 0,function(){var a,c,e,g;return __generator(this,function(f){a=this._noteTextManager.getPinSphereMeshId();if(null===a)throw new d.CommunicatorError("sphere mesh hasn't been created yet");c=new d.MeshInstanceData(a,b,"pin-sphere-instance",d.Color.white(),void 0);c.setOpacity(1);e=d.MeshInstanceCreationFlags.SuppressCameraScale|d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.DoNotXRay|d.MeshInstanceCreationFlags.ExcludeBounding|
d.MeshInstanceCreationFlags.OverrideSceneVisibility|d.MeshInstanceCreationFlags.AlwaysDraw;c.setCreationFlags(e);g=this._viewer.model;return[2,g.createMeshInstance(c,void 0,!0,!0)]})})};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{uniqueId:this._uniqueId,className:this.getClassName(),selectionPosition:this._selectionPosition.toJson(),selectionNormal:this._selectionNormal.toJson(),text:this._text,color:this._color,partId:this._partId}};c.prototype.forJson=
function(){return this.toJson()};c._fromJson=function(b,a,e){if(!e.findById(b.uniqueId)){var f=d.Point3.fromJson(b.selectionPosition),g=d.Point3.fromJson(b.selectionNormal);a=new c(a,e,f,g,b.partId);a._uniqueId=b.uniqueId;a.setText(b.text);a.setColor(d.Color.fromJson(b.color));return a}return null};c.fromJson=function(b,a,d){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(f){e=c._fromJson(b,a,d);return[2,e]})})};c.className="Communicator.Markup.Note.NoteText";
return c}(h.MarkupItem);g.NoteText=a})(h.Note||(h.Note={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){var c=a.call(this)||this;c._pinSphereMeshId=null;c._pinStemMeshId=null;c._noteTextList=[];c._activeItemHandle=null;c._activeItem=null;c._explodeActive=!1;c._isolateActive=!1;c._stemLength=2;c._sphereIterations=2;c._viewer=b;c._noteTextElement=new g.NoteTextElement;c._noteTextElement.setPositionOffset(new d.Point2(12,-24));c._viewer.setCallbacks({sceneReady:function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,
function(b){switch(b.label){case 0:return[4,this._init()];case 1:return b.sent(),[2]}})})}});return c}__extends(c,a);c.prototype._init=function(){return __awaiter(this,void 0,void 0,function(){var b,a,d,e;return __generator(this,function(f){switch(f.label){case 0:return null===c._globalPinSphereMeshData&&(c._globalPinSphereMeshData=this._createPinSphereMeshData()),null===c._globalPinStemMeshData&&(c._globalPinStemMeshData=this._createPinStemMeshData()),b=this._viewer.model,a=b.createMesh(c._globalPinSphereMeshData),
d=b.createMesh(c._globalPinStemMeshData),[4,Promise.all([a,d])];case 1:return e=f.sent(),this._pinSphereMeshId=e[0],this._pinStemMeshId=e[1],[2]}})})};c.prototype._createPinStemMeshData=function(){var b=new d.MeshData;b.addPolyline([0,0,0,this._stemLength,0,0]);return b};c.prototype._createPinSphereMeshData=function(){var b=(1+Math.sqrt(5))/2,a=Math.sqrt(10+2*Math.sqrt(5))/(4*b),c=a/2;b=a/(2*b);var e=[];e[0]=new d.Point3(-b,c,0);e[1]=new d.Point3(b,c,0);e[2]=new d.Point3(-b,-c,0);e[3]=new d.Point3(b,
-c,0);e[4]=new d.Point3(0,-b,c);e[5]=new d.Point3(0,b,c);e[6]=new d.Point3(0,-b,-c);e[7]=new d.Point3(0,b,-c);e[8]=new d.Point3(c,0,-b);e[9]=new d.Point3(c,0,b);e[10]=new d.Point3(-c,0,-b);e[11]=new d.Point3(-c,0,b);for(c=0;c<e.length;c++){var g=e[c];g.normalize()}var h=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],p=12;b=function(b){var a=[];h.map(function(b){var c=e[b[0]],
f=e[b[1]],g=e[b[2]];e[p++]=(new d.Point3(c.x+f.x,c.y+f.y,c.z+f.z)).scale(.5).normalize();e[p++]=(new d.Point3(f.x+g.x,f.y+g.y,f.z+g.z)).scale(.5).normalize();e[p++]=(new d.Point3(g.x+c.x,g.y+c.y,g.z+c.z)).scale(.5).normalize();a.push([b[0],p-3,p-1]);a.push([p-3,p-2,p-1]);a.push([p-3,b[1],p-2]);a.push([p-2,b[2],p-1])});h=a};for(c=0;c<this._sphereIterations;c++)b(c);b=[];a=[];for(var q=0,r=h;q<r.length;q++){var u=r[q];for(c=0;3>c;c++)g=e[u[c]],b.push(g.x+this._stemLength+1),b.push(g.y),b.push(g.z),
g=g.normalize(),a.push(g.x),a.push(g.y),a.push(g.z)}c=new d.MeshData;c.addFaces(b,a);c.setFaceWinding(d.FaceWinding.CounterClockwise);return c};c.prototype.getPinStemMeshId=function(){return this._pinStemMeshId};c.prototype.getPinSphereMeshId=function(){return this._pinSphereMeshId};c.prototype.getNoteTextElement=function(){return this._noteTextElement};c.prototype.setNoteTextElement=function(b){this._noteTextElement.hide();this._noteTextElement=b};c.prototype.getNoteTextList=function(){return this._noteTextList};
c.prototype.addNote=function(b){this._noteTextList.push(b);this._activeItem=b};c.prototype.removeNote=function(b){b=this._noteTextList.indexOf(b);this._noteTextList.splice(b,1)};c.prototype.updatePinVisibility=function(){return __awaiter(this,void 0,void 0,function(){var b,a,c,d,e,g,h;return __generator(this,function(f){if(0<this._noteTextList.length){b=[];a=0;for(c=this._noteTextList;a<c.length;a++)d=c[a],e=d.getSphereInstanceId(),g=d.getStemInstanceId(),void 0!==e&&b.push(e),void 0!==g&&b.push(g);
h=this._viewer.model.setNodesVisibility(b,!this._explodeActive);this._explodeActive&&this._noteTextElement.hide();return[2,h]}return[2]})})};c.prototype.explode=function(b){this._explodeActive=0<b;return this.updatePinVisibility()};c.prototype.getExplodeActive=function(){return this._explodeActive};c.prototype.setIsolateActive=function(b){this._isolateActive=b};c.prototype.getIsolateActive=function(){return this._isolateActive};c.prototype.getActiveItem=function(){return this._activeItem};c.prototype.setActiveItem=
function(b){this._activeItem=b};c.prototype.getActiveItemHandle=function(){return this._activeItemHandle};c.prototype.setActiveItemHandle=function(b){this._activeItemHandle=b};c.prototype.selectPin=function(b){this._activeItem&&this._activeItem.hide();b=b.getNodeId();return null!==b&&(b=this._getNoteTextFromNodeId(b),null!==b)?(b.restore(),!0):!1};c.prototype.checkPinInstance=function(b){return null!==this._getNoteTextFromNodeId(b)};c.prototype._getNoteTextFromNodeId=function(b){for(var a=0,c=this._noteTextList;a<
c.length;a++){var d=c[a];if(d.getSphereInstanceId()===b||d.getStemInstanceId()===b)return d}return null};c.prototype.findById=function(b){for(var a=0,c=this._noteTextList;a<c.length;a++)if(b===c[a].getUniqueId())return!0;return!1};c.prototype.loadData=function(b){for(var a=[],c=0;c<b.length;c++){var d=g.NoteText.fromJson(b[c],this._viewer,this).then(function(b){return null!==b});a.push(d)}return Promise.all(a)};c.prototype.exportMarkup=function(){for(var b=[],a=0,c=this._noteTextList;a<c.length;a++)b.push(c[a].toJson());
return b};c._globalPinSphereMeshData=null;c._globalPinStemMeshData=null;return c}(d.MarkupTypeManager);g.NoteTextManager=a})(h.Note||(h.Note={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){b=a.call(this,b)||this;b._uniqueId=d.UUID.create();b._centerPt=d.Point3.zero();b._radiusPt=d.Point3.zero();b._circleShape=new h.Shape.Circle;b._previousDragPlanePosition=d.Point3.zero();b._circleShape.setFillOpacity(0);b._circleShape.setStrokeColor(d.Color.red());b._circleShape.setStrokeWidth(2);return b}__extends(c,a);c.prototype.setCenter=function(b){this._centerPt.assign(b)};c.prototype.getCenter=function(){return this._centerPt.copy()};
c.prototype.setRadiusPoint=function(b){this._radiusPt.assign(b)};c.prototype.getRadiusPoint=function(){return this._radiusPt.copy()};c.prototype.getUniqueId=function(){return this._uniqueId};c.prototype._update=function(){var b=this._viewer.view,a=d.Point2.fromPoint3(b.projectPoint(this._centerPt));b=d.Point2.fromPoint3(b.projectPoint(this._radiusPt));b=d.Point2.distance(a,b);this._circleShape.set(a,b)};c.prototype.draw=function(){this._update();this._viewer.markupManager.getRenderer().drawCircle(this._circleShape)};
c.prototype.hit=function(b){return this.hitWithTolerance(b,0)};c.prototype.hitWithTolerance=function(b,a){this._update();a=this._circleShape.getStrokeWidth()+a;b=d.Point2.distance(this._circleShape.getCenter(),b)-this._circleShape.getRadius();return Math.abs(b)<=a};c.prototype.onSelect=function(){this._circleShape.setStrokeWidth(4)};c.prototype.onDeselect=function(){this._circleShape.setStrokeWidth(2)};c.prototype.isValid=function(){return this._circleShape.getRadius()>c._validRadiusTolerance};c.prototype.onDragStart=
function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);null!==b&&this._previousDragPlanePosition.assign(b);return!1};c.prototype.onDragMove=function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);null!==b&&(a=d.Point3.subtract(b,this._previousDragPlanePosition),this._centerPt.add(a),this._radiusPt.add(a),this._previousDragPlanePosition.assign(b));return!0};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{uniqueId:this._uniqueId,
centerPoint:this._centerPt.toJson(),radiusPoint:this._radiusPt.toJson(),className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){a=new c(a);a._uniqueId=b.uniqueId;a.setCenter(d.Point3.fromJson(b.centerPoint));a.setRadiusPoint(d.Point3.fromJson(b.radiusPoint));return a};c.construct=function(b,a){return c.fromJson(b,a)};c.prototype.getClassName=function(){return"Communicator.Markup.Redline.RedlineCircle"};c._validRadiusTolerance=1;return c}(g.RedlineItem);
g.RedlineCircle=a})(h.Redline||(h.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){b=a.call(this,b)||this;b._uniqueId=d.UUID.create();b._points=[];b._polylineShape=new h.Shape.Polyline;b._previousDragPlanePosition=d.Point3.zero();b._polylineShape.setStrokeWidth(2);b._polylineShape.setStrokeColor(d.Color.red());return b}__extends(c,a);c.prototype.addPoint=function(b){this._points.push(b.copy())};c.prototype.getPoints=function(){var b=[];this._points.forEach(function(a){b.push(a.copy())});return b};c.prototype._update=
function(){var b=this._viewer.view;this._polylineShape.clearPoints();for(var a=0,c=this._points;a<c.length;a++){var e=d.Point2.fromPoint3(b.projectPoint(c[a]));this._polylineShape.pushPoint(e)}};c.prototype.draw=function(){this._update();this.isValid()&&this._viewer.markupManager.getRenderer().drawPolyline(this._polylineShape)};c.prototype.hit=function(b){return this.hitWithTolerance(b,0)};c.prototype.hitWithTolerance=function(b,a){this._update();a=this._polylineShape.getStrokeWidth()+a;var c=this._polylineShape.getPoints();
if(1<c.length)for(var e=1;e<c.length;e++)if(d.Util.isPointOnLineSegment2d(b,c[e-1],c[e],a))return!0;return!1};c.prototype.onSelect=function(){this._polylineShape.setStrokeWidth(4)};c.prototype.onDeselect=function(){this._polylineShape.setStrokeWidth(2)};c.prototype.getClassName=function(){return"Communicator.Markup.Redline.RedlinePolyline"};c.prototype.isValid=function(){return 1<this._points.length};c.prototype.onDragStart=function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,
a);null!==b&&this._previousDragPlanePosition.assign(b);return!1};c.prototype.onDragMove=function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);if(null!==b){a=d.Point3.subtract(b,this._previousDragPlanePosition);for(var c=0,e=this._points;c<e.length;c++)e[c].add(a);this._polylineShape.clearPoints();this._previousDragPlanePosition.assign(b)}return!0};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){for(var b=[],a=0,c=this._points;a<
c.length;a++)b.push(c[a].toJson());return{uniqueId:this._uniqueId,points:b}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){a=new c(a);a._uniqueId=b.uniqueId;var e=0;for(b=b.points;e<b.length;e++)a.addPoint(d.Point3.fromJson(b[e]));return a};c.construct=function(b,a){return c.fromJson(b,a)};return c}(g.RedlineItem);g.RedlinePolyline=a})(h.Redline||(h.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b){b=a.call(this,b)||this;b._uniqueId=d.UUID.create();b._point1=d.Point3.zero();b._point2=d.Point3.zero();b._rectangleShape=new h.Shape.Rectangle;b._previousDragPlanePosition=d.Point3.zero();b._rectangleShape.setFillOpacity(0);b._rectangleShape.setStrokeColor(d.Color.red());b._rectangleShape.setStrokeWidth(2);return b}__extends(c,a);c.prototype.setPoint1=function(b){this._point1.assign(b)};c.prototype.getPoint1=function(){return this._point1.copy()};
c.prototype.setPoint2=function(b){this._point2.assign(b)};c.prototype.getPoint2=function(){return this._point2.copy()};c.prototype.getUniqueId=function(){return this._uniqueId};c.prototype._update=function(){var b=this._viewer.view,a=b.projectPoint(this._point1),c=b.projectPoint(this._point2);b=new d.Point2(Math.min(a.x,c.x),Math.min(a.y,c.y));a=new d.Point2(Math.max(a.x,c.x),Math.max(a.y,c.y));a=d.Point2.subtract(a,b);this._rectangleShape.setPosition(b);this._rectangleShape.setSize(a)};c.prototype.draw=
function(){this._update();this._viewer.markupManager.getRenderer().drawRectangle(this._rectangleShape)};c.prototype.hit=function(b){return this.hitWithTolerance(b,0)};c.prototype.hitWithTolerance=function(b,a){this._update();a=this._rectangleShape.getStrokeWidth()+a;var c=this._rectangleShape.getPosition(),e=this._rectangleShape.getSize(),f=new d.Point2(c.x+e.x,c.y),g=new d.Point2(c.x,c.y+e.y);e=new d.Point2(c.x+e.x,c.y+e.y);return d.Util.isPointOnLineSegment2d(b,c,f,a)||d.Util.isPointOnLineSegment2d(b,
f,e,a)||d.Util.isPointOnLineSegment2d(b,e,g,a)||d.Util.isPointOnLineSegment2d(b,g,c,a)?!0:!1};c.prototype.onSelect=function(){this._rectangleShape.setStrokeWidth(4)};c.prototype.onDeselect=function(){this._rectangleShape.setStrokeWidth(2)};c.prototype.isValid=function(){var b=this._rectangleShape.getSize();return b.x>c._validSizeTolerance.x&&b.y>c._validSizeTolerance.y};c.prototype.onDragStart=function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);null!==b&&this._previousDragPlanePosition.assign(b);
return!1};c.prototype.onDragMove=function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);null!==b&&(a=d.Point3.subtract(b,this._previousDragPlanePosition),this._point1.add(a),this._point2.add(a),this._previousDragPlanePosition.assign(b));return!0};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{uniqueId:this._uniqueId,className:this.getClassName(),point1:this._point1.toJson(),point2:this._point2.toJson()}};c.prototype.forJson=
function(){return this.toJson()};c.fromJson=function(b,a){a=new c(a);a._uniqueId=b.uniqueId;a.setPoint1(d.Point3.fromJson(b.point1));a.setPoint2(d.Point3.fromJson(b.point2));return a};c.construct=function(b,a){return c.fromJson(b,a)};c.prototype.getClassName=function(){return"Communicator.Markup.Redline.RedlineRectangle"};c._validSizeTolerance=new d.Point2(5,5);return c}(g.RedlineItem);g.RedlineRectangle=a})(h.Redline||(h.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(){function a(a,b){this._sizeChanged=!1;this._sizeUpdateCallback=a;this._textUpdateCallback=b;this._createTextBox()}a.prototype._createTextBox=function(){var c=this;this._currentSize=a._defaultSize.copy();this._textArea=document.createElement("textarea");this._textArea.style.position="absolute";this._textArea.style.width=a._defaultSize.x+"px";this._textArea.style.height=a._defaultSize.y+"px";this._textArea.style.zIndex="1";this._textArea.style.pointerEvents=
"none";this._textArea.style.resize="none";this.setBorderWidth(2);this._textArea.onmousemove=function(b){b.stopPropagation();b=new d.Point2(parseInt(c._textArea.style.width,10),parseInt(c._textArea.style.height,10));c.setSize(b)};this._textArea.onmouseup=function(b){b.stopPropagation();c._sizeChanged&&(c._sizeChanged=!1,c._sizeUpdateCallback(c._currentSize))};this._textArea.oninput=function(){c._textUpdateCallback(c._textArea.value)}};a.prototype.setPosition=function(a){this._textArea.style.left=a.x+
"px";this._textArea.style.top=a.y+"px"};a.prototype.setBorderWidth=function(a){this._textArea.style.outline=a+"px solid red"};a.prototype.setText=function(a){this._textArea.textContent=a};a.prototype.setSize=function(a){this._currentSize.equals(a)||(this._sizeChanged=!0,this._currentSize.assign(a),this._textArea.style.width=a.x+"px",this._textArea.style.height=a.y+"px")};a.prototype.focus=function(){this._textArea.focus();this._textArea.style.pointerEvents="auto";this._textArea.style.resize="both"};
a.prototype.blur=function(){this._textArea.blur();this._textArea.style.pointerEvents="none";this._textArea.style.resize="none"};a.prototype.getTextArea=function(){return this._textArea};a._defaultSize=new d.Point2(100,100);return a}();g.RedlineTextElement=a})(h.Redline||(h.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var a=function(a){function c(b,e){void 0===e&&(e=c.defaultText);var f=a.call(this,b)||this;f._uniqueId=d.UUID.create();f._position=d.Point3.zero();f._size=new d.Point2(100,100);f._redlineElementId=null;f._previousDragPlanePosition=d.Point3.zero();f._text=e;f._redlineTextElement=new g.RedlineTextElement(function(b){f.setSize(b)},function(b){f.setText(b)});f._redlineTextElement.setText(f._text);f._callbacks={selectionArray:function(){f.onDeselect()}};f._viewer.setCallbacks(f._callbacks);
return f}__extends(c,a);c.prototype.setPosition=function(b){this._position.assign(b)};c.prototype.getPosition=function(){return this._position.copy()};c.prototype.setSize=function(b){this._size.assign(b);this._redlineTextElement.setSize(b);this._viewer.trigger("redlineUpdated",this)};c.prototype.getSize=function(){return this._size.copy()};c.prototype.setText=function(b){this._text=b;this._redlineTextElement.setText(b);this._viewer.trigger("redlineUpdated",this)};c.prototype.getText=function(){return this._text};
c.prototype.draw=function(){var b=d.Point2.fromPoint3(this._viewer.view.projectPoint(this._position));this._redlineTextElement.setPosition(b);null===this._redlineElementId&&(this._redlineElementId=this._viewer.markupManager.addMarkupElement(this._redlineTextElement.getTextArea()))};c.prototype.hit=function(b){return this.hitWithTolerance(b,0)};c.prototype.hitWithTolerance=function(b,a){var c=this._redlineTextElement.getTextArea(),e=new d.Point2(parseFloat(c.style.left||"0"),parseFloat(c.style.top||
"0"));c=new d.Point2(parseFloat(c.style.width||"0"),parseFloat(c.style.height||"0"));return d.Util.isPointInRect2d(b,e,c,a)};c.prototype.getClassName=function(){return c.className};c.prototype.onSelect=function(){this._redlineTextElement.setBorderWidth(4);this._redlineTextElement.focus()};c.prototype.onDeselect=function(){this._redlineTextElement.setBorderWidth(2);this._redlineTextElement.blur()};c.prototype.isValid=function(){return 0<this._text.length};c.prototype.remove=function(){this._redlineElementId&&
(this._viewer.markupManager.removeMarkupElement(this._redlineElementId),this._redlineElementId=null);null!==this._callbacks&&(this._viewer.unsetCallbacks(this._callbacks),this._callbacks=null);a.prototype.remove.call(this)};c.prototype.onDragStart=function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);null!==b&&this._previousDragPlanePosition.assign(b);return!1};c.prototype.onDragMove=function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,
a);if(null!==b){a=d.Point3.subtract(b,this._previousDragPlanePosition);var c=this.getPosition();c.add(a);this.setPosition(c);this._previousDragPlanePosition.assign(b)}return!0};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{uniqueId:this._uniqueId,className:this.getClassName(),position:this._position.toJson(),size:this._size.toJson(),text:this._text}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){a=new c(a,b.text);a._uniqueId=
b.uniqueId;a.setPosition(d.Point3.fromJson(b.position));a.setSize(d.Point2.fromJson(b.size));return a};c.construct=function(b,a){return c.fromJson(b,a)};c.className="Communicator.Markup.Redline.RedlineText";c.defaultText="Type Here...";return c}(g.RedlineItem);g.RedlineText=a})(h.Redline||(h.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c,b){c=a.call(this,c)||this;c._moveSelectionAction=new d.Util.CurrentAction(!0);c._currentMoveHighlight=null;c._currentSelectHighlight=null;c._markup=null;c._measureManager=b;return c}__extends(e,a);e.prototype._unsetCurrentMoveHighlight=function(){null!==this._currentMoveHighlight&&(this._viewer.model.setNodesHighlighted([this._currentMoveHighlight.getNodeId()],!1),this._currentMoveHighlight=null)};e.prototype._unsetCurrentSelectionHighlight=
function(){null!==this._currentSelectHighlight&&(this._viewer.model.setNodesHighlighted([this._currentSelectHighlight.getNodeId()],!1),this._currentSelectHighlight=null)};e.prototype._performMoveSelection=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,g,h;return __generator(this,function(f){switch(f.label){case 0:return b=this._viewer.view,c=this._viewer.model,[4,b.pickFromPoint(a,new d.PickConfig)];case 1:e=f.sent();if(0!==e.overlayIndex()||!e.isNodeSelection())return this._unsetCurrentMoveHighlight(),
[2];g=e.getNodeId();if(null===g||c.getNodeType(g)!==d.NodeType.BodyInstance||this._markup&&(h=this._markup.getFirstNode(),null!==h&&g===h))return[2];null!==this._currentMoveHighlight?e.equals(this._currentMoveHighlight)?e.getSelectionType()===d.SelectionType.None&&this._unsetCurrentMoveHighlight():(this._unsetCurrentMoveHighlight(),this._currentMoveHighlight=e,c.setNodesHighlighted([g],!0)):(this._currentMoveHighlight=e,c.setNodesHighlighted([g],!0));return[2]}})})};e.prototype._performUpSelection=
function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,g,h;return __generator(this,function(f){switch(f.label){case 0:return b=this._viewer.view,c=this._viewer.model,[4,b.pickFromPoint(a,new d.PickConfig)];case 1:e=f.sent();if(e.overlayIndex())return[2];this._markup&&1===this._markup._getStage()&&this._viewer.trigger("measurementBegin");if(this._markup&&1<this._markup._getStage())return g=this._markup,this._markup=null,g.finalize(),this._measureManager.finalizeMeasurement(g),[2];h=e.getNodeId();
if(null===h||c.getNodeType(h)!==d.NodeType.BodyInstance||this._markup&&!(1>=this._markup._getStage()))return[2];this._unsetCurrentMoveHighlight();if(this._markup)return[3,2];this._markup=new d.Markup.Measure.MeasureBodyBodyDistanceMarkup(this._viewer);this._markup.setUnitMultiplier(c.getNodeUnitMultiplier(h));this._markup.setFirstNode(h);e.isNodeSelection()&&(this._unsetCurrentSelectionHighlight(),this._currentSelectHighlight=e,this._viewer.model.setNodesHighlighted([h],!0));this._measureManager.addMeasurement(this._markup);
return[3,4];case 2:return this._unsetCurrentSelectionHighlight(),[4,this._markup.setSecondNode(h)];case 3:f.sent(),this._markup.adjust(a),f.label=4;case 4:return[2]}})})};e.prototype.onMouseMove=function(c){var b=this;a.prototype.onMouseMove.call(this,c);var d=c.getPosition();(!this._markup||1>=this._markup._getStage())&&this._moveSelectionAction.set(function(){return b._performMoveSelection(d)});this._viewer.markupManager.refreshMarkup();null!==this._markup&&0<this._markup._getStage()&&this._markup.adjust(d)};
e.prototype._onMouseUpImpl=function(a){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(d){switch(d.label){case 0:if(!this.isActive())return[2];b=null!==this._primaryTouchId&&null!==this._markup&&1<this._markup._getStage();if(!(3>this._dragCount||b))return[2];c=a.getPosition();return[4,this._performUpSelection(c)];case 1:return d.sent(),[2]}})})};e.prototype.onMouseUp=function(c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,
this._onMouseUpImpl(c)];case 1:return b.sent(),a.prototype.onMouseUp.call(this,c),[2]}})})};e.prototype.setDraggingEnabled=function(a){this._dragging=a};e.prototype.onKeyUp=function(a){};e.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&(null!==this._markup?(this._measureManager.removeMeasurement(this._markup),this._markup=null):this._measureManager.removeLastMeasurement())};e.prototype.setHandled=function(){return null!==this._markup&&1<this._markup._getStage()};e.prototype.onDeactivate=
function(){a.prototype.onDeactivate.call(this);this._unsetCurrentMoveHighlight();null!==this._markup&&(this._measureManager.removeMeasurement(this._markup),this._markup=null)};return e}(h.OperatorBase);h.MeasureBodyBodyDistanceOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c,b){c=a.call(this,c)||this;c._pickConfig=new d.PickConfig(d.SelectionMask.Line);c._moveSelectionAction=new d.Util.CurrentAction(!0);c._lengthMarkup=null;c._edgeMarkup=null;c._measureManager=b;c._pickConfig.restrictLinesAndPointsToSelectedFaceInstances=!1;return c}__extends(e,a);e.prototype.onActivate=function(){null===this._edgeMarkup&&(this._edgeMarkup=new d.Markup.Measure.MeasureStraightEdgeLengthMarkup(this._viewer,null,new d.Matrix,1))};
e.prototype._unregisterEdgeMarkup=function(){if(null!==this._edgeMarkup){var a=this._edgeMarkup._getId();""!==a&&(this._viewer.markupManager.unregisterMarkup(a),this._edgeMarkup._setId(""))}};e.prototype._registerEdgeMarkup=function(){null!==this._edgeMarkup&&(this._unregisterEdgeMarkup(),this._edgeMarkup._setId(this._viewer.markupManager.registerMarkup(this._edgeMarkup)))};e.prototype._resetEdgeMarkup=function(){null!==this._edgeMarkup&&(this._unregisterEdgeMarkup(),this._edgeMarkup.reset())};e.prototype._performMoveSelection=
function(a,b){return __awaiter(this,void 0,void 0,function(){var c,d,e;return __generator(this,function(f){switch(f.label){case 0:return c=this._viewer.view,[4,c.pickFromPoint(a,this._pickConfig)];case 1:return d=f.sent(),(e=d.getLineEntity())&&0===d.overlayIndex()&&0!==(e.getLineBits()&4)?(b.setLineGeometry(e.getPoints()),this._registerEdgeMarkup()):this._resetEdgeMarkup(),[2]}})})};e.prototype._performUpSelection=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,g,h,m,p,q,r;return __generator(this,
function(f){switch(f.label){case 0:return b=this._viewer.view,c=this._viewer.model,[4,b.pickFromPoint(a,this._pickConfig)];case 1:e=f.sent();if(e.overlayIndex())return[2];if(this._lengthMarkup&&2===this._lengthMarkup._getStage())return g=this._lengthMarkup,this._lengthMarkup=null,g._nextStage(),this._measureManager.finalizeMeasurement(g),[2];if(this._lengthMarkup||!e.isLineSelection())return[2];h=e.getLineEntity();if(0===(h.getLineBits()&4))return[2];m=e.getNodeId();p=c.getNodeUnitMultiplier(m);return[4,
c.getEdgeProperty(m,h.getLineId())];case 2:q=f.sent();this._viewer.trigger("measurementBegin");if(!q)return[2];q instanceof d.SubentityProperties.LineElement||q instanceof d.SubentityProperties.OtherEdgeElement?(r=c.getNodeNetMatrix(m),this._lengthMarkup=new d.Markup.Measure.MeasureStraightEdgeLengthMarkup(this._viewer,q,r,p),this._measureManager.addMeasurement(this._lengthMarkup),this._lengthMarkup.setLineGeometry(h.getPoints()),this._lengthMarkup._nextStage(),this._lengthMarkup.adjust(a)):q instanceof
d.SubentityProperties.CircleElement&&(r=c.getNodeNetMatrix(m),this._lengthMarkup=new d.Markup.Measure.MeasureCircleEdgeLengthMarkup(this._viewer,q,r,p),this._measureManager.addMeasurement(this._lengthMarkup),this._lengthMarkup.setLineGeometry(h.getPoints()),this._lengthMarkup._nextStage(),this._lengthMarkup.adjust(a));2===this._lengthMarkup._getStage()&&this._viewer.trigger("measurementValueSet",this._lengthMarkup);return[2]}})})};e.prototype.onMouseMove=function(c){var b=this;a.prototype.onMouseMove.call(this,
c);var d=this._edgeMarkup;if(null!==d){var e=c.getPosition();this.isDragging()&&null===this._primaryTouchId?this._resetEdgeMarkup():(null===this._lengthMarkup&&this._moveSelectionAction.set(function(){return b._performMoveSelection(e,d)}),this._viewer.markupManager.refreshMarkup(),null!==this._lengthMarkup&&0<this._lengthMarkup._getStage()&&this._lengthMarkup.adjust(e))}};e.prototype._onMouseUpImpl=function(a){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(d){switch(d.label){case 0:if(!this.isActive())return[2];
b=null!==this._primaryTouchId&&null!==this._lengthMarkup;if(!(3>this._dragCount||b))return[2];c=a.getPosition();return[4,this._performUpSelection(c)];case 1:return d.sent(),[2]}})})};e.prototype.onMouseUp=function(c){this._onMouseUpImpl(c);a.prototype.onMouseUp.call(this,c)};e.prototype.setDraggingEnabled=function(a){this._dragging=a};e.prototype.onKeyUp=function(a){};e.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&(null!==this._lengthMarkup?(this._measureManager.removeMeasurement(this._lengthMarkup),
this._lengthMarkup=null):this._measureManager.removeLastMeasurement(),null!==this._edgeMarkup&&this._resetEdgeMarkup())};e.prototype.setHandled=function(){return null!==this._lengthMarkup};e.prototype.onDeactivate=function(){null!==this._lengthMarkup&&(this._measureManager.removeMeasurement(this._lengthMarkup),this._lengthMarkup=null);null!==this._edgeMarkup&&this._resetEdgeMarkup()};return e}(h.OperatorBase);h.MeasureEdgeLengthOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator=
{}));
(function(d){(function(h){function g(a){return a.getSelectionType()!==d.SelectionType.None?(a=a.getFaceEntity().getCadFaceBits(),0!==(a&2)&&0!==(a&1)):!1}var a=function(a){function c(b,c){b=a.call(this,b)||this;b._moveSelectionAction=new d.Util.CurrentAction(!0);b._currentHighlight=null;b._markup=null;b._useAuthoredNormals=!0;b._measureManager=c;return b}__extends(c,a);c.prototype._unsetCurrentHighlight=function(){null!==this._currentHighlight&&(this._viewer.model.unsetNodeFaceColor(this._currentHighlight.getNodeId(),this._currentHighlight.getFaceEntity().getCadFaceIndex()),
this._currentHighlight=null)};c.prototype._performMoveSelection=function(b){return __awaiter(this,void 0,void 0,function(){var a,c,e,h,m,p,q,r;return __generator(this,function(f){switch(f.label){case 0:return a=this._viewer.view,c=this._viewer.model,[4,a.pickFromPoint(b,new d.PickConfig)];case 1:e=f.sent();if(0!==e.overlayIndex()||!e.isFaceSelection())return[2];h=e.getNodeId();m=e.getFaceEntity();if(c.getNodeType(e.getNodeId())!==d.NodeType.BodyInstance||this._markup&&(p=this._markup.getFirstSelection(),
h===p.getNodeId()&&(q=p.getFaceEntity().getCadFaceIndex(),r=m.getCadFaceIndex(),q===r)))return[2];null!==this._currentHighlight?e.equals(this._currentHighlight)?e.getSelectionType()===d.SelectionType.None&&this._unsetCurrentHighlight():(this._unsetCurrentHighlight(),g(e)&&(this._currentHighlight=e,c.setNodeFaceColor(h,m.getCadFaceIndex(),d.Color.yellow()))):null===this._currentHighlight&&g(e)&&(this._currentHighlight=e,c.setNodeFaceColor(h,m.getCadFaceIndex(),d.Color.yellow()));return[2]}})})};c.prototype._performUpSelection=
function(b){return __awaiter(this,void 0,void 0,function(){var a,c,e,h,m,p,q;return __generator(this,function(f){switch(f.label){case 0:return a=this._viewer.view,c=this._viewer.model,[4,a.pickFromPoint(b,new d.PickConfig)];case 1:e=f.sent();if(e.overlayIndex())return[2];if(this._markup&&1<this._markup._getStage())return this._viewer.trigger("measurementBegin"),this._markup._nextStage(),this._markup._isFinalized()&&(h=this._markup,this._markup=null,this._measureManager.finalizeMeasurement(h)),[2];
if(!e.isFaceSelection()||c.getNodeType(e.getNodeId())!==d.NodeType.BodyInstance||this._markup&&!(1>=this._markup._getStage())||!g(e))return[2];m=e.getFaceEntity();return[4,c.getFaceProperty(e.getNodeId(),m.getCadFaceIndex())];case 2:p=f.sent();if(!(p instanceof d.SubentityProperties.PlaneElement))return[2];this._unsetCurrentHighlight();if(null!==this._markup)return[3,4];this._markup=new d.Markup.Measure.MeasureFaceFaceAngleMarkup(this._viewer);this._markup.setUseAuthoredNormals(this._useAuthoredNormals);
return[4,this._markup.setFirstFace(e)];case 3:return f.sent(),this._measureManager.addMeasurement(this._markup),[3,6];case 4:return[4,this._markup.setSecondFace(e)];case 5:(q=f.sent())&&this._markup.adjust(b),f.label=6;case 6:return[2]}})})};c.prototype.onMouseMove=function(b){a.prototype.onMouseMove.call(this,b);b=b.getPosition();(!this._markup||1>=this._markup._getStage())&&this._performMoveSelection(b);this._viewer.markupManager.refreshMarkup();null!==this._markup&&0<this._markup._getStage()&&
this._markup.adjust(b)};c.prototype._onMouseUpImpl=function(b){var a=this;if(this.isActive()){var c=null!==this._primaryTouchId&&null!==this._markup&&1<this._markup._getStage();if(3>this._dragCount||c){var d=b.getPosition();this._moveSelectionAction.set(function(){return a._performUpSelection(d)})}}};c.prototype.onMouseUp=function(b){this._onMouseUpImpl(b);a.prototype.onMouseUp.call(this,b)};c.prototype.setDraggingEnabled=function(b){this._dragging=b};c.prototype.onKeyUp=function(b){};c.prototype.onKeyDown=
function(b){b.getKeyCode()===d.KeyCode.Escape&&(null!==this._markup?(this._markup.cleanup(),this._measureManager.removeMeasurement(this._markup),this._markup=null):this._measureManager.removeLastMeasurement())};c.prototype.setHandled=function(){return null!==this._markup&&1<this._markup._getStage()};c.prototype.onDeactivate=function(){this._unsetCurrentHighlight();null!==this._markup&&(this._measureManager.removeMeasurement(this._markup),this._markup.cleanup(),this._markup=null)};c.prototype.setUseAuthoredNormals=
function(b){this._useAuthoredNormals=b};c.prototype.getUseAuthoredNormals=function(){return this._useAuthoredNormals};return c}(h.OperatorBase);h.MeasureFaceFaceAngleOperator=a})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function g(a){return a.getSelectionType()!==d.SelectionType.None?0!==(a.getFaceEntity().getCadFaceBits()&1):!1}var a=function(a){function c(b,c){b=a.call(this,b)||this;b._moveSelectionAction=new d.Util.CurrentAction(!0);b._currentHighlight=null;b._markup=null;b._measureManager=c;return b}__extends(c,a);c.prototype._unsetCurrentHighlight=function(){null!==this._currentHighlight&&(this._viewer.model.unsetNodeFaceColor(this._currentHighlight.getNodeId(),this._currentHighlight.getFaceEntity().getCadFaceIndex()),
this._currentHighlight=null)};c.prototype._performMoveSelection=function(b){return __awaiter(this,void 0,void 0,function(){var a,c,e,h,m,p;return __generator(this,function(f){switch(f.label){case 0:return a=this._viewer.view,c=this._viewer.model,[4,a.pickFromPoint(b,new d.PickConfig)];case 1:e=f.sent();if(0!==e.overlayIndex()||!e.isFaceSelection())return[2];h=e.getNodeId();m=e.getFaceEntity();if(c.getNodeType(h)!==d.NodeType.BodyInstance||this._markup&&(p=this._markup.getFirstSelection(),null!==p&&
h===p.getNodeId()&&m.getCadFaceIndex()===p.getFaceEntity().getCadFaceIndex()))return[2];null!==this._currentHighlight?e.equals(this._currentHighlight)?e.getSelectionType()===d.SelectionType.None&&this._unsetCurrentHighlight():(this._unsetCurrentHighlight(),g(e)&&(this._currentHighlight=e,c.setNodeFaceColor(h,m.getCadFaceIndex(),d.Color.yellow()))):g(e)&&(this._currentHighlight=e,c.setNodeFaceColor(h,m.getCadFaceIndex(),d.Color.yellow()));return[2]}})})};c.prototype._performUpSelection=function(b){return __awaiter(this,
void 0,void 0,function(){var a,c,e,h,m,p,q,r,u;return __generator(this,function(f){switch(f.label){case 0:return a=this._viewer.view,c=this._viewer.model,[4,a.pickFromPoint(b,new d.PickConfig)];case 1:e=f.sent();if(e.overlayIndex())return[2];if(this._markup&&1<this._markup._getStage())return this._viewer.trigger("measurementBegin"),this._markup._nextStage(),this._markup._isFinalized()&&(h=this._markup,this._markup=null,this._measureManager.finalizeMeasurement(h)),[2];if(!e.isFaceSelection())return[2];
m=e.getNodeId();p=e.getFaceEntity();return g(e)&&c.getNodeType(m)===d.NodeType.BodyInstance&&(!this._markup||1>=this._markup._getStage())?[4,c.getFaceProperty(m,p.getCadFaceIndex())]:[2];case 2:q=f.sent();if(!q)return[2];r=c.getNodeNetMatrix(m);this._unsetCurrentHighlight();return q instanceof d.SubentityProperties.PlaneElement||q instanceof d.SubentityProperties.CylinderElement?[4,c.getNodesBounding([m])]:[3,6];case 3:u=f.sent();if(this._markup)return[3,4];this._markup=new d.Markup.Measure.MeasureFaceFaceDistanceMarkup(this._viewer);
this._markup.setUnitMultiplier(c.getNodeUnitMultiplier(m));this._markup.setFirstFace(e,q,r,u);this._measureManager.addMeasurement(this._markup);return[3,6];case 4:return[4,this._markup.setSecondFace(b,e,q,r,u)];case 5:f.sent(),f.label=6;case 6:return[2]}})})};c.prototype.onMouseMove=function(b){var c=this;a.prototype.onMouseMove.call(this,b);var d=b.getPosition();(!this._markup||1>=this._markup._getStage())&&this._moveSelectionAction.set(function(){return c._performMoveSelection(d)});this._viewer.markupManager.refreshMarkup();
null!==this._markup&&0<this._markup._getStage()&&this._markup.adjust(d)};c.prototype._onMouseUpImpl=function(b){return __awaiter(this,void 0,void 0,function(){var a,c;return __generator(this,function(d){switch(d.label){case 0:if(!this.isActive())return[2];a=null!==this._primaryTouchId&&null!==this._markup&&1<this._markup._getStage();if(!(3>this._dragCount||a))return[2];c=b.getPosition();return[4,this._performUpSelection(c)];case 1:return d.sent(),[2]}})})};c.prototype.onMouseUp=function(b){this._onMouseUpImpl(b);
a.prototype.onMouseUp.call(this,b)};c.prototype.setDraggingEnabled=function(b){this._dragging=b};c.prototype.onKeyUp=function(b){};c.prototype.onKeyDown=function(b){b.getKeyCode()===d.KeyCode.Escape&&(null!==this._markup?(this._markup.cleanup(),this._measureManager.removeMeasurement(this._markup),this._markup=null):this._measureManager.removeLastMeasurement())};c.prototype.setHandled=function(){return null!==this._markup&&1<this._markup._getStage()};c.prototype.onDeactivate=function(){a.prototype.onDeactivate.call(this);
this._unsetCurrentHighlight();null!==this._markup&&(this._measureManager.removeMeasurement(this._markup),this._markup.cleanup(),this._markup=null)};return c}(h.OperatorBase);h.MeasureFaceFaceDistanceOperator=a})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c,b){var d=a.call(this,c)||this;d._markupItem=null;d._cameraInteractionActive=!1;d._measureManager=b;d._cursor=new h.Common.PointCursor(d._viewer);d._viewer.setCallbacks({beginInteraction:function(){d._onBeginInteraction()},endInteraction:function(){d._onEndInteraction()}});return d}__extends(e,a);e.prototype._onBeginInteraction=function(){this._cameraInteractionActive=!0;this._cursor.activateCursorSprite(!1)};e.prototype._onEndInteraction=function(){this._cameraInteractionActive=
!1};e.prototype._useSnapping=function(a){return this._cursor.snappingConfig.enabled&&!a.altDown()};e.prototype._addPoint=function(a,b){return __awaiter(this,void 0,void 0,function(){var c,e;return __generator(this,function(f){switch(f.label){case 0:return[4,this._cursor.getSelectionCursorPoints(a,b,null)];case 1:c=f.sent();if(null===c||null===c.worldPosition)return[2];null===this._markupItem&&(this._markupItem=new d.Markup.Measure.MeasureLineLineAngleMarkup(this._viewer),this._measureManager.addMeasurement(this._markupItem),
this._viewer.trigger("measurementBegin"));this._markupItem.addPoint(c.worldPosition);this._markupItem._isFinalized()&&(e=this._markupItem,this._markupItem=null,this._measureManager.finalizeMeasurement(e));return[2]}})})};e.prototype._updateMarkupSelectionPosition=function(a,b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:return null===this._markupItem?[2]:[4,this._cursor.getSelectionCursorPoints(a,b,null)];case 1:c=d.sent();if(null===
c)return[2];this._markupItem.setSelectionPosition(c.worldPosition);return[2]}})})};e.prototype.onMouseMove=function(c){return __awaiter(this,void 0,void 0,function(){var b,d;return __generator(this,function(e){switch(e.label){case 0:a.prototype.onMouseMove.call(this,c);if(this._cameraInteractionActive)return[2];b=c.getPosition();d=this._useSnapping(c);this._cursor.updateCursorSprite(b,d,null);return[4,this._updateMarkupSelectionPosition(b,d)];case 1:return e.sent(),this._viewer.markupManager.refreshMarkup(),
[2]}})})};e.prototype.onMouseUp=function(c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(d){switch(d.label){case 0:if(!this.isActive())return[2];b=c.getPosition();return this._ptFirst.equals(b)?[4,this._addPoint(b,this._useSnapping(c))]:[3,2];case 1:d.sent(),d.label=2;case 2:return a.prototype.onMouseUp.call(this,c),[2]}})})};e.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&this._clearMeasurement()};e.prototype._clearMeasurement=function(){null!==
this._markupItem?(this._measureManager.removeMeasurement(this._markupItem),this._markupItem=null):this._measureManager.removeLastMeasurement()};e.prototype.setHandled=function(){return null!==this._markupItem&&1<this._markupItem._getStage()};e.prototype.onActivate=function(){this._cursor.onOperatorActivate()};e.prototype.onDeactivate=function(){this._cursor.onOperatorDeactivate();null!==this._markupItem&&(this._measureManager.removeMeasurement(this._markupItem),this._markupItem=null)};return e}(h.OperatorBase);
h.MeasureLineLineAngleOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c,b){var d=a.call(this,c)||this;d._measureMarkup=null;d._cameraInteractionActive=!1;d._viewer=c;d._measureManager=b;d._cursor=new h.Common.PointCursor(d._viewer);d._viewer.setCallbacks({beginInteraction:function(){d._onBeginInteraction()},endInteraction:function(){d._onEndInteraction()}});return d}__extends(e,a);e.prototype._onBeginInteraction=function(){this._cameraInteractionActive=!0;this._cursor.activateCursorSprite(!1)};e.prototype._onEndInteraction=
function(){this._cameraInteractionActive=!1};e.prototype._getStage=function(){return null===this._measureMarkup?0:this._measureMarkup._getStage()};e.prototype._draw=function(){var a=!1;2>this._getStage()&&(this._cursor.draw(),a=!0);null!==this._measureMarkup&&(this._measureMarkup.draw(),a=!0);a&&this._viewer.markupManager.refreshMarkup()};e.prototype._finalizeMeasurement=function(a,b){return __awaiter(this,void 0,void 0,function(){var c,e,g;return __generator(this,function(f){switch(f.label){case 0:c=
this._measureMarkup;if(null===c)return console.assert(!1),[2];e=new d.PickConfig(b?d.SelectionMask.All:d.SelectionMask.Face);return[4,this._viewer.view.pickFromPoint(a,e)];case 1:g=f.sent();if(g.overlayIndex())return[2];c.finalize();this._measureMarkup=null;this._measureManager.finalizeMeasurement(c);return[2]}})})};e.prototype._getFirstPickPosition=function(){var a=null;null!==this._measureMarkup&&1<=this._getStage()&&(a=this._measureMarkup.getFirstPointPosition());return a};e.prototype._updateMeasurementPoints=
function(a,b){return __awaiter(this,void 0,void 0,function(){var c,e,g,h,m;return __generator(this,function(f){switch(f.label){case 0:return c=this._getStage(),console.assert(2>c),this._viewer.trigger("measurementBegin"),e=this._getFirstPickPosition(),[4,this._cursor.getSelectionCursorPoints(a,b,e)];case 1:g=f.sent();if(null===g||null===g.worldPosition)return this._cursor.activateCursorSprite(!1),[2];this._cursor.activateCursorSprite(!0);null===this._measureMarkup&&(this._measureMarkup=new d.Markup.Measure.MeasurePointPointDistanceMarkup(this._viewer),
this._measureManager.addMeasurement(this._measureMarkup));h=g.worldPosition.copy();this._viewer.sheetManager.isDrawingSheetActive()&&(h.z=0);0===c?(this._measureMarkup.setFirstPointPosition(h),this._measureMarkup.setUnitMultiplier(g.selectionItem.isNodeSelection()?this._viewer.model.getNodeUnitMultiplier(g.selectionItem.getNodeId()):1)):1===c&&(m=this._getFirstPickPosition(),g.worldPosition.equalsWithTolerance(m,1E-7)||(this._measureMarkup.setSecondPointPosition(h),this._measureMarkup.adjust(g.screenPosition)));
return[2]}})})};e.prototype._useSnapping=function(a){return this._cursor.snappingConfig.enabled&&!a.altDown()};e.prototype.onMouseMove=function(c){a.prototype.onMouseMove.call(this,c);var b=this._getStage();if(2>b){if(!this._cameraInteractionActive){b=c.getPosition();var d=this._getFirstPickPosition();this._cursor.updateCursorSprite(b,this._useSnapping(c),d)}}else 2===b&&(this._measureMarkup.adjust(c.getPosition()),c.setHandled(!0));this._draw()};e.prototype.onMouseUp=function(c){return __awaiter(this,
void 0,void 0,function(){var b,d,e,g;return __generator(this,function(f){switch(f.label){case 0:if(!this.isActive())return[3,4];b=this._getStage();d=null!==this._primaryTouchId&&null!==this._measureMarkup&&1<b;if(!(3>this._dragCount||d))return[3,4];e=this._useSnapping(c);g=c.getPosition();return 1>=b?[4,this._updateMeasurementPoints(g,e)]:[3,2];case 1:return f.sent(),[3,4];case 2:return[4,this._finalizeMeasurement(g,e)];case 3:f.sent(),f.label=4;case 4:return a.prototype.onMouseUp.call(this,c),[2]}})})};
e.prototype.onKeyUp=function(a){};e.prototype._clearMeasurement=function(){null!==this._measureMarkup?(this._measureManager.removeMeasurement(this._measureMarkup),this._measureMarkup=null):this._measureManager.removeLastMeasurement()};e.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&this._clearMeasurement()};e.prototype.setHandled=function(){return 1<this._getStage()};e.prototype.onActivate=function(){this._cursor.onOperatorActivate()};e.prototype.onDeactivate=function(){this._cursor.onOperatorDeactivate();
null!==this._measureMarkup&&(this._measureManager.removeMeasurement(this._measureMarkup),this._measureMarkup=null)};return e}(h.OperatorBase);h.MeasurePointPointDistanceOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g;(function(a){a[a.First=0]="First";a[a.Last=1]="Last";a[a.Midpoint=2]="Midpoint"})(g=h.MeasurePolygonAreaAnchor||(h.MeasurePolygonAreaAnchor={}));var a=function(a){function c(b,c){var e=a.call(this,b)||this;e._markupItem=null;e._cameraInteractionActive=!1;e._textShapeOffset=new d.Point2(10,-25);e._anchor=g.Last;e._dragPlane=null;e._measureManager=c;e._cursor=new h.Common.PointCursor(e._viewer);e._viewer.setCallbacks({beginInteraction:function(){e._onBeginInteraction()},
endInteraction:function(){e._onEndInteraction()}});return e}__extends(c,a);c.prototype.getMarkupItem=function(){return this._markupItem};c.prototype.setAnchor=function(b){this._anchor=b};c.prototype._useSnapping=function(b){return this._cursor.snappingConfig.enabled&&!b.altDown()};c.prototype._getLastSelectedPoint=function(){return this._markupItem?this._markupItem.getLast():null};c.prototype._createNewMarkupItem=function(b){this._markupItem=new d.Markup.Measure.MeasurePolygonAreaMarkup(this._viewer);
this._markupItem.setUnitMultiplier(b.selectionItem.isNodeSelection()?this._viewer.model.getNodeUnitMultiplier(b.selectionItem.getNodeId()):1);this._markupItem.setName("MeasurePolygonAreaMarkup");this._measureManager.addMeasurement(this._markupItem);this._markupItem.addPoint(b.worldPosition)};c.prototype._updateMarkupItem=function(b,a){if(null!==this._markupItem&&null!=a.worldPosition){var c=this._markupItem.getPoints(),e=d.Point2.fromPoint3(this._viewer.view.projectPoint(c[0]));d.Point2.distance(e,
b)<this._markupItem.pointRadius?2<c.length&&this._finalizeMeasurement():this._markupItem.addPoint(a.worldPosition)&&this._updateAnchor(b,a.worldPosition)}};c.prototype._updateMeasurementItem=function(b,a){return __awaiter(this,void 0,void 0,function(){var c,d;return __generator(this,function(e){switch(e.label){case 0:return c=this._getLastSelectedPoint(),[4,this._cursor.getSelectionCursorPoints(b,a,c)];case 1:d=e.sent();if(null===d||null===d.worldPosition)return this._cursor.activateCursorSprite(!1),
[2];this._cursor.activateCursorSprite(!0);null===this._markupItem?this._createNewMarkupItem(d):this._updateMarkupItem(b,d);return[2]}})})};c.prototype._isDraggingText=function(){return null!==this._dragPlane};c.prototype.onMouseDown=function(b){a.prototype.onMouseDown.call(this,b);if(!this._markupItem){var c=b.getPosition();this._pickExisting(c)&&(this._dragPlane=this._calculateSelectionPlane(this._markupItem.leaderPosition),b.setHandled(!0))}};c.prototype.onMouseMove=function(b){a.prototype.onMouseMove.call(this,
b);if(this._isDraggingText())this._dragMarkupText(b),b.setHandled(!0);else if(!this._cameraInteractionActive){var c=this._getLastSelectedPoint();this._cursor.updateCursorSprite(b.getPosition(),this._useSnapping(b),c);this._draw()}};c.prototype.onMouseUp=function(b){return __awaiter(this,void 0,void 0,function(){var c,d,e;return __generator(this,function(f){switch(f.label){case 0:if(!this.isActive())return[2];c=b.getPosition();if(!this._isDraggingText())return[3,1];this._dragPlane=this._markupItem=
null;return[3,3];case 1:if(!this._ptFirst.equals(c))return[3,3];d=this._useSnapping(b);e=c;return[4,this._updateMeasurementItem(e,d)];case 2:f.sent(),f.label=3;case 3:return a.prototype.onMouseUp.call(this,b),[2]}})})};c.prototype.onDoubleClick=function(a){this._finalizeMeasurement()};c.prototype._dragMarkupText=function(a){null!==this._markupItem&&null!==this._dragPlane&&(a=this._viewer.view.raycastFromPoint(a.getPosition()),this._dragPlane.intersectsRay(a,this._markupItem.textPosition),this._draw())};
c.prototype._finalizeMeasurement=function(){if(this._markupItem)if(this._markupItem.isValid()){var a=this._markupItem;this._markupItem=null;a.finalize();this._measureManager.finalizeMeasurement(a)}else this._clearMeasurement()};c.prototype._updateAnchor=function(a,c){if(this._markupItem){var b=this._markupItem.getPoints();if(1!==b.length)switch(this._anchor){case g.Last:this._calculateAnchorPos(a,c);break;case g.First:if(2!==b.length)break;c=this._viewer.view.projectPoint(b[0]);this._calculateAnchorPos(d.Point2.fromPoint3(c),
b[0]);break;case g.Midpoint:a=void 0;c=this._markupItem.getMeasurementValue()/2;for(var e=0,f=1;f<b.length;f++){var h=d.Point3.subtract(b[f],b[f-1]),p=h.length(),q=e+p;if(q>c){h.scale((c-e)/p);a=d.Point3.add(b[f-1],h);break}e=q}c=this._viewer.view.projectPoint(a);this._calculateAnchorPos(d.Point2.fromPoint3(c),a)}}};c.prototype._calculateSelectionPlane=function(a){var b=this._viewer.view.getCamera();b=d.Point3.subtract(b.getPosition(),a);b.normalize();return d.Plane.createFromPointAndNormal(a,b)};
c.prototype._calculateAnchorPos=function(a,c){var b=this._viewer.view.getCamera();d.Point3.subtract(b.getPosition(),c).normalize();b=this._calculateSelectionPlane(c);if(a=this._viewer.view.raycastFromPoint(d.Point2.add(a,this._textShapeOffset)))b.intersectsRay(a,this._markupItem.textPosition),this._markupItem.leaderPosition.assign(c)};c.prototype._clearMeasurement=function(){null!==this._markupItem?(this._measureManager.removeMeasurement(this._markupItem),this._markupItem=null):this._measureManager.removeLastMeasurement()};
c.prototype._draw=function(){this._viewer.markupManager.refreshMarkup()};c.prototype._pickExisting=function(a){return(a=this._viewer.markupManager.pickMarkupItem(a))&&"Communicator.Markup.Measure.MeasurePolygonAreaMarkup"===a.getClassName()?(this._markupItem=a,!0):!1};c.prototype.onActivate=function(){this._cursor.onOperatorActivate()};c.prototype.onDeactivate=function(){this._cursor.onOperatorDeactivate()};c.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&this._clearMeasurement()};
c.prototype._onBeginInteraction=function(){this._cameraInteractionActive=!0;this._cursor.activateCursorSprite(!1)};c.prototype._onEndInteraction=function(){this._cameraInteractionActive=!1};return c}(h.OperatorBase);h.MeasurePolygonAreaOperator=a})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g;(function(a){a[a.First=0]="First";a[a.Last=1]="Last";a[a.Midpoint=2]="Midpoint"})(g=h.MeasurePolylineDistanceAnchor||(h.MeasurePolylineDistanceAnchor={}));var a=function(a){function c(b,c){var e=a.call(this,b)||this;e._markupItem=null;e._cameraInteractionActive=!1;e._textShapeOffset=new d.Point2(10,-25);e._anchor=g.Last;e._dragPlane=null;e._measureManager=c;e._cursor=new h.Common.PointCursor(e._viewer);e._viewer.setCallbacks({beginInteraction:function(){e._onBeginInteraction()},
endInteraction:function(){e._onEndInteraction()}});return e}__extends(c,a);c.prototype.getMarkupItem=function(){return this._markupItem};c.prototype.setAnchor=function(a){this._anchor=a};c.prototype._useSnapping=function(a){return this._cursor.snappingConfig.enabled&&!a.altDown()};c.prototype._getLastSelectedPoint=function(){return this._markupItem?this._markupItem.getlast():null};c.prototype._createNewMarkupItem=function(a){this._markupItem=new d.Markup.Measure.MeasurePolylineDistanceMarkup(this._viewer);
this._markupItem.setUnitMultiplier(a.selectionItem.isNodeSelection()?this._viewer.model.getNodeUnitMultiplier(a.selectionItem.getNodeId()):1);this._markupItem.setName("MeasurePolylineDistanceMarkup");this._measureManager.addMeasurement(this._markupItem);this._markupItem.addPoint(a.worldPosition)};c.prototype._updateMarkupItem=function(a,c){if(null!==this._markupItem&&null!=c.worldPosition){var b=this._markupItem.getPoints(),e=d.Point2.fromPoint3(this._viewer.view.projectPoint(b[0]));d.Point2.distance(e,
a)<this._markupItem.pointRadius?2<b.length&&(this._markupItem.isLoop=!0,this._finalizeMeasurement()):(this._markupItem.addPoint(c.worldPosition),this._updateAnchor(a,c.worldPosition))}};c.prototype._updateMeasurementItem=function(a,c){return __awaiter(this,void 0,void 0,function(){var b,d;return __generator(this,function(e){switch(e.label){case 0:return b=this._getLastSelectedPoint(),[4,this._cursor.getSelectionCursorPoints(a,c,b)];case 1:d=e.sent();if(null===d||null===d.worldPosition)return this._cursor.activateCursorSprite(!1),
[2];this._cursor.activateCursorSprite(!0);null===this._markupItem?this._createNewMarkupItem(d):this._updateMarkupItem(a,d);return[2]}})})};c.prototype._isDraggingText=function(){return null!==this._dragPlane};c.prototype.onMouseDown=function(b){a.prototype.onMouseDown.call(this,b);if(!this._markupItem){var c=b.getPosition();this._pickExisting(c)&&(this._dragPlane=this._calculateSelectionPlane(this._markupItem.leaderPosition),b.setHandled(!0))}};c.prototype.onMouseMove=function(b){a.prototype.onMouseMove.call(this,
b);if(this._isDraggingText())this._dragMarkupText(b),b.setHandled(!0);else if(!this._cameraInteractionActive){var c=this._getLastSelectedPoint();this._cursor.updateCursorSprite(b.getPosition(),this._useSnapping(b),c);this._draw()}};c.prototype.onMouseUp=function(b){return __awaiter(this,void 0,void 0,function(){var c,d,e;return __generator(this,function(f){switch(f.label){case 0:if(!this.isActive())return[2];c=b.getPosition();if(!this._isDraggingText())return[3,1];this._dragPlane=this._markupItem=
null;return[3,3];case 1:if(!this._ptFirst.equals(c))return[3,3];d=this._useSnapping(b);e=c;return[4,this._updateMeasurementItem(e,d)];case 2:f.sent(),f.label=3;case 3:return a.prototype.onMouseUp.call(this,b),[2]}})})};c.prototype.onDoubleClick=function(a){this._finalizeMeasurement()};c.prototype._dragMarkupText=function(a){null!==this._markupItem&&null!==this._dragPlane&&(a=this._viewer.view.raycastFromPoint(a.getPosition()),this._dragPlane.intersectsRay(a,this._markupItem.textPosition),this._draw())};
c.prototype._finalizeMeasurement=function(){if(this._markupItem)if(this._markupItem.isValid()){var a=this._markupItem;this._markupItem=null;a.finalize();this._measureManager.finalizeMeasurement(a)}else this._clearMeasurement()};c.prototype._updateAnchor=function(a,c){if(this._markupItem){var b=this._markupItem.getPoints();if(1!==b.length)switch(this._anchor){case g.Last:this._calculateAnchorPos(a,c);break;case g.First:if(2!==b.length)break;c=this._viewer.view.projectPoint(b[0]);this._calculateAnchorPos(d.Point2.fromPoint3(c),
b[0]);break;case g.Midpoint:a=void 0;c=this._markupItem.getMeasurementValue()/2;for(var e=0,f=1;f<b.length;f++){var h=d.Point3.subtract(b[f],b[f-1]),p=h.length(),q=e+p;if(q>c){h.scale((c-e)/p);a=d.Point3.add(b[f-1],h);break}e=q}c=this._viewer.view.projectPoint(a);this._calculateAnchorPos(d.Point2.fromPoint3(c),a)}}};c.prototype._calculateSelectionPlane=function(a){var b=this._viewer.view.getCamera();b=d.Point3.subtract(b.getPosition(),a);b.normalize();return d.Plane.createFromPointAndNormal(a,b)};
c.prototype._calculateAnchorPos=function(a,c){var b=this._viewer.view.getCamera();d.Point3.subtract(b.getPosition(),c).normalize();b=this._calculateSelectionPlane(c);if(a=this._viewer.view.raycastFromPoint(d.Point2.add(a,this._textShapeOffset)))b.intersectsRay(a,this._markupItem.textPosition),this._markupItem.leaderPosition.assign(c)};c.prototype._clearMeasurement=function(){null!==this._markupItem?(this._measureManager.removeMeasurement(this._markupItem),this._markupItem=null):this._measureManager.removeLastMeasurement()};
c.prototype._draw=function(){this._viewer.markupManager.refreshMarkup()};c.prototype._pickExisting=function(a){return(a=this._viewer.markupManager.pickMarkupItem(a))&&"Communicator.Markup.Measure.MeasurePolylineDistanceMarkup"===a.getClassName()?(this._markupItem=a,!0):!1};c.prototype.onActivate=function(){this._cursor.onOperatorActivate()};c.prototype.onDeactivate=function(){this._cursor.onOperatorDeactivate()};c.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&this._clearMeasurement()};
c.prototype._onBeginInteraction=function(){this._cameraInteractionActive=!0;this._cursor.activateCursorSprite(!1)};c.prototype._onEndInteraction=function(){this._cameraInteractionActive=!1};return c}(h.OperatorBase);h.MeasurePolylineDistanceOperator=a})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function a(a,b){var c=new d.Point4(b.x,b.y,b.z,1);b=new d.Point4(0,0,0,0);a.view.getFullCameraMatrix().transform4(c,b);c=1/b.w;b=new d.Point2(b.x*c,b.y*c);c=a.model.getClientDimensions();a=c[0];c=c[1];b.x=.5*a*(b.x+1);b.y=.5*c*(b.y+1);b.x=Math.max(0,Math.min(b.x,a));b.y=c-Math.max(0,Math.min(b.y,c));return b}g.worldPointToScreenPoint=a;var e=function(){return function(a,b,c){this.worldPosition=a;this.screenPosition=b;this.selectionItem=c}}();g.SelectionPoints=
e;var c=function(a){function b(b){var c=a.call(this,b)||this;c._cursorSprite=new d.Markup.Shape.Circle;c._name="CursorMarkup";var e=b.measureManager.getMeasurementColor();c._cursorSprite.setFillColor(e);c._cursorSprite.setStrokeColor(e);c._markupId=b.markupManager.registerMarkup(c);return c}__extends(b,a);b.prototype.draw=function(){this._viewer.markupManager.getRenderer().drawCircle(this._cursorSprite)};b.prototype.enable=function(a){this._cursorSprite.setRadius(a?2.5:0)};b.prototype.isEnabled=function(){return 0<
this._cursorSprite.getRadius()};b.prototype.setPosition=function(a){this._cursorSprite.setCenter(a)};b.prototype.destroy=function(){this._viewer.markupManager.unregisterMarkup(this._markupId)};return b}(d.Markup.Measure.MeasureMarkup),b=function(){function b(a){this._cursorMarkup=null;this._updateCursorSpriteAction=new d.Util.CurrentAction(!0);this._viewer=a;this.snappingConfig={enabled:!0,preferVertices:!0}}b.prototype.getSelectionCursorPoints=function(b,c,f){return __awaiter(this,void 0,void 0,
function(){var g,h,k,l,n,t,v;return __generator(this,function(m){switch(m.label){case 0:return g=new d.PickConfig(c?d.SelectionMask.All:d.SelectionMask.Face),[4,this._viewer.view.pickFromPoint(b,g)];case 1:h=m.sent();if(0!==h.overlayIndex())return[2,null];k=h.getPosition();l=b;this.snappingConfig.enabled&&(n=h.getLineEntity(),t=h.getPointEntity(),n||t)&&(v=null,null!==n?v=this._getLineSnapPoint(n,c,f):null!==t&&(v=t.getPosition()),null!==v&&(k=v,l=a(this._viewer,k)));return[2,new e(k,l,h)]}})})};
b.prototype.updateCursorSprite=function(a,b,c){var d=this;this._updateCursorSpriteAction.set(function(){return d._updateCursorSpriteImpl(a,b,c)})};b.prototype._updateCursorSpriteImpl=function(a,b,c){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(e){switch(e.label){case 0:return null===this._cursorMarkup?[3,3]:b?[4,this.getSelectionCursorPoints(a,b,c)]:[3,2];case 1:return d=e.sent(),null!==d?(this._cursorMarkup.setPosition(d.screenPosition),this.activateCursorSprite(!0)):
this.activateCursorSprite(!1),[3,3];case 2:this._cursorMarkup.setPosition(a),e.label=3;case 3:return[2]}})})};b.prototype.draw=function(){null!==this._cursorMarkup&&this._cursorMarkup.draw()};b.prototype.activateCursorSprite=function(a){null!==this._cursorMarkup&&this._cursorMarkup.enable(a)};b.prototype._getLineSnapPoint=function(b,c,e){var f=this.snappingConfig.preferVertices?b.getBestVertex():null;if(null!==f)return f;f=b.getPosition();if(!c||null==e)return f;b=b.getPoints();a:{for(c=0;c<b.length-
1;c++)if(d.Util.isPointOnLineSegment(b[c],b[c+1],f,1E-10)){var g=c;break a}g=0}c=b[g];b=b[g+1];if(void 0===c||void 0===b)return f;e=d.Util.closestPointFromPointToSegment(c,b,e);b=a(this._viewer,e);c=a(this._viewer,f);b=d.Point2.subtract(b,c).squaredLength();c=this._viewer.selectionManager.getPickTolerance();return b<=c*c?e:f};b.prototype.onOperatorActivate=function(){this._cursorMarkup=new c(this._viewer);this._viewer.sheetManager.isDrawingSheetActive()&&this._viewer.sheetManager.setBackgroundSelectionEnabled(!0)};
b.prototype.onOperatorDeactivate=function(){null!==this._cursorMarkup&&(this._cursorMarkup.destroy(),this._cursorMarkup=null);this._viewer.sheetManager.isDrawingSheetActive()&&this._viewer.sheetManager.setBackgroundSelectionEnabled(!1)};return b}();g.PointCursor=b})(h.Common||(h.Common={}))})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){var h=function(g){function a(a){var c=g.call(this,a)||this;c._activeRedlineItem=null;c._newRedlineItem=null;c._viewer=a;return c}__extends(a,g);a.prototype.createRedlineItem=function(a){a;return null};a.prototype.updateRedlineItem=function(a){a};a.prototype.finalizeRedlineItem=function(a){a;return null};a.prototype.onMouseDown=function(a){g.prototype.onMouseDown.call(this,a);this.isActive()&&(a.getButton()!==d.Button.Left&&null===this._primaryTouchId||this._redlineOperatorStart(),a.setHandled(!0))};
a.prototype.onMouseMove=function(a){g.prototype.onMouseMove.call(this,a);this.isActive()&&(this._redlineOperatorMove(),a.setHandled(!0))};a.prototype.onMouseUp=function(a){this.isActive()&&(a.getButton()!==d.Button.Left&&null===this._primaryTouchId||this._redlineOperatorEnd(),a.setHandled(!0));g.prototype.onMouseUp.call(this,a)};a.prototype.onMousewheel=function(a){a.setHandled(!0)};a.prototype.setDraggingEnabled=function(a){this._dragging=a};a.prototype.setHandled=function(){return!0};a.prototype._isRedlineItem=
function(a){return Object.getPrototypeOf(a)instanceof d.Markup.Redline.RedlineItem};a.prototype.onKeyUp=function(a){a=a.getKeyCode();if(a===d.KeyCode.Backspace||a===d.KeyCode.Delete){a=this._viewer.markupManager;var c=a.getSelectedMarkup(),b=a.getActiveMarkupView();null!==c&&this._isRedlineItem(c)&&null!==b&&(b.removeMarkup(c),a.selectMarkup(null))}};a.prototype._removeRedlineTextIfInvalid=function(a){if(!a.isValid()){var c=this._viewer.markupManager.getActiveMarkupView();null!==c&&(c.removeMarkup(a),
this._viewer.trigger("redlineDeleted",a));a.remove()}};a.prototype._redlineOperatorStart=function(){var a=this._viewer.markupManager,c=a.pickMarkupItem(this._ptFirst),b=a.getSelectedMarkup();c?(this._activeRedlineItem=c,this._dragging&&this._activeRedlineItem.onDragStart(this._ptFirst)&&a.refreshMarkup()):(a.selectMarkup(null),this._markupIsTextArea(b)?this._removeRedlineTextIfInvalid(b):this._newRedlineItem=this.createRedlineItem(this._ptFirst))};a.prototype._redlineOperatorMove=function(){this._activeRedlineItem?
this._dragging&&this._activeRedlineItem.onDragMove(this._ptCurrent)&&this._viewer.markupManager.refreshMarkup():this.updateRedlineItem(this._ptCurrent)};a.prototype._redlineOperatorEnd=function(){var a=this._viewer.markupManager;this._activeRedlineItem?this._ptFirst.equals(this._ptCurrent)?a.selectMarkup(this._activeRedlineItem):(this._viewer.trigger("redlineUpdated",this._activeRedlineItem),this._dragging&&this._activeRedlineItem.onDragEnd(this._ptCurrent)&&a.refreshMarkup()):this._newRedlineItem&&
(a=this.finalizeRedlineItem(this._ptCurrent))&&this._attachNewMarkupToView(a);this._newRedlineItem=this._activeRedlineItem=null};a.prototype._attachNewMarkupToView=function(a){return __awaiter(this,void 0,void 0,function(){var c,b,e,g,h,n,m,p,q;return __generator(this,function(f){switch(f.label){case 0:c=this._viewer;b=c.model;e=c.markupManager;g=e.getActiveMarkupView();h=!1;if(null!==g)return[3,3];n=b.getAbsoluteRootNode();return[4,b.getVisibilityState(n)];case 1:return m=f.sent(),[4,b.getNodeColorMap(b.getAbsoluteRootNode(),
d.ElementType.Faces)];case 2:p=f.sent(),q=e.createMarkupView(void 0,!1,m,p,null),g=e.getMarkupView(q),h=!0,f.label=3;case 3:return null!==g&&(g.addMarkupItem(a),e.selectMarkup(a)),h&&null!==g&&this._viewer.trigger("viewCreated",g),this._viewer.trigger("redlineCreated",a),[2]}})})};a.prototype._markupIsTextArea=function(a){return a?a.getClassName()===d.Markup.Redline.RedlineText.className:!1};return a}(d.Operator.OperatorBase);d.RedlineOperator=h})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){c=a.call(this,c)||this;c._redlineCircle=null;c._previewHandle=null;c._centerSet=!1;return c}__extends(e,a);e.prototype.createRedlineItem=function(a){var b=this._viewer.view;this._redlineCircle=new d.Markup.Redline.RedlineCircle(this._viewer);this._previewHandle=this._viewer.markupManager.registerMarkup(this._redlineCircle);a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&(this._centerSet=!0,this._redlineCircle.setCenter(a),this._redlineCircle.setRadiusPoint(a));
return this._redlineCircle};e.prototype.updateRedlineItem=function(a){var b=this._viewer.view;this._redlineCircle&&(a=b.getCamera().getCameraPlaneIntersectionPoint(a,b),null!==a&&(this._centerSet||(this._centerSet=!0,this._redlineCircle.setCenter(a)),this._redlineCircle.setRadiusPoint(a),this._viewer.markupManager.refreshMarkup()))};e.prototype.finalizeRedlineItem=function(a){a=this._viewer.markupManager;var b=null;this._redlineCircle&&(this._redlineCircle.isValid()&&(b=this._redlineCircle),this._redlineCircle=
null,null!==this._previewHandle&&(a.unregisterMarkup(this._previewHandle),this._previewHandle=null),a.refreshMarkup());return b};return e}(d.RedlineOperator);h.RedlineCircleOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){c=a.call(this,c)||this;c._redlinePolyline=null;c._previewHandle=null;return c}__extends(e,a);e.prototype.createRedlineItem=function(a){var b=this._viewer.view;this._redlinePolyline=new d.Markup.Redline.RedlinePolyline(this._viewer);this._previewHandle=this._viewer.markupManager.registerMarkup(this._redlinePolyline);a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&this._redlinePolyline.addPoint(a);return this._redlinePolyline};
e.prototype.updateRedlineItem=function(a){if(this._redlinePolyline){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&(this._redlinePolyline.addPoint(a),this._viewer.markupManager.refreshMarkup())}};e.prototype.finalizeRedlineItem=function(a){a=this._viewer.markupManager;var b=null;this._redlinePolyline&&(this._redlinePolyline.isValid()&&(b=this._redlinePolyline),this._redlinePolyline=null,null!==this._previewHandle&&(a.unregisterMarkup(this._previewHandle),this._previewHandle=
null),a.refreshMarkup());return b};return e}(d.RedlineOperator);h.RedlinePolylineOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){c=a.call(this,c)||this;c._redlineRectangle=null;c._previewHandle=null;return c}__extends(e,a);e.prototype.createRedlineItem=function(a){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);this._redlineRectangle=new d.Markup.Redline.RedlineRectangle(this._viewer);null!==a&&(this._redlineRectangle.setPoint1(a),this._redlineRectangle.setPoint2(a));this._previewHandle=this._viewer.markupManager.registerMarkup(this._redlineRectangle);
return this._redlineRectangle};e.prototype.updateRedlineItem=function(a){if(this._redlineRectangle){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&this._redlineRectangle.setPoint2(a);this._viewer.markupManager.refreshMarkup()}};e.prototype.finalizeRedlineItem=function(a){a=null;if(this._redlineRectangle&&this._previewHandle){var b=this._viewer.markupManager;this._redlineRectangle.isValid()&&(a=this._redlineRectangle);b.unregisterMarkup(this._previewHandle);
this._redlineRectangle=this._previewHandle=null;b.refreshMarkup()}return a};return e}(d.RedlineOperator);h.RedlineRectangleOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(a){function e(c){c=a.call(this,c)||this;c._redlineText=null;return c}__extends(e,a);e.prototype.createRedlineItem=function(a){return this._redlineText=new d.Markup.Redline.RedlineText(this._viewer)};e.prototype.finalizeRedlineItem=function(a){if(null===this._redlineText)return null;var b=this._viewer.view,c=this._redlineText;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&c.setPosition(a);this._redlineText=null;return c};return e}(d.RedlineOperator);
h.RedlineTextOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));

var _SC = {
    _deferredInstances: [],

    _loadEngine: function (enginePath, onError) {
        if (this._engineLoaded) {
            return;
        }
        this._engineLoaded = true;
        this._enginePath = enginePath;

        var hasWebAssembly = (function () {
            try {
                if (
                    typeof WebAssembly === "object" &&
                    typeof WebAssembly.instantiate === "function"
                ) {
                    var module = new WebAssembly.Module(
                        Uint8Array.of(0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00)
                    );
                    if (module instanceof WebAssembly.Module) {
                        return new WebAssembly.Instance(module) instanceof WebAssembly.Instance;
                    }
                }
            } catch (e) {
                //
            }
            return false;
        })();

        var engineJs = hasWebAssembly ? "engine-wasm.js" : "engine-asmjs.js";
        if (enginePath) {
            engineJs = enginePath + "/" + engineJs;
        }

        var engineScript = document.createElement("script");
        engineScript.type = "text/javascript";

        if (typeof onError === "function") {
            engineScript.onerror = function (e) {
                onError("failed to load " + e.target.src);
            };
        }

        document.head.appendChild(engineScript);
        engineScript.src = engineJs;
    },

    _defaultEnginePath: (function () {
        // paths are normally relative to HTML, but we want a path relative to current JS file
        var scriptElements = document.getElementsByTagName("script");
        var path = scriptElements[scriptElements.length - 1].src; // URL of current script
        path = path.split("?")[0]; // remove query string
        path = path.split("/").slice(0, -1).join("/"); // remove filename
        return path;
    })(),

    // store instance arguments and return empty base object that will
    // be populated asynchronously
    createInstance: function (instanceArgs) {
        var enginePath = instanceArgs.enginePath;
        if (typeof enginePath !== "string") {
            // allow empty string, which means relative to HTML
            enginePath = this._defaultEnginePath;
        }

        this._loadEngine(enginePath, instanceArgs.onError);

        var argWrapper = {
            isWrapper: true,
            base: {},
            args: instanceArgs,
            enginePath: enginePath,
        };

        this._deferredInstances.push(argWrapper);
        return argWrapper.base;
    },
};

(function(m,r,R,S,E,L){function Ka(a,b,c,d,e){return ha(a,a,c,d,b,a.defaultView.pageXOffset,a.defaultView.pageYOffset).then(function(f){q("Document cloned");var g="data-html2canvas-node"+e,h="["+g+"='"+e+"']";a.querySelector(h).removeAttribute(g);var g=f.contentWindow,k=g.document.querySelector(h);return("function"===typeof b.onclone?Promise.resolve(b.onclone(g.document)):Promise.resolve(!0)).then(function(){return ia(k,f,b,c,d)})})}function ia(a,b,c,d,e){var f=b.contentWindow,g=new T(f.document),
h=new u(c,g),k=U(a);d="view"===c.type?d:La(f.document);e="view"===c.type?e:Ma(f.document);var F=new c.renderer(d,e,h,c,r);return(new n(a,F,g,h,c)).ready.then(function(){q("Finished rendering");var d;d="view"===c.type?ja(F.canvas,{width:F.canvas.width,height:F.canvas.height,top:0,left:0,x:0,y:0}):a===f.document.body||a===f.document.documentElement||null!=c.canvas?F.canvas:ja(F.canvas,{width:null!=c.width?c.width:k.width,height:null!=c.height?c.height:k.height,top:k.top,left:k.left,x:f.pageXOffset,
y:f.pageYOffset});c.removeContainer&&(b.parentNode.removeChild(b),q("Cleaned up container"));return d})}function ja(a,b){var c=r.createElement("canvas"),d=Math.min(a.width-1,Math.max(0,b.left)),e=Math.min(a.width,Math.max(1,b.left+b.width)),f=Math.min(a.height-1,Math.max(0,b.top)),g=Math.min(a.height,Math.max(1,b.top+b.height));c.width=b.width;c.height=b.height;q("Cropping canvas at:","left:",b.left,"top:",b.top,"width:",e-d,"height:",g-f);q("Resulting crop with width",b.width,"and height",b.height,
" with x",d,"and y",f);c.getContext("2d").drawImage(a,d,f,e-d,g-f,b.x,b.y,e-d,g-f);return c}function La(a){return Math.max(Math.max(a.body.scrollWidth,a.documentElement.scrollWidth),Math.max(a.body.offsetWidth,a.documentElement.offsetWidth),Math.max(a.body.clientWidth,a.documentElement.clientWidth))}function Ma(a){return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))}
function ka(){return"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"}function la(a,b){for(var c=3===a.nodeType?r.createTextNode(a.nodeValue):a.cloneNode(!1),d=a.firstChild;d;)!0!==b&&1===d.nodeType&&"SCRIPT"===d.nodeName||c.appendChild(la(d,b)),d=d.nextSibling;return c}function ha(a,b,c,d,e,f,g){Na(a);var h=r.documentMode&&9>=r.documentMode?la(a.documentElement,e.javascriptEnabled):a.documentElement.cloneNode(!0),k=b.createElement("iframe");k.className="html2canvas-container";
k.style.visibility="hidden";k.style.position="fixed";k.style.left="-10000px";k.style.top="0px";k.style.border="0";k.width=c;k.height=d;k.scrolling="no";b.body.appendChild(k);return new Promise(function(b){var c=k.contentWindow.document;ma(a.documentElement,h,"textarea");ma(a.documentElement,h,"select");k.contentWindow.onload=k.onload=function(){var d=setInterval(function(){0<c.body.childNodes.length&&(Oa(a,c),clearInterval(d),"view"===e.type&&k.contentWindow.scrollTo(f,g),b(k))},50)};c.open();c.write("<!DOCTYPE html><html></html>");
!a.defaultView||f===a.defaultView.pageXOffset&&g===a.defaultView.pageYOffset||a.defaultView.scrollTo(f,g);c.replaceChild(!0===e.javascriptEnabled?c.adoptNode(h):na(c.adoptNode(h)),c.documentElement);c.close()})}function ma(a,b,c){a=a.getElementsByTagName(c);b=b.getElementsByTagName(c);c=a.length;for(var d=0;d<c;d++)b[d].value=a[d].value}function oa(a,b,c,d,e,f){return(new Pa(a,b,m.document)).then(Qa(a)).then(function(a){return ha(a,c,d,e,f,0,0)})}function Qa(a){return function(b){var c=new DOMParser,
d;try{d=c.parseFromString(b,"text/html")}catch(e){q("DOMParser not supported, falling back to createHTMLDocument");d=r.implementation.createHTMLDocument("");try{d.open(),d.write(b),d.close()}catch(f){q("createHTMLDocument write not supported, falling back to document.body.innerHTML"),d.body.innerHTML=b}}b=d.querySelector("base");b&&b.href.host||(b=d.createElement("base"),b.href=a,d.head.insertBefore(b,d.head.firstChild));return d}}function Na(a){[].slice.call(a.querySelectorAll("canvas"),0).forEach(function(a){a.setAttribute("data-html2canvas-canvas-clone",
"canvas-"+Ra++)})}function Oa(a,b){[].slice.call(a.querySelectorAll("[data-html2canvas-canvas-clone]"),0).forEach(function(a){try{var d=b.querySelector('[data-html2canvas-canvas-clone="'+a.getAttribute("data-html2canvas-canvas-clone")+'"]');d&&(d.width=a.width,d.height=a.height,d.getContext("2d").putImageData(a.getContext("2d").getImageData(0,0,a.width,a.height),0,0))}catch(e){q("Unable to copy canvas content from",a,e)}a.removeAttribute("data-html2canvas-canvas-clone")})}function na(a){[].slice.call(a.childNodes,
0).filter(Sa).forEach(function(b){"SCRIPT"===b.tagName?a.removeChild(b):na(b)});return a}function Sa(a){return a.nodeType===Node.ELEMENT_NODE}function Ta(a){var b=r.createElement("a");b.href=a;b.href=b.href;return b}function t(a){this.b=this.g=this.r=0;this.a=null;this.fromArray(a)||this.namedColor(a)||this.rgb(a)||this.rgba(a)||this.hex6(a)||this.hex3(a)}function M(a){this.src=a;q("DummyImageContainer for",a);if(!this.promise||!this.image){q("Initiating DummyImageContainer");M.prototype.image=new Image;
var b=this.image;M.prototype.promise=new Promise(function(a,d){b.onload=a;b.onerror=d;b.src=ka();!0===b.complete&&a(b)})}}function Ua(a,b){var c=r.createElement("div"),d=r.createElement("img"),e=r.createElement("span"),f;c.style.visibility="hidden";c.style.fontFamily=a;c.style.fontSize=b;c.style.margin=0;c.style.padding=0;r.body.appendChild(c);d.src=ka();d.width=1;d.height=1;d.style.margin=0;d.style.padding=0;d.style.verticalAlign="baseline";e.style.fontFamily=a;e.style.fontSize=b;e.style.margin=
0;e.style.padding=0;e.appendChild(r.createTextNode("Hidden Text"));c.appendChild(e);c.appendChild(d);f=d.offsetTop-e.offsetTop+1;c.removeChild(e);c.appendChild(r.createTextNode("Hidden Text"));c.style.lineHeight="normal";d.style.verticalAlign="super";d=d.offsetTop-c.offsetTop+1;r.body.removeChild(c);this.baseline=f;this.lineWidth=1;this.middle=d}function pa(){this.data={}}function qa(a,b,c){this.image=null;this.src=a;var d=this,e=U(a);this.promise=(b?new Promise(function(b){"about:blank"===a.contentWindow.document.URL||
null==a.contentWindow.document.documentElement?a.contentWindow.onload=a.onload=function(){b(a)}:b(a)}):this.proxyLoad(c.proxy,e,c)).then(function(a){return html2canvas(a.contentWindow.document.documentElement,{type:"view",width:a.width,height:a.height,proxy:c.proxy,javascriptEnabled:c.javascriptEnabled,removeContainer:c.removeContainer,allowTaint:c.allowTaint,imageTimeout:c.imageTimeout/2})}).then(function(a){return d.image=a})}function N(a){this.src=a.value;this.colorStops=[];this.type=null;this.y1=
this.x1=this.y0=this.x0=.5;this.promise=Promise.resolve(!0)}function ba(a,b){this.src=a;this.image=new Image;var c=this;this.tainted=null;this.promise=new Promise(function(d,e){c.image.onload=d;c.image.onerror=e;b&&(c.image.crossOrigin="anonymous");c.image.src=a;!0===c.image.complete&&d(c.image)})}function u(a,b){this.link=null;this.options=a;this.support=b;this.origin=this.getOrigin(m.location.href)}function V(a){N.apply(this,arguments);this.type=this.TYPES.LINEAR;var b=null===a.args[0].match(this.stepRegExp);
b?a.args[0].split(" ").reverse().forEach(function(a){switch(a){case "left":this.x0=0;this.x1=1;break;case "top":this.y0=0;this.y1=1;break;case "right":this.x0=1;this.x1=0;break;case "bottom":this.y0=1;this.y1=0;break;case "to":a=this.y0;var b=this.x0;this.y0=this.y1;this.x0=this.x1;this.x1=b;this.y1=a}},this):(this.y0=0,this.y1=1);this.colorStops=a.args.slice(b?1:0).map(function(a){a=a.match(this.stepRegExp);return{color:new t(a[1]),stop:"%"===a[3]?a[2]/100:null}},this);null===this.colorStops[0].stop&&
(this.colorStops[0].stop=0);null===this.colorStops[this.colorStops.length-1].stop&&(this.colorStops[this.colorStops.length-1].stop=1);this.colorStops.forEach(function(a,b){null===a.stop&&this.colorStops.slice(b).some(function(e,f){return null!==e.stop?(a.stop=(e.stop-this.colorStops[b-1].stop)/(f+1)+this.colorStops[b-1].stop,!0):!1},this)},this)}function q(){m.html2canvas.logging&&m.console&&m.console.log&&Function.prototype.bind.call(m.console.log,m.console).apply(m.console,[Date.now()-m.html2canvas.start+
"ms","html2canvas:"].concat([].slice.call(arguments,0)))}function l(a,b){this.node=a;this.parent=b;this.borders=this.bounds=this.stack=null;this.clip=[];this.backgroundClip=[];this.computedStyles=this.visible=this.offsetBounds=null;this.colors={};this.styles={};this.transformMatrix=this.transformData=this.backgroundImages=null;this.isPseudoElement=!1;this.opacity=null}function Va(a){if(a&&"matrix"===a[1])return a[2].split(",").map(function(a){return parseFloat(a.trim())})}function W(a){return-1!==
a.toString().indexOf("%")}function ra(a){var b,c,d,e,f,g=[],h=0,k=0,l,m,q=function(){b&&('"'===c.substr(0,1)&&(c=c.substr(1,c.length-2)),c&&m.push(c),"-"===b.substr(0,1)&&0<(e=b.indexOf("-",1)+1)&&(d=b.substr(0,e),b=b.substr(e)),g.push({prefix:d,method:b.toLowerCase(),value:f,args:m,image:null}));m=[];b=d=c=f=""};m=[];b=d=c=f="";a.split("").forEach(function(a){if(!(0===h&&-1<" \r\n\t".indexOf(a))){switch(a){case '"':l?l===a&&(l=null):l=a;break;case "(":if(!l){if(0===h){h=1;f+=a;return}k++}break;case ")":if(!l&&
1===h){if(0===k){h=0;f+=a;q();return}k--}break;case ",":if(!l){if(0===h){q();return}if(1===h&&0===k&&!b.match(/^url$/i)){m.push(c);c="";f+=a;return}}}f+=a;0===h?b+=a:c+=a}});q();return g}function Wa(a){return a.replace("px","")}function Xa(a){return parseFloat(a)}function U(a){if(a.getBoundingClientRect){var b=a.getBoundingClientRect(),c=null==a.offsetWidth?b.width:a.offsetWidth;return{top:b.top,bottom:b.bottom||b.top+b.height,right:b.left+c,left:b.left,width:c,height:null==a.offsetHeight?b.height:
a.offsetHeight}}return{}}function ca(a){var b=a.offsetParent?ca(a.offsetParent):{top:0,left:0};return{top:a.offsetTop+b.top,bottom:a.offsetTop+a.offsetHeight+b.top,right:a.offsetLeft+b.left+a.offsetWidth,left:a.offsetLeft+b.left,width:a.offsetWidth,height:a.offsetHeight}}function n(a,b,c,d,e){q("Starting NodeParser");this.renderer=b;this.options=e;this.range=null;this.support=c;this.renderQueue=[];this.stack=new G(!0,1,a.ownerDocument,null);c=new l(a,null);e.background&&b.rectangle(0,0,b.width,b.height,
new t(e.background));if(a===a.ownerDocument.documentElement){var f=new l(c.color("backgroundColor").isTransparent()?a.ownerDocument.body:a.ownerDocument.documentElement,null);b.rectangle(0,0,b.width,b.height,f.color("backgroundColor"))}c.visibile=c.isElementVisible();this.createPseudoHideStyles(a.ownerDocument);this.disableAnimations(a.ownerDocument);this.nodes=[].concat.apply([],[c].concat(this.getChildren(c)).filter(function(a){return a.visible=a.isElementVisible()}).map(this.getPseudoElements,
this));this.fontMetrics=new pa;q("Fetched nodes, total:",this.nodes.length);q("Calculate overflow clips");this.calculateOverflowClips();q("Start fetching images");this.images=d.fetch(this.nodes.filter(O));this.ready=this.images.ready.then(X(function(){q("Images loaded, starting parsing");q("Creating stacking contexts");this.createStackingContexts();q("Sorting stacking contexts");this.sortStackingContexts(this.stack);this.parse(this.stack);q("Render queue created with "+this.renderQueue.length+" items");
return new Promise(X(function(a){e.async?"function"===typeof e.async?e.async.call(this,this.renderQueue,a):0<this.renderQueue.length?(this.renderIndex=0,this.asyncRenderer(this.renderQueue,a)):a():(this.renderQueue.forEach(this.paint,this),a())},this))},this))}function Ya(a){return a.replace(/(\-[a-z])/g,function(a){return a.toUpperCase().replace("-","")})}function sa(){}function ta(a,b,c,d){return a.map(function(e,f){if(0<e.width){var g=b.left,h=b.top,k=b.width,l=b.height-a[2].width;switch(f){case 0:l=
a[0].width;e.args=Y({c1:[g,h],c2:[g+k,h],c3:[g+k-a[1].width,h+l],c4:[g+a[3].width,h+l]},d[0],d[1],c.topLeftOuter,c.topLeftInner,c.topRightOuter,c.topRightInner);break;case 1:g=b.left+b.width-a[1].width;k=a[1].width;e.args=Y({c1:[g+k,h],c2:[g+k,h+l+a[2].width],c3:[g,h+l],c4:[g,h+a[0].width]},d[1],d[2],c.topRightOuter,c.topRightInner,c.bottomRightOuter,c.bottomRightInner);break;case 2:h=h+b.height-a[2].width;l=a[2].width;e.args=Y({c1:[g+k,h+l],c2:[g,h+l],c3:[g+a[3].width,h],c4:[g+k-a[3].width,h]},d[2],
d[3],c.bottomRightOuter,c.bottomRightInner,c.bottomLeftOuter,c.bottomLeftInner);break;case 3:k=a[3].width,e.args=Y({c1:[g,h+l+a[2].width],c2:[g,h],c3:[g+k,h+a[0].width],c4:[g+k,h+l]},d[3],d[0],c.bottomLeftOuter,c.bottomLeftInner,c.topLeftOuter,c.topLeftInner)}}return e})}function C(a,b,c,d){var e=(Math.sqrt(2)-1)/3*4,f=c*e,e=d*e;c=a+c;d=b+d;return{topLeft:H({x:a,y:d},{x:a,y:d-e},{x:c-f,y:b},{x:c,y:b}),topRight:H({x:a,y:b},{x:a+f,y:b},{x:c,y:d-e},{x:c,y:d}),bottomRight:H({x:c,y:b},{x:c,y:b+e},{x:a+
f,y:d},{x:a,y:d}),bottomLeft:H({x:c,y:d},{x:c-f,y:d},{x:a,y:b+e},{x:a,y:b})}}function ua(a,b,c){var d=a.left,e=a.top,f=a.width;a=a.height;var g=b[0][0],h=b[0][1],k=b[1][0],l=b[1][1],m=b[2][0],q=b[2][1],r=b[3][0];b=b[3][1];var n=f-k,t=a-q,p=f-m,u=a-b;return{topLeftOuter:C(d,e,g,h).topLeft.subdivide(.5),topLeftInner:C(d+c[3].width,e+c[0].width,Math.max(0,g-c[3].width),Math.max(0,h-c[0].width)).topLeft.subdivide(.5),topRightOuter:C(d+n,e,k,l).topRight.subdivide(.5),topRightInner:C(d+Math.min(n,f+c[3].width),
e+c[0].width,n>f+c[3].width?0:k-c[3].width,l-c[0].width).topRight.subdivide(.5),bottomRightOuter:C(d+p,e+t,m,q).bottomRight.subdivide(.5),bottomRightInner:C(d+Math.min(p,f-c[3].width),e+Math.min(t,a+c[0].width),Math.max(0,m-c[1].width),q-c[2].width).bottomRight.subdivide(.5),bottomLeftOuter:C(d,e+u,r,b).bottomLeft.subdivide(.5),bottomLeftInner:C(d+c[3].width,e+u,Math.max(0,r-c[3].width),b-c[2].width).bottomLeft.subdivide(.5)}}function H(a,b,c,d){var e=function(a,b,c){return{x:a.x+(b.x-a.x)*c,y:a.y+
(b.y-a.y)*c}};return{start:a,startControl:b,endControl:c,end:d,subdivide:function(f){var g=e(a,b,f),h=e(b,c,f),k=e(c,d,f),l=e(g,h,f),h=e(h,k,f);f=e(l,h,f);return[H(a,g,l,f),H(f,h,k,d)]},curveTo:function(a){a.push(["bezierCurve",b.x,b.y,c.x,c.y,d.x,d.y])},curveToReversed:function(d){d.push(["bezierCurve",c.x,c.y,b.x,b.y,a.x,a.y])}}}function Y(a,b,c,d,e,f,g){var h=[];0<b[0]||0<b[1]?(h.push(["line",d[1].start.x,d[1].start.y]),d[1].curveTo(h)):h.push(["line",a.c1[0],a.c1[1]]);0<c[0]||0<c[1]?(h.push(["line",
f[0].start.x,f[0].start.y]),f[0].curveTo(h),h.push(["line",g[0].end.x,g[0].end.y]),g[0].curveToReversed(h)):(h.push(["line",a.c2[0],a.c2[1]]),h.push(["line",a.c3[0],a.c3[1]]));0<b[0]||0<b[1]?(h.push(["line",e[1].end.x,e[1].end.y]),e[1].curveToReversed(h)):h.push(["line",a.c4[0],a.c4[1]]);return h}function D(a,b,c,d,e,f,g){0<b[0]||0<b[1]?(a.push(["line",d[0].start.x,d[0].start.y]),d[0].curveTo(a),d[1].curveTo(a)):a.push(["line",f,g]);(0<c[0]||0<c[1])&&a.push(["line",e[0].start.x,e[0].start.y])}function Za(a){return 0>
a.cssInt("zIndex")}function $a(a){return 0<a.cssInt("zIndex")}function va(a){return 0===a.cssInt("zIndex")}function wa(a){return-1!==["inline","inline-block","inline-table"].indexOf(a.css("display"))}function ab(a){return 0<a.node.data.trim().length}function bb(a){return["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(b){b=a.css("border"+b+"Radius").split(" ");1>=b.length&&(b[1]=b[0]);return b.map(cb)})}function db(a){return a.nodeType===Node.TEXT_NODE||a.nodeType===Node.ELEMENT_NODE}
function P(a){return"static"!==a.css("position")}function da(a){return"none"!==a.css("float")}function Q(a){var b=this;return function(){return!a.apply(b,arguments)}}function O(a){return a.node.nodeType===Node.ELEMENT_NODE}function ea(a){return a.node.nodeType===Node.TEXT_NODE}function eb(a){return function(b,c){return b.cssInt("zIndex")+a.indexOf(b)/a.length-(c.cssInt("zIndex")+a.indexOf(c)/a.length)}}function X(a,b){return function(){return a.apply(b,arguments)}}function cb(a){return parseInt(a,
10)}function fb(a){return a.width}function gb(a){return a.node.nodeType!==Node.ELEMENT_NODE||-1==="SCRIPT HEAD TITLE OBJECT BR OPTION".split(" ").indexOf(a.node.nodeName)}function hb(a){for(var b=[],c=0,d=!1,e;a.length;)-1!==[32,13,10,9,45].indexOf(a[c])===d?(e=a.splice(0,c),e.length&&b.push(m.html2canvas.punycode.ucs2.encode(e)),d=!d,c=0):c++,c>=a.length&&(e=a.splice(0,c),e.length&&b.push(m.html2canvas.punycode.ucs2.encode(e)));return b}function Pa(a,b,c){if(!b)return Promise.reject("No proxy configured");
var d=xa(ya);a=za(b,a,d);return ya?Aa(a):Ba(c,a,d).then(function(a){return Ca(a.content)})}function ib(a,b,c){var d=xa(Da);a=za(b,a,d);return Da?Promise.resolve(a):Ba(c,a,d).then(function(a){return"data:"+a.type+";base64,"+a.content})}function Ba(a,b,c){return new Promise(function(d,e){var f=a.createElement("script"),g=function(){delete m.html2canvas.proxy[c];a.body.removeChild(f)};m.html2canvas.proxy[c]=function(a){g();d(a)};f.src=b;f.onerror=function(a){g();e(a)};a.body.appendChild(f)})}function xa(a){var val=new Uint32Array(1);(window.crypto||window.msCrypto).getRandomValues(val);return a?
"":"html2canvas_"+Date.now()+"_"+ ++jb+"_"+Math.round(1E5*(val[0]/0xFFFFFFFF))}function za(a,b,c){return a+"?url="+encodeURIComponent(b)+(c.length?"&callback=html2canvas.proxy."+c:"")}function kb(a,b){r.createElement("script");var c=r.createElement("a");c.href=a;this.src=a=c.href;this.image=new Image;var d=this;this.promise=new Promise(function(c,f){d.image.crossOrigin="Anonymous";d.image.onload=c;d.image.onerror=f;(new ib(a,b,r)).then(function(a){d.image.src=a})["catch"](f)})}function v(a,b,c){l.call(this,
a,b);this.isPseudoElement=!0;this.before=":before"===c}function x(a,b,c,d,e){this.width=a;this.height=b;this.images=c;this.options=d;this.document=e}function G(a,b,c,d){l.call(this,c,d);this.ownStacking=a;this.contexts=[];this.children=[];this.opacity=(this.parent?this.parent.stack.opacity:1)*b}function T(a){this.rangeBounds=this.testRangeBounds(a);this.cors=this.testCORS();this.svg=this.testSVG()}function A(a){this.src=a;this.image=null;var b=this;this.promise=this.hasFabric().then(function(){return b.isInline(a)?
Promise.resolve(b.inlineFormatting(a)):Aa(a)}).then(function(a){return new Promise(function(d){html2canvas.fabric.loadSVGFromString(a,b.createCanvas.call(b,d))})})}function Ca(a){var b=a.length,c,d,e,f,g,h,k="";for(c=0;c<b;c+=4)d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[c]),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[c+1]),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[c+2]),g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[c+
3]),d=d<<2|e>>4,e=(e&15)<<4|f>>2,h=(f&3)<<6|g,k=64===f?k+String.fromCharCode(d):64===g||-1===g?k+String.fromCharCode(d,e):k+String.fromCharCode(d,e,h);return k}function Ea(a,b){this.src=a;this.image=null;var c=this;this.promise=b?new Promise(function(b,e){c.image=new Image;c.image.onload=b;c.image.onerror=e;c.image.src="data:image/svg+xml,"+(new XMLSerializer).serializeToString(a);!0===c.image.complete&&b(c.image)}):this.hasFabric().then(function(){return new Promise(function(b){html2canvas.fabric.parseSVGDocument(a,
c.createCanvas.call(c,b))})})}function I(a,b){l.call(this,a,b)}function lb(a,b,c){if(0<a.length)return b+c.toUpperCase()}function Fa(a){N.apply(this,arguments);this.type="linear"===a.args[0]?this.TYPES.LINEAR:this.TYPES.RADIAL}function Aa(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open("GET",a);d.onload=function(){200===d.status?b(d.responseText):c(Error(d.statusText))};d.onerror=function(){c(Error("Network Error"))};d.send()})}function p(a,b){x.apply(this,arguments);this.canvas=
this.options.canvas||this.document.createElement("canvas");this.options.canvas||(this.canvas.width=a,this.canvas.height=b);this.ctx=this.canvas.getContext("2d");this.taintCtx=this.document.createElement("canvas").getContext("2d");this.ctx.textBaseline="bottom";this.variables={};q("Initialized CanvasRenderer with size",a,"x",b)}function mb(a){return 0<a.length}(function(){function a(a,b){J[K]=a;J[K+1]=b;K+=2;2===K&&Ga()}function b(a){return"function"===typeof a}function c(){return function(){process.nextTick(g)}}
function d(){var a=0,b=new Ha(g),c=r.createTextNode("");b.observe(c,{characterData:!0});return function(){c.data=a=++a%2}}function e(){var a=new MessageChannel;a.port1.onmessage=g;return function(){a.port2.postMessage(0)}}function f(){return function(){setTimeout(g,1)}}function g(){for(var a=0;a<K;a+=2)(0,J[a])(J[a+1]),J[a]=void 0,J[a+1]=void 0;K=0}function h(){}function k(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function l(b,c,d){a(function(a){var b=!1,e=k(d,c,function(d){b||(b=!0,c!==d?n(a,
d):p(a,d))},function(c){b||(b=!0,w(a,c))});!b&&e&&(b=!0,w(a,e))},b)}function q(a,b){1===b.a?p(a,b.b):2===a.a?w(a,b.b):u(b,void 0,function(b){n(a,b)},function(b){w(a,b)})}function n(a,c){if(a===c)w(a,new TypeError("You cannot resolve a promise with itself"));else if("function"===typeof c||"object"===typeof c&&null!==c)if(c.constructor===a.constructor)q(a,c);else{var d;try{d=c.then}catch(e){Z.error=e,d=Z}d===Z?w(a,Z.error):void 0===d?p(a,c):b(d)?l(a,c,d):p(a,c)}else p(a,c)}function t(a){a.f&&a.f(a.b);
v(a)}function p(b,c){void 0===b.a&&(b.b=c,b.a=1,0!==b.e.length&&a(v,b))}function w(b,c){void 0===b.a&&(b.a=2,b.b=c,a(t,b))}function u(b,c,d,e){var f=b.e,g=f.length;b.f=null;f[g]=c;f[g+1]=d;f[g+2]=e;0===g&&b.a&&a(v,b)}function v(a){var b=a.e,c=a.a;if(0!==b.length){for(var d,e,f=a.b,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?z(c,d,e,f):e(f);a.e.length=0}}function x(){this.error=null}function z(a,c,d,e){var f=b(d),g,h,k,l;if(f){try{g=d(e)}catch(B){fa.error=B,g=fa}g===fa?(l=!0,h=g.error,g=null):k=!0;if(c===
g){w(c,new TypeError("A promises callback cannot return that same promise."));return}}else g=e,k=!0;void 0===c.a&&(f&&k?n(c,g):l?w(c,h):1===a?p(c,g):2===a&&w(c,g))}function A(a,b){try{b(function(b){n(a,b)},function(b){w(a,b)})}catch(c){w(a,c)}}function y(a,b,c,d){this.n=a;this.c=new a(h,d);this.i=c;this.o(b)?(this.m=b,this.d=this.length=b.length,this.l(),0===this.length?p(this.c,this.b):(this.length=this.length||0,this.k(),0===this.d&&p(this.c,this.b))):w(this.c,this.p())}function B(a){nb++;this.b=
this.a=void 0;this.e=[];if(h!==a){if(!b(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof B))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");A(this,a)}}var Ia=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},K=0,aa="undefined"!==typeof m?m:{},Ha=aa.MutationObserver||aa.WebKitMutationObserver,
aa="undefined"!==typeof Uint8ClampedArray&&"undefined"!==typeof importScripts&&"undefined"!==typeof MessageChannel,J=Array(1E3),Ga;Ga="undefined"!==typeof process&&"[object process]"==={}.toString.call(process)?c():Ha?d():aa?e():f();var Z=new x,fa=new x;y.prototype.o=function(a){return Ia(a)};y.prototype.p=function(){return Error("Array Methods must be provided an Array")};y.prototype.l=function(){this.b=Array(this.length)};y.prototype.k=function(){for(var a=this.length,b=this.c,c=this.m,d=0;void 0===
b.a&&d<a;d++)this.j(c[d],d)};y.prototype.j=function(a,b){var c=this.n;"object"===typeof a&&null!==a?a.constructor===c&&void 0!==a.a?(a.f=null,this.g(a.a,b,a.b)):this.q(c.resolve(a),b):(this.d--,this.b[b]=this.h(a))};y.prototype.g=function(a,b,c){var d=this.c;void 0===d.a&&(this.d--,this.i&&2===a?w(d,c):this.b[b]=this.h(c));0===this.d&&p(d,this.b)};y.prototype.h=function(a){return a};y.prototype.q=function(a,b){var c=this;u(a,void 0,function(a){c.g(1,b,a)},function(a){c.g(2,b,a)})};var nb=0;B.all=
function(a,b){return(new y(this,a,!0,b)).c};B.race=function(a,b){function c(a){n(e,a)}function d(a){w(e,a)}var e=new this(h,b);if(!Ia(a))return w(e,new TypeError("You must pass an array to race.")),e;for(var f=a.length,g=0;void 0===e.a&&g<f;g++)u(this.resolve(a[g]),void 0,c,d);return e};B.resolve=function(a,b){if(a&&"object"===typeof a&&a.constructor===this)return a;var c=new this(h,b);n(c,a);return c};B.reject=function(a,b){var c=new this(h,b);w(c,a);return c};B.prototype={constructor:B,then:function(b,
c){var d=this.a;if(1===d&&!b||2===d&&!c)return this;var e=new this.constructor(h),f=this.b;if(d){var g=arguments[d-1];a(function(){z(d,e,g,f)})}else u(this,e,b,c);return e},"catch":function(a){return this.then(null,a)}};var ga={Promise:B,polyfill:function(){var a;a="undefined"!==typeof S?S:"undefined"!==typeof m&&m.document?m:self;"Promise"in a&&"resolve"in a.Promise&&"reject"in a.Promise&&"all"in a.Promise&&"race"in a.Promise&&function(){var c;new a.Promise(function(a){c=a});return b(c)}()||(a.Promise=
B)}};"function"===typeof E&&E.amd?E(function(){return ga}):"undefined"!==typeof module&&module.exports?module.exports=ga:"undefined"!==typeof this&&(this.ES6Promise=ga)}).call(m);m&&m.ES6Promise.polyfill();if("undefined"===typeof r||"function"!==typeof Object.create||"function"!==typeof r.createElement("canvas").getContext)(m||module.exports).html2canvas=function(){return Promise.reject("No canvas support")};else{(function(a){function b(a){throw RangeError(v[a]);}function c(a,b){for(var c=a.length,
d=[];c--;)d[c]=b(a[c]);return d}function d(a,b){var d=a.split("@"),e="";1<d.length&&(e=d[0]+"@",a=d[1]);d=a.split(u);d=c(d,b).join(".");return e+d}function e(a){for(var b=[],c=0,d=a.length,e,f;c<d;)e=a.charCodeAt(c++),55296<=e&&56319>=e&&c<d?(f=a.charCodeAt(c++),56320==(f&64512)?b.push(((e&1023)<<10)+(f&1023)+65536):(b.push(e),c--)):b.push(e);return b}function f(a){return c(a,function(a){var b="";65535<a&&(a-=65536,b+=x(a>>>10&1023|55296),a=56320|a&1023);return b+=x(a)}).join("")}function g(a,b){return a+
22+75*(26>a)-((0!=b)<<5)}function h(a,b,c){var d=0;a=c?z(a/700):a>>1;for(a+=z(a/b);455<a;d+=36)a=z(a/35);return z(d+36*a/(a+38))}function k(a){var c=[],d=a.length,e,g=0,k=128,l=72,m,n,q,p,r;m=a.lastIndexOf("-");0>m&&(m=0);for(n=0;n<m;++n)128<=a.charCodeAt(n)&&b("not-basic"),c.push(a.charCodeAt(n));for(m=0<m?m+1:0;m<d;){n=g;e=1;for(q=36;;q+=36){m>=d&&b("invalid-input");p=a.charCodeAt(m++);p=10>p-48?p-22:26>p-65?p-65:26>p-97?p-97:36;(36<=p||p>z((2147483647-g)/e))&&b("overflow");g+=p*e;r=q<=l?1:q>=l+
26?26:q-l;if(p<r)break;p=36-r;e>z(2147483647/p)&&b("overflow");e*=p}e=c.length+1;l=h(g-n,e,0==n);z(g/e)>2147483647-k&&b("overflow");k+=z(g/e);g%=e;c.splice(g++,0,k)}return f(c)}function l(a){var c,d,f,k,p,m,n,q,r,t=[],u,v,w;a=e(a);u=a.length;c=128;d=0;p=72;for(m=0;m<u;++m)r=a[m],128>r&&t.push(x(r));for((f=k=t.length)&&t.push("-");f<u;){n=2147483647;for(m=0;m<u;++m)r=a[m],r>=c&&r<n&&(n=r);v=f+1;n-c>z((2147483647-d)/v)&&b("overflow");d+=(n-c)*v;c=n;for(m=0;m<u;++m)if(r=a[m],r<c&&2147483647<++d&&b("overflow"),
r==c){q=d;for(n=36;;n+=36){r=n<=p?1:n>=p+26?26:n-p;if(q<r)break;w=q-r;q=36-r;t.push(x(g(r+w%q,0)));q=z(w/q)}t.push(x(g(q,0)));p=h(d,v,f==k);d=0;++f}++d;++c}return t.join("")}var m="object"==typeof R&&R&&!R.nodeType&&R,q="object"==typeof module&&module&&!module.nodeType&&module,n="object"==typeof S&&S;if(n.global===n||n.window===n||n.self===n)a=n;var p,r=/^xn--/,t=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)",
"invalid-input":"Invalid input"},z=Math.floor,x=String.fromCharCode,y;p={version:"1.3.1",ucs2:{decode:e,encode:f},decode:k,encode:l,toASCII:function(a){return d(a,function(a){return t.test(a)?"xn--"+l(a):a})},toUnicode:function(a){return d(a,function(a){return r.test(a)?k(a.slice(4).toLowerCase()):a})}};if("function"==typeof E&&"object"==typeof E.amd&&E.amd)E("punycode",function(){return p});else if(m&&q)if(module.exports==m)q.exports=p;else for(y in p)p.hasOwnProperty(y)&&(m[y]=p[y]);else a.punycode=
p})(this);var Ra=0,ob=0;m.html2canvas=function(a,b){var c=ob++;b=b||{};b.logging&&(m.html2canvas.logging=!0,m.html2canvas.start=Date.now());b.async="undefined"===typeof b.async?!0:b.async;b.allowTaint="undefined"===typeof b.allowTaint?!1:b.allowTaint;b.removeContainer="undefined"===typeof b.removeContainer?!0:b.removeContainer;b.javascriptEnabled="undefined"===typeof b.javascriptEnabled?!1:b.javascriptEnabled;b.imageTimeout="undefined"===typeof b.imageTimeout?1E4:b.imageTimeout;b.renderer="function"===
typeof b.renderer?b.renderer:p;b.strict=!!b.strict;if("string"===typeof a){if("string"!==typeof b.proxy)return Promise.reject("Proxy must be used when rendering url");var d=null!=b.width?b.width:m.innerWidth,e=null!=b.height?b.height:m.innerHeight;return oa(Ta(a),b.proxy,r,d,e,b).then(function(a){return ia(a.contentWindow.document.documentElement,a,b,d,e)})}var f=(a===L?[r.documentElement]:a.length?a:[a])[0];f.setAttribute("data-html2canvas-node"+c,c);return Ka(f.ownerDocument,b,f.ownerDocument.defaultView.innerWidth,
f.ownerDocument.defaultView.innerHeight,c).then(function(a){"function"===typeof b.onrendered&&(q("options.onrendered is deprecated, html2canvas returns a Promise containing the canvas"),b.onrendered(a));return a})};m.html2canvas.punycode=this.punycode;m.html2canvas.proxy={};t.prototype.darken=function(a){a=1-a;return new t([Math.round(this.r*a),Math.round(this.g*a),Math.round(this.b*a),this.a])};t.prototype.isTransparent=function(){return 0===this.a};t.prototype.isBlack=function(){return 0===this.r&&
0===this.g&&0===this.b};t.prototype.fromArray=function(a){Array.isArray(a)&&(this.r=Math.min(a[0],255),this.g=Math.min(a[1],255),this.b=Math.min(a[2],255),3<a.length&&(this.a=a[3]));return Array.isArray(a)};var pb=/^#([a-f0-9]{3})$/i;t.prototype.hex3=function(a){null!==(a=a.match(pb))&&(this.r=parseInt(a[1][0]+a[1][0],16),this.g=parseInt(a[1][1]+a[1][1],16),this.b=parseInt(a[1][2]+a[1][2],16));return null!==a};var qb=/^#([a-f0-9]{6})$/i;t.prototype.hex6=function(a){null!==(a=a.match(qb))&&(this.r=
parseInt(a[1].substring(0,2),16),this.g=parseInt(a[1].substring(2,4),16),this.b=parseInt(a[1].substring(4,6),16));return null!==a};var rb=/^rgb\((\d{1,3}) *, *(\d{1,3}) *, *(\d{1,3})\)$/;t.prototype.rgb=function(a){null!==(a=a.match(rb))&&(this.r=Number(a[1]),this.g=Number(a[2]),this.b=Number(a[3]));return null!==a};var sb=/^rgba\((\d{1,3}) *, *(\d{1,3}) *, *(\d{1,3}) *, *(\d+\.?\d*)\)$/;t.prototype.rgba=function(a){null!==(a=a.match(sb))&&(this.r=Number(a[1]),this.g=Number(a[2]),this.b=Number(a[3]),
this.a=Number(a[4]));return null!==a};t.prototype.toString=function(){return null!==this.a&&1!==this.a?"rgba("+[this.r,this.g,this.b,this.a].join()+")":"rgb("+[this.r,this.g,this.b].join()+")"};t.prototype.namedColor=function(a){var b=tb[a.toLowerCase()];if(b)this.r=b[0],this.g=b[1],this.b=b[2];else if("transparent"===a.toLowerCase())return this.r=this.g=this.b=this.a=0,!0;return!!b};t.prototype.isColor=!0;var tb={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,
255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],
darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],
fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,
250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,
179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,
239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,
255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};pa.prototype.getMetrics=function(a,b){this.data[a+"-"+b]===L&&(this.data[a+"-"+b]=new Ua(a,b));return this.data[a+"-"+b]};qa.prototype.proxyLoad=function(a,b,c){var d=this.src;return oa(d.src,a,d.ownerDocument,b.width,b.height,c)};N.prototype.TYPES=
{LINEAR:1,RADIAL:2};u.prototype.findImages=function(a){var b=[];a.reduce(function(a,b){switch(b.node.nodeName){case "IMG":return a.concat([{args:[b.node.src],method:"url"}]);case "svg":case "IFRAME":return a.concat([{args:[b.node],method:b.node.nodeName}])}return a},[]).forEach(this.addImage(b,this.loadImage),this);return b};u.prototype.findBackgroundImage=function(a,b){b.parseBackgroundImages().filter(this.hasImageBackground).forEach(this.addImage(a,this.loadImage),this);return a};u.prototype.addImage=
function(a,b){return function(c){c.args.forEach(function(d){this.imageExists(a,d)||(a.splice(0,0,b.call(this,c)),q("Added image #"+a.length,"string"===typeof d?d.substring(0,100):d))},this)}};u.prototype.hasImageBackground=function(a){return"none"!==a.method};u.prototype.loadImage=function(a){return"url"===a.method?(a=a.args[0],!this.isSVG(a)||this.support.svg||this.options.allowTaint?a.match(/data:image\/.*;base64,/i)?new ba(a.replace(/url\(['"]{0,}|['"]{0,}\)$/ig,""),!1):this.isSameOrigin(a)||!0===
this.options.allowTaint||this.isSVG(a)?new ba(a,!1):this.support.cors&&!this.options.allowTaint&&this.options.useCORS?new ba(a,!0):this.options.proxy?new kb(a,this.options.proxy):new M(a):new A(a)):"linear-gradient"===a.method?new V(a):"gradient"===a.method?new Fa(a):"svg"===a.method?new Ea(a.args[0],this.support.svg):"IFRAME"===a.method?new qa(a.args[0],this.isSameOrigin(a.args[0].src),this.options):new M(a)};u.prototype.isSVG=function(a){return"svg"===a.substring(a.length-3).toLowerCase()||A.prototype.isInline(a)};
u.prototype.imageExists=function(a,b){return a.some(function(a){return a.src===b})};u.prototype.isSameOrigin=function(a){return this.getOrigin(a)===this.origin};u.prototype.getOrigin=function(a){var b=this.link||(this.link=r.createElement("a"));b.href=a;b.href=b.href;return b.protocol+b.hostname+b.port};u.prototype.getPromise=function(a){return this.timeout(a,this.options.imageTimeout)["catch"](function(){return(new M(a.src)).promise.then(function(b){a.image=b})})};u.prototype.get=function(a){var b=
null;return this.images.some(function(c){return(b=c).src===a})?b:null};u.prototype.fetch=function(a){this.images=a.reduce(X(this.findBackgroundImage,this),this.findImages(a));this.images.forEach(function(a,c){a.promise.then(function(){q("Succesfully loaded image #"+(c+1),a)},function(d){q("Failed loading image #"+(c+1),a,d)})});this.ready=Promise.all(this.images.map(this.getPromise,this));q("Finished searching images");return this};u.prototype.timeout=function(a,b){var c,d=Promise.race([a.promise,
new Promise(function(d,f){c=setTimeout(function(){q("Timed out loading image",a);f(a)},b)})]).then(function(a){clearTimeout(c);return a});d["catch"](function(){clearTimeout(c)});return d};V.prototype=Object.create(N.prototype);V.prototype.stepRegExp=/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/;l.prototype.cloneTo=function(a){a.visible=this.visible;a.borders=this.borders;a.bounds=this.bounds;a.clip=this.clip;a.backgroundClip=this.backgroundClip;a.computedStyles=
this.computedStyles;a.styles=this.styles;a.backgroundImages=this.backgroundImages;a.opacity=this.opacity};l.prototype.getOpacity=function(){return null===this.opacity?this.opacity=this.cssFloat("opacity"):this.opacity};l.prototype.assignStack=function(a){this.stack=a;a.children.push(this)};l.prototype.isElementVisible=function(){return this.node.nodeType===Node.TEXT_NODE?this.parent.visible:"none"!==this.css("display")&&"hidden"!==this.css("visibility")&&!this.node.hasAttribute("data-html2canvas-ignore")&&
("INPUT"!==this.node.nodeName||"hidden"!==this.node.getAttribute("type"))};l.prototype.css=function(a){this.computedStyles||(this.computedStyles=this.isPseudoElement?this.parent.computedStyle(this.before?":before":":after"):this.computedStyle(null));return this.styles[a]||(this.styles[a]=this.computedStyles[a])};l.prototype.prefixedCss=function(a){var b=["webkit","moz","ms","o"],c=this.css(a);c===L&&b.some(function(b){c=this.css(b+a.substr(0,1).toUpperCase()+a.substr(1));return c!==L},this);return c===
L?null:c};l.prototype.computedStyle=function(a){return this.node.ownerDocument.defaultView.getComputedStyle(this.node,a)};l.prototype.cssInt=function(a){a=parseInt(this.css(a),10);return isNaN(a)?0:a};l.prototype.color=function(a){return this.colors[a]||(this.colors[a]=new t(this.css(a)))};l.prototype.cssFloat=function(a){a=parseFloat(this.css(a));return isNaN(a)?0:a};l.prototype.fontWeight=function(){var a=this.css("fontWeight");switch(parseInt(a,10)){case 401:a="bold";break;case 400:a="normal"}return a};
l.prototype.parseClip=function(){var a=this.css("clip").match(this.CLIP);return a?{top:parseInt(a[1],10),right:parseInt(a[2],10),bottom:parseInt(a[3],10),left:parseInt(a[4],10)}:null};l.prototype.parseBackgroundImages=function(){return this.backgroundImages||(this.backgroundImages=ra(this.css("backgroundImage")))};l.prototype.cssList=function(a,b){var c=(this.css(a)||"").split(","),c=c[b||0]||c[0]||"auto",c=c.trim().split(" ");1===c.length&&(c=[c[0],c[0]]);return c};l.prototype.parseBackgroundSize=
function(a,b,c){c=this.cssList("backgroundSize",c);var d;if(W(c[0]))d=a.width*parseFloat(c[0])/100;else{if(/contain|cover/.test(c[0]))return b=b.width/b.height,a.width/a.height<b^"contain"===c[0]?{width:a.height*b,height:a.height}:{width:a.width,height:a.width/b};d=parseInt(c[0],10)}a="auto"===c[0]&&"auto"===c[1]?b.height:"auto"===c[1]?d/b.width*b.height:W(c[1])?a.height*parseFloat(c[1])/100:parseInt(c[1],10);"auto"===c[0]&&(d=a/b.height*b.width);return{width:d,height:a}};l.prototype.parseBackgroundPosition=
function(a,b,c,d){c=this.cssList("backgroundPosition",c);var e;e=W(c[0])?(a.width-(d||b).width)*(parseFloat(c[0])/100):parseInt(c[0],10);a="auto"===c[1]?e/b.width*b.height:W(c[1])?(a.height-(d||b).height)*parseFloat(c[1])/100:parseInt(c[1],10);"auto"===c[0]&&(e=a/b.height*b.width);return{left:e,top:a}};l.prototype.parseBackgroundRepeat=function(a){return this.cssList("backgroundRepeat",a)[0]};l.prototype.parseTextShadows=function(){var a=this.css("textShadow"),b=[];if(a&&"none"!==a)for(var a=a.match(this.TEXT_SHADOW_PROPERTY),
c=0;a&&c<a.length;c++){var d=a[c].match(this.TEXT_SHADOW_VALUES);b.push({color:new t(d[0]),offsetX:d[1]?parseFloat(d[1].replace("px","")):0,offsetY:d[2]?parseFloat(d[2].replace("px","")):0,blur:d[3]?d[3].replace("px",""):0})}return b};l.prototype.parseTransform=function(){if(!this.transformData)if(this.hasTransform()){var a=this.parseBounds(),b=this.prefixedCss("transformOrigin").split(" ").map(Wa).map(Xa);b[0]+=a.left;b[1]+=a.top;this.transformData={origin:b,matrix:this.parseTransformMatrix()}}else this.transformData=
{origin:[0,0],matrix:[1,0,0,1,0,0]};return this.transformData};l.prototype.parseTransformMatrix=function(){if(!this.transformMatrix){var a=this.prefixedCss("transform");this.transformMatrix=(a=a?Va(a.match(this.MATRIX_PROPERTY)):null)?a:[1,0,0,1,0,0]}return this.transformMatrix};l.prototype.parseBounds=function(){return this.bounds||(this.bounds=this.hasTransform()?ca(this.node):U(this.node))};l.prototype.hasTransform=function(){return"1,0,0,1,0,0"!==this.parseTransformMatrix().join(",")||this.parent&&
this.parent.hasTransform()};l.prototype.getValue=function(){var a=this.node.value||"";"SELECT"===this.node.tagName?(a=this.node,a=(a=a.options[a.selectedIndex||0])?a.text||"":""):"password"===this.node.type&&(a=Array(a.length+1).join("\u2022"));return 0===a.length?this.node.placeholder||"":a};l.prototype.MATRIX_PROPERTY=/(matrix)\((.+)\)/;l.prototype.TEXT_SHADOW_PROPERTY=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g;l.prototype.TEXT_SHADOW_VALUES=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g;l.prototype.CLIP=
/^rect\((\d+)px,? (\d+)px,? (\d+)px,? (\d+)px\)$/;n.prototype.calculateOverflowClips=function(){this.nodes.forEach(function(a){if(O(a)){!0===a.isPseudoElement&&a.appendToDOM();a.borders=this.parseBorders(a);var b="hidden"===a.css("overflow")?[a.borders.clip]:[],c=a.parseClip();c&&-1!==["absolute","fixed"].indexOf(a.css("position"))&&b.push([["rect",a.bounds.left+c.left,a.bounds.top+c.top,c.right-c.left,c.bottom-c.top]]);a.clip=a.parent&&a.parent.clip.length?a.parent.clip.concat(b):b;a.backgroundClip=
"hidden"!==a.css("overflow")?a.clip.concat([a.borders.clip]):a.clip;!0===a.isPseudoElement&&a.cleanDOM()}else ea(a)&&(a.clip=a.parent&&a.parent.clip.length?a.parent.clip:[]);!0!==a.isPseudoElement&&(a.bounds=null)},this)};n.prototype.asyncRenderer=function(a,b,c){c=c||Date.now();this.paint(a[this.renderIndex++]);a.length===this.renderIndex?b():c+20>Date.now()?this.asyncRenderer(a,b,c):setTimeout(X(function(){this.asyncRenderer(a,b)},this),0)};n.prototype.createPseudoHideStyles=function(a){this.createStyles(a,
"."+v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+':before { content: "" !important; display: none !important; }.'+v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER+':after { content: "" !important; display: none !important; }')};n.prototype.disableAnimations=function(a){this.createStyles(a,"* { -webkit-animation: none !important; -moz-animation: none !important; -o-animation: none !important; animation: none !important; -webkit-transition: none !important; -moz-transition: none !important; -o-transition: none !important; transition: none !important;}")};
n.prototype.createStyles=function(a,b){var c=a.createElement("style");c.innerHTML=b;a.body.appendChild(c)};n.prototype.getPseudoElements=function(a){var b=[[a]];if(a.node.nodeType===Node.ELEMENT_NODE){var c=this.getPseudoElement(a,":before");a=this.getPseudoElement(a,":after");c&&b.push(c);a&&b.push(a)}return[].concat.apply([],b)};n.prototype.getPseudoElement=function(a,b){var c=a.computedStyle(b);if(!c||!c.content||"none"===c.content||"-moz-alt-content"===c.content||"none"===c.display)return null;
var d,e=c.content,f=e.substr(0,1);d=f===e.substr(e.length-1)&&f.match(/'|"/)?e.substr(1,e.length-2):e;for(var g="url"===d.substr(0,3),e=r.createElement(g?"img":"html2canvaspseudoelement"),f=new v(e,a,b),h=c.length-1;0<=h;h--){var k=Ya(c.item(h));e.style[k]=c[k]}e.className=v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+" "+v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER;if(g)return e.src=ra(d)[0].args[0],[f];c=r.createTextNode(d);e.appendChild(c);return[f,new I(c,f)]};n.prototype.getChildren=function(a){return[].concat.apply([],
[].filter.call(a.node.childNodes,db).map(function(b){var c=[b.nodeType===Node.TEXT_NODE?new I(b,a):new l(b,a)].filter(gb);return b.nodeType===Node.ELEMENT_NODE&&c.length&&"TEXTAREA"!==b.tagName?c[0].isElementVisible()?c.concat(this.getChildren(c[0])):[]:c},this))};n.prototype.newStackingContext=function(a,b){var c=new G(b,a.getOpacity(),a.node,a.parent);a.cloneTo(c);(b?c.getParentStack(this):c.parent.stack).contexts.push(c);a.stack=c};n.prototype.createStackingContexts=function(){this.nodes.forEach(function(a){var b;
if(b=O(a))(b=this.isRootElement(a)||1>a.getOpacity())||(b=a.css("position"),b="auto"!==(-1!==["absolute","relative","fixed"].indexOf(b)?a.css("zIndex"):"auto")),b=b||this.isBodyWithTransparentRoot(a)||a.hasTransform();b?this.newStackingContext(a,!0):O(a)&&(P(a)&&va(a)||-1!==["inline-block","inline-table"].indexOf(a.css("display"))||da(a))?this.newStackingContext(a,!1):a.assignStack(a.parent.stack)},this)};n.prototype.isBodyWithTransparentRoot=function(a){return"BODY"===a.node.nodeName&&a.parent.color("backgroundColor").isTransparent()};
n.prototype.isRootElement=function(a){return null===a.parent};n.prototype.sortStackingContexts=function(a){a.contexts.sort(eb(a.contexts.slice(0)));a.contexts.forEach(this.sortStackingContexts,this)};n.prototype.parseTextBounds=function(a){return function(b,c,d){if("none"!==a.parent.css("textDecoration").substr(0,4)||0!==b.trim().length){if(this.support.rangeBounds&&!a.parent.hasTransform())return c=d.slice(0,c).join("").length,this.getRangeBounds(a.node,c,b.length);if(a.node&&"string"===typeof a.node.data)return b=
a.node.splitText(b.length),c=this.getWrapperBounds(a.node,a.parent.hasTransform()),a.node=b,c}else if(!this.support.rangeBounds||a.parent.hasTransform())a.node=a.node.splitText(b.length);return{}}};n.prototype.getWrapperBounds=function(a,b){var c=a.ownerDocument.createElement("html2canvaswrapper"),d=a.parentNode,e=a.cloneNode(!0);c.appendChild(a.cloneNode(!0));d.replaceChild(c,a);var f=b?ca(c):U(c);d.replaceChild(e,c);return f};n.prototype.getRangeBounds=function(a,b,c){var d=this.range||(this.range=
a.ownerDocument.createRange());d.setStart(a,b);d.setEnd(a,b+c);return d.getBoundingClientRect()};n.prototype.parse=function(a){var b=a.contexts.filter(Za),c=a.children.filter(O),d=c.filter(Q(da)),e=d.filter(Q(P)).filter(Q(wa)),c=c.filter(Q(P)).filter(da),f=d.filter(Q(P)).filter(wa),d=a.contexts.concat(d.filter(P)).filter(va),g=a.children.filter(ea).filter(ab);a=a.contexts.filter($a);b.concat(e).concat(c).concat(f).concat(d).concat(g).concat(a).forEach(function(a){this.renderQueue.push(a);a instanceof
G&&(this.parse(a),this.renderQueue.push(new sa))},this)};n.prototype.paint=function(a){try{a instanceof sa?this.renderer.ctx.restore():ea(a)?(!0===a.parent.isPseudoElement&&a.parent.appendToDOM(),this.paintText(a),!0===a.parent.isPseudoElement&&a.parent.cleanDOM()):this.paintNode(a)}catch(b){if(q(b),this.options.strict)throw b;}};n.prototype.paintNode=function(a){a instanceof G&&(this.renderer.setOpacity(a.opacity),this.renderer.ctx.save(),a.hasTransform()&&this.renderer.setTransform(a.parseTransform()));
"INPUT"===a.node.nodeName&&"checkbox"===a.node.type?this.paintCheckbox(a):"INPUT"===a.node.nodeName&&"radio"===a.node.type?this.paintRadio(a):this.paintElement(a)};n.prototype.paintElement=function(a){var b=a.parseBounds();this.renderer.clip(a.backgroundClip,function(){this.renderer.renderBackground(a,b,a.borders.borders.map(fb))},this);this.renderer.clip(a.clip,function(){this.renderer.renderBorders(a.borders.borders)},this);this.renderer.clip(a.backgroundClip,function(){switch(a.node.nodeName){case "svg":case "IFRAME":var c=
this.images.get(a.node);c?this.renderer.renderImage(a,b,a.borders,c):q("Error loading <"+a.node.nodeName+">",a.node);break;case "IMG":(c=this.images.get(a.node.src))?this.renderer.renderImage(a,b,a.borders,c):q("Error loading <img>",a.node.src);break;case "CANVAS":this.renderer.renderImage(a,b,a.borders,{image:a.node});break;case "SELECT":case "INPUT":case "TEXTAREA":this.paintFormValue(a)}},this)};n.prototype.paintCheckbox=function(a){var b=a.parseBounds(),c=Math.min(b.width,b.height),d={width:c-
1,height:c-1,top:b.top,left:b.left},b=[3,3],e=[b,b,b,b],f=[1,1,1,1].map(function(a){return{color:new t("#A5A5A5"),width:a}}),g=ua(d,e,f);this.renderer.clip(a.backgroundClip,function(){this.renderer.rectangle(d.left+1,d.top+1,d.width-2,d.height-2,new t("#DEDEDE"));this.renderer.renderBorders(ta(f,d,g,e));a.node.checked&&(this.renderer.font(new t("#424242"),"normal","normal","bold",c-3+"px","arial"),this.renderer.text("\u2714",d.left+c/6,d.top+c-1))},this)};n.prototype.paintRadio=function(a){var b=
a.parseBounds(),c=Math.min(b.width,b.height)-2;this.renderer.clip(a.backgroundClip,function(){this.renderer.circleStroke(b.left+1,b.top+1,c,new t("#DEDEDE"),1,new t("#A5A5A5"));a.node.checked&&this.renderer.circle(Math.ceil(b.left+c/4)+1,Math.ceil(b.top+c/4)+1,Math.floor(c/2),new t("#424242"))},this)};n.prototype.paintFormValue=function(a){var b=a.getValue();if(0<b.length){var c=a.node.ownerDocument,d=c.createElement("html2canvaswrapper");"lineHeight textAlign fontFamily fontWeight fontSize color paddingLeft paddingTop paddingRight paddingBottom width height borderLeftStyle borderTopStyle borderLeftWidth borderTopWidth boxSizing whiteSpace wordWrap".split(" ").forEach(function(b){try{d.style[b]=
a.css(b)}catch(c){q("html2canvas: Parse: Exception caught in renderFormValue: "+c.message)}});var e=a.parseBounds();d.style.position="fixed";d.style.left=e.left+"px";d.style.top=e.top+"px";d.textContent=b;c.body.appendChild(d);this.paintText(new I(d.firstChild,a));c.body.removeChild(d)}};n.prototype.paintText=function(a){a.applyTextTransform();var b=m.html2canvas.punycode.ucs2.decode(a.node.data),c=this.options.letterRendering&&!/^(normal|none|0px)$/.test(a.parent.css("letterSpacing"))||/[^\u0000-\u00ff]/.test(a.node.data)?
b.map(function(a){return m.html2canvas.punycode.ucs2.encode([a])}):hb(b),b=a.parent.fontWeight(),d=a.parent.css("fontSize"),e=a.parent.css("fontFamily"),f=a.parent.parseTextShadows();this.renderer.font(a.parent.color("color"),a.parent.css("fontStyle"),a.parent.css("fontVariant"),b,d,e);f.length?this.renderer.fontShadow(f[0].color,f[0].offsetX,f[0].offsetY,f[0].blur):this.renderer.clearShadow();this.renderer.clip(a.parent.clip,function(){c.map(this.parseTextBounds(a),this).forEach(function(b,f){b&&
(this.renderer.text(c[f],b.left,b.bottom),this.renderTextDecoration(a.parent,b,this.fontMetrics.getMetrics(e,d)))},this)},this)};n.prototype.renderTextDecoration=function(a,b,c){switch(a.css("textDecoration").split(" ")[0]){case "underline":this.renderer.rectangle(b.left,Math.round(b.top+c.baseline+c.lineWidth),b.width,1,a.color("color"));break;case "overline":this.renderer.rectangle(b.left,Math.round(b.top),b.width,1,a.color("color"));break;case "line-through":this.renderer.rectangle(b.left,Math.ceil(b.top+
c.middle+c.lineWidth),b.width,1,a.color("color"))}};var Ja={inset:[["darken",.6],["darken",.1],["darken",.1],["darken",.6]]};n.prototype.parseBorders=function(a){var b=a.parseBounds(),c=bb(a),d=["Top","Right","Bottom","Left"].map(function(b,c){var d=a.css("border"+b+"Style"),e=a.color("border"+b+"Color");"inset"===d&&e.isBlack()&&(e=new t([255,255,255,e.a]));d=Ja[d]?Ja[d][c]:null;return{width:a.cssInt("border"+b+"Width"),color:d?e[d[0]](d[1]):e,args:null}}),e=ua(b,c,d);return{clip:this.parseBackgroundClip(a,
e,d,c,b),borders:ta(d,b,e,c)}};n.prototype.parseBackgroundClip=function(a,b,c,d,e){var f=[];switch(a.css("backgroundClip")){case "content-box":case "padding-box":D(f,d[0],d[1],b.topLeftInner,b.topRightInner,e.left+c[3].width,e.top+c[0].width);D(f,d[1],d[2],b.topRightInner,b.bottomRightInner,e.left+e.width-c[1].width,e.top+c[0].width);D(f,d[2],d[3],b.bottomRightInner,b.bottomLeftInner,e.left+e.width-c[1].width,e.top+e.height-c[2].width);D(f,d[3],d[0],b.bottomLeftInner,b.topLeftInner,e.left+c[3].width,
e.top+e.height-c[2].width);break;default:D(f,d[0],d[1],b.topLeftOuter,b.topRightOuter,e.left,e.top),D(f,d[1],d[2],b.topRightOuter,b.bottomRightOuter,e.left+e.width,e.top),D(f,d[2],d[3],b.bottomRightOuter,b.bottomLeftOuter,e.left+e.width,e.top+e.height),D(f,d[3],d[0],b.bottomLeftOuter,b.topLeftOuter,e.left,e.top+e.height)}return f};var jb=0,ya="withCredentials"in new XMLHttpRequest,Da="crossOrigin"in new Image;v.prototype.cloneTo=function(a){v.prototype.cloneTo.call(this,a);a.isPseudoElement=!0;a.before=
this.before};v.prototype=Object.create(l.prototype);v.prototype.appendToDOM=function(){this.before?this.parent.node.insertBefore(this.node,this.parent.node.firstChild):this.parent.node.appendChild(this.node);this.parent.node.className+=" "+this.getHideClass()};v.prototype.cleanDOM=function(){this.node.parentNode.removeChild(this.node);this.parent.node.className=this.parent.node.className.replace(this.getHideClass(),"")};v.prototype.getHideClass=function(){return this["PSEUDO_HIDE_ELEMENT_CLASS_"+
(this.before?"BEFORE":"AFTER")]};v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE="___html2canvas___pseudoelement_before";v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER="___html2canvas___pseudoelement_after";x.prototype.renderImage=function(a,b,c,d){var e=a.cssInt("paddingLeft"),f=a.cssInt("paddingTop"),g=a.cssInt("paddingRight");a=a.cssInt("paddingBottom");c=c.borders;g=b.width-(c[1].width+c[3].width+e+g);a=b.height-(c[0].width+c[2].width+f+a);this.drawImage(d,0,0,d.image.width||g,d.image.height||a,b.left+
e+c[3].width,b.top+f+c[0].width,g,a)};x.prototype.renderBackground=function(a,b,c){0<b.height&&0<b.width&&(this.renderBackgroundColor(a,b),this.renderBackgroundImage(a,b,c))};x.prototype.renderBackgroundColor=function(a,b){var c=a.color("backgroundColor");c.isTransparent()||this.rectangle(b.left,b.top,b.width,b.height,c)};x.prototype.renderBorders=function(a){a.forEach(this.renderBorder,this)};x.prototype.renderBorder=function(a){a.color.isTransparent()||null===a.args||this.drawShape(a.args,a.color)};
x.prototype.renderBackgroundImage=function(a,b,c){a.parseBackgroundImages().reverse().forEach(function(d,e,f){switch(d.method){case "url":var g=this.images.get(d.args[0]);g?this.renderBackgroundRepeating(a,b,g,f.length-(e+1),c):q("Error loading background-image",d.args[0]);break;case "linear-gradient":case "gradient":(e=this.images.get(d.value))?this.renderBackgroundGradient(e,b,c):q("Error loading background-image",d.args[0]);break;case "none":break;default:q("Unknown background-image type",d.args[0])}},
this)};x.prototype.renderBackgroundRepeating=function(a,b,c,d,e){var f=a.parseBackgroundSize(b,c.image,d),g=a.parseBackgroundPosition(b,c.image,d,f);switch(a.parseBackgroundRepeat(d)){case "repeat-x":case "repeat no-repeat":this.backgroundRepeatShape(c,g,f,b,b.left+e[3],b.top+g.top+e[0],99999,f.height,e);break;case "repeat-y":case "no-repeat repeat":this.backgroundRepeatShape(c,g,f,b,b.left+g.left+e[3],b.top+e[0],f.width,99999,e);break;case "no-repeat":this.backgroundRepeatShape(c,g,f,b,b.left+g.left+
e[3],b.top+g.top+e[0],f.width,f.height,e);break;default:this.renderBackgroundRepeat(c,g,f,{top:b.top,left:b.left},e[3],e[0])}};G.prototype=Object.create(l.prototype);G.prototype.getParentStack=function(a){var b=this.parent?this.parent.stack:null;return b?b.ownStacking?b:b.getParentStack(a):a.stack};T.prototype.testRangeBounds=function(a){var b,c,d=!1;a.createRange&&(b=a.createRange(),b.getBoundingClientRect&&(c=a.createElement("boundtest"),c.style.height="123px",c.style.display="block",a.body.appendChild(c),
b.selectNode(c),b=b.getBoundingClientRect(),b=b.height,123===b&&(d=!0),a.body.removeChild(c)));return d};T.prototype.testCORS=function(){return"undefined"!==typeof(new Image).crossOrigin};T.prototype.testSVG=function(){var a=new Image,b=r.createElement("canvas"),c=b.getContext("2d");a.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{c.drawImage(a,0,0),b.toDataURL()}catch(d){return!1}return!0};A.prototype.hasFabric=function(){return html2canvas.fabric?Promise.resolve():Promise.reject(Error("html2canvas.svg.js is not loaded, cannot render svg"))};
A.prototype.inlineFormatting=function(a){return/^data:image\/svg\+xml;base64,/.test(a)?this.decode64(this.removeContentType(a)):this.removeContentType(a)};A.prototype.removeContentType=function(a){return a.replace(/^data:image\/svg\+xml(;base64)?,/,"")};A.prototype.isInline=function(a){return/^data:image\/svg\+xml/i.test(a)};A.prototype.createCanvas=function(a){var b=this;return function(c,d){var e=new html2canvas.fabric.StaticCanvas("c");b.image=e.lowerCanvasEl;e.setWidth(d.width).setHeight(d.height).add(html2canvas.fabric.util.groupSVGElements(c,
d)).renderAll();a(e.lowerCanvasEl)}};A.prototype.decode64=function(a){return"function"===typeof m.atob?m.atob(a):Ca(a)};Ea.prototype=Object.create(A.prototype);I.prototype=Object.create(l.prototype);I.prototype.applyTextTransform=function(){this.node.data=this.transform(this.parent.css("textTransform"))};I.prototype.transform=function(a){var b=this.node.data;switch(a){case "lowercase":return b.toLowerCase();case "capitalize":return b.replace(/(^|\s|:|-|\(|\))([a-z])/g,lb);case "uppercase":return b.toUpperCase();
default:return b}};Fa.prototype=Object.create(N.prototype);p.prototype=Object.create(x.prototype);p.prototype.setFillStyle=function(a){this.ctx.fillStyle="object"===typeof a&&a.isColor?a.toString():a;return this.ctx};p.prototype.rectangle=function(a,b,c,d,e){this.setFillStyle(e).fillRect(a,b,c,d)};p.prototype.circle=function(a,b,c,d){this.setFillStyle(d);this.ctx.beginPath();this.ctx.arc(a+c/2,b+c/2,c/2,0,2*Math.PI,!0);this.ctx.closePath();this.ctx.fill()};p.prototype.circleStroke=function(a,b,c,
d,e,f){this.circle(a,b,c,d);this.ctx.strokeStyle=f.toString();this.ctx.stroke()};p.prototype.drawShape=function(a,b){this.shape(a);this.setFillStyle(b).fill()};p.prototype.taints=function(a){if(null===a.tainted){this.taintCtx.drawImage(a.image,0,0);try{this.taintCtx.getImageData(0,0,1,1),a.tainted=!1}catch(b){this.taintCtx=r.createElement("canvas").getContext("2d"),a.tainted=!0}}return a.tainted};p.prototype.drawImage=function(a,b,c,d,e,f,g,h,k){this.taints(a)&&!this.options.allowTaint||this.ctx.drawImage(a.image,
b,c,d,e,f,g,h,k)};p.prototype.clip=function(a,b,c){this.ctx.save();a.filter(mb).forEach(function(a){this.shape(a).clip()},this);b.call(c);this.ctx.restore()};p.prototype.shape=function(a){this.ctx.beginPath();a.forEach(function(a,c){"rect"===a[0]?this.ctx.rect.apply(this.ctx,a.slice(1)):this.ctx[0===c?"moveTo":a[0]+"To"].apply(this.ctx,a.slice(1))},this);this.ctx.closePath();return this.ctx};p.prototype.font=function(a,b,c,d,e,f){this.setFillStyle(a).font=[b,c,d,e,f].join(" ").split(",")[0]};p.prototype.fontShadow=
function(a,b,c,d){this.setVariable("shadowColor",a.toString()).setVariable("shadowOffsetY",b).setVariable("shadowOffsetX",c).setVariable("shadowBlur",d)};p.prototype.clearShadow=function(){this.setVariable("shadowColor","rgba(0,0,0,0)")};p.prototype.setOpacity=function(a){this.ctx.globalAlpha=a};p.prototype.setTransform=function(a){this.ctx.translate(a.origin[0],a.origin[1]);this.ctx.transform.apply(this.ctx,a.matrix);this.ctx.translate(-a.origin[0],-a.origin[1])};p.prototype.setVariable=function(a,
b){this.variables[a]!==b&&(this.variables[a]=this.ctx[a]=b);return this};p.prototype.text=function(a,b,c){this.ctx.fillText(a,b,c)};p.prototype.backgroundRepeatShape=function(a,b,c,d,e,f,g,h,k){this.clip([[["line",Math.round(e),Math.round(f)],["line",Math.round(e+g),Math.round(f)],["line",Math.round(e+g),Math.round(h+f)],["line",Math.round(e),Math.round(h+f)]]],function(){this.renderBackgroundRepeat(a,b,c,d,k[3],k[0])},this)};p.prototype.renderBackgroundRepeat=function(a,b,c,d,e,f){e=Math.round(d.left+
b.left+e);b=Math.round(d.top+b.top+f);this.setFillStyle(this.ctx.createPattern(this.resizeImage(a,c),"repeat"));this.ctx.translate(e,b);this.ctx.fill();this.ctx.translate(-e,-b)};p.prototype.renderBackgroundGradient=function(a,b){if(a instanceof V){var c=this.ctx.createLinearGradient(b.left+b.width*a.x0,b.top+b.height*a.y0,b.left+b.width*a.x1,b.top+b.height*a.y1);a.colorStops.forEach(function(a){c.addColorStop(a.stop,a.color.toString())});this.rectangle(b.left,b.top,b.width,b.height,c)}};p.prototype.resizeImage=
function(a,b){var c=a.image;if(c.width===b.width&&c.height===b.height)return c;var d=r.createElement("canvas");d.width=b.width;d.height=b.height;d.getContext("2d").drawImage(c,0,0,c.width,c.height,0,0,b.width,b.height);return d}}}).call({},"undefined"!==typeof window?window:void 0,"undefined"!==typeof document?document:void 0);

/*
 Use it if you like it
*/
(function(A){function E(K){this.ok=!1;"#"==K.charAt(0)&&(K=K.substr(1,6));K=K.replace(/ /g,"");K=K.toLowerCase();var A={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",
darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",
gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",
lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",
oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",
slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},O;for(O in A)K==O&&(K=A[O]);var L=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(u){return[parseInt(u[1]),parseInt(u[2]),parseInt(u[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,
example:["#00ff00","336699"],process:function(u){return[parseInt(u[1],16),parseInt(u[2],16),parseInt(u[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(u){return[parseInt(u[1]+u[1],16),parseInt(u[2]+u[2],16),parseInt(u[3]+u[3],16)]}}];for(O=0;O<L.length;O++){var W=L[O].process,M=L[O].re.exec(K);M&&(channels=W(M),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=0>this.r||isNaN(this.r)?0:255<this.r?255:this.r;this.g=0>this.g||isNaN(this.g)?0:
255<this.g?255:this.g;this.b=0>this.b||isNaN(this.b)?0:255<this.b?255:this.b;this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};this.toHex=function(){var u=this.r.toString(16),B=this.g.toString(16),p=this.b.toString(16);1==u.length&&(u="0"+u);1==B.length&&(B="0"+B);1==p.length&&(p="0"+p);return"#"+u+B+p};this.getHelpXML=function(){for(var u=[],B=0;B<L.length;B++)for(var p=L[B].example,C=0;C<p.length;C++)u[u.length]=p[C];for(var w in A)u[u.length]=w;p=document.createElement("ul");
p.setAttribute("id","rgbcolor-examples");for(B=0;B<u.length;B++)try{var h=document.createElement("li"),a=new E(u[B]),l=document.createElement("div");l.style.cssText="margin: 3px; border: 1px solid black; background:"+a.toHex()+"; color:"+a.toHex();l.appendChild(document.createTextNode("test"));var c=document.createTextNode(" "+u[B]+" -> "+a.toRGB()+" -> "+a.toHex());h.appendChild(l);h.appendChild(c);p.appendChild(h)}catch(b){}return p}}"undefined"!==typeof define&&define.amd?define(function(){return E}):
"undefined"!==typeof module&&module.exports&&(module.exports=E);A.RGBColor=E})("undefined"!==typeof window?window:this);
(function(A){function E(M,u,B,p,C,w){if(!(isNaN(w)||1>w)){w|=0;M=document.getElementById(M).getContext("2d");var h;try{try{h=M.getImageData(u,B,p,C)}catch(A){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),h=M.getImageData(u,B,p,C)}catch(K){throw alert("Cannot access local image"),Error("unable to access local image data: "+K);}}}catch(A){throw alert("Cannot access image"),Error("unable to access image data: "+A);}for(var a=h.data,l=h.width*h.height*4,c=0;c<l;c+=4){var b=
a[c+3]/255;a[c]*=b;a[c+1]*=b;a[c+2]*=b}var a=h.data,e,d,k,f,g,n,m,v,z,H,q,F,r,G,D,N,P,S,y,I,J,t,E;e=w+w+1;var R=p-1,l=C-1,c=w+1,b=c*(c+1)/2,Q=new X,x=Q;for(k=1;k<e;k++)if(x=x.next=new X,k==c)var T=x;x.next=Q;n=g=0;var U=O[w],V=L[w];for(d=0;d<C;d++){D=N=P=S=m=v=z=H=0;q=c*(y=a[g]);F=c*(I=a[g+1]);r=c*(J=a[g+2]);G=c*(t=a[g+3]);m+=b*y;v+=b*I;z+=b*J;H+=b*t;x=Q;for(k=0;k<c;k++)x.r=y,x.g=I,x.b=J,x.a=t,x=x.next;for(k=1;k<c;k++)f=g+((R<k?R:k)<<2),m+=(x.r=y=a[f])*(E=c-k),v+=(x.g=I=a[f+1])*E,z+=(x.b=J=a[f+2])*
E,H+=(x.a=t=a[f+3])*E,D+=y,N+=I,P+=J,S+=t,x=x.next;k=Q;x=T;for(e=0;e<p;e++)a[g]=m*U>>V,a[g+1]=v*U>>V,a[g+2]=z*U>>V,a[g+3]=H*U>>V,m-=q,v-=F,z-=r,H-=G,q-=k.r,F-=k.g,r-=k.b,G-=k.a,f=n+((f=e+w+1)<R?f:R)<<2,D+=k.r=a[f],N+=k.g=a[f+1],P+=k.b=a[f+2],S+=k.a=a[f+3],m+=D,v+=N,z+=P,H+=S,k=k.next,q+=y=x.r,F+=I=x.g,r+=J=x.b,G+=t=x.a,D-=y,N-=I,P-=J,S-=t,x=x.next,g+=4;n+=p}for(e=0;e<p;e++){N=P=S=D=v=z=H=m=0;g=e<<2;q=c*(y=a[g]);F=c*(I=a[g+1]);r=c*(J=a[g+2]);G=c*(t=a[g+3]);m+=b*y;v+=b*I;z+=b*J;H+=b*t;x=Q;for(k=0;k<
c;k++)x.r=y,x.g=I,x.b=J,x.a=t,x=x.next;f=p;for(k=1;k<=w;k++)g=f+e<<2,m+=(x.r=y=a[g])*(E=c-k),v+=(x.g=I=a[g+1])*E,z+=(x.b=J=a[g+2])*E,H+=(x.a=t=a[g+3])*E,D+=y,N+=I,P+=J,S+=t,x=x.next,k<l&&(f+=p);g=e;k=Q;x=T;for(d=0;d<C;d++)f=g<<2,a[f]=m*U>>V,a[f+1]=v*U>>V,a[f+2]=z*U>>V,a[f+3]=H*U>>V,m-=q,v-=F,z-=r,H-=G,q-=k.r,F-=k.g,r-=k.b,G-=k.a,f=e+((f=d+c)<l?f:l)*p<<2,m+=D+=k.r=a[f],v+=N+=k.g=a[f+1],z+=P+=k.b=a[f+2],H+=S+=k.a=a[f+3],k=k.next,q+=y=x.r,F+=I=x.g,r+=J=x.b,G+=t=x.a,D-=y,N-=I,P-=J,S-=t,x=x.next,g+=p}p=
h.data;C=h.width*h.height*4;for(w=0;w<C;w+=4)T=p[w+3],0!=T&&(T=255/T,p[w]*=T,p[w+1]*=T,p[w+2]*=T);M.putImageData(h,u,B)}}function K(M,u,B,p,C,w){if(!(isNaN(w)||1>w)){w|=0;M=document.getElementById(M).getContext("2d");var h;try{try{h=M.getImageData(u,B,p,C)}catch(x){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),h=M.getImageData(u,B,p,C)}catch(E){throw alert("Cannot access local image"),Error("unable to access local image data: "+E);}}}catch(x){throw alert("Cannot access image"),
Error("unable to access image data: "+x);}var a=h.data,l,c,b,e,d,k,f,g,n,m,v,z,H,q,F,r,G,D,N;l=w+w+1;var P=p-1,A=C-1,y=w+1,I=y*(y+1)/2,J=new X,t=J;for(b=1;b<l;b++)if(t=t.next=new X,b==y)var K=t;t.next=J;k=d=0;var R=O[w],Q=L[w];for(c=0;c<C;c++){H=q=F=f=g=n=0;m=y*(r=a[d]);v=y*(G=a[d+1]);z=y*(D=a[d+2]);f+=I*r;g+=I*G;n+=I*D;t=J;for(b=0;b<y;b++)t.r=r,t.g=G,t.b=D,t=t.next;for(b=1;b<y;b++)e=d+((P<b?P:b)<<2),f+=(t.r=r=a[e])*(N=y-b),g+=(t.g=G=a[e+1])*N,n+=(t.b=D=a[e+2])*N,H+=r,q+=G,F+=D,t=t.next;b=J;t=K;for(l=
0;l<p;l++)a[d]=f*R>>Q,a[d+1]=g*R>>Q,a[d+2]=n*R>>Q,f-=m,g-=v,n-=z,m-=b.r,v-=b.g,z-=b.b,e=k+((e=l+w+1)<P?e:P)<<2,H+=b.r=a[e],q+=b.g=a[e+1],F+=b.b=a[e+2],f+=H,g+=q,n+=F,b=b.next,m+=r=t.r,v+=G=t.g,z+=D=t.b,H-=r,q-=G,F-=D,t=t.next,d+=4;k+=p}for(l=0;l<p;l++){q=F=H=g=n=f=0;d=l<<2;m=y*(r=a[d]);v=y*(G=a[d+1]);z=y*(D=a[d+2]);f+=I*r;g+=I*G;n+=I*D;t=J;for(b=0;b<y;b++)t.r=r,t.g=G,t.b=D,t=t.next;e=p;for(b=1;b<=w;b++)d=e+l<<2,f+=(t.r=r=a[d])*(N=y-b),g+=(t.g=G=a[d+1])*N,n+=(t.b=D=a[d+2])*N,H+=r,q+=G,F+=D,t=t.next,
b<A&&(e+=p);d=l;b=J;t=K;for(c=0;c<C;c++)e=d<<2,a[e]=f*R>>Q,a[e+1]=g*R>>Q,a[e+2]=n*R>>Q,f-=m,g-=v,n-=z,m-=b.r,v-=b.g,z-=b.b,e=l+((e=c+y)<A?e:A)*p<<2,f+=H+=b.r=a[e],g+=q+=b.g=a[e+1],n+=F+=b.b=a[e+2],b=b.next,m+=r=t.r,v+=G=t.g,z+=D=t.b,H-=r,q-=G,F-=D,t=t.next,d+=p}M.putImageData(h,u,B)}}function X(){this.a=this.b=this.g=this.r=0;this.next=null}var O=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,
345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,
309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],L=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,
20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,
24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],W={image:function(A,u,B,p){A=document.getElementById(A);var C=A.naturalWidth,w=A.naturalHeight,h=document.getElementById(u);h.style.width=C+"px";h.style.height=w+"px";h.width=C;h.height=w;h=h.getContext("2d");h.clearRect(0,0,C,w);h.drawImage(A,0,0);isNaN(B)||1>B||(p?E(u,0,0,C,w,B):K(u,0,0,C,w,B))},canvasRGBA:E,canvasRGB:K};"undefined"!==typeof define&&define.amd?define(function(){return W}):
"undefined"!==typeof module&&module.exports&&(module.exports=W);A.stackBlur=W})("undefined"!==typeof window?window:this);
(function(A,E){A.canvg=E(A.RGBColor,A.stackBlur)})("undefined"!==typeof window?window:this,function(A,E){function K(h){var a=[0,0,0],l=function(c,b){var e=h.match(c);null!=e&&(a[b]+=e.length,h=h.replace(c," "))};h=h.replace(/:not\(([^\)]*)\)/g,"     $1 ");h=h.replace(/{[\s\S]*/gm," ");l(W,1);l(M,0);l(u,1);l(B,2);l(p,1);l(C,1);h=h.replace(/[\*\s\+>~]/g," ");h=h.replace(/[#\.]/g," ");l(w,2);return a.join("")}function X(h){var a={opts:h,FRAMERATE:30,MAX_VIRTUAL_PIXELS:3E4,log:function(a){}};1==a.opts.log&&
"undefined"!=typeof console&&(a.log=function(a){console.log(a)});a.init=function(c){var b=0;a.UniqueId=function(){b++;return"canvg"+b};a.Definitions={};a.Styles={};a.StylesSpecificity={};a.Animations=[];a.Images=[];a.ctx=c;a.ViewPort=new function(){this.viewPorts=[];this.Clear=function(){this.viewPorts=[]};this.SetCurrent=function(a,b){this.viewPorts.push({width:a,height:b})};this.RemoveCurrent=function(){this.viewPorts.pop()};this.Current=function(){return this.viewPorts[this.viewPorts.length-1]};
this.width=function(){return this.Current().width};this.height=function(){return this.Current().height};this.ComputeSize=function(a){return null!=a&&"number"==typeof a?a:"x"==a?this.width():"y"==a?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}};a.init();a.ImagesLoaded=function(){for(var c=0;c<a.Images.length;c++)if(!a.Images[c].loaded)return!1;return!0};a.trim=function(a){return a.replace(/^\s+|\s+$/g,"")};a.compressSpaces=function(a){return a.replace(/[\s\r\t\n]+/gm,
" ")};a.ajax=function(a){var b;b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.open("GET",a,!1);b.send(null);return b.responseText};a.parseXml=function(a){if("undefined"!=typeof Windows&&"undefined"!=typeof Windows.Data&&"undefined"!=typeof Windows.Data.Xml){var b=new Windows.Data.Xml.Dom.XmlDocument,e=new Windows.Data.Xml.Dom.XmlLoadSettings;e.prohibitDtd=!1;b.loadXml(a,e);return b}if(window.DOMParser)return(new DOMParser).parseFromString(a,"text/xml");a=a.replace(/<!DOCTYPE svg[^>]*>/,
"");b=new ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(a);return b};a.Property=function(a,b){this.name=a;this.value=b};a.Property.prototype.getValue=function(){return this.value};a.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value};a.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var a=parseFloat(this.value);(this.value+"").match(/%$/)&&(a/=100);return a};a.Property.prototype.valueOrDefault=function(a){return this.hasValue()?this.value:
a};a.Property.prototype.numValueOrDefault=function(a){return this.hasValue()?this.numValue():a};a.Property.prototype.addOpacity=function(c){var b=this.value;if(null!=c.value&&""!=c.value&&"string"==typeof this.value){var e=new A(this.value);e.ok&&(b="rgba("+e.r+", "+e.g+", "+e.b+", "+c.numValue()+")")}return new a.Property(this.name,b)};a.Property.prototype.getDefinition=function(){var c=this.value.match(/#([^\)'"]+)/);c&&(c=c[1]);c||(c=this.value);return a.Definitions[c]};a.Property.prototype.isUrlDefinition=
function(){return 0==this.value.indexOf("url(")};a.Property.prototype.getFillStyleDefinition=function(c,b){var e=this.getDefinition();if(null!=e&&e.createGradient)return e.createGradient(a.ctx,c,b);if(null!=e&&e.createPattern){if(e.getHrefAttribute().hasValue()){var d=e.attribute("patternTransform"),e=e.getHrefAttribute().getDefinition();d.hasValue()&&(e.attribute("patternTransform",!0).value=d.value)}return e.createPattern(a.ctx,c)}return null};a.Property.prototype.getDPI=function(a){return 96};
a.Property.prototype.getEM=function(c){var b=12,e=new a.Property("fontSize",a.Font.Parse(a.ctx.font).fontSize);e.hasValue()&&(b=e.toPixels(c));return b};a.Property.prototype.getUnits=function(){return(this.value+"").replace(/[0-9\.\-]/g,"")};a.Property.prototype.toPixels=function(c,b){if(!this.hasValue())return 0;var e=this.value+"";if(e.match(/em$/))return this.numValue()*this.getEM(c);if(e.match(/ex$/))return this.numValue()*this.getEM(c)/2;if(e.match(/px$/))return this.numValue();if(e.match(/pt$/))return this.numValue()*
this.getDPI(c)*(1/72);if(e.match(/pc$/))return 15*this.numValue();if(e.match(/cm$/))return this.numValue()*this.getDPI(c)/2.54;if(e.match(/mm$/))return this.numValue()*this.getDPI(c)/25.4;if(e.match(/in$/))return this.numValue()*this.getDPI(c);if(e.match(/%$/))return this.numValue()*a.ViewPort.ComputeSize(c);e=this.numValue();return b&&1>e?e*a.ViewPort.ComputeSize(c):e};a.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var a=this.value+"";if(a.match(/s$/))return 1E3*this.numValue();
a.match(/ms$/);return this.numValue()};a.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var a=this.value+"";return a.match(/deg$/)?this.numValue()*(Math.PI/180):a.match(/grad$/)?this.numValue()*(Math.PI/200):a.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)};var l={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",
mathematical:"alphabetic"};a.Property.prototype.toTextBaseline=function(){return this.hasValue()?l[this.value]:null};a.Font=new function(){this.Styles="normal|italic|oblique|inherit";this.Variants="normal|small-caps|inherit";this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";this.CreateFont=function(b,e,d,c,f,g){g=null!=g?this.Parse(g):this.CreateFont("","","","","",a.ctx.font);return{fontFamily:f||g.fontFamily,fontSize:c||g.fontSize,fontStyle:b||g.fontStyle,fontWeight:d||
g.fontWeight,fontVariant:e||g.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var c=this;this.Parse=function(b){var e={};b=a.trim(a.compressSpaces(b||"")).split(" ");for(var d=!1,k=!1,f=!1,g=!1,n="",m=0;m<b.length;m++)k||-1==c.Styles.indexOf(b[m])?g||-1==c.Variants.indexOf(b[m])?f||-1==c.Weights.indexOf(b[m])?d?"inherit"!=b[m]&&(n+=b[m]):("inherit"!=b[m]&&(e.fontSize=b[m].split("/")[0]),k=g=f=d=!0):("inherit"!=b[m]&&
(e.fontWeight=b[m]),k=g=f=!0):("inherit"!=b[m]&&(e.fontVariant=b[m]),k=g=!0):("inherit"!=b[m]&&(e.fontStyle=b[m]),k=!0);""!=n&&(e.fontFamily=n);return e}};a.ToNumberArray=function(c){c=a.trim(a.compressSpaces((c||"").replace(/,/g," "))).split(" ");for(var b=0;b<c.length;b++)c[b]=parseFloat(c[b]);return c};a.Point=function(a,b){this.x=a;this.y=b};a.Point.prototype.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)};a.Point.prototype.applyTransform=function(a){var b=this.x*a[1]+this.y*a[3]+
a[5];this.x=this.x*a[0]+this.y*a[2]+a[4];this.y=b};a.CreatePoint=function(c){c=a.ToNumberArray(c);return new a.Point(c[0],c[1])};a.CreatePath=function(c){c=a.ToNumberArray(c);for(var b=[],e=0;e<c.length;e+=2)b.push(new a.Point(c[e],c[e+1]));return b};a.BoundingBox=function(a,b,e,d){this.y2=this.x2=this.y1=this.x1=Number.NaN;this.x=function(){return this.x1};this.y=function(){return this.y1};this.width=function(){return this.x2-this.x1};this.height=function(){return this.y2-this.y1};this.addPoint=
function(a,b){if(null!=a){if(isNaN(this.x1)||isNaN(this.x2))this.x2=this.x1=a;a<this.x1&&(this.x1=a);a>this.x2&&(this.x2=a)}if(null!=b){if(isNaN(this.y1)||isNaN(this.y2))this.y2=this.y1=b;b<this.y1&&(this.y1=b);b>this.y2&&(this.y2=b)}};this.addX=function(a){this.addPoint(a,null)};this.addY=function(a){this.addPoint(null,a)};this.addBoundingBox=function(a){this.addPoint(a.x1,a.y1);this.addPoint(a.x2,a.y2)};this.addQuadraticCurve=function(a,b,e,d,c,v){e=a+2/3*(e-a);d=b+2/3*(d-b);this.addBezierCurve(a,
b,e,e+1/3*(c-a),d,d+1/3*(v-b),c,v)};this.addBezierCurve=function(a,b,e,d,c,v,z,h){var q=[a,b],F=[e,d],r=[c,v],l=[z,h];this.addPoint(q[0],q[1]);this.addPoint(l[0],l[1]);for(i=0;1>=i;i++)a=function(a){return Math.pow(1-a,3)*q[i]+3*Math.pow(1-a,2)*a*F[i]+3*(1-a)*Math.pow(a,2)*r[i]+Math.pow(a,3)*l[i]},b=6*q[i]-12*F[i]+6*r[i],e=-3*q[i]+9*F[i]-9*r[i]+3*l[i],d=3*F[i]-3*q[i],0==e?0!=b&&(b=-d/b,0<b&&1>b&&(0==i&&this.addX(a(b)),1==i&&this.addY(a(b)))):(d=Math.pow(b,2)-4*d*e,0>d||(c=(-b+Math.sqrt(d))/(2*e),
0<c&&1>c&&(0==i&&this.addX(a(c)),1==i&&this.addY(a(c))),b=(-b-Math.sqrt(d))/(2*e),0<b&&1>b&&(0==i&&this.addX(a(b)),1==i&&this.addY(a(b)))))};this.isPointInBox=function(a,b){return this.x1<=a&&a<=this.x2&&this.y1<=b&&b<=this.y2};this.addPoint(a,b);this.addPoint(e,d)};a.Transform=function(c){var b=this;this.Type={};this.Type.translate=function(b){this.p=a.CreatePoint(b);this.apply=function(a){a.translate(this.p.x||0,this.p.y||0)};this.unapply=function(a){a.translate(-1*this.p.x||0,-1*this.p.y||0)};
this.applyToPoint=function(a){a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}};this.Type.rotate=function(b){b=a.ToNumberArray(b);this.angle=new a.Property("angle",b[0]);this.cx=b[1]||0;this.cy=b[2]||0;this.apply=function(a){a.translate(this.cx,this.cy);a.rotate(this.angle.toRadians());a.translate(-this.cx,-this.cy)};this.unapply=function(a){a.translate(this.cx,this.cy);a.rotate(-1*this.angle.toRadians());a.translate(-this.cx,-this.cy)};this.applyToPoint=function(a){var b=this.angle.toRadians();
a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]);a.applyTransform([Math.cos(b),Math.sin(b),-Math.sin(b),Math.cos(b),0,0]);a.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}};this.Type.scale=function(b){this.p=a.CreatePoint(b);this.apply=function(a){a.scale(this.p.x||1,this.p.y||this.p.x||1)};this.unapply=function(a){a.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)};this.applyToPoint=function(a){a.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}};this.Type.matrix=function(b){this.m=a.ToNumberArray(b);
this.apply=function(a){a.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])};this.unapply=function(a){var b=this.m[0],e=this.m[2],d=this.m[4],c=this.m[1],f=this.m[3],g=this.m[5],k=1/(b*(1*f-0*g)-e*(1*c-0*g)+d*(0*c-0*f));a.transform(k*(1*f-0*g),k*(0*g-1*c),k*(0*d-1*e),k*(1*b-0*d),k*(e*g-d*f),k*(d*c-b*g))};this.applyToPoint=function(a){a.applyTransform(this.m)}};this.Type.SkewBase=function(e){this.base=b.Type.matrix;this.base(e);this.angle=new a.Property("angle",e)};this.Type.SkewBase.prototype=
new this.Type.matrix;this.Type.skewX=function(a){this.base=b.Type.SkewBase;this.base(a);this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]};this.Type.skewX.prototype=new this.Type.SkewBase;this.Type.skewY=function(a){this.base=b.Type.SkewBase;this.base(a);this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]};this.Type.skewY.prototype=new this.Type.SkewBase;this.transforms=[];this.apply=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].apply(a)};this.unapply=function(a){for(var b=
this.transforms.length-1;0<=b;b--)this.transforms[b].unapply(a)};this.applyToPoint=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].applyToPoint(a)};c=a.trim(a.compressSpaces(c)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/);for(var e=0;e<c.length;e++){var d=a.trim(c[e].split("(")[0]),k=c[e].split("(")[1].replace(")",""),f=this.Type[d];"undefined"!=typeof f&&(k=new f(k),k.type=d,this.transforms.push(k))}};a.AspectRatio=function(c,b,e,d,k,
f,g,n,m,v){b=a.compressSpaces(b);b=b.replace(/^defer\s/,"");var z=b.split(" ")[0]||"xMidYMid";b=b.split(" ")[1]||"meet";var h=e/d,q=k/f,l=Math.min(h,q),r=Math.max(h,q);"meet"==b&&(d*=l,f*=l);"slice"==b&&(d*=r,f*=r);m=new a.Property("refX",m);v=new a.Property("refY",v);m.hasValue()&&v.hasValue()?c.translate(-l*m.toPixels("x"),-l*v.toPixels("y")):(z.match(/^xMid/)&&("meet"==b&&l==q||"slice"==b&&r==q)&&c.translate(e/2-d/2,0),z.match(/YMid$/)&&("meet"==b&&l==h||"slice"==b&&r==h)&&c.translate(0,k/2-f/
2),z.match(/^xMax/)&&("meet"==b&&l==q||"slice"==b&&r==q)&&c.translate(e-d,0),z.match(/YMax$/)&&("meet"==b&&l==h||"slice"==b&&r==h)&&c.translate(0,k-f));"none"==z?c.scale(h,q):"meet"==b?c.scale(l,l):"slice"==b&&c.scale(r,r);c.translate(null==g?0:-g,null==n?0:-n)};a.Element={};a.EmptyProperty=new a.Property("EMPTY","");a.Element.ElementBase=function(c){this.attributes={};this.styles={};this.stylesSpecificity={};this.children=[];this.attribute=function(b,e){var d=this.attributes[b];if(null!=d)return d;
1==e&&(d=new a.Property(b,""),this.attributes[b]=d);return d||a.EmptyProperty};this.getHrefAttribute=function(){for(var b in this.attributes)if("href"==b||b.match(/:href$/))return this.attributes[b];return a.EmptyProperty};this.style=function(b,e,d){var c=this.styles[b];if(null!=c)return c;var f=this.attribute(b);if(null!=f&&f.hasValue())return this.styles[b]=f;if(1!=d&&(d=this.parent,null!=d&&(d=d.style(b),null!=d&&d.hasValue())))return d;1==e&&(c=new a.Property(b,""),this.styles[b]=c);return c||
a.EmptyProperty};this.render=function(a){if("none"!=this.style("display").value&&"hidden"!=this.style("visibility").value){a.save();if(this.style("mask").hasValue()){var b=this.style("mask").getDefinition();null!=b&&b.apply(a,this)}else this.style("filter").hasValue()?(b=this.style("filter").getDefinition(),null!=b&&b.apply(a,this)):(this.setContext(a),this.renderChildren(a),this.clearContext(a));a.restore()}};this.setContext=function(a){};this.clearContext=function(a){};this.renderChildren=function(a){for(var b=
0;b<this.children.length;b++)this.children[b].render(a)};this.addChild=function(b,e){var d=b;e&&(d=a.CreateElement(b));d.parent=this;"title"!=d.type&&this.children.push(d)};this.addStylesFromStyleDefinition=function(){for(var b in a.Styles)if("@"!=b[0]&&L(c,b)){var e=a.Styles[b],d=a.StylesSpecificity[b];if(null!=e)for(var f in e){var k=this.stylesSpecificity[f];"undefined"==typeof k&&(k="000");d>k&&(this.styles[f]=e[f],this.stylesSpecificity[f]=d)}}};var b=/^[A-Z-]+$/,e=function(a){return b.test(a)?
a.toLowerCase():a};if(null!=c&&1==c.nodeType){for(var d=0;d<c.attributes.length;d++){var k=c.attributes[d],f=e(k.nodeName);this.attributes[f]=new a.Property(f,k.value)}this.addStylesFromStyleDefinition();if(this.attribute("style").hasValue())for(e=this.attribute("style").value.split(";"),d=0;d<e.length;d++)""!=a.trim(e[d])&&(f=e[d].split(":"),k=a.trim(f[0]),f=a.trim(f[1]),this.styles[k]=new a.Property(k,f));this.attribute("id").hasValue()&&null==a.Definitions[this.attribute("id").value]&&(a.Definitions[this.attribute("id").value]=
this);for(d=0;d<c.childNodes.length;d++)e=c.childNodes[d],1==e.nodeType&&this.addChild(e,!0),!this.captureTextNodes||3!=e.nodeType&&4!=e.nodeType||""!=a.compressSpaces(e.value||e.text||e.textContent||"")&&this.addChild(new a.Element.tspan(e),!1)}};a.Element.RenderedElementBase=function(c){this.base=a.Element.ElementBase;this.base(c);this.setContext=function(b){if(this.style("fill").isUrlDefinition()){var e=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));null!=e&&(b.fillStyle=
e)}else this.style("fill").hasValue()&&(e=this.style("fill"),"currentColor"==e.value&&(e.value=this.style("color").value),"inherit"!=e.value&&(b.fillStyle="none"==e.value?"rgba(0,0,0,0)":e.value));this.style("fill-opacity").hasValue()&&(e=new a.Property("fill",b.fillStyle),e=e.addOpacity(this.style("fill-opacity")),b.fillStyle=e.value);this.style("stroke").isUrlDefinition()?(e=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity")),null!=e&&(b.strokeStyle=e)):this.style("stroke").hasValue()&&
(e=this.style("stroke"),"currentColor"==e.value&&(e.value=this.style("color").value),"inherit"!=e.value&&(b.strokeStyle="none"==e.value?"rgba(0,0,0,0)":e.value));this.style("stroke-opacity").hasValue()&&(e=new a.Property("stroke",b.strokeStyle),e=e.addOpacity(this.style("stroke-opacity")),b.strokeStyle=e.value);this.style("stroke-width").hasValue()&&(e=this.style("stroke-width").toPixels(),b.lineWidth=0==e?.001:e);this.style("stroke-linecap").hasValue()&&(b.lineCap=this.style("stroke-linecap").value);
this.style("stroke-linejoin").hasValue()&&(b.lineJoin=this.style("stroke-linejoin").value);this.style("stroke-miterlimit").hasValue()&&(b.miterLimit=this.style("stroke-miterlimit").value);this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value&&(e=a.ToNumberArray(this.style("stroke-dasharray").value),"undefined"!=typeof b.setLineDash?b.setLineDash(e):"undefined"!=typeof b.webkitLineDash?b.webkitLineDash=e:"undefined"==typeof b.mozDash||1==e.length&&0==e[0]||(b.mozDash=
e),e=this.style("stroke-dashoffset").numValueOrDefault(1),"undefined"!=typeof b.lineDashOffset?b.lineDashOffset=e:"undefined"!=typeof b.webkitLineDashOffset?b.webkitLineDashOffset=e:"undefined"!=typeof b.mozDashOffset&&(b.mozDashOffset=e));"undefined"!=typeof b.font&&(b.font=a.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString());
this.style("transform",!1,!0).hasValue()&&(new a.Transform(this.style("transform",!1,!0).value)).apply(b);this.style("clip-path",!1,!0).hasValue()&&(e=this.style("clip-path",!1,!0).getDefinition(),null!=e&&e.apply(b));this.style("opacity").hasValue()&&(b.globalAlpha=this.style("opacity").numValue())}};a.Element.RenderedElementBase.prototype=new a.Element.ElementBase;a.Element.PathElementBase=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.path=function(b){null!=b&&b.beginPath();
return new a.BoundingBox};this.renderChildren=function(b){this.path(b);a.Mouse.checkPath(this,b);""!=b.fillStyle&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?b.fill(this.style("fill-rule").value):b.fill());""!=b.strokeStyle&&b.stroke();var e=this.getMarkers();if(null!=e){if(this.style("marker-start").isUrlDefinition()){var d=this.style("marker-start").getDefinition();d.render(b,e[0][0],e[0][1])}if(this.style("marker-mid").isUrlDefinition())for(var d=this.style("marker-mid").getDefinition(),
c=1;c<e.length-1;c++)d.render(b,e[c][0],e[c][1]);this.style("marker-end").isUrlDefinition()&&(d=this.style("marker-end").getDefinition(),d.render(b,e[e.length-1][0],e[e.length-1][1]))}};this.getBoundingBox=function(){return this.path()};this.getMarkers=function(){return null}};a.Element.PathElementBase.prototype=new a.Element.RenderedElementBase;a.Element.svg=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.baseClearContext=this.clearContext;this.clearContext=function(b){this.baseClearContext(b);
a.ViewPort.RemoveCurrent()};this.baseSetContext=this.setContext;this.setContext=function(b){b.strokeStyle="rgba(0,0,0,0)";b.lineCap="butt";b.lineJoin="miter";b.miterLimit=4;"undefined"!=typeof b.font&&"undefined"!=typeof window.getComputedStyle&&(b.font=window.getComputedStyle(b.canvas).getPropertyValue("font"));this.baseSetContext(b);this.attribute("x").hasValue()||(this.attribute("x",!0).value=0);this.attribute("y").hasValue()||(this.attribute("y",!0).value=0);b.translate(this.attribute("x").toPixels("x"),
this.attribute("y").toPixels("y"));var e=a.ViewPort.width(),d=a.ViewPort.height();this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%");this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%");if("undefined"==typeof this.root){var e=this.attribute("width").toPixels("x"),d=this.attribute("height").toPixels("y"),c=0,f=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(c=-this.attribute("refX").toPixels("x"),f=-this.attribute("refY").toPixels("y"));
"visible"!=this.attribute("overflow").valueOrDefault("hidden")&&(b.beginPath(),b.moveTo(c,f),b.lineTo(e,f),b.lineTo(e,d),b.lineTo(c,d),b.closePath(),b.clip())}a.ViewPort.SetCurrent(e,d);if(this.attribute("viewBox").hasValue()){var c=a.ToNumberArray(this.attribute("viewBox").value),f=c[0],g=c[1],e=c[2],d=c[3];a.AspectRatio(b,this.attribute("preserveAspectRatio").value,a.ViewPort.width(),e,a.ViewPort.height(),d,f,g,this.attribute("refX").value,this.attribute("refY").value);a.ViewPort.RemoveCurrent();
a.ViewPort.SetCurrent(c[2],c[3])}}};a.Element.svg.prototype=new a.Element.RenderedElementBase;a.Element.rect=function(c){this.base=a.Element.PathElementBase;this.base(c);this.path=function(b){var e=this.attribute("x").toPixels("x"),d=this.attribute("y").toPixels("y"),c=this.attribute("width").toPixels("x"),f=this.attribute("height").toPixels("y"),g=this.attribute("rx").toPixels("x"),n=this.attribute("ry").toPixels("y");this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(n=g);this.attribute("ry").hasValue()&&
!this.attribute("rx").hasValue()&&(g=n);g=Math.min(g,c/2);n=Math.min(n,f/2);null!=b&&(b.beginPath(),b.moveTo(e+g,d),b.lineTo(e+c-g,d),b.quadraticCurveTo(e+c,d,e+c,d+n),b.lineTo(e+c,d+f-n),b.quadraticCurveTo(e+c,d+f,e+c-g,d+f),b.lineTo(e+g,d+f),b.quadraticCurveTo(e,d+f,e,d+f-n),b.lineTo(e,d+n),b.quadraticCurveTo(e,d,e+g,d),b.closePath());return new a.BoundingBox(e,d,e+c,d+f)}};a.Element.rect.prototype=new a.Element.PathElementBase;a.Element.circle=function(c){this.base=a.Element.PathElementBase;this.base(c);
this.path=function(b){var e=this.attribute("cx").toPixels("x"),d=this.attribute("cy").toPixels("y"),c=this.attribute("r").toPixels();null!=b&&(b.beginPath(),b.arc(e,d,c,0,2*Math.PI,!0),b.closePath());return new a.BoundingBox(e-c,d-c,e+c,d+c)}};a.Element.circle.prototype=new a.Element.PathElementBase;a.Element.ellipse=function(c){this.base=a.Element.PathElementBase;this.base(c);this.path=function(b){var e=(Math.sqrt(2)-1)/3*4,d=this.attribute("rx").toPixels("x"),c=this.attribute("ry").toPixels("y"),
f=this.attribute("cx").toPixels("x"),g=this.attribute("cy").toPixels("y");null!=b&&(b.beginPath(),b.moveTo(f,g-c),b.bezierCurveTo(f+e*d,g-c,f+d,g-e*c,f+d,g),b.bezierCurveTo(f+d,g+e*c,f+e*d,g+c,f,g+c),b.bezierCurveTo(f-e*d,g+c,f-d,g+e*c,f-d,g),b.bezierCurveTo(f-d,g-e*c,f-e*d,g-c,f,g-c),b.closePath());return new a.BoundingBox(f-d,g-c,f+d,g+c)}};a.Element.ellipse.prototype=new a.Element.PathElementBase;a.Element.line=function(c){this.base=a.Element.PathElementBase;this.base(c);this.getPoints=function(){return[new a.Point(this.attribute("x1").toPixels("x"),
this.attribute("y1").toPixels("y")),new a.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]};this.path=function(b){var e=this.getPoints();null!=b&&(b.beginPath(),b.moveTo(e[0].x,e[0].y),b.lineTo(e[1].x,e[1].y));return new a.BoundingBox(e[0].x,e[0].y,e[1].x,e[1].y)};this.getMarkers=function(){var a=this.getPoints(),e=a[0].angleTo(a[1]);return[[a[0],e],[a[1],e]]}};a.Element.line.prototype=new a.Element.PathElementBase;a.Element.polyline=function(c){this.base=a.Element.PathElementBase;
this.base(c);this.points=a.CreatePath(this.attribute("points").value);this.path=function(b){var e=new a.BoundingBox(this.points[0].x,this.points[0].y);null!=b&&(b.beginPath(),b.moveTo(this.points[0].x,this.points[0].y));for(var d=1;d<this.points.length;d++)e.addPoint(this.points[d].x,this.points[d].y),null!=b&&b.lineTo(this.points[d].x,this.points[d].y);return e};this.getMarkers=function(){for(var a=[],e=0;e<this.points.length-1;e++)a.push([this.points[e],this.points[e].angleTo(this.points[e+1])]);
0<a.length&&a.push([this.points[this.points.length-1],a[a.length-1][1]]);return a}};a.Element.polyline.prototype=new a.Element.PathElementBase;a.Element.polygon=function(c){this.base=a.Element.polyline;this.base(c);this.basePath=this.path;this.path=function(a){var e=this.basePath(a);null!=a&&(a.lineTo(this.points[0].x,this.points[0].y),a.closePath());return e}};a.Element.polygon.prototype=new a.Element.polyline;a.Element.path=function(c){this.base=a.Element.PathElementBase;this.base(c);c=this.attribute("d").value;
c=c.replace(/,/gm," ");for(var b=0;2>b;b++)c=c.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");c=c.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");c=c.replace(/([0-9])([+\-])/gm,"$1 $2");for(b=0;2>b;b++)c=c.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");c=c.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 ");c=a.compressSpaces(c);c=a.trim(c);this.PathParser=new function(b){this.tokens=b.split(" ");this.reset=function(){this.i=-1;this.previousCommand=this.command="";this.start=new a.Point(0,
0);this.control=new a.Point(0,0);this.current=new a.Point(0,0);this.points=[];this.angles=[]};this.isEnd=function(){return this.i>=this.tokens.length-1};this.isCommandOrEnd=function(){return this.isEnd()?!0:null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)};this.isRelativeCommand=function(){switch(this.command){case "m":case "l":case "h":case "v":case "c":case "s":case "q":case "t":case "a":case "z":return!0}return!1};this.getToken=function(){this.i++;return this.tokens[this.i]};this.getScalar=function(){return parseFloat(this.getToken())};
this.nextCommand=function(){this.previousCommand=this.command;this.command=this.getToken()};this.getPoint=function(){var b=new a.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(b)};this.getAsControlPoint=function(){var a=this.getPoint();return this.control=a};this.getAsCurrentPoint=function(){var a=this.getPoint();return this.current=a};this.getReflectedControlPoint=function(){return"c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&
"t"!=this.previousCommand.toLowerCase()?this.current:new a.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)};this.makeAbsolute=function(a){this.isRelativeCommand()&&(a.x+=this.current.x,a.y+=this.current.y);return a};this.addMarker=function(a,b,e){null!=e&&0<this.angles.length&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(e));this.addMarkerAngle(a,null==b?null:b.angleTo(a))};this.addMarkerAngle=function(a,
b){this.points.push(a);this.angles.push(b)};this.getMarkerPoints=function(){return this.points};this.getMarkerAngles=function(){for(var a=0;a<this.angles.length;a++)if(null==this.angles[a])for(var b=a+1;b<this.angles.length;b++)if(null!=this.angles[b]){this.angles[a]=this.angles[b];break}return this.angles}}(c);this.path=function(b){var d=this.PathParser;d.reset();var c=new a.BoundingBox;for(null!=b&&b.beginPath();!d.isEnd();)switch(d.nextCommand(),d.command){case "M":case "m":var f=d.getAsCurrentPoint();
d.addMarker(f);c.addPoint(f.x,f.y);null!=b&&b.moveTo(f.x,f.y);for(d.start=d.current;!d.isCommandOrEnd();)f=d.getAsCurrentPoint(),d.addMarker(f,d.start),c.addPoint(f.x,f.y),null!=b&&b.lineTo(f.x,f.y);break;case "L":case "l":for(;!d.isCommandOrEnd();){var g=d.current,f=d.getAsCurrentPoint();d.addMarker(f,g);c.addPoint(f.x,f.y);null!=b&&b.lineTo(f.x,f.y)}break;case "H":case "h":for(;!d.isCommandOrEnd();)f=new a.Point((d.isRelativeCommand()?d.current.x:0)+d.getScalar(),d.current.y),d.addMarker(f,d.current),
d.current=f,c.addPoint(d.current.x,d.current.y),null!=b&&b.lineTo(d.current.x,d.current.y);break;case "V":case "v":for(;!d.isCommandOrEnd();)f=new a.Point(d.current.x,(d.isRelativeCommand()?d.current.y:0)+d.getScalar()),d.addMarker(f,d.current),d.current=f,c.addPoint(d.current.x,d.current.y),null!=b&&b.lineTo(d.current.x,d.current.y);break;case "C":case "c":for(;!d.isCommandOrEnd();){var n=d.current,g=d.getPoint(),m=d.getAsControlPoint(),f=d.getAsCurrentPoint();d.addMarker(f,m,g);c.addBezierCurve(n.x,
n.y,g.x,g.y,m.x,m.y,f.x,f.y);null!=b&&b.bezierCurveTo(g.x,g.y,m.x,m.y,f.x,f.y)}break;case "S":case "s":for(;!d.isCommandOrEnd();)n=d.current,g=d.getReflectedControlPoint(),m=d.getAsControlPoint(),f=d.getAsCurrentPoint(),d.addMarker(f,m,g),c.addBezierCurve(n.x,n.y,g.x,g.y,m.x,m.y,f.x,f.y),null!=b&&b.bezierCurveTo(g.x,g.y,m.x,m.y,f.x,f.y);break;case "Q":case "q":for(;!d.isCommandOrEnd();)n=d.current,m=d.getAsControlPoint(),f=d.getAsCurrentPoint(),d.addMarker(f,m,m),c.addQuadraticCurve(n.x,n.y,m.x,m.y,
f.x,f.y),null!=b&&b.quadraticCurveTo(m.x,m.y,f.x,f.y);break;case "T":case "t":for(;!d.isCommandOrEnd();)n=d.current,m=d.getReflectedControlPoint(),d.control=m,f=d.getAsCurrentPoint(),d.addMarker(f,m,m),c.addQuadraticCurve(n.x,n.y,m.x,m.y,f.x,f.y),null!=b&&b.quadraticCurveTo(m.x,m.y,f.x,f.y);break;case "A":case "a":for(;!d.isCommandOrEnd();){var n=d.current,v=d.getScalar(),h=d.getScalar(),g=d.getScalar()*(Math.PI/180),l=d.getScalar(),m=d.getScalar(),f=d.getAsCurrentPoint(),q=new a.Point(Math.cos(g)*
(n.x-f.x)/2+Math.sin(g)*(n.y-f.y)/2,-Math.sin(g)*(n.x-f.x)/2+Math.cos(g)*(n.y-f.y)/2),p=Math.pow(q.x,2)/Math.pow(v,2)+Math.pow(q.y,2)/Math.pow(h,2);1<p&&(v*=Math.sqrt(p),h*=Math.sqrt(p));l=(l==m?-1:1)*Math.sqrt((Math.pow(v,2)*Math.pow(h,2)-Math.pow(v,2)*Math.pow(q.y,2)-Math.pow(h,2)*Math.pow(q.x,2))/(Math.pow(v,2)*Math.pow(q.y,2)+Math.pow(h,2)*Math.pow(q.x,2)));isNaN(l)&&(l=0);var r=new a.Point(l*v*q.y/h,l*-h*q.x/v),n=new a.Point((n.x+f.x)/2+Math.cos(g)*r.x-Math.sin(g)*r.y,(n.y+f.y)/2+Math.sin(g)*
r.x+Math.cos(g)*r.y),u=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2))*Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)))},w=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(u(a,b))},l=w([1,0],[(q.x-r.x)/v,(q.y-r.y)/h]),p=[(q.x-r.x)/v,(q.y-r.y)/h],r=[(-q.x-r.x)/v,(-q.y-r.y)/h],q=w(p,r);-1>=u(p,r)&&(q=Math.PI);1<=u(p,r)&&(q=0);p=1-m?1:-1;r=l+q/2*p;w=new a.Point(n.x+v*Math.cos(r),n.y+h*Math.sin(r));d.addMarkerAngle(w,r-p*Math.PI/2);d.addMarkerAngle(f,r-p*Math.PI);
c.addPoint(f.x,f.y);null!=b&&(u=v>h?v:h,f=v>h?1:v/h,v=v>h?h/v:1,b.translate(n.x,n.y),b.rotate(g),b.scale(f,v),b.arc(0,0,u,l,l+q,1-m),b.scale(1/f,1/v),b.rotate(-g),b.translate(-n.x,-n.y))}break;case "Z":case "z":null!=b&&b.closePath(),d.current=d.start}return c};this.getMarkers=function(){for(var a=this.PathParser.getMarkerPoints(),b=this.PathParser.getMarkerAngles(),c=[],f=0;f<a.length;f++)c.push([a[f],b[f]]);return c}};a.Element.path.prototype=new a.Element.PathElementBase;a.Element.pattern=function(c){this.base=
a.Element.ElementBase;this.base(c);this.createPattern=function(b,e){var d=this.attribute("width").toPixels("x",!0),c=this.attribute("height").toPixels("y",!0),f=new a.Element.svg;f.attributes.viewBox=new a.Property("viewBox",this.attribute("viewBox").value);f.attributes.width=new a.Property("width",d+"px");f.attributes.height=new a.Property("height",c+"px");f.attributes.transform=new a.Property("transform",this.attribute("patternTransform").value);f.children=this.children;var g=document.createElement("canvas");
g.width=d;g.height=c;d=g.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&d.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(c=-1;1>=c;c++)for(var n=-1;1>=n;n++)d.save(),f.attributes.x=new a.Property("x",c*g.width),f.attributes.y=new a.Property("y",n*g.height),f.render(d),d.restore();return b.createPattern(g,"repeat")}};a.Element.pattern.prototype=new a.Element.ElementBase;a.Element.marker=function(c){this.base=a.Element.ElementBase;
this.base(c);this.baseRender=this.render;this.render=function(b,e,d){b.translate(e.x,e.y);"auto"==this.attribute("orient").valueOrDefault("auto")&&b.rotate(d);"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&b.scale(b.lineWidth,b.lineWidth);b.save();var c=new a.Element.svg;c.attributes.viewBox=new a.Property("viewBox",this.attribute("viewBox").value);c.attributes.refX=new a.Property("refX",this.attribute("refX").value);c.attributes.refY=new a.Property("refY",this.attribute("refY").value);
c.attributes.width=new a.Property("width",this.attribute("markerWidth").value);c.attributes.height=new a.Property("height",this.attribute("markerHeight").value);c.attributes.fill=new a.Property("fill",this.attribute("fill").valueOrDefault("black"));c.attributes.stroke=new a.Property("stroke",this.attribute("stroke").valueOrDefault("none"));c.children=this.children;var f=0,g=0;this.attribute("refX").hasValue()&&(f=-parseFloat(this.attribute("refX").value));this.attribute("refY").hasValue()&&(g=-parseFloat(this.attribute("refY").value));
b.translate(f,g);c.render(b);b.restore();"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&b.scale(1/b.lineWidth,1/b.lineWidth);"auto"==this.attribute("orient").valueOrDefault("auto")&&b.rotate(-d);b.translate(-e.x,-e.y)}};a.Element.marker.prototype=new a.Element.ElementBase;a.Element.defs=function(c){this.base=a.Element.ElementBase;this.base(c);this.render=function(a){}};a.Element.defs.prototype=new a.Element.ElementBase;a.Element.GradientBase=function(c){this.base=a.Element.ElementBase;
this.base(c);this.stops=[];for(c=0;c<this.children.length;c++){var b=this.children[c];"stop"==b.type&&this.stops.push(b)}this.getGradient=function(){};this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")};this.attributesToInherit=["gradientUnits"];this.inheritStopContainer=function(a){for(var b=0;b<this.attributesToInherit.length;b++){var c=this.attributesToInherit[b];!this.attribute(c).hasValue()&&a.attribute(c).hasValue()&&(this.attribute(c,!0).value=
a.attribute(c).value)}};this.createGradient=function(b,d,c){var f=this;this.getHrefAttribute().hasValue()&&(f=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(f));var g=function(b){return c.hasValue()?(new a.Property("color",b)).addOpacity(c).value:b};b=this.getGradient(b,d);if(null==b)return g(f.stops[f.stops.length-1].color);for(d=0;d<f.stops.length;d++)b.addColorStop(f.stops[d].offset,g(f.stops[d].color));return this.attribute("gradientTransform").hasValue()?(f=a.ViewPort.viewPorts[0],
g=new a.Element.rect,g.attributes.x=new a.Property("x",-a.MAX_VIRTUAL_PIXELS/3),g.attributes.y=new a.Property("y",-a.MAX_VIRTUAL_PIXELS/3),g.attributes.width=new a.Property("width",a.MAX_VIRTUAL_PIXELS),g.attributes.height=new a.Property("height",a.MAX_VIRTUAL_PIXELS),d=new a.Element.g,d.attributes.transform=new a.Property("transform",this.attribute("gradientTransform").value),d.children=[g],g=new a.Element.svg,g.attributes.x=new a.Property("x",0),g.attributes.y=new a.Property("y",0),g.attributes.width=
new a.Property("width",f.width),g.attributes.height=new a.Property("height",f.height),g.children=[d],d=document.createElement("canvas"),d.width=f.width,d.height=f.height,f=d.getContext("2d"),f.fillStyle=b,g.render(f),f.createPattern(d,"no-repeat")):b}};a.Element.GradientBase.prototype=new a.Element.ElementBase;a.Element.linearGradient=function(c){this.base=a.Element.GradientBase;this.base(c);this.attributesToInherit.push("x1");this.attributesToInherit.push("y1");this.attributesToInherit.push("x2");
this.attributesToInherit.push("y2");this.getGradient=function(a,e){var c="objectBoundingBox"==this.gradientUnits()?e.getBoundingBox():null;this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var k="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),
f="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),g="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),c="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return k==g&&f==c?null:a.createLinearGradient(k,f,g,c)}};a.Element.linearGradient.prototype=new a.Element.GradientBase;
a.Element.radialGradient=function(c){this.base=a.Element.GradientBase;this.base(c);this.attributesToInherit.push("cx");this.attributesToInherit.push("cy");this.attributesToInherit.push("r");this.attributesToInherit.push("fx");this.attributesToInherit.push("fy");this.getGradient=function(a,c){var d=c.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%");this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%");this.attribute("r").hasValue()||(this.attribute("r",
!0).value="50%");var k="objectBoundingBox"==this.gradientUnits()?d.x()+d.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),f="objectBoundingBox"==this.gradientUnits()?d.y()+d.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),g=k,n=f;this.attribute("fx").hasValue()&&(g="objectBoundingBox"==this.gradientUnits()?d.x()+d.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x"));this.attribute("fy").hasValue()&&(n="objectBoundingBox"==
this.gradientUnits()?d.y()+d.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));d="objectBoundingBox"==this.gradientUnits()?(d.width()+d.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return a.createRadialGradient(g,n,0,k,f,d)}};a.Element.radialGradient.prototype=new a.Element.GradientBase;a.Element.stop=function(c){this.base=a.Element.ElementBase;this.base(c);this.offset=this.attribute("offset").numValue();0>this.offset&&(this.offset=0);1<this.offset&&
(this.offset=1);c=this.style("stop-color",!0);""===c.value&&(c.value="#000");this.style("stop-opacity").hasValue()&&(c=c.addOpacity(this.style("stop-opacity")));this.color=c.value};a.Element.stop.prototype=new a.Element.ElementBase;a.Element.AnimateBase=function(c){this.base=a.Element.ElementBase;this.base(c);a.Animations.push(this);this.duration=0;this.begin=this.attribute("begin").toMilliseconds();this.maxDuration=this.begin+this.attribute("dur").toMilliseconds();this.getProperty=function(){var a=
this.attribute("attributeType").value,c=this.attribute("attributeName").value;return"CSS"==a?this.parent.style(c,!0):this.parent.attribute(c,!0)};this.initialValue=null;this.initialUnits="";this.removed=!1;this.calcValue=function(){return""};this.update=function(a){null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits());if(this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=
0;else if("freeze"==this.attribute("fill").valueOrDefault("remove")&&!this.frozen)this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;else if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0;return!1}this.duration+=a;a=!1;this.begin<this.duration&&(a=this.calcValue(),this.attribute("type").hasValue()&&
(a=this.attribute("type").value+"("+a+")"),this.getProperty().value=a,a=!0);return a};this.from=this.attribute("from");this.to=this.attribute("to");this.values=this.attribute("values");this.values.hasValue()&&(this.values.value=this.values.value.split(";"));this.progress=function(){var b={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var c=b.progress*(this.values.value.length-1),d=Math.floor(c),k=Math.ceil(c);b.from=new a.Property("from",parseFloat(this.values.value[d]));
b.to=new a.Property("to",parseFloat(this.values.value[k]));b.progress=(c-d)/(k-d)}else b.from=this.from,b.to=this.to;return b}};a.Element.AnimateBase.prototype=new a.Element.ElementBase;a.Element.animate=function(c){this.base=a.Element.AnimateBase;this.base(c);this.calcValue=function(){var a=this.progress();return a.from.numValue()+(a.to.numValue()-a.from.numValue())*a.progress+this.initialUnits}};a.Element.animate.prototype=new a.Element.AnimateBase;a.Element.animateColor=function(c){this.base=a.Element.AnimateBase;
this.base(c);this.calcValue=function(){var a=this.progress(),c=new A(a.from.value),d=new A(a.to.value);if(c.ok&&d.ok){var k=c.g+(d.g-c.g)*a.progress,f=c.b+(d.b-c.b)*a.progress;return"rgb("+parseInt(c.r+(d.r-c.r)*a.progress,10)+","+parseInt(k,10)+","+parseInt(f,10)+")"}return this.attribute("from").value}};a.Element.animateColor.prototype=new a.Element.AnimateBase;a.Element.animateTransform=function(c){this.base=a.Element.AnimateBase;this.base(c);this.calcValue=function(){for(var b=this.progress(),
c=a.ToNumberArray(b.from.value),d=a.ToNumberArray(b.to.value),k="",f=0;f<c.length;f++)k+=c[f]+(d[f]-c[f])*b.progress+" ";return k}};a.Element.animateTransform.prototype=new a.Element.animate;a.Element.font=function(c){this.base=a.Element.ElementBase;this.base(c);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.isArabic=this.isRTL=!1;this.missingGlyph=this.fontFace=null;this.glyphs=[];for(c=0;c<this.children.length;c++){var b=this.children[c];"font-face"==b.type?(this.fontFace=b,b.style("font-family").hasValue()&&
(a.Definitions[b.style("font-family").value]=this)):"missing-glyph"==b.type?this.missingGlyph=b:"glyph"==b.type&&(""!=b.arabicForm?(this.isArabic=this.isRTL=!0,"undefined"==typeof this.glyphs[b.unicode]&&(this.glyphs[b.unicode]=[]),this.glyphs[b.unicode][b.arabicForm]=b):this.glyphs[b.unicode]=b)}};a.Element.font.prototype=new a.Element.ElementBase;a.Element.fontface=function(c){this.base=a.Element.ElementBase;this.base(c);this.ascent=this.attribute("ascent").value;this.descent=this.attribute("descent").value;
this.unitsPerEm=this.attribute("units-per-em").numValue()};a.Element.fontface.prototype=new a.Element.ElementBase;a.Element.missingglyph=function(c){this.base=a.Element.path;this.base(c);this.horizAdvX=0};a.Element.missingglyph.prototype=new a.Element.path;a.Element.glyph=function(c){this.base=a.Element.path;this.base(c);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.unicode=this.attribute("unicode").value;this.arabicForm=this.attribute("arabic-form").value};a.Element.glyph.prototype=
new a.Element.path;a.Element.text=function(c){this.captureTextNodes=!0;this.base=a.Element.RenderedElementBase;this.base(c);this.baseSetContext=this.setContext;this.setContext=function(a){this.baseSetContext(a);var c=this.style("dominant-baseline").toTextBaseline();null==c&&(c=this.style("alignment-baseline").toTextBaseline());null!=c&&(a.textBaseline=c)};this.getBoundingBox=function(){var b=this.attribute("x").toPixels("x"),c=this.attribute("y").toPixels("y"),d=this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize);
return new a.BoundingBox(b,c-d,b+Math.floor(2*d/3)*this.children[0].getText().length,c)};this.renderChildren=function(a){this.x=this.attribute("x").toPixels("x");this.y=this.attribute("y").toPixels("y");this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x"));this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y"));this.x+=this.getAnchorDelta(a,this,0);for(var c=0;c<this.children.length;c++)this.renderChild(a,this,this,c)};this.getAnchorDelta=function(a,c,
d){var k=this.style("text-anchor").valueOrDefault("start");if("start"!=k){for(var f=0,g=d;g<c.children.length;g++){var n=c.children[g];if(g>d&&n.attribute("x").hasValue())break;f+=n.measureTextRecursive(a)}return-1*("end"==k?f:f/2)}return 0};this.renderChild=function(a,c,d,k){var f=d.children[k];f.attribute("x").hasValue()?(f.x=f.attribute("x").toPixels("x")+c.getAnchorDelta(a,d,k),f.attribute("dx").hasValue()&&(f.x+=f.attribute("dx").toPixels("x"))):(f.attribute("dx").hasValue()&&(c.x+=f.attribute("dx").toPixels("x")),
f.x=c.x);c.x=f.x+f.measureText(a);f.attribute("y").hasValue()?(f.y=f.attribute("y").toPixels("y"),f.attribute("dy").hasValue()&&(f.y+=f.attribute("dy").toPixels("y"))):(f.attribute("dy").hasValue()&&(c.y+=f.attribute("dy").toPixels("y")),f.y=c.y);c.y=f.y;f.render(a);for(k=0;k<f.children.length;k++)c.renderChild(a,c,f,k)}};a.Element.text.prototype=new a.Element.RenderedElementBase;a.Element.TextElementBase=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.getGlyph=function(a,c,
d){var k=c[d],f=null;if(a.isArabic){var g="isolated";(0==d||" "==c[d-1])&&d<c.length-2&&" "!=c[d+1]&&(g="terminal");0<d&&" "!=c[d-1]&&d<c.length-2&&" "!=c[d+1]&&(g="medial");0<d&&" "!=c[d-1]&&(d==c.length-1||" "==c[d+1])&&(g="initial");"undefined"!=typeof a.glyphs[k]&&(f=a.glyphs[k][g],null==f&&"glyph"==a.glyphs[k].type&&(f=a.glyphs[k]))}else f=a.glyphs[k];null==f&&(f=a.missingGlyph);return f};this.renderChildren=function(b){var c=this.parent.style("font-family").getDefinition();if(null!=c){var d=
this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize),k=this.parent.style("font-style").valueOrDefault(a.Font.Parse(a.ctx.font).fontStyle),f=this.getText();c.isRTL&&(f=f.split("").reverse().join(""));for(var g=a.ToNumberArray(this.parent.attribute("dx").value),n=0;n<f.length;n++){var m=this.getGlyph(c,f,n),h=d/c.fontFace.unitsPerEm;b.translate(this.x,this.y);b.scale(h,-h);var l=b.lineWidth;b.lineWidth=b.lineWidth*c.fontFace.unitsPerEm/d;"italic"==k&&b.transform(1,0,.4,
1,0,0);m.render(b);"italic"==k&&b.transform(1,0,-.4,1,0,0);b.lineWidth=l;b.scale(1/h,-1/h);b.translate(-this.x,-this.y);this.x+=d*(m.horizAdvX||c.horizAdvX)/c.fontFace.unitsPerEm;"undefined"==typeof g[n]||isNaN(g[n])||(this.x+=g[n])}}else""!=b.fillStyle&&b.fillText(a.compressSpaces(this.getText()),this.x,this.y),""!=b.strokeStyle&&b.strokeText(a.compressSpaces(this.getText()),this.x,this.y)};this.getText=function(){};this.measureTextRecursive=function(a){for(var c=this.measureText(a),d=0;d<this.children.length;d++)c+=
this.children[d].measureTextRecursive(a);return c};this.measureText=function(b){var c=this.parent.style("font-family").getDefinition();if(null!=c){b=this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize);var d=0,k=this.getText();c.isRTL&&(k=k.split("").reverse().join(""));for(var f=a.ToNumberArray(this.parent.attribute("dx").value),g=0;g<k.length;g++){var n=this.getGlyph(c,k,g),d=d+(n.horizAdvX||c.horizAdvX)*b/c.fontFace.unitsPerEm;"undefined"==typeof f[g]||isNaN(f[g])||
(d+=f[g])}return d}c=a.compressSpaces(this.getText());if(!b.measureText)return 10*c.length;b.save();this.setContext(b);c=b.measureText(c).width;b.restore();return c}};a.Element.TextElementBase.prototype=new a.Element.RenderedElementBase;a.Element.tspan=function(c){this.captureTextNodes=!0;this.base=a.Element.TextElementBase;this.base(c);this.text=a.compressSpaces(c.value||c.text||c.textContent||"");this.getText=function(){return 0<this.children.length?"":this.text}};a.Element.tspan.prototype=new a.Element.TextElementBase;
a.Element.tref=function(c){this.base=a.Element.TextElementBase;this.base(c);this.getText=function(){var a=this.getHrefAttribute().getDefinition();if(null!=a)return a.children[0].getText()}};a.Element.tref.prototype=new a.Element.TextElementBase;a.Element.a=function(c){this.base=a.Element.TextElementBase;this.base(c);this.hasText=0<c.childNodes.length;for(var b=0;b<c.childNodes.length;b++)3!=c.childNodes[b].nodeType&&(this.hasText=!1);this.text=this.hasText?c.childNodes[0].value:"";this.getText=function(){return this.text};
this.baseRenderChildren=this.renderChildren;this.renderChildren=function(b){if(this.hasText){this.baseRenderChildren(b);var c=new a.Property("fontSize",a.Font.Parse(a.ctx.font).fontSize);a.Mouse.checkBoundingBox(this,new a.BoundingBox(this.x,this.y-c.toPixels("y"),this.x+this.measureText(b),this.y))}else 0<this.children.length&&(c=new a.Element.g,c.children=this.children,c.parent=this,c.render(b))};this.onclick=function(){window.open(this.getHrefAttribute().value)};this.onmousemove=function(){a.ctx.canvas.style.cursor=
"pointer"}};a.Element.a.prototype=new a.Element.TextElementBase;a.Element.image=function(c){this.base=a.Element.RenderedElementBase;this.base(c);var b=this.getHrefAttribute().value;if(""!=b){var e=b.match(/\.svg$/);a.Images.push(this);this.loaded=!1;if(e)this.img=a.ajax(b),this.loaded=!0;else{this.img=document.createElement("img");1==a.opts.useCORS&&(this.img.crossOrigin="Anonymous");var d=this;this.img.onload=function(){d.loaded=!0};this.img.onerror=function(){a.log('ERROR: image "'+b+'" not found');
d.loaded=!0};this.img.src=b}this.renderChildren=function(b){var c=this.attribute("x").toPixels("x"),d=this.attribute("y").toPixels("y"),n=this.attribute("width").toPixels("x"),m=this.attribute("height").toPixels("y");0!=n&&0!=m&&(b.save(),e?b.drawSvg(this.img,c,d,n,m):(b.translate(c,d),a.AspectRatio(b,this.attribute("preserveAspectRatio").value,n,this.img.width,m,this.img.height,0,0),b.drawImage(this.img,0,0)),b.restore())};this.getBoundingBox=function(){var b=this.attribute("x").toPixels("x"),c=
this.attribute("y").toPixels("y"),d=this.attribute("width").toPixels("x"),e=this.attribute("height").toPixels("y");return new a.BoundingBox(b,c,b+d,c+e)}}};a.Element.image.prototype=new a.Element.RenderedElementBase;a.Element.g=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.getBoundingBox=function(){for(var b=new a.BoundingBox,c=0;c<this.children.length;c++)b.addBoundingBox(this.children[c].getBoundingBox());return b}};a.Element.g.prototype=new a.Element.RenderedElementBase;
a.Element.symbol=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.render=function(a){}};a.Element.symbol.prototype=new a.Element.RenderedElementBase;a.Element.style=function(c){this.base=a.Element.ElementBase;this.base(c);for(var b="",e=0;e<c.childNodes.length;e++)b+=c.childNodes[e].data;b=b.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");b=a.compressSpaces(b);c=b.split("}");for(e=0;e<c.length;e++)if(""!=a.trim(c[e]))for(var d=c[e].split("{"),b=d[0].split(","),
d=d[1].split(";"),k=0;k<b.length;k++){var f=a.trim(b[k]);if(""!=f){for(var g=a.Styles[f]||{},n=0;n<d.length;n++){var m=d[n].indexOf(":"),h=d[n].substr(0,m),m=d[n].substr(m+1,d[n].length-m);null!=h&&null!=m&&(g[a.trim(h)]=new a.Property(a.trim(h),a.trim(m)))}a.Styles[f]=g;a.StylesSpecificity[f]=K(f);if("@font-face"==f)for(f=g["font-family"].value.replace(/"/g,""),g=g.src.value.split(","),n=0;n<g.length;n++)if(0<g[n].indexOf('format("svg")'))for(h=g[n].indexOf("url"),m=g[n].indexOf(")",h),h=g[n].substr(h+
5,m-h-6),h=a.parseXml(a.ajax(h)).getElementsByTagName("font"),m=0;m<h.length;m++){var l=a.CreateElement(h[m]);a.Definitions[f]=l}}}};a.Element.style.prototype=new a.Element.ElementBase;a.Element.use=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.baseSetContext=this.setContext;this.setContext=function(a){this.baseSetContext(a);this.attribute("x").hasValue()&&a.translate(this.attribute("x").toPixels("x"),0);this.attribute("y").hasValue()&&a.translate(0,this.attribute("y").toPixels("y"))};
var b=this.getHrefAttribute().getDefinition();this.path=function(a){null!=b&&b.path(a)};this.getBoundingBox=function(){if(null!=b)return b.getBoundingBox()};this.renderChildren=function(c){if(null!=b){var d=b;"symbol"==b.type&&(d=new a.Element.svg,d.type="svg",d.attributes.viewBox=new a.Property("viewBox",b.attribute("viewBox").value),d.attributes.preserveAspectRatio=new a.Property("preserveAspectRatio",b.attribute("preserveAspectRatio").value),d.attributes.overflow=new a.Property("overflow",b.attribute("overflow").value),
d.children=b.children);"svg"==d.type&&(this.attribute("width").hasValue()&&(d.attributes.width=new a.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(d.attributes.height=new a.Property("height",this.attribute("height").value)));var k=d.parent;d.parent=null;d.render(c);d.parent=k}}};a.Element.use.prototype=new a.Element.RenderedElementBase;a.Element.mask=function(c){this.base=a.Element.ElementBase;this.base(c);this.apply=function(b,c){var d=this.attribute("x").toPixels("x"),
k=this.attribute("y").toPixels("y"),f=this.attribute("width").toPixels("x"),g=this.attribute("height").toPixels("y");if(0==f&&0==g){g=new a.BoundingBox;for(d=0;d<this.children.length;d++)g.addBoundingBox(this.children[d].getBoundingBox());d=Math.floor(g.x1);k=Math.floor(g.y1);f=Math.floor(g.width());g=Math.floor(g.height())}var n=c.attribute("mask").value;c.attribute("mask").value="";var m=document.createElement("canvas");m.width=d+f;m.height=k+g;var h=m.getContext("2d");this.renderChildren(h);var l=
document.createElement("canvas");l.width=d+f;l.height=k+g;var p=l.getContext("2d");c.render(p);p.globalCompositeOperation="destination-in";p.fillStyle=h.createPattern(m,"no-repeat");p.fillRect(0,0,d+f,k+g);b.fillStyle=p.createPattern(l,"no-repeat");b.fillRect(0,0,d+f,k+g);c.attribute("mask").value=n};this.render=function(a){}};a.Element.mask.prototype=new a.Element.ElementBase;a.Element.clipPath=function(c){this.base=a.Element.ElementBase;this.base(c);this.apply=function(b){var c=CanvasRenderingContext2D.prototype.beginPath;
CanvasRenderingContext2D.prototype.beginPath=function(){};var d=CanvasRenderingContext2D.prototype.closePath;CanvasRenderingContext2D.prototype.closePath=function(){};c.call(b);for(var k=0;k<this.children.length;k++){var f=this.children[k];if("undefined"!=typeof f.path){var g=null;f.style("transform",!1,!0).hasValue()&&(g=new a.Transform(f.style("transform",!1,!0).value),g.apply(b));f.path(b);CanvasRenderingContext2D.prototype.closePath=d;g&&g.unapply(b)}}d.call(b);b.clip();CanvasRenderingContext2D.prototype.beginPath=
c;CanvasRenderingContext2D.prototype.closePath=d};this.render=function(a){}};a.Element.clipPath.prototype=new a.Element.ElementBase;a.Element.filter=function(c){this.base=a.Element.ElementBase;this.base(c);this.apply=function(a,c){var d=c.getBoundingBox(),k=Math.floor(d.x1),f=Math.floor(d.y1),g=Math.floor(d.width()),d=Math.floor(d.height()),n=c.style("filter").value;c.style("filter").value="";for(var m=0,h=0,l=0;l<this.children.length;l++)var p=this.children[l].extraFilterDistance||0,m=Math.max(m,
p),h=Math.max(h,p);p=document.createElement("canvas");p.width=g+2*m;p.height=d+2*h;var q=p.getContext("2d");q.translate(-k+m,-f+h);c.render(q);for(l=0;l<this.children.length;l++)"function"==typeof this.children[l].apply&&this.children[l].apply(q,0,0,g+2*m,d+2*h);a.drawImage(p,0,0,g+2*m,d+2*h,k-m,f-h,g+2*m,d+2*h);c.style("filter",!0).value=n};this.render=function(a){}};a.Element.filter.prototype=new a.Element.ElementBase;a.Element.feMorphology=function(c){this.base=a.Element.ElementBase;this.base(c);
this.apply=function(a,c,d,k,f){}};a.Element.feMorphology.prototype=new a.Element.ElementBase;a.Element.feComposite=function(c){this.base=a.Element.ElementBase;this.base(c);this.apply=function(a,c,d,k,f){}};a.Element.feComposite.prototype=new a.Element.ElementBase;a.Element.feColorMatrix=function(c){function b(a,b){var c=e[a];return c*(0>c?b-255:b)}this.base=a.Element.ElementBase;this.base(c);var e=a.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case "saturate":c=
e[0];e=[.213+.787*c,.715-.715*c,.072-.072*c,0,0,.213-.213*c,.715+.285*c,.072-.072*c,0,0,.213-.213*c,.715-.715*c,.072+.928*c,0,0,0,0,0,1,0,0,0,0,0,1];break;case "hueRotate":var d=e[0]*Math.PI/180;c=function(a,b,c){return a+Math.cos(d)*b+Math.sin(d)*c};e=[c(.213,.787,-.213),c(.715,-.715,-.715),c(.072,-.072,.928),0,0,c(.213,-.213,.143),c(.715,.285,.14),c(.072,-.072,-.283),0,0,c(.213,-.213,-.787),c(.715,-.715,.715),c(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case "luminanceToAlpha":e=[0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}this.apply=function(a,c,d,e,h){var l=a.getImageData(0,0,e,h);for(d=0;d<h;d++)for(c=0;c<e;c++){var p=l.data[d*e*4+4*c+0],u=l.data[d*e*4+4*c+1],q=l.data[d*e*4+4*c+2],w=l.data[d*e*4+4*c+3],r=b(0,p)+b(1,u)+b(2,q)+b(3,w)+b(4,1);l.data[d*e*4+4*c+0]=r;r=b(5,p)+b(6,u)+b(7,q)+b(8,w)+b(9,1);l.data[d*e*4+4*c+1]=r;r=b(10,p)+b(11,u)+b(12,q)+b(13,w)+b(14,1);l.data[d*e*4+4*c+2]=r;p=b(15,p)+b(16,u)+b(17,q)+b(18,w)+b(19,1);l.data[d*e*4+4*c+3]=p}a.clearRect(0,0,
e,h);a.putImageData(l,0,0)}};a.Element.feColorMatrix.prototype=new a.Element.ElementBase;a.Element.feGaussianBlur=function(c){this.base=a.Element.ElementBase;this.base(c);this.extraFilterDistance=this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue());this.apply=function(b,c,d,k,f){"undefined"==typeof E.canvasRGBA?a.log("ERROR: StackBlur.js must be included for blur to work"):(b.canvas.id=a.UniqueId(),b.canvas.style.display="none",document.body.appendChild(b.canvas),E.canvasRGBA(b.canvas.id,
c,d,k,f,this.blurRadius),document.body.removeChild(b.canvas))}};a.Element.feGaussianBlur.prototype=new a.Element.ElementBase;a.Element.title=function(a){};a.Element.title.prototype=new a.Element.ElementBase;a.Element.desc=function(a){};a.Element.desc.prototype=new a.Element.ElementBase;a.Element.MISSING=function(c){a.log("ERROR: Element '"+c.nodeName+"' not yet implemented.")};a.Element.MISSING.prototype=new a.Element.ElementBase;a.CreateElement=function(c){var b=c.nodeName.replace(/^[^:]+:/,""),
b=b.replace(/\-/g,""),b="undefined"!=typeof a.Element[b]?new a.Element[b](c):new a.Element.MISSING(c);b.type=c.nodeName;return b};a.load=function(c,b){a.loadXml(c,a.ajax(b))};a.loadXml=function(c,b){a.loadXmlDoc(c,a.parseXml(b))};a.loadXmlDoc=function(c,b){a.init(c);var e=function(a){for(var b=c.canvas;b;)a.x-=b.offsetLeft,a.y-=b.offsetTop,b=b.offsetParent;window.scrollX&&(a.x+=window.scrollX);window.scrollY&&(a.y+=window.scrollY);return a};1!=a.opts.ignoreMouse&&(c.canvas.onclick=function(b){b=e(new a.Point(null!=
b?b.clientX:event.clientX,null!=b?b.clientY:event.clientY));a.Mouse.onclick(b.x,b.y)},c.canvas.onmousemove=function(b){b=e(new a.Point(null!=b?b.clientX:event.clientX,null!=b?b.clientY:event.clientY));a.Mouse.onmousemove(b.x,b.y)});var d=a.CreateElement(b.documentElement);d.root=!0;d.addStylesFromStyleDefinition();var k=!0,f=function(){a.ViewPort.Clear();c.canvas.parentNode&&a.ViewPort.SetCurrent(c.canvas.parentNode.clientWidth,c.canvas.parentNode.clientHeight);1!=a.opts.ignoreDimensions&&(d.style("width").hasValue()&&
(c.canvas.width=d.style("width").toPixels("x"),c.canvas.style.width=c.canvas.width+"px"),d.style("height").hasValue()&&(c.canvas.height=d.style("height").toPixels("y"),c.canvas.style.height=c.canvas.height+"px"));var e=c.canvas.clientWidth||c.canvas.width,f=c.canvas.clientHeight||c.canvas.height;1==a.opts.ignoreDimensions&&d.style("width").hasValue()&&d.style("height").hasValue()&&(e=d.style("width").toPixels("x"),f=d.style("height").toPixels("y"));a.ViewPort.SetCurrent(e,f);null!=a.opts.offsetX&&
(d.attribute("x",!0).value=a.opts.offsetX);null!=a.opts.offsetY&&(d.attribute("y",!0).value=a.opts.offsetY);if(null!=a.opts.scaleWidth||null!=a.opts.scaleHeight){var g=null,h=null,l=a.ToNumberArray(d.attribute("viewBox").value);null!=a.opts.scaleWidth&&(d.attribute("width").hasValue()?g=d.attribute("width").toPixels("x")/a.opts.scaleWidth:isNaN(l[2])||(g=l[2]/a.opts.scaleWidth));null!=a.opts.scaleHeight&&(d.attribute("height").hasValue()?h=d.attribute("height").toPixels("y")/a.opts.scaleHeight:isNaN(l[3])||
(h=l[3]/a.opts.scaleHeight));null==g&&(g=h);null==h&&(h=g);d.attribute("width",!0).value=a.opts.scaleWidth;d.attribute("height",!0).value=a.opts.scaleHeight;d.style("transform",!0,!0).value+=" scale("+1/g+","+1/h+")"}1!=a.opts.ignoreClear&&c.clearRect(0,0,e,f);d.render(c);k&&(k=!1,"function"==typeof a.opts.renderCallback&&a.opts.renderCallback(b))},g=!0;a.ImagesLoaded()&&(g=!1,f());a.intervalID=setInterval(function(){var b=!1;g&&a.ImagesLoaded()&&(g=!1,b=!0);1!=a.opts.ignoreMouse&&(b|=a.Mouse.hasEvents());
if(1!=a.opts.ignoreAnimation)for(var c=0;c<a.Animations.length;c++)b|=a.Animations[c].update(1E3/a.FRAMERATE);"function"==typeof a.opts.forceRedraw&&1==a.opts.forceRedraw()&&(b=!0);b&&(f(),a.Mouse.runEvents())},1E3/a.FRAMERATE)};a.stop=function(){a.intervalID&&clearInterval(a.intervalID)};a.Mouse=new function(){this.events=[];this.hasEvents=function(){return 0!=this.events.length};this.onclick=function(a,b){this.events.push({type:"onclick",x:a,y:b,run:function(a){if(a.onclick)a.onclick()}})};this.onmousemove=
function(a,b){this.events.push({type:"onmousemove",x:a,y:b,run:function(a){if(a.onmousemove)a.onmousemove()}})};this.eventElements=[];this.checkPath=function(a,b){for(var e=0;e<this.events.length;e++){var d=this.events[e];b.isPointInPath&&b.isPointInPath(d.x,d.y)&&(this.eventElements[e]=a)}};this.checkBoundingBox=function(a,b){for(var e=0;e<this.events.length;e++){var d=this.events[e];b.isPointInBox(d.x,d.y)&&(this.eventElements[e]=a)}};this.runEvents=function(){a.ctx.canvas.style.cursor="";for(var c=
0;c<this.events.length;c++)for(var b=this.events[c],e=this.eventElements[c];e;)b.run(e),e=e.parent;this.events=[];this.eventElements=[]}};return a}var O=function(h,a,l){if(null==h&&null==a&&null==l)for(a=document.querySelectorAll("svg"),h=0;h<a.length;h++){l=a[h];var c=document.createElement("canvas");c.width=l.clientWidth;c.height=l.clientHeight;l.parentNode.insertBefore(c,l);l.parentNode.removeChild(l);var b=document.createElement("div");b.appendChild(l);O(c,b.innerHTML)}else{"string"==typeof h&&
(h=document.getElementById(h));null!=h.svg&&h.svg.stop();l=X(l||{});if(1!=h.childNodes.length||"OBJECT"!=h.childNodes[0].nodeName)h.svg=l;h=h.getContext("2d");"undefined"!=typeof a.documentElement?l.loadXmlDoc(h,a):"<"==a.substr(0,1)?l.loadXml(h,a):l.load(h,a)}},L;if("undefined"!=typeof Element.prototype.matches)L=function(h,a){return h.matches(a)};else if("undefined"!=typeof Element.prototype.webkitMatchesSelector)L=function(h,a){return h.webkitMatchesSelector(a)};else if("undefined"!=typeof Element.prototype.mozMatchesSelector)L=
function(h,a){return h.mozMatchesSelector(a)};else if("undefined"!=typeof Element.prototype.msMatchesSelector)L=function(h,a){return h.msMatchesSelector(a)};else if("undefined"!=typeof Element.prototype.oMatchesSelector)L=function(h,a){return h.oMatchesSelector(a)};else{if("function"===typeof jQuery||"function"===typeof Zepto)L=function(h,a){return $(h).is(a)};"undefined"===typeof L&&(L=Sizzle.matchesSelector)}var W=/(\[[^\]]+\])/g,M=/(#[^\s\+>~\.\[:]+)/g,u=/(\.[^\s\+>~\.\[:]+)/g,B=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,
p=/(:[\w-]+\([^\)]*\))/gi,C=/(:[^\s\+>~\.\[:]+)/g,w=/([^\s\+>~\.\[:]+)/g;"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(h,a,l,c,b,e){a={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:a,offsetY:l,scaleWidth:c,scaleHeight:b};for(var d in e)e.hasOwnProperty(d)&&(a[d]=e[d]);O(this.canvas,h,a)});return O});

/*!

JSZip v3.1.5 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/master/LICENSE
*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.JSZip=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=a("./utils"),e=a("./support"),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c.encode=function(a){for(var b,c,e,g,h,i,j,k=[],l=0,m=a.length,n=m,o="string"!==d.getTypeOf(a);l<a.length;)n=m-l,o?(b=a[l++],c=l<m?a[l++]:0,e=l<m?a[l++]:0):(b=a.charCodeAt(l++),c=l<m?a.charCodeAt(l++):0,e=l<m?a.charCodeAt(l++):0),g=b>>2,h=(3&b)<<4|c>>4,i=n>1?(15&c)<<2|e>>6:64,j=n>2?63&e:64,k.push(f.charAt(g)+f.charAt(h)+f.charAt(i)+f.charAt(j));return k.join("")},c.decode=function(a){var b,c,d,g,h,i,j,k=0,l=0,m="data:";if(a.substr(0,m.length)===m)throw new Error("Invalid base64 input, it looks like a data url.");a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");var n=3*a.length/4;if(a.charAt(a.length-1)===f.charAt(64)&&n--,a.charAt(a.length-2)===f.charAt(64)&&n--,n%1!==0)throw new Error("Invalid base64 input, bad content length.");var o;for(o=e.uint8array?new Uint8Array(0|n):new Array(0|n);k<a.length;)g=f.indexOf(a.charAt(k++)),h=f.indexOf(a.charAt(k++)),i=f.indexOf(a.charAt(k++)),j=f.indexOf(a.charAt(k++)),b=g<<2|h>>4,c=(15&h)<<4|i>>2,d=(3&i)<<6|j,o[l++]=b,64!==i&&(o[l++]=c),64!==j&&(o[l++]=d);return o}},{"./support":30,"./utils":32}],2:[function(a,b,c){"use strict";function d(a,b,c,d,e){this.compressedSize=a,this.uncompressedSize=b,this.crc32=c,this.compression=d,this.compressedContent=e}var e=a("./external"),f=a("./stream/DataWorker"),g=a("./stream/DataLengthProbe"),h=a("./stream/Crc32Probe"),g=a("./stream/DataLengthProbe");d.prototype={getContentWorker:function(){var a=new f(e.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new g("data_length")),b=this;return a.on("end",function(){if(this.streamInfo.data_length!==b.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),a},getCompressedWorker:function(){return new f(e.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(a,b,c){return a.pipe(new h).pipe(new g("uncompressedSize")).pipe(b.compressWorker(c)).pipe(new g("compressedSize")).withStreamInfo("compression",b)},b.exports=d},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(a,b,c){"use strict";var d=a("./stream/GenericWorker");c.STORE={magic:"\0\0",compressWorker:function(a){return new d("STORE compression")},uncompressWorker:function(){return new d("STORE decompression")}},c.DEFLATE=a("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(a,b,c){"use strict";function d(){for(var a,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function e(a,b,c,d){var e=h,f=d+c;a^=-1;for(var g=d;g<f;g++)a=a>>>8^e[255&(a^b[g])];return a^-1}function f(a,b,c,d){var e=h,f=d+c;a^=-1;for(var g=d;g<f;g++)a=a>>>8^e[255&(a^b.charCodeAt(g))];return a^-1}var g=a("./utils"),h=d();b.exports=function(a,b){if("undefined"==typeof a||!a.length)return 0;var c="string"!==g.getTypeOf(a);return c?e(0|b,a,a.length,0):f(0|b,a,a.length,0)}},{"./utils":32}],5:[function(a,b,c){"use strict";c.base64=!1,c.binary=!1,c.dir=!1,c.createFolders=!0,c.date=null,c.compression=null,c.compressionOptions=null,c.comment=null,c.unixPermissions=null,c.dosPermissions=null},{}],6:[function(a,b,c){"use strict";var d=null;d="undefined"!=typeof Promise?Promise:a("lie"),b.exports={Promise:d}},{lie:58}],7:[function(a,b,c){"use strict";function d(a,b){h.call(this,"FlateWorker/"+a),this._pako=null,this._pakoAction=a,this._pakoOptions=b,this.meta={}}var e="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,f=a("pako"),g=a("./utils"),h=a("./stream/GenericWorker"),i=e?"uint8array":"array";c.magic="\b\0",g.inherits(d,h),d.prototype.processChunk=function(a){this.meta=a.meta,null===this._pako&&this._createPako(),this._pako.push(g.transformTo(i,a.data),!1)},d.prototype.flush=function(){h.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},d.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},d.prototype._createPako=function(){this._pako=new f[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var a=this;this._pako.onData=function(b){a.push({data:b,meta:a.meta})}},c.compressWorker=function(a){return new d("Deflate",a)},c.uncompressWorker=function(){return new d("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:59}],8:[function(a,b,c){"use strict";function d(a,b,c,d){f.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=b,this.zipPlatform=c,this.encodeFileName=d,this.streamFiles=a,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}var e=a("../utils"),f=a("../stream/GenericWorker"),g=a("../utf8"),h=a("../crc32"),i=a("../signature"),j=function(a,b){var c,d="";for(c=0;c<b;c++)d+=String.fromCharCode(255&a),a>>>=8;return d},k=function(a,b){var c=a;return a||(c=b?16893:33204),(65535&c)<<16},l=function(a,b){return 63&(a||0)},m=function(a,b,c,d,f,m){var n,o,p=a.file,q=a.compression,r=m!==g.utf8encode,s=e.transformTo("string",m(p.name)),t=e.transformTo("string",g.utf8encode(p.name)),u=p.comment,v=e.transformTo("string",m(u)),w=e.transformTo("string",g.utf8encode(u)),x=t.length!==p.name.length,y=w.length!==u.length,z="",A="",B="",C=p.dir,D=p.date,E={crc32:0,compressedSize:0,uncompressedSize:0};b&&!c||(E.crc32=a.crc32,E.compressedSize=a.compressedSize,E.uncompressedSize=a.uncompressedSize);var F=0;b&&(F|=8),r||!x&&!y||(F|=2048);var G=0,H=0;C&&(G|=16),"UNIX"===f?(H=798,G|=k(p.unixPermissions,C)):(H=20,G|=l(p.dosPermissions,C)),n=D.getUTCHours(),n<<=6,n|=D.getUTCMinutes(),n<<=5,n|=D.getUTCSeconds()/2,o=D.getUTCFullYear()-1980,o<<=4,o|=D.getUTCMonth()+1,o<<=5,o|=D.getUTCDate(),x&&(A=j(1,1)+j(h(s),4)+t,z+="up"+j(A.length,2)+A),y&&(B=j(1,1)+j(h(v),4)+w,z+="uc"+j(B.length,2)+B);var I="";I+="\n\0",I+=j(F,2),I+=q.magic,I+=j(n,2),I+=j(o,2),I+=j(E.crc32,4),I+=j(E.compressedSize,4),I+=j(E.uncompressedSize,4),I+=j(s.length,2),I+=j(z.length,2);var J=i.LOCAL_FILE_HEADER+I+s+z,K=i.CENTRAL_FILE_HEADER+j(H,2)+I+j(v.length,2)+"\0\0\0\0"+j(G,4)+j(d,4)+s+z+v;return{fileRecord:J,dirRecord:K}},n=function(a,b,c,d,f){var g="",h=e.transformTo("string",f(d));return g=i.CENTRAL_DIRECTORY_END+"\0\0\0\0"+j(a,2)+j(a,2)+j(b,4)+j(c,4)+j(h.length,2)+h},o=function(a){var b="";return b=i.DATA_DESCRIPTOR+j(a.crc32,4)+j(a.compressedSize,4)+j(a.uncompressedSize,4)};e.inherits(d,f),d.prototype.push=function(a){var b=a.meta.percent||0,c=this.entriesCount,d=this._sources.length;this.accumulate?this.contentBuffer.push(a):(this.bytesWritten+=a.data.length,f.prototype.push.call(this,{data:a.data,meta:{currentFile:this.currentFile,percent:c?(b+100*(c-d-1))/c:100}}))},d.prototype.openedSource=function(a){this.currentSourceOffset=this.bytesWritten,this.currentFile=a.file.name;var b=this.streamFiles&&!a.file.dir;if(b){var c=m(a,b,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:c.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(a){this.accumulate=!1;var b=this.streamFiles&&!a.file.dir,c=m(a,b,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(c.dirRecord),b)this.push({data:o(a),meta:{percent:100}});else for(this.push({data:c.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var a=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var c=this.bytesWritten-a,d=n(this.dirRecords.length,c,a,this.zipComment,this.encodeFileName);this.push({data:d,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(a){this._sources.push(a);var b=this;return a.on("data",function(a){b.processChunk(a)}),a.on("end",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()}),a.on("error",function(a){b.error(a)}),this},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(a){var b=this._sources;if(!f.prototype.error.call(this,a))return!1;for(var c=0;c<b.length;c++)try{b[c].error(a)}catch(a){}return!0},d.prototype.lock=function(){f.prototype.lock.call(this);for(var a=this._sources,b=0;b<a.length;b++)a[b].lock()},b.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(a,b,c){"use strict";var d=a("../compressions"),e=a("./ZipFileWorker"),f=function(a,b){var c=a||b,e=d[c];if(!e)throw new Error(c+" is not a valid compression method !");return e};c.generateWorker=function(a,b,c){var d=new e(b.streamFiles,c,b.platform,b.encodeFileName),g=0;try{a.forEach(function(a,c){g++;var e=f(c.options.compression,b.compression),h=c.options.compressionOptions||b.compressionOptions||{},i=c.dir,j=c.date;c._compressWorker(e,h).withStreamInfo("file",{name:a,dir:i,date:j,comment:c.comment||"",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(d)}),d.entriesCount=g}catch(h){d.error(h)}return d}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(a,b,c){"use strict";function d(){if(!(this instanceof d))return new d;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var a=new d;for(var b in this)"function"!=typeof this[b]&&(a[b]=this[b]);return a}}d.prototype=a("./object"),d.prototype.loadAsync=a("./load"),d.support=a("./support"),d.defaults=a("./defaults"),d.version="3.1.5",d.loadAsync=function(a,b){return(new d).loadAsync(a,b)},d.external=a("./external"),b.exports=d},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(a,b,c){"use strict";function d(a){return new f.Promise(function(b,c){var d=a.decompressed.getContentWorker().pipe(new i);d.on("error",function(a){c(a)}).on("end",function(){d.streamInfo.crc32!==a.decompressed.crc32?c(new Error("Corrupted zip : CRC32 mismatch")):b()}).resume()})}var e=a("./utils"),f=a("./external"),g=a("./utf8"),e=a("./utils"),h=a("./zipEntries"),i=a("./stream/Crc32Probe"),j=a("./nodejsUtils");b.exports=function(a,b){var c=this;return b=e.extend(b||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:g.utf8decode}),j.isNode&&j.isStream(a)?f.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):e.prepareContent("the loaded zip file",a,!0,b.optimizedBinaryString,b.base64).then(function(a){var c=new h(b);return c.load(a),c}).then(function(a){var c=[f.Promise.resolve(a)],e=a.files;if(b.checkCRC32)for(var g=0;g<e.length;g++)c.push(d(e[g]));return f.Promise.all(c)}).then(function(a){for(var d=a.shift(),e=d.files,f=0;f<e.length;f++){var g=e[f];c.file(g.fileNameStr,g.decompressed,{binary:!0,optimizedBinaryString:!0,date:g.date,dir:g.dir,comment:g.fileCommentStr.length?g.fileCommentStr:null,unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions,createFolders:b.createFolders})}return d.zipComment.length&&(c.comment=d.zipComment),c})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(a,b,c){"use strict";function d(a,b){f.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(b)}var e=a("../utils"),f=a("../stream/GenericWorker");e.inherits(d,f),d.prototype._bindStream=function(a){var b=this;this._stream=a,a.pause(),a.on("data",function(a){b.push({data:a,meta:{percent:0}})}).on("error",function(a){b.isPaused?this.generatedError=a:b.error(a)}).on("end",function(){b.isPaused?b._upstreamEnded=!0:b.end()})},d.prototype.pause=function(){return!!f.prototype.pause.call(this)&&(this._stream.pause(),!0)},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},b.exports=d},{"../stream/GenericWorker":28,"../utils":32}],13:[function(a,b,c){"use strict";function d(a,b,c){e.call(this,b),this._helper=a;var d=this;a.on("data",function(a,b){d.push(a)||d._helper.pause(),c&&c(b)}).on("error",function(a){d.emit("error",a)}).on("end",function(){d.push(null)})}var e=a("readable-stream").Readable,f=a("../utils");f.inherits(d,e),d.prototype._read=function(){this._helper.resume()},b.exports=d},{"../utils":32,"readable-stream":16}],14:[function(a,b,c){"use strict";b.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(a,b){return new Buffer(a,b)},allocBuffer:function(a){return Buffer.alloc?Buffer.alloc(a):new Buffer(a)},isBuffer:function(a){return Buffer.isBuffer(a)},isStream:function(a){return a&&"function"==typeof a.on&&"function"==typeof a.pause&&"function"==typeof a.resume}}},{}],15:[function(a,b,c){"use strict";function d(a){return"[object RegExp]"===Object.prototype.toString.call(a)}var e=a("./utf8"),f=a("./utils"),g=a("./stream/GenericWorker"),h=a("./stream/StreamHelper"),i=a("./defaults"),j=a("./compressedObject"),k=a("./zipObject"),l=a("./generate"),m=a("./nodejsUtils"),n=a("./nodejs/NodejsStreamInputAdapter"),o=function(a,b,c){var d,e=f.getTypeOf(b),h=f.extend(c||{},i);h.date=h.date||new Date,null!==h.compression&&(h.compression=h.compression.toUpperCase()),"string"==typeof h.unixPermissions&&(h.unixPermissions=parseInt(h.unixPermissions,8)),h.unixPermissions&&16384&h.unixPermissions&&(h.dir=!0),h.dosPermissions&&16&h.dosPermissions&&(h.dir=!0),h.dir&&(a=q(a)),h.createFolders&&(d=p(a))&&r.call(this,d,!0);var l="string"===e&&h.binary===!1&&h.base64===!1;c&&"undefined"!=typeof c.binary||(h.binary=!l);var o=b instanceof j&&0===b.uncompressedSize;(o||h.dir||!b||0===b.length)&&(h.base64=!1,h.binary=!0,b="",h.compression="STORE",e="string");var s=null;s=b instanceof j||b instanceof g?b:m.isNode&&m.isStream(b)?new n(a,b):f.prepareContent(a,b,h.binary,h.optimizedBinaryString,h.base64);var t=new k(a,s,h);this.files[a]=t},p=function(a){"/"===a.slice(-1)&&(a=a.substring(0,a.length-1));var b=a.lastIndexOf("/");return b>0?a.substring(0,b):""},q=function(a){return"/"!==a.slice(-1)&&(a+="/"),a},r=function(a,b){return b="undefined"!=typeof b?b:i.createFolders,a=q(a),this.files[a]||o.call(this,a,null,{dir:!0,createFolders:b}),this.files[a]},s={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(a){var b,c,d;for(b in this.files)this.files.hasOwnProperty(b)&&(d=this.files[b],c=b.slice(this.root.length,b.length),c&&b.slice(0,this.root.length)===this.root&&a(c,d))},filter:function(a){var b=[];return this.forEach(function(c,d){a(c,d)&&b.push(d)}),b},file:function(a,b,c){if(1===arguments.length){if(d(a)){var e=a;return this.filter(function(a,b){return!b.dir&&e.test(a)})}var f=this.files[this.root+a];return f&&!f.dir?f:null}return a=this.root+a,o.call(this,a,b,c),this},folder:function(a){if(!a)return this;if(d(a))return this.filter(function(b,c){return c.dir&&a.test(b)});var b=this.root+a,c=r.call(this,b),e=this.clone();return e.root=c.name,e},remove:function(a){a=this.root+a;var b=this.files[a];if(b||("/"!==a.slice(-1)&&(a+="/"),b=this.files[a]),b&&!b.dir)delete this.files[a];else for(var c=this.filter(function(b,c){return c.name.slice(0,a.length)===a}),d=0;d<c.length;d++)delete this.files[c[d].name];return this},generate:function(a){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(a){var b,c={};try{if(c=f.extend(a||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:e.utf8encode}),c.type=c.type.toLowerCase(),c.compression=c.compression.toUpperCase(),"binarystring"===c.type&&(c.type="string"),!c.type)throw new Error("No output type specified.");f.checkSupport(c.type),"darwin"!==c.platform&&"freebsd"!==c.platform&&"linux"!==c.platform&&"sunos"!==c.platform||(c.platform="UNIX"),"win32"===c.platform&&(c.platform="DOS");var d=c.comment||this.comment||"";b=l.generateWorker(this,c,d)}catch(i){b=new g("error"),b.error(i)}return new h(b,c.type||"string",c.mimeType)},generateAsync:function(a,b){return this.generateInternalStream(a).accumulate(b)},generateNodeStream:function(a,b){return a=a||{},a.type||(a.type="nodebuffer"),this.generateInternalStream(a).toNodejsStream(b)}};b.exports=s},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(a,b,c){b.exports=a("stream")},{stream:void 0}],17:[function(a,b,c){"use strict";function d(a){e.call(this,a);for(var b=0;b<this.data.length;b++)a[b]=255&a[b]}var e=a("./DataReader"),f=a("../utils");f.inherits(d,e),d.prototype.byteAt=function(a){return this.data[this.zero+a]},d.prototype.lastIndexOfSignature=function(a){for(var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=this.length-4;f>=0;--f)if(this.data[f]===b&&this.data[f+1]===c&&this.data[f+2]===d&&this.data[f+3]===e)return f-this.zero;return-1},d.prototype.readAndCheckSignature=function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=this.readData(4);return b===f[0]&&c===f[1]&&d===f[2]&&e===f[3]},d.prototype.readData=function(a){if(this.checkOffset(a),0===a)return[];var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":32,"./DataReader":18}],18:[function(a,b,c){"use strict";function d(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}var e=a("../utils");d.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(a){},readInt:function(a){var b,c=0;for(this.checkOffset(a),b=this.index+a-1;b>=this.index;b--)c=(c<<8)+this.byteAt(b);return this.index+=a,c},readString:function(a){return e.transformTo("string",this.readData(a))},readData:function(a){},lastIndexOfSignature:function(a){},readAndCheckSignature:function(a){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},b.exports=d},{"../utils":32}],19:[function(a,b,c){"use strict";function d(a){e.call(this,a)}var e=a("./Uint8ArrayReader"),f=a("../utils");f.inherits(d,e),d.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(a,b,c){"use strict";function d(a){e.call(this,a)}var e=a("./DataReader"),f=a("../utils");f.inherits(d,e),d.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},d.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},d.prototype.readAndCheckSignature=function(a){var b=this.readData(4);return a===b},d.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":32,"./DataReader":18}],21:[function(a,b,c){"use strict";function d(a){e.call(this,a)}var e=a("./ArrayReader"),f=a("../utils");f.inherits(d,e),d.prototype.readData=function(a){if(this.checkOffset(a),0===a)return new Uint8Array(0);var b=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":32,"./ArrayReader":17}],22:[function(a,b,c){"use strict";var d=a("../utils"),e=a("../support"),f=a("./ArrayReader"),g=a("./StringReader"),h=a("./NodeBufferReader"),i=a("./Uint8ArrayReader");b.exports=function(a){var b=d.getTypeOf(a);return d.checkSupport(b),"string"!==b||e.uint8array?"nodebuffer"===b?new h(a):e.uint8array?new i(d.transformTo("uint8array",a)):new f(d.transformTo("array",a)):new g(a)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(a,b,c){"use strict";c.LOCAL_FILE_HEADER="PK",c.CENTRAL_FILE_HEADER="PK",c.CENTRAL_DIRECTORY_END="PK",c.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",c.ZIP64_CENTRAL_DIRECTORY_END="PK",c.DATA_DESCRIPTOR="PK\b"},{}],24:[function(a,b,c){"use strict";function d(a){e.call(this,"ConvertWorker to "+a),this.destType=a}var e=a("./GenericWorker"),f=a("../utils");f.inherits(d,e),d.prototype.processChunk=function(a){this.push({data:f.transformTo(this.destType,a.data),meta:a.meta})},b.exports=d},{"../utils":32,"./GenericWorker":28}],25:[function(a,b,c){"use strict";function d(){e.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}var e=a("./GenericWorker"),f=a("../crc32"),g=a("../utils");g.inherits(d,e),d.prototype.processChunk=function(a){this.streamInfo.crc32=f(a.data,this.streamInfo.crc32||0),this.push(a)},b.exports=d},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(a,b,c){"use strict";function d(a){f.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}var e=a("../utils"),f=a("./GenericWorker");e.inherits(d,f),d.prototype.processChunk=function(a){if(a){var b=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=b+a.data.length}f.prototype.processChunk.call(this,a)},b.exports=d},{"../utils":32,"./GenericWorker":28}],27:[function(a,b,c){"use strict";function d(a){f.call(this,"DataWorker");var b=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(a){b.dataIsReady=!0,b.data=a,b.max=a&&a.length||0,b.type=e.getTypeOf(a),b.isPaused||b._tickAndRepeat()},function(a){b.error(a)})}var e=a("../utils"),f=a("./GenericWorker"),g=16384;e.inherits(d,f),d.prototype.cleanUp=function(){f.prototype.cleanUp.call(this),this.data=null},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,e.delay(this._tickAndRepeat,[],this)),!0)},d.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(e.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=g,b=null,c=Math.min(this.max,this.index+a);if(this.index>=this.max)return this.end();switch(this.type){case"string":b=this.data.substring(this.index,c);break;case"uint8array":b=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":b=this.data.slice(this.index,c)}return this.index=c,this.push({data:b,meta:{percent:this.max?this.index/this.max*100:0}})},b.exports=d},{"../utils":32,"./GenericWorker":28}],28:[function(a,b,c){"use strict";function d(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}d.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,b){return this._listeners[a].push(b),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,b){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].call(this,b)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var b=this;return a.on("data",function(a){b.processChunk(a)}),a.on("end",function(){b.end()}),a.on("error",function(a){b.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var a=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,b){return this.extraStreamInfo[a]=b,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},b.exports=d},{}],29:[function(a,b,c){"use strict";function d(a,b,c){switch(a){case"blob":return h.newBlob(h.transformTo("arraybuffer",b),c);case"base64":return k.encode(b);default:return h.transformTo(a,b)}}function e(a,b){var c,d=0,e=null,f=0;for(c=0;c<b.length;c++)f+=b[c].length;switch(a){case"string":return b.join("");case"array":return Array.prototype.concat.apply([],b);case"uint8array":for(e=new Uint8Array(f),c=0;c<b.length;c++)e.set(b[c],d),d+=b[c].length;return e;case"nodebuffer":return Buffer.concat(b);default:throw new Error("concat : unsupported type '"+a+"'")}}function f(a,b){return new m.Promise(function(c,f){var g=[],h=a._internalType,i=a._outputType,j=a._mimeType;a.on("data",function(a,c){g.push(a),b&&b(c)}).on("error",function(a){g=[],f(a)}).on("end",function(){try{var a=d(i,e(h,g),j);c(a)}catch(b){f(b)}g=[]}).resume()})}function g(a,b,c){var d=b;switch(b){case"blob":case"arraybuffer":d="uint8array";break;case"base64":d="string"}try{this._internalType=d,this._outputType=b,this._mimeType=c,h.checkSupport(d),this._worker=a.pipe(new i(d)),a.lock()}catch(e){this._worker=new j("error"),this._worker.error(e)}}var h=a("../utils"),i=a("./ConvertWorker"),j=a("./GenericWorker"),k=a("../base64"),l=a("../support"),m=a("../external"),n=null;if(l.nodestream)try{n=a("../nodejs/NodejsStreamOutputAdapter")}catch(o){}g.prototype={accumulate:function(a){return f(this,a)},on:function(a,b){var c=this;return"data"===a?this._worker.on(a,function(a){b.call(c,a.data,a.meta)}):this._worker.on(a,function(){h.delay(b,arguments,c)}),this},resume:function(){return h.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(a){if(h.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new n(this,{objectMode:"nodebuffer"!==this._outputType},a)}},b.exports=g},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(a,b,c){"use strict";if(c.base64=!0,c.array=!0,c.string=!0,c.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,c.nodebuffer="undefined"!=typeof Buffer,c.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)c.blob=!1;else{var d=new ArrayBuffer(0);try{c.blob=0===new Blob([d],{type:"application/zip"}).size}catch(e){try{var f=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,g=new f;g.append(d),c.blob=0===g.getBlob("application/zip").size}catch(e){c.blob=!1}}}try{c.nodestream=!!a("readable-stream").Readable}catch(e){c.nodestream=!1}},{"readable-stream":16}],31:[function(a,b,c){"use strict";function d(){i.call(this,"utf-8 decode"),this.leftOver=null}function e(){i.call(this,"utf-8 encode")}for(var f=a("./utils"),g=a("./support"),h=a("./nodejsUtils"),i=a("./stream/GenericWorker"),j=new Array(256),k=0;k<256;k++)j[k]=k>=252?6:k>=248?5:k>=240?4:k>=224?3:k>=192?2:1;j[254]=j[254]=1;var l=function(a){var b,c,d,e,f,h=a.length,i=0;for(e=0;e<h;e++)c=a.charCodeAt(e),55296===(64512&c)&&e+1<h&&(d=a.charCodeAt(e+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),e++)),i+=c<128?1:c<2048?2:c<65536?3:4;for(b=g.uint8array?new Uint8Array(i):new Array(i),f=0,e=0;f<i;e++)c=a.charCodeAt(e),55296===(64512&c)&&e+1<h&&(d=a.charCodeAt(e+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),e++)),c<128?b[f++]=c:c<2048?(b[f++]=192|c>>>6,b[f++]=128|63&c):c<65536?(b[f++]=224|c>>>12,b[f++]=128|c>>>6&63,b[f++]=128|63&c):(b[f++]=240|c>>>18,b[f++]=128|c>>>12&63,b[f++]=128|c>>>6&63,b[f++]=128|63&c);return b},m=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return c<0?b:0===c?b:c+j[a[c]]>b?c:b},n=function(a){var b,c,d,e,g=a.length,h=new Array(2*g);for(c=0,b=0;b<g;)if(d=a[b++],d<128)h[c++]=d;else if(e=j[d],e>4)h[c++]=65533,b+=e-1;else{for(d&=2===e?31:3===e?15:7;e>1&&b<g;)d=d<<6|63&a[b++],e--;e>1?h[c++]=65533:d<65536?h[c++]=d:(d-=65536,h[c++]=55296|d>>10&1023,h[c++]=56320|1023&d)}return h.length!==c&&(h.subarray?h=h.subarray(0,c):h.length=c),f.applyFromCharCode(h)};c.utf8encode=function(a){return g.nodebuffer?h.newBufferFrom(a,"utf-8"):l(a)},c.utf8decode=function(a){return g.nodebuffer?f.transformTo("nodebuffer",a).toString("utf-8"):(a=f.transformTo(g.uint8array?"uint8array":"array",a),n(a))},f.inherits(d,i),d.prototype.processChunk=function(a){var b=f.transformTo(g.uint8array?"uint8array":"array",a.data);if(this.leftOver&&this.leftOver.length){if(g.uint8array){var d=b;b=new Uint8Array(d.length+this.leftOver.length),b.set(this.leftOver,0),b.set(d,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var e=m(b),h=b;e!==b.length&&(g.uint8array?(h=b.subarray(0,e),this.leftOver=b.subarray(e,b.length)):(h=b.slice(0,e),this.leftOver=b.slice(e,b.length))),this.push({data:c.utf8decode(h),meta:a.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:c.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},c.Utf8DecodeWorker=d,f.inherits(e,i),e.prototype.processChunk=function(a){this.push({data:c.utf8encode(a.data),meta:a.meta})},c.Utf8EncodeWorker=e},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(a,b,c){"use strict";function d(a){var b=null;return b=i.uint8array?new Uint8Array(a.length):new Array(a.length),f(a,b)}function e(a){return a}function f(a,b){for(var c=0;c<a.length;++c)b[c]=255&a.charCodeAt(c);return b}function g(a){var b=65536,d=c.getTypeOf(a),e=!0;if("uint8array"===d?e=n.applyCanBeUsed.uint8array:"nodebuffer"===d&&(e=n.applyCanBeUsed.nodebuffer),e)for(;b>1;)try{return n.stringifyByChunk(a,d,b)}catch(f){b=Math.floor(b/2)}return n.stringifyByChar(a)}function h(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];
return b}var i=a("./support"),j=a("./base64"),k=a("./nodejsUtils"),l=a("core-js/library/fn/set-immediate"),m=a("./external");c.newBlob=function(a,b){c.checkSupport("blob");try{return new Blob([a],{type:b})}catch(d){try{var e=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,f=new e;return f.append(a),f.getBlob(b)}catch(d){throw new Error("Bug : can't construct the Blob.")}}};var n={stringifyByChunk:function(a,b,c){var d=[],e=0,f=a.length;if(f<=c)return String.fromCharCode.apply(null,a);for(;e<f;)"array"===b||"nodebuffer"===b?d.push(String.fromCharCode.apply(null,a.slice(e,Math.min(e+c,f)))):d.push(String.fromCharCode.apply(null,a.subarray(e,Math.min(e+c,f)))),e+=c;return d.join("")},stringifyByChar:function(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(a){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,k.allocBuffer(1)).length}catch(a){return!1}}()}};c.applyFromCharCode=g;var o={};o.string={string:e,array:function(a){return f(a,new Array(a.length))},arraybuffer:function(a){return o.string.uint8array(a).buffer},uint8array:function(a){return f(a,new Uint8Array(a.length))},nodebuffer:function(a){return f(a,k.allocBuffer(a.length))}},o.array={string:g,array:e,arraybuffer:function(a){return new Uint8Array(a).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return k.newBufferFrom(a)}},o.arraybuffer={string:function(a){return g(new Uint8Array(a))},array:function(a){return h(new Uint8Array(a),new Array(a.byteLength))},arraybuffer:e,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return k.newBufferFrom(new Uint8Array(a))}},o.uint8array={string:g,array:function(a){return h(a,new Array(a.length))},arraybuffer:function(a){return a.buffer},uint8array:e,nodebuffer:function(a){return k.newBufferFrom(a)}},o.nodebuffer={string:g,array:function(a){return h(a,new Array(a.length))},arraybuffer:function(a){return o.nodebuffer.uint8array(a).buffer},uint8array:function(a){return h(a,new Uint8Array(a.length))},nodebuffer:e},c.transformTo=function(a,b){if(b||(b=""),!a)return b;c.checkSupport(a);var d=c.getTypeOf(b),e=o[d][a](b);return e},c.getTypeOf=function(a){return"string"==typeof a?"string":"[object Array]"===Object.prototype.toString.call(a)?"array":i.nodebuffer&&k.isBuffer(a)?"nodebuffer":i.uint8array&&a instanceof Uint8Array?"uint8array":i.arraybuffer&&a instanceof ArrayBuffer?"arraybuffer":void 0},c.checkSupport=function(a){var b=i[a.toLowerCase()];if(!b)throw new Error(a+" is not supported by this platform")},c.MAX_VALUE_16BITS=65535,c.MAX_VALUE_32BITS=-1,c.pretty=function(a){var b,c,d="";for(c=0;c<(a||"").length;c++)b=a.charCodeAt(c),d+="\\x"+(b<16?"0":"")+b.toString(16).toUpperCase();return d},c.delay=function(a,b,c){l(function(){a.apply(c||null,b||[])})},c.inherits=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c},c.extend=function(){var a,b,c={};for(a=0;a<arguments.length;a++)for(b in arguments[a])arguments[a].hasOwnProperty(b)&&"undefined"==typeof c[b]&&(c[b]=arguments[a][b]);return c},c.prepareContent=function(a,b,e,f,g){var h=m.Promise.resolve(b).then(function(a){var b=i.blob&&(a instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(a))!==-1);return b&&"undefined"!=typeof FileReader?new m.Promise(function(b,c){var d=new FileReader;d.onload=function(a){b(a.target.result)},d.onerror=function(a){c(a.target.error)},d.readAsArrayBuffer(a)}):a});return h.then(function(b){var h=c.getTypeOf(b);return h?("arraybuffer"===h?b=c.transformTo("uint8array",b):"string"===h&&(g?b=j.decode(b):e&&f!==!0&&(b=d(b))),b):m.Promise.reject(new Error("Can't read the data of '"+a+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"core-js/library/fn/set-immediate":36}],33:[function(a,b,c){"use strict";function d(a){this.files=[],this.loadOptions=a}var e=a("./reader/readerFor"),f=a("./utils"),g=a("./signature"),h=a("./zipEntry"),i=(a("./utf8"),a("./support"));d.prototype={checkSignature:function(a){if(!this.reader.readAndCheckSignature(a)){this.reader.index-=4;var b=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+f.pretty(b)+", expected "+f.pretty(a)+")")}},isSignature:function(a,b){var c=this.reader.index;this.reader.setIndex(a);var d=this.reader.readString(4),e=d===b;return this.reader.setIndex(c),e},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var a=this.reader.readData(this.zipCommentLength),b=i.uint8array?"uint8array":"array",c=f.transformTo(b,a);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var a,b,c,d=this.zip64EndOfCentralSize-44,e=0;e<d;)a=this.reader.readInt(2),b=this.reader.readInt(4),c=this.reader.readData(b),this.zip64ExtensibleData[a]={id:a,length:b,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var a,b;for(a=0;a<this.files.length;a++)b=this.files[a],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(g.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var a;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(g.CENTRAL_FILE_HEADER);)a=new h({zip64:this.zip64},this.loadOptions),a.readCentralPart(this.reader),this.files.push(a);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var a=this.reader.lastIndexOfSignature(g.CENTRAL_DIRECTORY_END);if(a<0){var b=!this.isSignature(0,g.LOCAL_FILE_HEADER);throw b?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(a);var c=a;if(this.checkSignature(g.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===f.MAX_VALUE_16BITS||this.diskWithCentralDirStart===f.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===f.MAX_VALUE_16BITS||this.centralDirRecords===f.MAX_VALUE_16BITS||this.centralDirSize===f.MAX_VALUE_32BITS||this.centralDirOffset===f.MAX_VALUE_32BITS){if(this.zip64=!0,a=this.reader.lastIndexOfSignature(g.ZIP64_CENTRAL_DIRECTORY_LOCATOR),a<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(a),this.checkSignature(g.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,g.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(g.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(g.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var e=c-d;if(e>0)this.isSignature(c,g.CENTRAL_FILE_HEADER)||(this.reader.zero=e);else if(e<0)throw new Error("Corrupted zip: missing "+Math.abs(e)+" bytes.")},prepareReader:function(a){this.reader=e(a)},load:function(a){this.prepareReader(a),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},b.exports=d},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(a,b,c){"use strict";function d(a,b){this.options=a,this.loadOptions=b}var e=a("./reader/readerFor"),f=a("./utils"),g=a("./compressedObject"),h=a("./crc32"),i=a("./utf8"),j=a("./compressions"),k=a("./support"),l=0,m=3,n=function(a){for(var b in j)if(j.hasOwnProperty(b)&&j[b].magic===a)return j[b];return null};d.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},readLocalPart:function(a){var b,c;if(a.skip(22),this.fileNameLength=a.readInt(2),c=a.readInt(2),this.fileName=a.readData(this.fileNameLength),a.skip(c),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(b=n(this.compressionMethod),null===b)throw new Error("Corrupted zip : compression "+f.pretty(this.compressionMethod)+" unknown (inner file : "+f.transformTo("string",this.fileName)+")");this.decompressed=new g(this.compressedSize,this.uncompressedSize,this.crc32,b,a.readData(this.compressedSize))},readCentralPart:function(a){this.versionMadeBy=a.readInt(2),a.skip(2),this.bitFlag=a.readInt(2),this.compressionMethod=a.readString(2),this.date=a.readDate(),this.crc32=a.readInt(4),this.compressedSize=a.readInt(4),this.uncompressedSize=a.readInt(4);var b=a.readInt(2);if(this.extraFieldsLength=a.readInt(2),this.fileCommentLength=a.readInt(2),this.diskNumberStart=a.readInt(2),this.internalFileAttributes=a.readInt(2),this.externalFileAttributes=a.readInt(4),this.localHeaderOffset=a.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");a.skip(b),this.readExtraFields(a),this.parseZIP64ExtraField(a),this.fileComment=a.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var a=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),a===l&&(this.dosPermissions=63&this.externalFileAttributes),a===m&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(a){if(this.extraFields[1]){var b=e(this.extraFields[1].value);this.uncompressedSize===f.MAX_VALUE_32BITS&&(this.uncompressedSize=b.readInt(8)),this.compressedSize===f.MAX_VALUE_32BITS&&(this.compressedSize=b.readInt(8)),this.localHeaderOffset===f.MAX_VALUE_32BITS&&(this.localHeaderOffset=b.readInt(8)),this.diskNumberStart===f.MAX_VALUE_32BITS&&(this.diskNumberStart=b.readInt(4))}},readExtraFields:function(a){var b,c,d,e=a.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});a.index<e;)b=a.readInt(2),c=a.readInt(2),d=a.readData(c),this.extraFields[b]={id:b,length:c,value:d}},handleUTF8:function(){var a=k.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=i.utf8decode(this.fileName),this.fileCommentStr=i.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(null!==b)this.fileNameStr=b;else{var c=f.transformTo(a,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(c)}var d=this.findExtraFieldUnicodeComment();if(null!==d)this.fileCommentStr=d;else{var e=f.transformTo(a,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(e)}}},findExtraFieldUnicodePath:function(){var a=this.extraFields[28789];if(a){var b=e(a.value);return 1!==b.readInt(1)?null:h(this.fileName)!==b.readInt(4)?null:i.utf8decode(b.readData(a.length-5))}return null},findExtraFieldUnicodeComment:function(){var a=this.extraFields[25461];if(a){var b=e(a.value);return 1!==b.readInt(1)?null:h(this.fileComment)!==b.readInt(4)?null:i.utf8decode(b.readData(a.length-5))}return null}},b.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(a,b,c){"use strict";var d=a("./stream/StreamHelper"),e=a("./stream/DataWorker"),f=a("./utf8"),g=a("./compressedObject"),h=a("./stream/GenericWorker"),i=function(a,b,c){this.name=a,this.dir=c.dir,this.date=c.date,this.comment=c.comment,this.unixPermissions=c.unixPermissions,this.dosPermissions=c.dosPermissions,this._data=b,this._dataBinary=c.binary,this.options={compression:c.compression,compressionOptions:c.compressionOptions}};i.prototype={internalStream:function(a){var b=null,c="string";try{if(!a)throw new Error("No output type specified.");c=a.toLowerCase();var e="string"===c||"text"===c;"binarystring"!==c&&"text"!==c||(c="string"),b=this._decompressWorker();var g=!this._dataBinary;g&&!e&&(b=b.pipe(new f.Utf8EncodeWorker)),!g&&e&&(b=b.pipe(new f.Utf8DecodeWorker))}catch(i){b=new h("error"),b.error(i)}return new d(b,c,"")},async:function(a,b){return this.internalStream(a).accumulate(b)},nodeStream:function(a,b){return this.internalStream(a||"nodebuffer").toNodejsStream(b)},_compressWorker:function(a,b){if(this._data instanceof g&&this._data.compression.magic===a.magic)return this._data.getCompressedWorker();var c=this._decompressWorker();return this._dataBinary||(c=c.pipe(new f.Utf8EncodeWorker)),g.createWorkerFrom(c,a,b)},_decompressWorker:function(){return this._data instanceof g?this._data.getContentWorker():this._data instanceof h?this._data:new e(this._data)}};for(var j=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],k=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},l=0;l<j.length;l++)i.prototype[j[l]]=k;b.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(a,b,c){a("../modules/web.immediate"),b.exports=a("../modules/_core").setImmediate},{"../modules/_core":40,"../modules/web.immediate":56}],37:[function(a,b,c){b.exports=function(a){if("function"!=typeof a)throw TypeError(a+" is not a function!");return a}},{}],38:[function(a,b,c){var d=a("./_is-object");b.exports=function(a){if(!d(a))throw TypeError(a+" is not an object!");return a}},{"./_is-object":51}],39:[function(a,b,c){var d={}.toString;b.exports=function(a){return d.call(a).slice(8,-1)}},{}],40:[function(a,b,c){var d=b.exports={version:"2.3.0"};"number"==typeof __e&&(__e=d)},{}],41:[function(a,b,c){var d=a("./_a-function");b.exports=function(a,b,c){if(d(a),void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)}}return function(){return a.apply(b,arguments)}}},{"./_a-function":37}],42:[function(a,b,c){b.exports=!a("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":45}],43:[function(a,b,c){var d=a("./_is-object"),e=a("./_global").document,f=d(e)&&d(e.createElement);b.exports=function(a){return f?e.createElement(a):{}}},{"./_global":46,"./_is-object":51}],44:[function(a,b,c){var d=a("./_global"),e=a("./_core"),f=a("./_ctx"),g=a("./_hide"),h="prototype",i=function(a,b,c){var j,k,l,m=a&i.F,n=a&i.G,o=a&i.S,p=a&i.P,q=a&i.B,r=a&i.W,s=n?e:e[b]||(e[b]={}),t=s[h],u=n?d:o?d[b]:(d[b]||{})[h];n&&(c=b);for(j in c)k=!m&&u&&void 0!==u[j],k&&j in s||(l=k?u[j]:c[j],s[j]=n&&"function"!=typeof u[j]?c[j]:q&&k?f(l,d):r&&u[j]==l?function(a){var b=function(b,c,d){if(this instanceof a){switch(arguments.length){case 0:return new a;case 1:return new a(b);case 2:return new a(b,c)}return new a(b,c,d)}return a.apply(this,arguments)};return b[h]=a[h],b}(l):p&&"function"==typeof l?f(Function.call,l):l,p&&((s.virtual||(s.virtual={}))[j]=l,a&i.R&&t&&!t[j]&&g(t,j,l)))};i.F=1,i.G=2,i.S=4,i.P=8,i.B=16,i.W=32,i.U=64,i.R=128,b.exports=i},{"./_core":40,"./_ctx":41,"./_global":46,"./_hide":47}],45:[function(a,b,c){b.exports=function(a){try{return!!a()}catch(b){return!0}}},{}],46:[function(a,b,c){var d=b.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=d)},{}],47:[function(a,b,c){var d=a("./_object-dp"),e=a("./_property-desc");b.exports=a("./_descriptors")?function(a,b,c){return d.f(a,b,e(1,c))}:function(a,b,c){return a[b]=c,a}},{"./_descriptors":42,"./_object-dp":52,"./_property-desc":53}],48:[function(a,b,c){b.exports=a("./_global").document&&document.documentElement},{"./_global":46}],49:[function(a,b,c){b.exports=!a("./_descriptors")&&!a("./_fails")(function(){return 7!=Object.defineProperty(a("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":42,"./_dom-create":43,"./_fails":45}],50:[function(a,b,c){b.exports=function(a,b,c){var d=void 0===c;switch(b.length){case 0:return d?a():a.call(c);case 1:return d?a(b[0]):a.call(c,b[0]);case 2:return d?a(b[0],b[1]):a.call(c,b[0],b[1]);case 3:return d?a(b[0],b[1],b[2]):a.call(c,b[0],b[1],b[2]);case 4:return d?a(b[0],b[1],b[2],b[3]):a.call(c,b[0],b[1],b[2],b[3])}return a.apply(c,b)}},{}],51:[function(a,b,c){b.exports=function(a){return"object"==typeof a?null!==a:"function"==typeof a}},{}],52:[function(a,b,c){var d=a("./_an-object"),e=a("./_ie8-dom-define"),f=a("./_to-primitive"),g=Object.defineProperty;c.f=a("./_descriptors")?Object.defineProperty:function(a,b,c){if(d(a),b=f(b,!0),d(c),e)try{return g(a,b,c)}catch(h){}if("get"in c||"set"in c)throw TypeError("Accessors not supported!");return"value"in c&&(a[b]=c.value),a}},{"./_an-object":38,"./_descriptors":42,"./_ie8-dom-define":49,"./_to-primitive":55}],53:[function(a,b,c){b.exports=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}}},{}],54:[function(a,b,c){var d,e,f,g=a("./_ctx"),h=a("./_invoke"),i=a("./_html"),j=a("./_dom-create"),k=a("./_global"),l=k.process,m=k.setImmediate,n=k.clearImmediate,o=k.MessageChannel,p=0,q={},r="onreadystatechange",s=function(){var a=+this;if(q.hasOwnProperty(a)){var b=q[a];delete q[a],b()}},t=function(a){s.call(a.data)};m&&n||(m=function(a){for(var b=[],c=1;arguments.length>c;)b.push(arguments[c++]);return q[++p]=function(){h("function"==typeof a?a:Function(a),b)},d(p),p},n=function(a){delete q[a]},"process"==a("./_cof")(l)?d=function(a){l.nextTick(g(s,a,1))}:o?(e=new o,f=e.port2,e.port1.onmessage=t,d=g(f.postMessage,f,1)):k.addEventListener&&"function"==typeof postMessage&&!k.importScripts?(d=function(a){k.postMessage(a+"","*")},k.addEventListener("message",t,!1)):d=r in j("script")?function(a){i.appendChild(j("script"))[r]=function(){i.removeChild(this),s.call(a)}}:function(a){setTimeout(g(s,a,1),0)}),b.exports={set:m,clear:n}},{"./_cof":39,"./_ctx":41,"./_dom-create":43,"./_global":46,"./_html":48,"./_invoke":50}],55:[function(a,b,c){var d=a("./_is-object");b.exports=function(a,b){if(!d(a))return a;var c,e;if(b&&"function"==typeof(c=a.toString)&&!d(e=c.call(a)))return e;if("function"==typeof(c=a.valueOf)&&!d(e=c.call(a)))return e;if(!b&&"function"==typeof(c=a.toString)&&!d(e=c.call(a)))return e;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":51}],56:[function(a,b,c){var d=a("./_export"),e=a("./_task");d(d.G+d.B,{setImmediate:e.set,clearImmediate:e.clear})},{"./_export":44,"./_task":54}],57:[function(a,b,c){(function(a){"use strict";function c(){k=!0;for(var a,b,c=l.length;c;){for(b=l,l=[],a=-1;++a<c;)b[a]();c=l.length}k=!1}function d(a){1!==l.push(a)||k||e()}var e,f=a.MutationObserver||a.WebKitMutationObserver;if(f){var g=0,h=new f(c),i=a.document.createTextNode("");h.observe(i,{characterData:!0}),e=function(){i.data=g=++g%2}}else if(a.setImmediate||"undefined"==typeof a.MessageChannel)e="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var b=a.document.createElement("script");b.onreadystatechange=function(){c(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},a.document.documentElement.appendChild(b)}:function(){setTimeout(c,0)};else{var j=new a.MessageChannel;j.port1.onmessage=c,e=function(){j.port2.postMessage(0)}}var k,l=[];b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],58:[function(a,b,c){"use strict";function d(){}function e(a){if("function"!=typeof a)throw new TypeError("resolver must be a function");this.state=s,this.queue=[],this.outcome=void 0,a!==d&&i(this,a)}function f(a,b,c){this.promise=a,"function"==typeof b&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),"function"==typeof c&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}function g(a,b,c){o(function(){var d;try{d=b(c)}catch(e){return p.reject(a,e)}d===a?p.reject(a,new TypeError("Cannot resolve promise with itself")):p.resolve(a,d)})}function h(a){var b=a&&a.then;if(a&&("object"==typeof a||"function"==typeof a)&&"function"==typeof b)return function(){b.apply(a,arguments)}}function i(a,b){function c(b){f||(f=!0,p.reject(a,b))}function d(b){f||(f=!0,p.resolve(a,b))}function e(){b(d,c)}var f=!1,g=j(e);"error"===g.status&&c(g.value)}function j(a,b){var c={};try{c.value=a(b),c.status="success"}catch(d){c.status="error",c.value=d}return c}function k(a){return a instanceof this?a:p.resolve(new this(d),a)}function l(a){var b=new this(d);return p.reject(b,a)}function m(a){function b(a,b){function d(a){g[b]=a,++h!==e||f||(f=!0,p.resolve(j,g))}c.resolve(a).then(d,function(a){f||(f=!0,p.reject(j,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=new Array(e),h=0,i=-1,j=new this(d);++i<e;)b(a[i],i);return j}function n(a){function b(a){c.resolve(a).then(function(a){f||(f=!0,p.resolve(h,a))},function(a){f||(f=!0,p.reject(h,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=-1,h=new this(d);++g<e;)b(a[g]);return h}var o=a("immediate"),p={},q=["REJECTED"],r=["FULFILLED"],s=["PENDING"];b.exports=e,e.prototype["catch"]=function(a){return this.then(null,a)},e.prototype.then=function(a,b){if("function"!=typeof a&&this.state===r||"function"!=typeof b&&this.state===q)return this;var c=new this.constructor(d);if(this.state!==s){var e=this.state===r?a:b;g(c,e,this.outcome)}else this.queue.push(new f(c,a,b));return c},f.prototype.callFulfilled=function(a){p.resolve(this.promise,a)},f.prototype.otherCallFulfilled=function(a){g(this.promise,this.onFulfilled,a)},f.prototype.callRejected=function(a){p.reject(this.promise,a)},f.prototype.otherCallRejected=function(a){g(this.promise,this.onRejected,a)},p.resolve=function(a,b){var c=j(h,b);if("error"===c.status)return p.reject(a,c.value);var d=c.value;if(d)i(a,d);else{a.state=r,a.outcome=b;for(var e=-1,f=a.queue.length;++e<f;)a.queue[e].callFulfilled(b)}return a},p.reject=function(a,b){a.state=q,a.outcome=b;for(var c=-1,d=a.queue.length;++c<d;)a.queue[c].callRejected(b);return a},e.resolve=k,e.reject=l,e.all=m,e.race=n},{immediate:57}],59:[function(a,b,c){"use strict";var d=a("./lib/utils/common").assign,e=a("./lib/deflate"),f=a("./lib/inflate"),g=a("./lib/zlib/constants"),h={};d(h,e,f,g),b.exports=h},{"./lib/deflate":60,"./lib/inflate":61,"./lib/utils/common":62,"./lib/zlib/constants":65}],60:[function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);this.options=i.assign({level:s,method:u,chunkSize:16384,windowBits:15,memLevel:8,strategy:t,to:""},a||{});var b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var c=h.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(c!==p)throw new Error(k[c]);if(b.header&&h.deflateSetHeader(this.strm,b.header),b.dictionary){var e;if(e="string"==typeof b.dictionary?j.string2buf(b.dictionary):"[object ArrayBuffer]"===m.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,c=h.deflateSetDictionary(this.strm,e),c!==p)throw new Error(k[c]);this._dict_set=!0}}function e(a,b){var c=new d(b);if(c.push(a,!0),c.err)throw c.msg||k[c.err];return c.result}function f(a,b){return b=b||{},b.raw=!0,e(a,b)}function g(a,b){return b=b||{},b.gzip=!0,e(a,b)}var h=a("./zlib/deflate"),i=a("./utils/common"),j=a("./utils/strings"),k=a("./zlib/messages"),l=a("./zlib/zstream"),m=Object.prototype.toString,n=0,o=4,p=0,q=1,r=2,s=-1,t=0,u=8;d.prototype.push=function(a,b){var c,d,e=this.strm,f=this.options.chunkSize;if(this.ended)return!1;d=b===~~b?b:b===!0?o:n,"string"==typeof a?e.input=j.string2buf(a):"[object ArrayBuffer]"===m.call(a)?e.input=new Uint8Array(a):e.input=a,e.next_in=0,e.avail_in=e.input.length;do{if(0===e.avail_out&&(e.output=new i.Buf8(f),e.next_out=0,e.avail_out=f),c=h.deflate(e,d),c!==q&&c!==p)return this.onEnd(c),this.ended=!0,!1;0!==e.avail_out&&(0!==e.avail_in||d!==o&&d!==r)||("string"===this.options.to?this.onData(j.buf2binstring(i.shrinkBuf(e.output,e.next_out))):this.onData(i.shrinkBuf(e.output,e.next_out)))}while((e.avail_in>0||0===e.avail_out)&&c!==q);return d===o?(c=h.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===p):d!==r||(this.onEnd(p),e.avail_out=0,!0)},d.prototype.onData=function(a){this.chunks.push(a)},d.prototype.onEnd=function(a){a===p&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Deflate=d,c.deflate=e,c.deflateRaw=f,c.gzip=g},{"./utils/common":62,"./utils/strings":63,"./zlib/deflate":67,"./zlib/messages":72,"./zlib/zstream":74}],61:[function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);this.options=h.assign({chunkSize:16384,windowBits:0,to:""},a||{});var b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||a&&a.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var c=g.inflateInit2(this.strm,b.windowBits);if(c!==j.Z_OK)throw new Error(k[c]);this.header=new m,g.inflateGetHeader(this.strm,this.header)}function e(a,b){var c=new d(b);if(c.push(a,!0),c.err)throw c.msg||k[c.err];return c.result}function f(a,b){return b=b||{},b.raw=!0,e(a,b)}var g=a("./zlib/inflate"),h=a("./utils/common"),i=a("./utils/strings"),j=a("./zlib/constants"),k=a("./zlib/messages"),l=a("./zlib/zstream"),m=a("./zlib/gzheader"),n=Object.prototype.toString;d.prototype.push=function(a,b){var c,d,e,f,k,l,m=this.strm,o=this.options.chunkSize,p=this.options.dictionary,q=!1;if(this.ended)return!1;d=b===~~b?b:b===!0?j.Z_FINISH:j.Z_NO_FLUSH,"string"==typeof a?m.input=i.binstring2buf(a):"[object ArrayBuffer]"===n.call(a)?m.input=new Uint8Array(a):m.input=a,m.next_in=0,m.avail_in=m.input.length;do{if(0===m.avail_out&&(m.output=new h.Buf8(o),m.next_out=0,m.avail_out=o),c=g.inflate(m,j.Z_NO_FLUSH),c===j.Z_NEED_DICT&&p&&(l="string"==typeof p?i.string2buf(p):"[object ArrayBuffer]"===n.call(p)?new Uint8Array(p):p,c=g.inflateSetDictionary(this.strm,l)),c===j.Z_BUF_ERROR&&q===!0&&(c=j.Z_OK,q=!1),c!==j.Z_STREAM_END&&c!==j.Z_OK)return this.onEnd(c),this.ended=!0,!1;m.next_out&&(0!==m.avail_out&&c!==j.Z_STREAM_END&&(0!==m.avail_in||d!==j.Z_FINISH&&d!==j.Z_SYNC_FLUSH)||("string"===this.options.to?(e=i.utf8border(m.output,m.next_out),f=m.next_out-e,k=i.buf2string(m.output,e),m.next_out=f,m.avail_out=o-f,f&&h.arraySet(m.output,m.output,e,f,0),this.onData(k)):this.onData(h.shrinkBuf(m.output,m.next_out)))),0===m.avail_in&&0===m.avail_out&&(q=!0)}while((m.avail_in>0||0===m.avail_out)&&c!==j.Z_STREAM_END);return c===j.Z_STREAM_END&&(d=j.Z_FINISH),d===j.Z_FINISH?(c=g.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===j.Z_OK):d!==j.Z_SYNC_FLUSH||(this.onEnd(j.Z_OK),m.avail_out=0,!0)},d.prototype.onData=function(a){this.chunks.push(a)},d.prototype.onEnd=function(a){a===j.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Inflate=d,c.inflate=e,c.inflateRaw=f,c.ungzip=e},{"./utils/common":62,"./utils/strings":63,"./zlib/constants":65,"./zlib/gzheader":68,"./zlib/inflate":70,"./zlib/messages":72,"./zlib/zstream":74}],62:[function(a,b,c){"use strict";var d="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;c.assign=function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var c=b.shift();if(c){if("object"!=typeof c)throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}}return a},c.shrinkBuf=function(a,b){return a.length===b?a:a.subarray?a.subarray(0,b):(a.length=b,a)};var e={arraySet:function(a,b,c,d,e){if(b.subarray&&a.subarray)return void a.set(b.subarray(c,c+d),e);for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){var b,c,d,e,f,g;for(d=0,b=0,c=a.length;b<c;b++)d+=a[b].length;for(g=new Uint8Array(d),e=0,b=0,c=a.length;b<c;b++)f=a[b],g.set(f,e),e+=f.length;return g}},f={arraySet:function(a,b,c,d,e){for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){return[].concat.apply([],a)}};c.setTyped=function(a){a?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,e)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,f))},c.setTyped(d)},{}],63:[function(a,b,c){"use strict";function d(a,b){if(b<65537&&(a.subarray&&g||!a.subarray&&f))return String.fromCharCode.apply(null,e.shrinkBuf(a,b));for(var c="",d=0;d<b;d++)c+=String.fromCharCode(a[d]);return c}var e=a("./common"),f=!0,g=!0;try{String.fromCharCode.apply(null,[0])}catch(h){f=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(h){g=!1}for(var i=new e.Buf8(256),j=0;j<256;j++)i[j]=j>=252?6:j>=248?5:j>=240?4:j>=224?3:j>=192?2:1;i[254]=i[254]=1,c.string2buf=function(a){var b,c,d,f,g,h=a.length,i=0;for(f=0;f<h;f++)c=a.charCodeAt(f),55296===(64512&c)&&f+1<h&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),i+=c<128?1:c<2048?2:c<65536?3:4;for(b=new e.Buf8(i),g=0,f=0;g<i;f++)c=a.charCodeAt(f),55296===(64512&c)&&f+1<h&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),c<128?b[g++]=c:c<2048?(b[g++]=192|c>>>6,b[g++]=128|63&c):c<65536?(b[g++]=224|c>>>12,b[g++]=128|c>>>6&63,b[g++]=128|63&c):(b[g++]=240|c>>>18,b[g++]=128|c>>>12&63,b[g++]=128|c>>>6&63,b[g++]=128|63&c);return b},c.buf2binstring=function(a){return d(a,a.length)},c.binstring2buf=function(a){for(var b=new e.Buf8(a.length),c=0,d=b.length;c<d;c++)b[c]=a.charCodeAt(c);return b},c.buf2string=function(a,b){var c,e,f,g,h=b||a.length,j=new Array(2*h);for(e=0,c=0;c<h;)if(f=a[c++],f<128)j[e++]=f;else if(g=i[f],g>4)j[e++]=65533,c+=g-1;else{for(f&=2===g?31:3===g?15:7;g>1&&c<h;)f=f<<6|63&a[c++],g--;g>1?j[e++]=65533:f<65536?j[e++]=f:(f-=65536,j[e++]=55296|f>>10&1023,j[e++]=56320|1023&f)}return d(j,e)},c.utf8border=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return c<0?b:0===c?b:c+i[a[c]]>b?c:b}},{"./common":62}],64:[function(a,b,c){"use strict";function d(a,b,c,d){for(var e=65535&a|0,f=a>>>16&65535|0,g=0;0!==c;){g=c>2e3?2e3:c,c-=g;do e=e+b[d++]|0,f=f+e|0;while(--g);e%=65521,f%=65521}return e|f<<16|0;
}b.exports=d},{}],65:[function(a,b,c){"use strict";b.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],66:[function(a,b,c){"use strict";function d(){for(var a,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function e(a,b,c,d){var e=f,g=d+c;a^=-1;for(var h=d;h<g;h++)a=a>>>8^e[255&(a^b[h])];return a^-1}var f=d();b.exports=e},{}],67:[function(a,b,c){"use strict";function d(a,b){return a.msg=I[b],b}function e(a){return(a<<1)-(a>4?9:0)}function f(a){for(var b=a.length;--b>=0;)a[b]=0}function g(a){var b=a.state,c=b.pending;c>a.avail_out&&(c=a.avail_out),0!==c&&(E.arraySet(a.output,b.pending_buf,b.pending_out,c,a.next_out),a.next_out+=c,b.pending_out+=c,a.total_out+=c,a.avail_out-=c,b.pending-=c,0===b.pending&&(b.pending_out=0))}function h(a,b){F._tr_flush_block(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,b),a.block_start=a.strstart,g(a.strm)}function i(a,b){a.pending_buf[a.pending++]=b}function j(a,b){a.pending_buf[a.pending++]=b>>>8&255,a.pending_buf[a.pending++]=255&b}function k(a,b,c,d){var e=a.avail_in;return e>d&&(e=d),0===e?0:(a.avail_in-=e,E.arraySet(b,a.input,a.next_in,e,c),1===a.state.wrap?a.adler=G(a.adler,b,e,c):2===a.state.wrap&&(a.adler=H(a.adler,b,e,c)),a.next_in+=e,a.total_in+=e,e)}function l(a,b){var c,d,e=a.max_chain_length,f=a.strstart,g=a.prev_length,h=a.nice_match,i=a.strstart>a.w_size-la?a.strstart-(a.w_size-la):0,j=a.window,k=a.w_mask,l=a.prev,m=a.strstart+ka,n=j[f+g-1],o=j[f+g];a.prev_length>=a.good_match&&(e>>=2),h>a.lookahead&&(h=a.lookahead);do if(c=b,j[c+g]===o&&j[c+g-1]===n&&j[c]===j[f]&&j[++c]===j[f+1]){f+=2,c++;do;while(j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&f<m);if(d=ka-(m-f),f=m-ka,d>g){if(a.match_start=b,g=d,d>=h)break;n=j[f+g-1],o=j[f+g]}}while((b=l[b&k])>i&&0!==--e);return g<=a.lookahead?g:a.lookahead}function m(a){var b,c,d,e,f,g=a.w_size;do{if(e=a.window_size-a.lookahead-a.strstart,a.strstart>=g+(g-la)){E.arraySet(a.window,a.window,g,g,0),a.match_start-=g,a.strstart-=g,a.block_start-=g,c=a.hash_size,b=c;do d=a.head[--b],a.head[b]=d>=g?d-g:0;while(--c);c=g,b=c;do d=a.prev[--b],a.prev[b]=d>=g?d-g:0;while(--c);e+=g}if(0===a.strm.avail_in)break;if(c=k(a.strm,a.window,a.strstart+a.lookahead,e),a.lookahead+=c,a.lookahead+a.insert>=ja)for(f=a.strstart-a.insert,a.ins_h=a.window[f],a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+ja-1])&a.hash_mask,a.prev[f&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=f,f++,a.insert--,!(a.lookahead+a.insert<ja)););}while(a.lookahead<la&&0!==a.strm.avail_in)}function n(a,b){var c=65535;for(c>a.pending_buf_size-5&&(c=a.pending_buf_size-5);;){if(a.lookahead<=1){if(m(a),0===a.lookahead&&b===J)return ua;if(0===a.lookahead)break}a.strstart+=a.lookahead,a.lookahead=0;var d=a.block_start+c;if((0===a.strstart||a.strstart>=d)&&(a.lookahead=a.strstart-d,a.strstart=d,h(a,!1),0===a.strm.avail_out))return ua;if(a.strstart-a.block_start>=a.w_size-la&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.strstart>a.block_start&&(h(a,!1),0===a.strm.avail_out)?ua:ua}function o(a,b){for(var c,d;;){if(a.lookahead<la){if(m(a),a.lookahead<la&&b===J)return ua;if(0===a.lookahead)break}if(c=0,a.lookahead>=ja&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==c&&a.strstart-c<=a.w_size-la&&(a.match_length=l(a,c)),a.match_length>=ja)if(d=F._tr_tally(a,a.strstart-a.match_start,a.match_length-ja),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=ja){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!==--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else d=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(d&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=a.strstart<ja-1?a.strstart:ja-1,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function p(a,b){for(var c,d,e;;){if(a.lookahead<la){if(m(a),a.lookahead<la&&b===J)return ua;if(0===a.lookahead)break}if(c=0,a.lookahead>=ja&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=ja-1,0!==c&&a.prev_length<a.max_lazy_match&&a.strstart-c<=a.w_size-la&&(a.match_length=l(a,c),a.match_length<=5&&(a.strategy===U||a.match_length===ja&&a.strstart-a.match_start>4096)&&(a.match_length=ja-1)),a.prev_length>=ja&&a.match_length<=a.prev_length){e=a.strstart+a.lookahead-ja,d=F._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-ja),a.lookahead-=a.prev_length-1,a.prev_length-=2;do++a.strstart<=e&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(0!==--a.prev_length);if(a.match_available=0,a.match_length=ja-1,a.strstart++,d&&(h(a,!1),0===a.strm.avail_out))return ua}else if(a.match_available){if(d=F._tr_tally(a,0,a.window[a.strstart-1]),d&&h(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return ua}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(d=F._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<ja-1?a.strstart:ja-1,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function q(a,b){for(var c,d,e,f,g=a.window;;){if(a.lookahead<=ka){if(m(a),a.lookahead<=ka&&b===J)return ua;if(0===a.lookahead)break}if(a.match_length=0,a.lookahead>=ja&&a.strstart>0&&(e=a.strstart-1,d=g[e],d===g[++e]&&d===g[++e]&&d===g[++e])){f=a.strstart+ka;do;while(d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&e<f);a.match_length=ka-(f-e),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=ja?(c=F._tr_tally(a,1,a.match_length-ja),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),c&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function r(a,b){for(var c;;){if(0===a.lookahead&&(m(a),0===a.lookahead)){if(b===J)return ua;break}if(a.match_length=0,c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,c&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function s(a,b,c,d,e){this.good_length=a,this.max_lazy=b,this.nice_length=c,this.max_chain=d,this.func=e}function t(a){a.window_size=2*a.w_size,f(a.head),a.max_lazy_match=D[a.level].max_lazy,a.good_match=D[a.level].good_length,a.nice_match=D[a.level].nice_length,a.max_chain_length=D[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=ja-1,a.match_available=0,a.ins_h=0}function u(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=$,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new E.Buf16(2*ha),this.dyn_dtree=new E.Buf16(2*(2*fa+1)),this.bl_tree=new E.Buf16(2*(2*ga+1)),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new E.Buf16(ia+1),this.heap=new E.Buf16(2*ea+1),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new E.Buf16(2*ea+1),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function v(a){var b;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=Z,b=a.state,b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?na:sa,a.adler=2===b.wrap?0:1,b.last_flush=J,F._tr_init(b),O):d(a,Q)}function w(a){var b=v(a);return b===O&&t(a.state),b}function x(a,b){return a&&a.state?2!==a.state.wrap?Q:(a.state.gzhead=b,O):Q}function y(a,b,c,e,f,g){if(!a)return Q;var h=1;if(b===T&&(b=6),e<0?(h=0,e=-e):e>15&&(h=2,e-=16),f<1||f>_||c!==$||e<8||e>15||b<0||b>9||g<0||g>X)return d(a,Q);8===e&&(e=9);var i=new u;return a.state=i,i.strm=a,i.wrap=h,i.gzhead=null,i.w_bits=e,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=f+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+ja-1)/ja),i.window=new E.Buf8(2*i.w_size),i.head=new E.Buf16(i.hash_size),i.prev=new E.Buf16(i.w_size),i.lit_bufsize=1<<f+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new E.Buf8(i.pending_buf_size),i.d_buf=1*i.lit_bufsize,i.l_buf=3*i.lit_bufsize,i.level=b,i.strategy=g,i.method=c,w(a)}function z(a,b){return y(a,b,$,aa,ba,Y)}function A(a,b){var c,h,k,l;if(!a||!a.state||b>N||b<0)return a?d(a,Q):Q;if(h=a.state,!a.output||!a.input&&0!==a.avail_in||h.status===ta&&b!==M)return d(a,0===a.avail_out?S:Q);if(h.strm=a,c=h.last_flush,h.last_flush=b,h.status===na)if(2===h.wrap)a.adler=0,i(h,31),i(h,139),i(h,8),h.gzhead?(i(h,(h.gzhead.text?1:0)+(h.gzhead.hcrc?2:0)+(h.gzhead.extra?4:0)+(h.gzhead.name?8:0)+(h.gzhead.comment?16:0)),i(h,255&h.gzhead.time),i(h,h.gzhead.time>>8&255),i(h,h.gzhead.time>>16&255),i(h,h.gzhead.time>>24&255),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,255&h.gzhead.os),h.gzhead.extra&&h.gzhead.extra.length&&(i(h,255&h.gzhead.extra.length),i(h,h.gzhead.extra.length>>8&255)),h.gzhead.hcrc&&(a.adler=H(a.adler,h.pending_buf,h.pending,0)),h.gzindex=0,h.status=oa):(i(h,0),i(h,0),i(h,0),i(h,0),i(h,0),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,ya),h.status=sa);else{var m=$+(h.w_bits-8<<4)<<8,n=-1;n=h.strategy>=V||h.level<2?0:h.level<6?1:6===h.level?2:3,m|=n<<6,0!==h.strstart&&(m|=ma),m+=31-m%31,h.status=sa,j(h,m),0!==h.strstart&&(j(h,a.adler>>>16),j(h,65535&a.adler)),a.adler=1}if(h.status===oa)if(h.gzhead.extra){for(k=h.pending;h.gzindex<(65535&h.gzhead.extra.length)&&(h.pending!==h.pending_buf_size||(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending!==h.pending_buf_size));)i(h,255&h.gzhead.extra[h.gzindex]),h.gzindex++;h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),h.gzindex===h.gzhead.extra.length&&(h.gzindex=0,h.status=pa)}else h.status=pa;if(h.status===pa)if(h.gzhead.name){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.name.length?255&h.gzhead.name.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.gzindex=0,h.status=qa)}else h.status=qa;if(h.status===qa)if(h.gzhead.comment){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.comment.length?255&h.gzhead.comment.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.status=ra)}else h.status=ra;if(h.status===ra&&(h.gzhead.hcrc?(h.pending+2>h.pending_buf_size&&g(a),h.pending+2<=h.pending_buf_size&&(i(h,255&a.adler),i(h,a.adler>>8&255),a.adler=0,h.status=sa)):h.status=sa),0!==h.pending){if(g(a),0===a.avail_out)return h.last_flush=-1,O}else if(0===a.avail_in&&e(b)<=e(c)&&b!==M)return d(a,S);if(h.status===ta&&0!==a.avail_in)return d(a,S);if(0!==a.avail_in||0!==h.lookahead||b!==J&&h.status!==ta){var o=h.strategy===V?r(h,b):h.strategy===W?q(h,b):D[h.level].func(h,b);if(o!==wa&&o!==xa||(h.status=ta),o===ua||o===wa)return 0===a.avail_out&&(h.last_flush=-1),O;if(o===va&&(b===K?F._tr_align(h):b!==N&&(F._tr_stored_block(h,0,0,!1),b===L&&(f(h.head),0===h.lookahead&&(h.strstart=0,h.block_start=0,h.insert=0))),g(a),0===a.avail_out))return h.last_flush=-1,O}return b!==M?O:h.wrap<=0?P:(2===h.wrap?(i(h,255&a.adler),i(h,a.adler>>8&255),i(h,a.adler>>16&255),i(h,a.adler>>24&255),i(h,255&a.total_in),i(h,a.total_in>>8&255),i(h,a.total_in>>16&255),i(h,a.total_in>>24&255)):(j(h,a.adler>>>16),j(h,65535&a.adler)),g(a),h.wrap>0&&(h.wrap=-h.wrap),0!==h.pending?O:P)}function B(a){var b;return a&&a.state?(b=a.state.status,b!==na&&b!==oa&&b!==pa&&b!==qa&&b!==ra&&b!==sa&&b!==ta?d(a,Q):(a.state=null,b===sa?d(a,R):O)):Q}function C(a,b){var c,d,e,g,h,i,j,k,l=b.length;if(!a||!a.state)return Q;if(c=a.state,g=c.wrap,2===g||1===g&&c.status!==na||c.lookahead)return Q;for(1===g&&(a.adler=G(a.adler,b,l,0)),c.wrap=0,l>=c.w_size&&(0===g&&(f(c.head),c.strstart=0,c.block_start=0,c.insert=0),k=new E.Buf8(c.w_size),E.arraySet(k,b,l-c.w_size,c.w_size,0),b=k,l=c.w_size),h=a.avail_in,i=a.next_in,j=a.input,a.avail_in=l,a.next_in=0,a.input=b,m(c);c.lookahead>=ja;){d=c.strstart,e=c.lookahead-(ja-1);do c.ins_h=(c.ins_h<<c.hash_shift^c.window[d+ja-1])&c.hash_mask,c.prev[d&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=d,d++;while(--e);c.strstart=d,c.lookahead=ja-1,m(c)}return c.strstart+=c.lookahead,c.block_start=c.strstart,c.insert=c.lookahead,c.lookahead=0,c.match_length=c.prev_length=ja-1,c.match_available=0,a.next_in=i,a.input=j,a.avail_in=h,c.wrap=g,O}var D,E=a("../utils/common"),F=a("./trees"),G=a("./adler32"),H=a("./crc32"),I=a("./messages"),J=0,K=1,L=3,M=4,N=5,O=0,P=1,Q=-2,R=-3,S=-5,T=-1,U=1,V=2,W=3,X=4,Y=0,Z=2,$=8,_=9,aa=15,ba=8,ca=29,da=256,ea=da+1+ca,fa=30,ga=19,ha=2*ea+1,ia=15,ja=3,ka=258,la=ka+ja+1,ma=32,na=42,oa=69,pa=73,qa=91,ra=103,sa=113,ta=666,ua=1,va=2,wa=3,xa=4,ya=3;D=[new s(0,0,0,0,n),new s(4,4,8,4,o),new s(4,5,16,8,o),new s(4,6,32,32,o),new s(4,4,16,16,p),new s(8,16,32,32,p),new s(8,16,128,128,p),new s(8,32,128,256,p),new s(32,128,258,1024,p),new s(32,258,258,4096,p)],c.deflateInit=z,c.deflateInit2=y,c.deflateReset=w,c.deflateResetKeep=v,c.deflateSetHeader=x,c.deflate=A,c.deflateEnd=B,c.deflateSetDictionary=C,c.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./messages":72,"./trees":73}],68:[function(a,b,c){"use strict";function d(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}b.exports=d},{}],69:[function(a,b,c){"use strict";var d=30,e=12;b.exports=function(a,b){var c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;c=a.state,f=a.next_in,B=a.input,g=f+(a.avail_in-5),h=a.next_out,C=a.output,i=h-(b-a.avail_out),j=h+(a.avail_out-257),k=c.dmax,l=c.wsize,m=c.whave,n=c.wnext,o=c.window,p=c.hold,q=c.bits,r=c.lencode,s=c.distcode,t=(1<<c.lenbits)-1,u=(1<<c.distbits)-1;a:do{q<15&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=r[p&t];b:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,0===w)C[h++]=65535&v;else{if(!(16&w)){if(0===(64&w)){v=r[(65535&v)+(p&(1<<w)-1)];continue b}if(32&w){c.mode=e;break a}a.msg="invalid literal/length code",c.mode=d;break a}x=65535&v,w&=15,w&&(q<w&&(p+=B[f++]<<q,q+=8),x+=p&(1<<w)-1,p>>>=w,q-=w),q<15&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=s[p&u];c:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,!(16&w)){if(0===(64&w)){v=s[(65535&v)+(p&(1<<w)-1)];continue c}a.msg="invalid distance code",c.mode=d;break a}if(y=65535&v,w&=15,q<w&&(p+=B[f++]<<q,q+=8,q<w&&(p+=B[f++]<<q,q+=8)),y+=p&(1<<w)-1,y>k){a.msg="invalid distance too far back",c.mode=d;break a}if(p>>>=w,q-=w,w=h-i,y>w){if(w=y-w,w>m&&c.sane){a.msg="invalid distance too far back",c.mode=d;break a}if(z=0,A=o,0===n){if(z+=l-w,w<x){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}else if(n<w){if(z+=l+n-w,w-=n,w<x){x-=w;do C[h++]=o[z++];while(--w);if(z=0,n<x){w=n,x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}}else if(z+=n-w,w<x){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}for(;x>2;)C[h++]=A[z++],C[h++]=A[z++],C[h++]=A[z++],x-=3;x&&(C[h++]=A[z++],x>1&&(C[h++]=A[z++]))}else{z=h-y;do C[h++]=C[z++],C[h++]=C[z++],C[h++]=C[z++],x-=3;while(x>2);x&&(C[h++]=C[z++],x>1&&(C[h++]=C[z++]))}break}}break}}while(f<g&&h<j);x=q>>3,f-=x,q-=x<<3,p&=(1<<q)-1,a.next_in=f,a.next_out=h,a.avail_in=f<g?5+(g-f):5-(f-g),a.avail_out=h<j?257+(j-h):257-(h-j),c.hold=p,c.bits=q}},{}],70:[function(a,b,c){"use strict";function d(a){return(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24)}function e(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(a){var b;return a&&a.state?(b=a.state,a.total_in=a.total_out=b.total=0,a.msg="",b.wrap&&(a.adler=1&b.wrap),b.mode=L,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new s.Buf32(pa),b.distcode=b.distdyn=new s.Buf32(qa),b.sane=1,b.back=-1,D):G}function g(a){var b;return a&&a.state?(b=a.state,b.wsize=0,b.whave=0,b.wnext=0,f(a)):G}function h(a,b){var c,d;return a&&a.state?(d=a.state,b<0?(c=0,b=-b):(c=(b>>4)+1,b<48&&(b&=15)),b&&(b<8||b>15)?G:(null!==d.window&&d.wbits!==b&&(d.window=null),d.wrap=c,d.wbits=b,g(a))):G}function i(a,b){var c,d;return a?(d=new e,a.state=d,d.window=null,c=h(a,b),c!==D&&(a.state=null),c):G}function j(a){return i(a,sa)}function k(a){if(ta){var b;for(q=new s.Buf32(512),r=new s.Buf32(32),b=0;b<144;)a.lens[b++]=8;for(;b<256;)a.lens[b++]=9;for(;b<280;)a.lens[b++]=7;for(;b<288;)a.lens[b++]=8;for(w(y,a.lens,0,288,q,0,a.work,{bits:9}),b=0;b<32;)a.lens[b++]=5;w(z,a.lens,0,32,r,0,a.work,{bits:5}),ta=!1}a.lencode=q,a.lenbits=9,a.distcode=r,a.distbits=5}function l(a,b,c,d){var e,f=a.state;return null===f.window&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new s.Buf8(f.wsize)),d>=f.wsize?(s.arraySet(f.window,b,c-f.wsize,f.wsize,0),f.wnext=0,f.whave=f.wsize):(e=f.wsize-f.wnext,e>d&&(e=d),s.arraySet(f.window,b,c-d,e,f.wnext),d-=e,d?(s.arraySet(f.window,b,c-d,d,0),f.wnext=d,f.whave=f.wsize):(f.wnext+=e,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=e))),0}function m(a,b){var c,e,f,g,h,i,j,m,n,o,p,q,r,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa=0,Ba=new s.Buf8(4),Ca=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return G;c=a.state,c.mode===W&&(c.mode=X),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,o=i,p=j,xa=D;a:for(;;)switch(c.mode){case L:if(0===c.wrap){c.mode=X;break}for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(2&c.wrap&&35615===m){c.check=0,Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0),m=0,n=0,c.mode=M;break}if(c.flags=0,c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&m)<<8)+(m>>8))%31){a.msg="incorrect header check",c.mode=ma;break}if((15&m)!==K){a.msg="unknown compression method",c.mode=ma;break}if(m>>>=4,n-=4,wa=(15&m)+8,0===c.wbits)c.wbits=wa;else if(wa>c.wbits){a.msg="invalid window size",c.mode=ma;break}c.dmax=1<<wa,a.adler=c.check=1,c.mode=512&m?U:W,m=0,n=0;break;case M:for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.flags=m,(255&c.flags)!==K){a.msg="unknown compression method",c.mode=ma;break}if(57344&c.flags){a.msg="unknown header flags set",c.mode=ma;break}c.head&&(c.head.text=m>>8&1),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=N;case N:for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.time=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,Ba[2]=m>>>16&255,Ba[3]=m>>>24&255,c.check=u(c.check,Ba,4,0)),m=0,n=0,c.mode=O;case O:for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.xflags=255&m,c.head.os=m>>8),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=P;case P:if(1024&c.flags){for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length=m,c.head&&(c.head.extra_len=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0}else c.head&&(c.head.extra=null);c.mode=Q;case Q:if(1024&c.flags&&(q=c.length,q>i&&(q=i),q&&(c.head&&(wa=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Array(c.head.extra_len)),s.arraySet(c.head.extra,e,g,q,wa)),512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,c.length-=q),c.length))break a;c.length=0,c.mode=R;case R:if(2048&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.name+=String.fromCharCode(wa));while(wa&&q<i);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.name=null);c.length=0,c.mode=S;case S:if(4096&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.comment+=String.fromCharCode(wa));while(wa&&q<i);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.comment=null);c.mode=T;case T:if(512&c.flags){for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(65535&c.check)){a.msg="header crc mismatch",c.mode=ma;break}m=0,n=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),a.adler=c.check=0,c.mode=W;break;case U:for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}a.adler=c.check=d(m),m=0,n=0,c.mode=V;case V:if(0===c.havedict)return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,F;a.adler=c.check=1,c.mode=W;case W:if(b===B||b===C)break a;case X:if(c.last){m>>>=7&n,n-=7&n,c.mode=ja;break}for(;n<3;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}switch(c.last=1&m,m>>>=1,n-=1,3&m){case 0:c.mode=Y;break;case 1:if(k(c),c.mode=ca,b===C){m>>>=2,n-=2;break a}break;case 2:c.mode=_;break;case 3:a.msg="invalid block type",c.mode=ma}m>>>=2,n-=2;break;case Y:for(m>>>=7&n,n-=7&n;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if((65535&m)!==(m>>>16^65535)){a.msg="invalid stored block lengths",c.mode=ma;break}if(c.length=65535&m,m=0,n=0,c.mode=Z,b===C)break a;case Z:c.mode=$;case $:if(q=c.length){if(q>i&&(q=i),q>j&&(q=j),0===q)break a;s.arraySet(f,e,g,q,h),i-=q,g+=q,j-=q,h+=q,c.length-=q;break}c.mode=W;break;case _:for(;n<14;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.nlen=(31&m)+257,m>>>=5,n-=5,c.ndist=(31&m)+1,m>>>=5,n-=5,c.ncode=(15&m)+4,m>>>=4,n-=4,c.nlen>286||c.ndist>30){a.msg="too many length or distance symbols",c.mode=ma;break}c.have=0,c.mode=aa;case aa:for(;c.have<c.ncode;){for(;n<3;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.lens[Ca[c.have++]]=7&m,m>>>=3,n-=3}for(;c.have<19;)c.lens[Ca[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,ya={bits:c.lenbits},xa=w(x,c.lens,0,19,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid code lengths set",c.mode=ma;break}c.have=0,c.mode=ba;case ba:for(;c.have<c.nlen+c.ndist;){for(;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(sa<16)m>>>=qa,n-=qa,c.lens[c.have++]=sa;else{if(16===sa){for(za=qa+2;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m>>>=qa,n-=qa,0===c.have){a.msg="invalid bit length repeat",c.mode=ma;break}wa=c.lens[c.have-1],q=3+(3&m),m>>>=2,n-=2}else if(17===sa){for(za=qa+3;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=3+(7&m),m>>>=3,n-=3}else{for(za=qa+7;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=11+(127&m),m>>>=7,n-=7}if(c.have+q>c.nlen+c.ndist){a.msg="invalid bit length repeat",c.mode=ma;break}for(;q--;)c.lens[c.have++]=wa}}if(c.mode===ma)break;if(0===c.lens[256]){a.msg="invalid code -- missing end-of-block",c.mode=ma;break}if(c.lenbits=9,ya={bits:c.lenbits},xa=w(y,c.lens,0,c.nlen,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid literal/lengths set",c.mode=ma;break}if(c.distbits=6,c.distcode=c.distdyn,ya={bits:c.distbits},xa=w(z,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,ya),c.distbits=ya.bits,xa){a.msg="invalid distances set",c.mode=ma;break}if(c.mode=ca,b===C)break a;case ca:c.mode=da;case da:if(i>=6&&j>=258){a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,v(a,p),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,c.mode===W&&(c.back=-1);break}for(c.back=0;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(ra&&0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.lencode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(ta+qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,c.length=sa,0===ra){c.mode=ia;break}if(32&ra){c.back=-1,c.mode=W;break}if(64&ra){a.msg="invalid literal/length code",c.mode=ma;break}c.extra=15&ra,c.mode=ea;case ea:if(c.extra){for(za=c.extra;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=fa;case fa:for(;Aa=c.distcode[m&(1<<c.distbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.distcode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(ta+qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,64&ra){a.msg="invalid distance code",c.mode=ma;break}c.offset=sa,c.extra=15&ra,c.mode=ga;case ga:if(c.extra){for(za=c.extra;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.offset+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){a.msg="invalid distance too far back",c.mode=ma;break}c.mode=ha;case ha:if(0===j)break a;if(q=p-j,c.offset>q){if(q=c.offset-q,q>c.whave&&c.sane){a.msg="invalid distance too far back",c.mode=ma;break}q>c.wnext?(q-=c.wnext,r=c.wsize-q):r=c.wnext-q,q>c.length&&(q=c.length),pa=c.window}else pa=f,r=h-c.offset,q=c.length;q>j&&(q=j),j-=q,c.length-=q;do f[h++]=pa[r++];while(--q);0===c.length&&(c.mode=da);break;case ia:if(0===j)break a;f[h++]=c.length,j--,c.mode=da;break;case ja:if(c.wrap){for(;n<32;){if(0===i)break a;i--,m|=e[g++]<<n,n+=8}if(p-=j,a.total_out+=p,c.total+=p,p&&(a.adler=c.check=c.flags?u(c.check,f,p,h-p):t(c.check,f,p,h-p)),p=j,(c.flags?m:d(m))!==c.check){a.msg="incorrect data check",c.mode=ma;break}m=0,n=0}c.mode=ka;case ka:if(c.wrap&&c.flags){for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(4294967295&c.total)){a.msg="incorrect length check",c.mode=ma;break}m=0,n=0}c.mode=la;case la:xa=E;break a;case ma:xa=H;break a;case na:return I;case oa:default:return G}return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,(c.wsize||p!==a.avail_out&&c.mode<ma&&(c.mode<ja||b!==A))&&l(a,a.output,a.next_out,p-a.avail_out)?(c.mode=na,I):(o-=a.avail_in,p-=a.avail_out,a.total_in+=o,a.total_out+=p,c.total+=p,c.wrap&&p&&(a.adler=c.check=c.flags?u(c.check,f,p,a.next_out-p):t(c.check,f,p,a.next_out-p)),a.data_type=c.bits+(c.last?64:0)+(c.mode===W?128:0)+(c.mode===ca||c.mode===Z?256:0),(0===o&&0===p||b===A)&&xa===D&&(xa=J),xa)}function n(a){if(!a||!a.state)return G;var b=a.state;return b.window&&(b.window=null),a.state=null,D}function o(a,b){var c;return a&&a.state?(c=a.state,0===(2&c.wrap)?G:(c.head=b,b.done=!1,D)):G}function p(a,b){var c,d,e,f=b.length;return a&&a.state?(c=a.state,0!==c.wrap&&c.mode!==V?G:c.mode===V&&(d=1,d=t(d,b,f,0),d!==c.check)?H:(e=l(a,b,f,f))?(c.mode=na,I):(c.havedict=1,D)):G}var q,r,s=a("../utils/common"),t=a("./adler32"),u=a("./crc32"),v=a("./inffast"),w=a("./inftrees"),x=0,y=1,z=2,A=4,B=5,C=6,D=0,E=1,F=2,G=-2,H=-3,I=-4,J=-5,K=8,L=1,M=2,N=3,O=4,P=5,Q=6,R=7,S=8,T=9,U=10,V=11,W=12,X=13,Y=14,Z=15,$=16,_=17,aa=18,ba=19,ca=20,da=21,ea=22,fa=23,ga=24,ha=25,ia=26,ja=27,ka=28,la=29,ma=30,na=31,oa=32,pa=852,qa=592,ra=15,sa=ra,ta=!0;c.inflateReset=g,c.inflateReset2=h,c.inflateResetKeep=f,c.inflateInit=j,c.inflateInit2=i,c.inflate=m,c.inflateEnd=n,c.inflateGetHeader=o,c.inflateSetDictionary=p,c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./inffast":69,"./inftrees":71}],71:[function(a,b,c){"use strict";var d=a("../utils/common"),e=15,f=852,g=592,h=0,i=1,j=2,k=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],m=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],n=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];b.exports=function(a,b,c,o,p,q,r,s){var t,u,v,w,x,y,z,A,B,C=s.bits,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=null,O=0,P=new d.Buf16(e+1),Q=new d.Buf16(e+1),R=null,S=0;for(D=0;D<=e;D++)P[D]=0;for(E=0;E<o;E++)P[b[c+E]]++;for(H=C,G=e;G>=1&&0===P[G];G--);if(H>G&&(H=G),0===G)return p[q++]=20971520,p[q++]=20971520,s.bits=1,0;for(F=1;F<G&&0===P[F];F++);for(H<F&&(H=F),K=1,D=1;D<=e;D++)if(K<<=1,K-=P[D],K<0)return-1;if(K>0&&(a===h||1!==G))return-1;for(Q[1]=0,D=1;D<e;D++)Q[D+1]=Q[D]+P[D];for(E=0;E<o;E++)0!==b[c+E]&&(r[Q[b[c+E]]++]=E);if(a===h?(N=R=r,y=19):a===i?(N=k,O-=257,R=l,S-=257,y=256):(N=m,R=n,y=-1),M=0,E=0,D=F,x=q,I=H,J=0,v=-1,L=1<<H,w=L-1,a===i&&L>f||a===j&&L>g)return 1;for(;;){z=D-J,r[E]<y?(A=0,B=r[E]):r[E]>y?(A=R[S+r[E]],B=N[O+r[E]]):(A=96,B=0),t=1<<D-J,u=1<<I,F=u;do u-=t,p[x+(M>>J)+u]=z<<24|A<<16|B|0;while(0!==u);for(t=1<<D-1;M&t;)t>>=1;if(0!==t?(M&=t-1,M+=t):M=0,E++,0===--P[D]){if(D===G)break;D=b[c+r[E]]}if(D>H&&(M&w)!==v){for(0===J&&(J=H),x+=F,I=D-J,K=1<<I;I+J<G&&(K-=P[I+J],!(K<=0));)I++,K<<=1;if(L+=1<<I,a===i&&L>f||a===j&&L>g)return 1;v=M&w,p[v]=H<<24|I<<16|x-q|0}}return 0!==M&&(p[x+M]=D-J<<24|64<<16|0),s.bits=H,0}},{"../utils/common":62}],72:[function(a,b,c){"use strict";b.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],73:[function(a,b,c){"use strict";function d(a){for(var b=a.length;--b>=0;)a[b]=0}function e(a,b,c,d,e){this.static_tree=a,this.extra_bits=b,this.extra_base=c,this.elems=d,this.max_length=e,this.has_stree=a&&a.length}function f(a,b){this.dyn_tree=a,this.max_code=0,this.stat_desc=b}function g(a){return a<256?ia[a]:ia[256+(a>>>7)]}function h(a,b){a.pending_buf[a.pending++]=255&b,a.pending_buf[a.pending++]=b>>>8&255}function i(a,b,c){a.bi_valid>X-c?(a.bi_buf|=b<<a.bi_valid&65535,h(a,a.bi_buf),a.bi_buf=b>>X-a.bi_valid,a.bi_valid+=c-X):(a.bi_buf|=b<<a.bi_valid&65535,a.bi_valid+=c)}function j(a,b,c){i(a,c[2*b],c[2*b+1])}function k(a,b){var c=0;do c|=1&a,a>>>=1,c<<=1;while(--b>0);return c>>>1}function l(a){16===a.bi_valid?(h(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)}function m(a,b){var c,d,e,f,g,h,i=b.dyn_tree,j=b.max_code,k=b.stat_desc.static_tree,l=b.stat_desc.has_stree,m=b.stat_desc.extra_bits,n=b.stat_desc.extra_base,o=b.stat_desc.max_length,p=0;for(f=0;f<=W;f++)a.bl_count[f]=0;for(i[2*a.heap[a.heap_max]+1]=0,
c=a.heap_max+1;c<V;c++)d=a.heap[c],f=i[2*i[2*d+1]+1]+1,f>o&&(f=o,p++),i[2*d+1]=f,d>j||(a.bl_count[f]++,g=0,d>=n&&(g=m[d-n]),h=i[2*d],a.opt_len+=h*(f+g),l&&(a.static_len+=h*(k[2*d+1]+g)));if(0!==p){do{for(f=o-1;0===a.bl_count[f];)f--;a.bl_count[f]--,a.bl_count[f+1]+=2,a.bl_count[o]--,p-=2}while(p>0);for(f=o;0!==f;f--)for(d=a.bl_count[f];0!==d;)e=a.heap[--c],e>j||(i[2*e+1]!==f&&(a.opt_len+=(f-i[2*e+1])*i[2*e],i[2*e+1]=f),d--)}}function n(a,b,c){var d,e,f=new Array(W+1),g=0;for(d=1;d<=W;d++)f[d]=g=g+c[d-1]<<1;for(e=0;e<=b;e++){var h=a[2*e+1];0!==h&&(a[2*e]=k(f[h]++,h))}}function o(){var a,b,c,d,f,g=new Array(W+1);for(c=0,d=0;d<Q-1;d++)for(ka[d]=c,a=0;a<1<<ba[d];a++)ja[c++]=d;for(ja[c-1]=d,f=0,d=0;d<16;d++)for(la[d]=f,a=0;a<1<<ca[d];a++)ia[f++]=d;for(f>>=7;d<T;d++)for(la[d]=f<<7,a=0;a<1<<ca[d]-7;a++)ia[256+f++]=d;for(b=0;b<=W;b++)g[b]=0;for(a=0;a<=143;)ga[2*a+1]=8,a++,g[8]++;for(;a<=255;)ga[2*a+1]=9,a++,g[9]++;for(;a<=279;)ga[2*a+1]=7,a++,g[7]++;for(;a<=287;)ga[2*a+1]=8,a++,g[8]++;for(n(ga,S+1,g),a=0;a<T;a++)ha[2*a+1]=5,ha[2*a]=k(a,5);ma=new e(ga,ba,R+1,S,W),na=new e(ha,ca,0,T,W),oa=new e(new Array(0),da,0,U,Y)}function p(a){var b;for(b=0;b<S;b++)a.dyn_ltree[2*b]=0;for(b=0;b<T;b++)a.dyn_dtree[2*b]=0;for(b=0;b<U;b++)a.bl_tree[2*b]=0;a.dyn_ltree[2*Z]=1,a.opt_len=a.static_len=0,a.last_lit=a.matches=0}function q(a){a.bi_valid>8?h(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf),a.bi_buf=0,a.bi_valid=0}function r(a,b,c,d){q(a),d&&(h(a,c),h(a,~c)),G.arraySet(a.pending_buf,a.window,b,c,a.pending),a.pending+=c}function s(a,b,c,d){var e=2*b,f=2*c;return a[e]<a[f]||a[e]===a[f]&&d[b]<=d[c]}function t(a,b,c){for(var d=a.heap[c],e=c<<1;e<=a.heap_len&&(e<a.heap_len&&s(b,a.heap[e+1],a.heap[e],a.depth)&&e++,!s(b,d,a.heap[e],a.depth));)a.heap[c]=a.heap[e],c=e,e<<=1;a.heap[c]=d}function u(a,b,c){var d,e,f,h,k=0;if(0!==a.last_lit)do d=a.pending_buf[a.d_buf+2*k]<<8|a.pending_buf[a.d_buf+2*k+1],e=a.pending_buf[a.l_buf+k],k++,0===d?j(a,e,b):(f=ja[e],j(a,f+R+1,b),h=ba[f],0!==h&&(e-=ka[f],i(a,e,h)),d--,f=g(d),j(a,f,c),h=ca[f],0!==h&&(d-=la[f],i(a,d,h)));while(k<a.last_lit);j(a,Z,b)}function v(a,b){var c,d,e,f=b.dyn_tree,g=b.stat_desc.static_tree,h=b.stat_desc.has_stree,i=b.stat_desc.elems,j=-1;for(a.heap_len=0,a.heap_max=V,c=0;c<i;c++)0!==f[2*c]?(a.heap[++a.heap_len]=j=c,a.depth[c]=0):f[2*c+1]=0;for(;a.heap_len<2;)e=a.heap[++a.heap_len]=j<2?++j:0,f[2*e]=1,a.depth[e]=0,a.opt_len--,h&&(a.static_len-=g[2*e+1]);for(b.max_code=j,c=a.heap_len>>1;c>=1;c--)t(a,f,c);e=i;do c=a.heap[1],a.heap[1]=a.heap[a.heap_len--],t(a,f,1),d=a.heap[1],a.heap[--a.heap_max]=c,a.heap[--a.heap_max]=d,f[2*e]=f[2*c]+f[2*d],a.depth[e]=(a.depth[c]>=a.depth[d]?a.depth[c]:a.depth[d])+1,f[2*c+1]=f[2*d+1]=e,a.heap[1]=e++,t(a,f,1);while(a.heap_len>=2);a.heap[--a.heap_max]=a.heap[1],m(a,b),n(f,j,a.bl_count)}function w(a,b,c){var d,e,f=-1,g=b[1],h=0,i=7,j=4;for(0===g&&(i=138,j=3),b[2*(c+1)+1]=65535,d=0;d<=c;d++)e=g,g=b[2*(d+1)+1],++h<i&&e===g||(h<j?a.bl_tree[2*e]+=h:0!==e?(e!==f&&a.bl_tree[2*e]++,a.bl_tree[2*$]++):h<=10?a.bl_tree[2*_]++:a.bl_tree[2*aa]++,h=0,f=e,0===g?(i=138,j=3):e===g?(i=6,j=3):(i=7,j=4))}function x(a,b,c){var d,e,f=-1,g=b[1],h=0,k=7,l=4;for(0===g&&(k=138,l=3),d=0;d<=c;d++)if(e=g,g=b[2*(d+1)+1],!(++h<k&&e===g)){if(h<l){do j(a,e,a.bl_tree);while(0!==--h)}else 0!==e?(e!==f&&(j(a,e,a.bl_tree),h--),j(a,$,a.bl_tree),i(a,h-3,2)):h<=10?(j(a,_,a.bl_tree),i(a,h-3,3)):(j(a,aa,a.bl_tree),i(a,h-11,7));h=0,f=e,0===g?(k=138,l=3):e===g?(k=6,l=3):(k=7,l=4)}}function y(a){var b;for(w(a,a.dyn_ltree,a.l_desc.max_code),w(a,a.dyn_dtree,a.d_desc.max_code),v(a,a.bl_desc),b=U-1;b>=3&&0===a.bl_tree[2*ea[b]+1];b--);return a.opt_len+=3*(b+1)+5+5+4,b}function z(a,b,c,d){var e;for(i(a,b-257,5),i(a,c-1,5),i(a,d-4,4),e=0;e<d;e++)i(a,a.bl_tree[2*ea[e]+1],3);x(a,a.dyn_ltree,b-1),x(a,a.dyn_dtree,c-1)}function A(a){var b,c=4093624447;for(b=0;b<=31;b++,c>>>=1)if(1&c&&0!==a.dyn_ltree[2*b])return I;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return J;for(b=32;b<R;b++)if(0!==a.dyn_ltree[2*b])return J;return I}function B(a){pa||(o(),pa=!0),a.l_desc=new f(a.dyn_ltree,ma),a.d_desc=new f(a.dyn_dtree,na),a.bl_desc=new f(a.bl_tree,oa),a.bi_buf=0,a.bi_valid=0,p(a)}function C(a,b,c,d){i(a,(L<<1)+(d?1:0),3),r(a,b,c,!0)}function D(a){i(a,M<<1,3),j(a,Z,ga),l(a)}function E(a,b,c,d){var e,f,g=0;a.level>0?(a.strm.data_type===K&&(a.strm.data_type=A(a)),v(a,a.l_desc),v(a,a.d_desc),g=y(a),e=a.opt_len+3+7>>>3,f=a.static_len+3+7>>>3,f<=e&&(e=f)):e=f=c+5,c+4<=e&&b!==-1?C(a,b,c,d):a.strategy===H||f===e?(i(a,(M<<1)+(d?1:0),3),u(a,ga,ha)):(i(a,(N<<1)+(d?1:0),3),z(a,a.l_desc.max_code+1,a.d_desc.max_code+1,g+1),u(a,a.dyn_ltree,a.dyn_dtree)),p(a),d&&q(a)}function F(a,b,c){return a.pending_buf[a.d_buf+2*a.last_lit]=b>>>8&255,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&b,a.pending_buf[a.l_buf+a.last_lit]=255&c,a.last_lit++,0===b?a.dyn_ltree[2*c]++:(a.matches++,b--,a.dyn_ltree[2*(ja[c]+R+1)]++,a.dyn_dtree[2*g(b)]++),a.last_lit===a.lit_bufsize-1}var G=a("../utils/common"),H=4,I=0,J=1,K=2,L=0,M=1,N=2,O=3,P=258,Q=29,R=256,S=R+1+Q,T=30,U=19,V=2*S+1,W=15,X=16,Y=7,Z=256,$=16,_=17,aa=18,ba=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ca=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],da=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ea=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],fa=512,ga=new Array(2*(S+2));d(ga);var ha=new Array(2*T);d(ha);var ia=new Array(fa);d(ia);var ja=new Array(P-O+1);d(ja);var ka=new Array(Q);d(ka);var la=new Array(T);d(la);var ma,na,oa,pa=!1;c._tr_init=B,c._tr_stored_block=C,c._tr_flush_block=E,c._tr_tally=F,c._tr_align=D},{"../utils/common":62}],74:[function(a,b,c){"use strict";function d(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}b.exports=d},{}]},{},[10])(10)});
/*!

JSZipUtils - A collection of cross-browser utilities to go along with JSZip.
<http://stuk.github.io/jszip-utils>

(c) 2014 Stuart Knightley, David Duponchel
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip-utils/master/LICENSE.markdown.

*/
!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.JSZipUtils=a():"undefined"!=typeof global?global.JSZipUtils=a():"undefined"!=typeof self&&(self.JSZipUtils=a())}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";function c(){try{return new window.XMLHttpRequest}catch(a){}}function d(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}}var e={};e._getBinaryFromXHR=function(a){return a.response||a.responseText};var f=window.ActiveXObject?function(){return c()||d()}:c;e.getBinaryContent=function(a,b){try{var c=f();c.open("GET",a,!0),"responseType"in c&&(c.responseType="arraybuffer"),c.overrideMimeType&&c.overrideMimeType("text/plain; charset=x-user-defined"),c.onreadystatechange=function(){var d,f;if(4===c.readyState)if(200===c.status||0===c.status){d=null,f=null;try{d=e._getBinaryFromXHR(c)}catch(g){f=new Error(g)}b(f,d)}else b(new Error("Ajax error for "+a+" : "+this.status+" "+this.statusText),null)},c.send()}catch(d){b(new Error(d),null)}},b.exports=e},{}]},{},[1])(1)});
var _global="object"===typeof window&&window.window===window?window:"object"===typeof self&&self.self===self?self:"object"===typeof global&&global.global===global?global:this;
function bom(a,b){"undefined"===typeof b?b={autoBom:!1}:"object"!==typeof b&&(console.warn("Depricated: Expected third argument to be a object"),b={autoBom:!b});return b.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob([String.fromCharCode(65279),a],{type:a.type}):a}
function download(a,b,e){var c=new XMLHttpRequest;c.open("GET",a);c.responseType="blob";c.onload=function(){saveAs(c.response,b,e)};c.onerror=function(){console.error("could not download file")};c.send()}function corsEnabled(a){var b=new XMLHttpRequest;b.open("HEAD",a,!1);b.send();return 200<=b.status&&299>=b.status}
function click(a){try{a.dispatchEvent(new MouseEvent("click"))}catch(e){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null);a.dispatchEvent(b)}}
var saveAs=_global.saveAs||"object"!==typeof window||window!==_global?function(){}:"download"in HTMLAnchorElement.prototype?function(a,b,e){var c=_global.URL||_global.webkitURL,d=document.createElement("a");b=b||a.name||"download";d.download=b;d.rel="noopener";"string"===typeof a?(d.href=a,d.origin!==location.origin?corsEnabled(d.href)?download(a,b,e):click(d,d.target="_blank"):click(d)):(d.href=c.createObjectURL(a),setTimeout(function(){c.revokeObjectURL(d.href)},4E4),setTimeout(function(){click(d)},
0))}:"msSaveOrOpenBlob"in navigator?function(a,b,e){b=b||a.name||"download";if("string"===typeof a)if(corsEnabled(a))download(a,b,e);else{var c=document.createElement("a");c.href=a;c.target="_blank";setTimeout(function(){click(c)})}else navigator.msSaveOrOpenBlob(bom(a,e),b)}:function(a,b,e,c){if(c=c||open("","_blank"))c.document.title=c.document.body.innerText="downloading...";if("string"===typeof a)return download(a,b,e);b="application/octet-stream"===a.type;e=/constructor/i.test(_global.HTMLElement)||
_global.safari;var d=/CriOS\/[\d]+/.test(navigator.userAgent);if((d||b&&e)&&"object"===typeof FileReader){var f=new FileReader;f.onloadend=function(){var a=f.result;a=d?a:a.replace(/^data:[^;]*;/,"data:attachment/file;");c?c.location.href=a:location=a;c=null};f.readAsDataURL(a)}else{var h=_global.URL||_global.webkitURL,g=h.createObjectURL(a);c?c.location=g:location.href=g;c=null;setTimeout(function(){h.revokeObjectURL(g)},4E4)}};_global.saveAs=saveAs.saveAs=saveAs;
"undefined"!==typeof module&&(module.exports=saveAs);
